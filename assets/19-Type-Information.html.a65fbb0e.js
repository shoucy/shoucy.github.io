import{_ as o,r as c,o as l,c as i,a as s,b as t,w as p,e,d as n}from"./app.205a3d76.js";var u="/assets/image-20190409114913825-4781754.23d75c14.png";const k={},d=e('<p>[TOC]</p><h1 id="\u7B2C\u5341\u4E5D\u7AE0-\u7C7B\u578B\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u5341\u4E5D\u7AE0-\u7C7B\u578B\u4FE1\u606F" aria-hidden="true">#</a> \u7B2C\u5341\u4E5D\u7AE0 \u7C7B\u578B\u4FE1\u606F</h1><blockquote><p>RTTI\uFF08RunTime Type Information\uFF0C\u8FD0\u884C\u65F6\u7C7B\u578B\u4FE1\u606F\uFF09\u80FD\u591F\u5728\u7A0B\u5E8F\u8FD0\u884C\u65F6\u53D1\u73B0\u548C\u4F7F\u7528\u7C7B\u578B\u4FE1\u606F</p></blockquote><p>RTTI \u628A\u6211\u4EEC\u4ECE\u53EA\u80FD\u5728\u7F16\u8BD1\u671F\u8FDB\u884C\u9762\u5411\u7C7B\u578B\u64CD\u4F5C\u7684\u7981\u9522\u4E2D\u89E3\u8131\u4E86\u51FA\u6765\uFF0C\u5E76\u4E14\u8BA9\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u67D0\u4E9B\u975E\u5E38\u5F3A\u5927\u7684\u7A0B\u5E8F\u3002\u5BF9 RTTI \u7684\u9700\u8981\uFF0C\u63ED\u793A\u4E86\u9762\u5411\u5BF9\u8C61\u8BBE\u8BA1\u4E2D\u8BB8\u591A\u6709\u8DA3\uFF08\u5E76\u4E14\u590D\u6742\uFF09\u7684\u7279\u6027\uFF0C\u540C\u65F6\u4E5F\u5E26\u6765\u4E86\u5173\u4E8E\u5982\u4F55\u7EC4\u7EC7\u7A0B\u5E8F\u7684\u57FA\u672C\u95EE\u9898\u3002</p><p>\u672C\u7AE0\u5C06\u8BA8\u8BBA Java \u662F\u5982\u4F55\u5728\u8FD0\u884C\u65F6\u8BC6\u522B\u5BF9\u8C61\u548C\u7C7B\u4FE1\u606F\u7684\u3002\u4E3B\u8981\u6709\u4E24\u79CD\u65B9\u5F0F\uFF1A</p><ol><li>\u201C\u4F20\u7EDF\u7684\u201D RTTI\uFF1A\u5047\u5B9A\u6211\u4EEC\u5728\u7F16\u8BD1\u65F6\u5DF2\u7ECF\u77E5\u9053\u4E86\u6240\u6709\u7684\u7C7B\u578B\uFF1B</li><li>\u201C\u53CD\u5C04\u201D\u673A\u5236\uFF1A\u5141\u8BB8\u6211\u4EEC\u5728\u8FD0\u884C\u65F6\u53D1\u73B0\u548C\u4F7F\u7528\u7C7B\u7684\u4FE1\u606F\u3002</li></ol><h2 id="\u4E3A\u4EC0\u4E48\u9700\u8981-rtti" tabindex="-1"><a class="header-anchor" href="#\u4E3A\u4EC0\u4E48\u9700\u8981-rtti" aria-hidden="true">#</a> \u4E3A\u4EC0\u4E48\u9700\u8981 RTTI</h2><p>\u4E0B\u9762\u770B\u4E00\u4E0B\u6211\u4EEC\u5DF2\u7ECF\u5F88\u719F\u6089\u7684\u4E00\u4E2A\u4F8B\u5B50\uFF0C\u5B83\u4F7F\u7528\u4E86\u591A\u6001\u7684\u7C7B\u5C42\u6B21\u7ED3\u6784\u3002\u57FA\u7C7B <code>Shape</code> \u662F\u6CDB\u5316\u7684\u7C7B\u578B\uFF0C\u4ECE\u5B83\u6D3E\u751F\u51FA\u4E86\u4E09\u4E2A\u5177\u4F53\u7C7B\uFF1A <code>Circle</code> \u3001<code>Square</code> \u548C <code>Triangle</code>\uFF08\u89C1\u4E0B\u56FE\u6240\u793A\uFF09\u3002</p><p><img src="'+u+`" alt="\u591A\u6001\u4F8B\u5B50Shape\u7684\u7C7B\u5C42\u6B21\u7ED3\u6784\u56FE"></p><p>\u8FD9\u662F\u4E00\u4E2A\u5178\u578B\u7684\u7C7B\u5C42\u6B21\u7ED3\u6784\u56FE\uFF0C\u57FA\u7C7B\u4F4D\u4E8E\u9876\u90E8\uFF0C\u6D3E\u751F\u7C7B\u5411\u4E0B\u6269\u5C55\u3002\u9762\u5411\u5BF9\u8C61\u7F16\u7A0B\u7684\u4E00\u4E2A\u57FA\u672C\u76EE\u7684\u662F\uFF1A\u8BA9\u4EE3\u7801\u53EA\u64CD\u7EB5\u5BF9\u57FA\u7C7B(\u8FD9\u91CC\u5373 <code>Shape</code> )\u7684\u5F15\u7528\u3002\u8FD9\u6837\uFF0C\u5982\u679C\u4F60\u60F3\u6DFB\u52A0\u4E00\u4E2A\u65B0\u7C7B(\u6BD4\u5982\u4ECE <code>Shape</code> \u6D3E\u751F\u51FA <code>Rhomboid</code>)\u6765\u6269\u5C55\u7A0B\u5E8F\uFF0C\u5C31\u4E0D\u4F1A\u5F71\u54CD\u539F\u6765\u7684\u4EE3\u7801\u3002\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C<code>Shape</code> \u63A5\u53E3\u4E2D\u52A8\u6001\u7ED1\u5B9A\u4E86 <code>draw()</code> \u65B9\u6CD5\uFF0C\u8FD9\u6837\u505A\u7684\u76EE\u7684\u5C31\u662F\u8BA9\u5BA2\u6237\u7AEF\u7A0B\u5E8F\u5458\u53EF\u4EE5\u4F7F\u7528\u6CDB\u5316\u7684 <code>Shape</code> \u5F15\u7528\u6765\u8C03\u7528 <code>draw()</code>\u3002<code>draw()</code> \u65B9\u6CD5\u5728\u6240\u6709\u6D3E\u751F\u7C7B\u91CC\u90FD\u4F1A\u88AB\u8986\u76D6\uFF0C\u800C\u4E14\u7531\u4E8E\u5B83\u662F\u52A8\u6001\u7ED1\u5B9A\u7684\uFF0C\u6240\u4EE5\u5373\u4F7F\u901A\u8FC7 <code>Shape</code> \u5F15\u7528\u6765\u8C03\u7528\u5B83\uFF0C\u4E5F\u80FD\u4EA7\u751F\u6070\u5F53\u7684\u884C\u4E3A\uFF0C\u8FD9\u5C31\u662F\u591A\u6001\u3002</p><p>\u56E0\u6B64\uFF0C\u6211\u4EEC\u901A\u5E38\u4F1A\u521B\u5EFA\u4E00\u4E2A\u5177\u4F53\u7684\u5BF9\u8C61(<code>Circle</code>\u3001<code>Square</code> \u6216\u8005 <code>Triangle</code>)\uFF0C\u628A\u5B83\u5411\u4E0A\u8F6C\u578B\u6210 <code>Shape</code> (\u5FFD\u7565\u5BF9\u8C61\u7684\u5177\u4F53\u7C7B\u578B)\uFF0C\u5E76\u4E14\u5728\u540E\u9762\u7684\u7A0B\u5E8F\u4E2D\u4F7F\u7528 <code>Shape</code> \u5F15\u7528\u6765\u8C03\u7528\u5728\u5177\u4F53\u5BF9\u8C61\u4E2D\u88AB\u91CD\u8F7D\u7684\u65B9\u6CD5\uFF08\u5982 <code>draw()</code>\uFF09\u3002</p><p>\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/Shapes.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">+</span> <span class="token string">&quot;.draw()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;Circle&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Square</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;Square&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Triangle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;Triangle&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Shapes</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Square</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Triangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Shape</span><span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Circle.draw()
Square.draw()
Triangle.draw()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u57FA\u7C7B\u4E2D\u5305\u542B <code>draw()</code> \u65B9\u6CD5\uFF0C\u5B83\u901A\u8FC7\u4F20\u9012 <code>this</code> \u53C2\u6570\u4F20\u9012\u7ED9 <code>System.out.println()</code>\uFF0C\u95F4\u63A5\u5730\u4F7F\u7528 <code>toString()</code> \u6253\u5370\u7C7B\u6807\u8BC6\u7B26(\u6CE8\u610F\uFF1A\u8FD9\u91CC\u5C06 <code>toString()</code> \u58F0\u660E\u4E3A <code>abstract</code>\uFF0C\u4EE5\u6B64\u5F3A\u5236\u7EE7\u627F\u8005\u8986\u76D6\u8BE5\u65B9\u6CD5\uFF0C\u5E76\u9632\u6B62\u5BF9 <code>Shape</code> \u7684\u5B9E\u4F8B\u5316)\u3002\u5982\u679C\u67D0\u4E2A\u5BF9\u8C61\u51FA\u73B0\u5728\u5B57\u7B26\u4E32\u8868\u8FBE\u5F0F\u4E2D(\u6D89\u53CA&quot;+&quot;\u548C\u5B57\u7B26\u4E32\u5BF9\u8C61\u7684\u8868\u8FBE\u5F0F)\uFF0C<code>toString()</code> \u65B9\u6CD5\u5C31\u4F1A\u88AB\u81EA\u52A8\u8C03\u7528\uFF0C\u4EE5\u751F\u6210\u8868\u793A\u8BE5\u5BF9\u8C61\u7684 <code>String</code>\u3002\u6BCF\u4E2A\u6D3E\u751F\u7C7B\u90FD\u8981\u8986\u76D6\uFF08\u4ECE <code>Object</code> \u7EE7\u627F\u6765\u7684\uFF09<code>toString()</code> \u65B9\u6CD5\uFF0C\u8FD9\u6837 <code>draw()</code> \u5728\u4E0D\u540C\u60C5\u51B5\u4E0B\u5C31\u6253\u5370\u51FA\u4E0D\u540C\u7684\u6D88\u606F(\u591A\u6001)\u3002</p><p>\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u5728\u628A <code>Shape</code> \u5BF9\u8C61\u653E\u5165 <code>Stream&lt;Shape&gt;</code> \u4E2D\u65F6\u5C31\u4F1A\u8FDB\u884C\u5411\u4E0A\u8F6C\u578B(\u9690\u5F0F)\uFF0C\u4F46\u5728\u5411\u4E0A\u8F6C\u578B\u7684\u65F6\u5019\u4E5F\u4E22\u5931\u4E86\u8FD9\u4E9B\u5BF9\u8C61\u7684\u5177\u4F53\u7C7B\u578B\u3002\u5BF9 <code>stream</code> \u800C\u8A00\uFF0C\u5B83\u4EEC\u53EA\u662F <code>Shape</code> \u5BF9\u8C61\u3002</p><p>\u4E25\u683C\u6765\u8BF4\uFF0C<code>Stream&lt;Shape&gt;</code> \u5B9E\u9645\u4E0A\u662F\u628A\u653E\u5165\u5176\u4E2D\u7684\u6240\u6709\u5BF9\u8C61\u90FD\u5F53\u505A <code>Object</code> \u5BF9\u8C61\u6765\u6301\u6709\uFF0C\u53EA\u662F\u53D6\u5143\u7D20\u65F6\u4F1A\u81EA\u52A8\u5C06\u5176\u7C7B\u578B\u8F6C\u4E3A <code>Shape</code>\u3002\u8FD9\u4E5F\u662F RTTI \u6700\u57FA\u672C\u7684\u4F7F\u7528\u5F62\u5F0F\uFF0C\u56E0\u4E3A\u5728 Java \u4E2D\uFF0C\u6240\u6709\u7C7B\u578B\u8F6C\u6362\u7684\u6B63\u786E\u6027\u68C0\u67E5\u90FD\u662F\u5728\u8FD0\u884C\u65F6\u8FDB\u884C\u7684\u3002\u8FD9\u4E5F\u6B63\u662F RTTI \u7684\u542B\u4E49\u6240\u5728\uFF1A\u5728\u8FD0\u884C\u65F6\uFF0C\u8BC6\u522B\u4E00\u4E2A\u5BF9\u8C61\u7684\u7C7B\u578B\u3002</p><p>\u53E6\u5916\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u7C7B\u578B\u8F6C\u6362\u5E76\u4E0D\u5F7B\u5E95\uFF1A<code>Object</code> \u88AB\u8F6C\u578B\u4E3A <code>Shape</code> \uFF0C\u800C\u4E0D\u662F <code>Circle</code>\u3001<code>Square</code> \u6216\u8005 <code>Triangle</code>\u3002\u8FD9\u662F\u56E0\u4E3A\u76EE\u524D\u6211\u4EEC\u53EA\u80FD\u786E\u4FDD\u8FD9\u4E2A <code>Stream&lt;Shape&gt;</code> \u4FDD\u5B58\u7684\u90FD\u662F <code>Shape</code>\uFF1A</p><ul><li>\u7F16\u8BD1\u671F\uFF0C<code>stream</code> \u548C Java \u6CDB\u578B\u7CFB\u7EDF\u786E\u4FDD\u653E\u5165 <code>stream</code> \u7684\u90FD\u662F <code>Shape</code> \u5BF9\u8C61\uFF08<code>Shape</code> \u5B50\u7C7B\u7684\u5BF9\u8C61\u4E5F\u53EF\u89C6\u4E3A <code>Shape</code> \u7684\u5BF9\u8C61\uFF09\uFF0C\u5426\u5219\u7F16\u8BD1\u5668\u4F1A\u62A5\u9519\uFF1B</li><li>\u8FD0\u884C\u65F6\uFF0C\u81EA\u52A8\u7C7B\u578B\u8F6C\u6362\u786E\u4FDD\u4E86\u4ECE <code>stream</code> \u4E2D\u53D6\u51FA\u7684\u5BF9\u8C61\u90FD\u662F <code>Shape</code> \u7C7B\u578B\u3002</li></ul><p>\u63A5\u4E0B\u6765\u5C31\u662F\u591A\u6001\u673A\u5236\u7684\u4E8B\u4E86\uFF0C<code>Shape</code> \u5BF9\u8C61\u5B9E\u9645\u6267\u884C\u4EC0\u4E48\u6837\u7684\u4EE3\u7801\uFF0C\u662F\u7531\u5F15\u7528\u6240\u6307\u5411\u7684\u5177\u4F53\u5BF9\u8C61\uFF08<code>Circle</code>\u3001<code>Square</code> \u6216\u8005 <code>Triangle</code>\uFF09\u51B3\u5B9A\u7684\u3002\u8FD9\u4E5F\u7B26\u5408\u6211\u4EEC\u7F16\u5199\u4EE3\u7801\u7684\u4E00\u822C\u9700\u6C42\uFF0C\u901A\u5E38\uFF0C\u6211\u4EEC\u5E0C\u671B\u5927\u90E8\u5206\u4EE3\u7801\u5C3D\u53EF\u80FD\u5C11\u4E86\u89E3\u5BF9\u8C61\u7684\u5177\u4F53\u7C7B\u578B\uFF0C\u800C\u662F\u53EA\u4E0E\u5BF9\u8C61\u5BB6\u65CF\u4E2D\u7684\u4E00\u4E2A\u901A\u7528\u8868\u793A\u6253\u4EA4\u9053\uFF08\u672C\u4F8B\u4E2D\u5373\u4E3A <code>Shape</code>\uFF09\u3002\u8FD9\u6837\uFF0C\u4EE3\u7801\u4F1A\u66F4\u5BB9\u6613\u5199\uFF0C\u66F4\u6613\u8BFB\u548C\u7EF4\u62A4\uFF1B\u8BBE\u8BA1\u4E5F\u66F4\u5BB9\u6613\u5B9E\u73B0\uFF0C\u66F4\u6613\u4E8E\u7406\u89E3\u548C\u4FEE\u6539\u3002\u6240\u4EE5\u591A\u6001\u662F\u9762\u5411\u5BF9\u8C61\u7684\u57FA\u672C\u76EE\u6807\u3002</p><p>\u4F46\u662F\uFF0C\u6709\u65F6\u4F60\u4F1A\u78B0\u5230\u4E00\u4E9B\u7F16\u7A0B\u95EE\u9898\uFF0C\u5728\u8FD9\u4E9B\u95EE\u9898\u4E2D\u5982\u679C\u4F60\u80FD\u77E5\u9053\u67D0\u4E2A\u6CDB\u5316\u5F15\u7528\u7684\u5177\u4F53\u7C7B\u578B\uFF0C\u5C31\u53EF\u4EE5\u628A\u95EE\u9898\u8F7B\u677E\u89E3\u51B3\u3002\u4F8B\u5982\uFF0C\u5047\u8BBE\u6211\u4EEC\u5141\u8BB8\u7528\u6237\u5C06\u67D0\u4E9B\u51E0\u4F55\u5F62\u72B6\u9AD8\u4EAE\u663E\u793A\uFF0C\u73B0\u5728\u5E0C\u671B\u627E\u5230\u5C4F\u5E55\u4E0A\u6240\u6709\u9AD8\u4EAE\u663E\u793A\u7684\u4E09\u89D2\u5F62\uFF1B\u6216\u8005\uFF0C\u6211\u4EEC\u73B0\u5728\u9700\u8981\u65CB\u8F6C\u6240\u6709\u56FE\u5F62\uFF0C\u4F46\u662F\u60F3\u8DF3\u8FC7\u5706\u5F62(\u56E0\u4E3A\u5706\u5F62\u65CB\u8F6C\u6CA1\u6709\u610F\u4E49)\u3002\u8FD9\u65F6\u6211\u4EEC\u5C31\u5E0C\u671B\u77E5\u9053 <code>Stream&lt;Shape&gt;</code> \u91CC\u8FB9\u7684\u5F62\u72B6\u5177\u4F53\u662F\u4EC0\u4E48\u7C7B\u578B\uFF0C\u800C Java \u5B9E\u9645\u4E0A\u4E5F\u6EE1\u8DB3\u4E86\u6211\u4EEC\u7684\u8FD9\u79CD\u9700\u6C42\u3002\u4F7F\u7528 RTTI\uFF0C\u6211\u4EEC\u53EF\u4EE5\u67E5\u8BE2\u67D0\u4E2A <code>Shape</code> \u5F15\u7528\u6240\u6307\u5411\u5BF9\u8C61\u7684\u786E\u5207\u7C7B\u578B\uFF0C\u7136\u540E\u9009\u62E9\u6216\u8005\u5254\u9664\u7279\u4F8B\u3002</p><h2 id="class-\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#class-\u5BF9\u8C61" aria-hidden="true">#</a> Class \u5BF9\u8C61</h2><p>\u8981\u7406\u89E3 RTTI \u5728 Java \u4E2D\u7684\u5DE5\u4F5C\u539F\u7406\uFF0C\u9996\u5148\u5FC5\u987B\u77E5\u9053\u7C7B\u578B\u4FE1\u606F\u5728\u8FD0\u884C\u65F6\u662F\u5982\u4F55\u8868\u793A\u7684\u3002\u8FD9\u9879\u5DE5\u4F5C\u662F\u7531\u79F0\u4E3A <strong><code>Class</code>\u5BF9\u8C61</strong> \u7684\u7279\u6B8A\u5BF9\u8C61\u5B8C\u6210\u7684\uFF0C\u5B83\u5305\u542B\u4E86\u4E0E\u7C7B\u6709\u5173\u7684\u4FE1\u606F\u3002\u5B9E\u9645\u4E0A\uFF0C<code>Class</code> \u5BF9\u8C61\u5C31\u662F\u7528\u6765\u521B\u5EFA\u8BE5\u7C7B\u6240\u6709&quot;\u5E38\u89C4&quot;\u5BF9\u8C61\u7684\u3002Java \u4F7F\u7528 <code>Class</code> \u5BF9\u8C61\u6765\u5B9E\u73B0 RTTI\uFF0C\u5373\u4FBF\u662F\u7C7B\u578B\u8F6C\u6362\u8FD9\u6837\u7684\u64CD\u4F5C\u90FD\u662F\u7528 <code>Class</code> \u5BF9\u8C61\u5B9E\u73B0\u7684\u3002\u4E0D\u4EC5\u5982\u6B64\uFF0C<code>Class</code> \u7C7B\u8FD8\u63D0\u4F9B\u4E86\u5F88\u591A\u4F7F\u7528 RTTI \u7684\u5176\u5B83\u65B9\u5F0F\u3002</p><p>\u7C7B\u662F\u7A0B\u5E8F\u7684\u4E00\u90E8\u5206\uFF0C\u6BCF\u4E2A\u7C7B\u90FD\u6709\u4E00\u4E2A <code>Class</code> \u5BF9\u8C61\u3002\u6362\u8A00\u4E4B\uFF0C\u6BCF\u5F53\u6211\u4EEC\u7F16\u5199\u5E76\u4E14\u7F16\u8BD1\u4E86\u4E00\u4E2A\u65B0\u7C7B\uFF0C\u5C31\u4F1A\u4EA7\u751F\u4E00\u4E2A <code>Class</code> \u5BF9\u8C61\uFF08\u66F4\u6070\u5F53\u7684\u8BF4\uFF0C\u662F\u88AB\u4FDD\u5B58\u5728\u4E00\u4E2A\u540C\u540D\u7684 <code>.class</code> \u6587\u4EF6\u4E2D\uFF09\u3002\u4E3A\u4E86\u751F\u6210\u8FD9\u4E2A\u7C7B\u7684\u5BF9\u8C61\uFF0CJava \u865A\u62DF\u673A (JVM) \u5148\u4F1A\u8C03\u7528&quot;\u7C7B\u52A0\u8F7D\u5668&quot;\u5B50\u7CFB\u7EDF\u628A\u8FD9\u4E2A\u7C7B\u52A0\u8F7D\u5230\u5185\u5B58\u4E2D\u3002</p><p>\u7C7B\u52A0\u8F7D\u5668\u5B50\u7CFB\u7EDF\u53EF\u80FD\u5305\u542B\u4E00\u6761\u7C7B\u52A0\u8F7D\u5668\u94FE\uFF0C\u4F46\u6709\u4E14\u53EA\u6709\u4E00\u4E2A<strong>\u539F\u751F\u7C7B\u52A0\u8F7D\u5668</strong>\uFF0C\u5B83\u662F JVM \u5B9E\u73B0\u7684\u4E00\u90E8\u5206\u3002\u539F\u751F\u7C7B\u52A0\u8F7D\u5668\u52A0\u8F7D\u7684\u662F\u201D\u53EF\u4FE1\u7C7B\u201D\uFF08\u5305\u62EC Java API \u7C7B\uFF09\u3002\u5B83\u4EEC\u901A\u5E38\u662F\u4ECE\u672C\u5730\u76D8\u52A0\u8F7D\u7684\u3002\u5728\u8FD9\u6761\u94FE\u4E2D\uFF0C\u901A\u5E38\u4E0D\u9700\u8981\u6DFB\u52A0\u989D\u5916\u7684\u7C7B\u52A0\u8F7D\u5668\uFF0C\u4F46\u662F\u5982\u679C\u4F60\u6709\u7279\u6B8A\u9700\u6C42\uFF08\u4F8B\u5982\u4EE5\u67D0\u79CD\u7279\u6B8A\u7684\u65B9\u5F0F\u52A0\u8F7D\u7C7B\uFF0C\u4EE5\u652F\u6301 Web \u670D\u52A1\u5668\u5E94\u7528\uFF0C\u6216\u8005\u901A\u8FC7\u7F51\u7EDC\u4E0B\u8F7D\u7C7B\uFF09\uFF0C\u4E5F\u53EF\u4EE5\u6302\u8F7D\u989D\u5916\u7684\u7C7B\u52A0\u8F7D\u5668\u3002</p><p>\u6240\u6709\u7684\u7C7B\u90FD\u662F\u7B2C\u4E00\u6B21\u4F7F\u7528\u65F6\u52A8\u6001\u52A0\u8F7D\u5230 JVM \u4E2D\u7684\uFF0C\u5F53\u7A0B\u5E8F\u521B\u5EFA\u7B2C\u4E00\u4E2A\u5BF9\u7C7B\u7684\u9759\u6001\u6210\u5458\u7684\u5F15\u7528\u65F6\uFF0C\u5C31\u4F1A\u52A0\u8F7D\u8FD9\u4E2A\u7C7B\u3002</p><blockquote><p>\u5176\u5B9E\u6784\u9020\u5668\u4E5F\u662F\u7C7B\u7684\u9759\u6001\u65B9\u6CD5\uFF0C\u867D\u7136\u6784\u9020\u5668\u524D\u9762\u5E76\u6CA1\u6709 <code>static</code> \u5173\u952E\u5B57\u3002\u6240\u4EE5\uFF0C\u4F7F\u7528 <code>new</code> \u64CD\u4F5C\u7B26\u521B\u5EFA\u7C7B\u7684\u65B0\u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u64CD\u4F5C\u4E5F\u7B97\u4F5C\u5BF9\u7C7B\u7684\u9759\u6001\u6210\u5458\u5F15\u7528\u3002</p></blockquote><p>\u56E0\u6B64\uFF0CJava \u7A0B\u5E8F\u5728\u5B83\u5F00\u59CB\u8FD0\u884C\u4E4B\u524D\u5E76\u6CA1\u6709\u88AB\u5B8C\u5168\u52A0\u8F7D\uFF0C\u5F88\u591A\u90E8\u5206\u662F\u5728\u9700\u8981\u65F6\u624D\u4F1A\u52A0\u8F7D\u3002\u8FD9\u4E00\u70B9\u4E0E\u8BB8\u591A\u4F20\u7EDF\u7F16\u7A0B\u8BED\u8A00\u4E0D\u540C\uFF0C\u52A8\u6001\u52A0\u8F7D\u4F7F\u5F97 Java \u5177\u6709\u4E00\u4E9B\u9759\u6001\u52A0\u8F7D\u8BED\u8A00\uFF08\u5982 C++\uFF09\u5F88\u96BE\u6216\u8005\u6839\u672C\u4E0D\u53EF\u80FD\u5B9E\u73B0\u7684\u7279\u6027\u3002</p><p>\u7C7B\u52A0\u8F7D\u5668\u9996\u5148\u4F1A\u68C0\u67E5\u8FD9\u4E2A\u7C7B\u7684 <code>Class</code> \u5BF9\u8C61\u662F\u5426\u5DF2\u7ECF\u52A0\u8F7D\uFF0C\u5982\u679C\u5C1A\u672A\u52A0\u8F7D\uFF0C\u9ED8\u8BA4\u7684\u7C7B\u52A0\u8F7D\u5668\u5C31\u4F1A\u6839\u636E\u7C7B\u540D\u67E5\u627E <code>.class</code> \u6587\u4EF6\uFF08\u5982\u679C\u6709\u9644\u52A0\u7684\u7C7B\u52A0\u8F7D\u5668\uFF0C\u8FD9\u65F6\u5019\u53EF\u80FD\u5C31\u4F1A\u5728\u6570\u636E\u5E93\u4E2D\u6216\u8005\u901A\u8FC7\u5176\u5B83\u65B9\u5F0F\u83B7\u5F97\u5B57\u8282\u7801\uFF09\u3002\u8FD9\u4E2A\u7C7B\u7684\u5B57\u8282\u7801\u88AB\u52A0\u8F7D\u540E\uFF0CJVM \u4F1A\u5BF9\u5176\u8FDB\u884C\u9A8C\u8BC1\uFF0C\u786E\u4FDD\u5B83\u6CA1\u6709\u635F\u574F\uFF0C\u5E76\u4E14\u4E0D\u5305\u542B\u4E0D\u826F\u7684 Java \u4EE3\u7801(\u8FD9\u662F Java \u5B89\u5168\u9632\u8303\u7684\u4E00\u79CD\u63AA\u65BD)\u3002</p><p>\u4E00\u65E6\u67D0\u4E2A\u7C7B\u7684 <code>Class</code> \u5BF9\u8C61\u88AB\u8F7D\u5165\u5185\u5B58\uFF0C\u5B83\u5C31\u53EF\u4EE5\u7528\u6765\u521B\u5EFA\u8FD9\u4E2A\u7C7B\u7684\u6240\u6709\u5BF9\u8C61\u3002\u4E0B\u9762\u7684\u793A\u8303\u7A0B\u5E8F\u53EF\u4EE5\u8BC1\u660E\u8FD9\u70B9\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/SweetShop.java</span>
<span class="token comment">// \u68C0\u67E5\u7C7B\u52A0\u8F7D\u5668\u5DE5\u4F5C\u65B9\u5F0F</span>
<span class="token keyword">class</span> <span class="token class-name">Cookie</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Loading Cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Gum</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Loading Gum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Candy</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Loading Candy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SweetShop</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;inside main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Candy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After creating Candy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;Gum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Couldn&#39;t find Gum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After Class.forName(\\&quot;Gum\\&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After creating Cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>inside main
Loading Candy
After creating Candy
Loading Gum
After Class.forName(&quot;Gum&quot;)
Loading Cookie
After creating Cookie
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7684\u4EE3\u7801\u4E2D\uFF0C<code>Candy</code>\u3001<code>Gum</code> \u548C <code>Cookie</code> \u8FD9\u51E0\u4E2A\u7C7B\u90FD\u6709\u4E00\u4E2A <code>static{...}</code> \u9759\u6001\u521D\u59CB\u5316\u5757\uFF0C\u8FD9\u4E9B\u9759\u6001\u521D\u59CB\u5316\u5757\u5728\u7C7B\u7B2C\u4E00\u6B21\u88AB\u52A0\u8F7D\u7684\u65F6\u5019\u5C31\u4F1A\u6267\u884C\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u9759\u6001\u521D\u59CB\u5316\u5757\u4F1A\u6253\u5370\u51FA\u76F8\u5E94\u7684\u4FE1\u606F\uFF0C\u544A\u8BC9\u6211\u4EEC\u8FD9\u4E9B\u7C7B\u5206\u522B\u662F\u4EC0\u4E48\u65F6\u5019\u88AB\u52A0\u8F7D\u4E86\u3002\u800C\u5728\u4E3B\u65B9\u6CD5\u91CC\u8FB9\uFF0C\u521B\u5EFA\u5BF9\u8C61\u7684\u4EE3\u7801\u90FD\u653E\u5728\u4E86 <code>print()</code> \u8BED\u53E5\u4E4B\u95F4\uFF0C\u4EE5\u5E2E\u52A9\u6211\u4EEC\u5224\u65AD\u7C7B\u52A0\u8F7D\u7684\u65F6\u95F4\u70B9\u3002</p><p>\u4ECE\u8F93\u51FA\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C<code>Class</code> \u5BF9\u8C61\u4EC5\u5728\u9700\u8981\u7684\u65F6\u5019\u624D\u4F1A\u88AB\u52A0\u8F7D\uFF0C<code>static</code> \u521D\u59CB\u5316\u662F\u5728\u7C7B\u52A0\u8F7D\u65F6\u8FDB\u884C\u7684\u3002</p><p>\u4EE3\u7801\u91CC\u9762\u8FD8\u6709\u7279\u522B\u6709\u8DA3\u7684\u4E00\u884C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;Gum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6240\u6709 <code>Class</code> \u5BF9\u8C61\u90FD\u5C5E\u4E8E <code>Class</code> \u7C7B\uFF0C\u800C\u4E14\u5B83\u8DDF\u5176\u4ED6\u666E\u901A\u5BF9\u8C61\u4E00\u6837\uFF0C\u6211\u4EEC\u53EF\u4EE5\u83B7\u53D6\u548C\u64CD\u63A7\u5B83\u7684\u5F15\u7528(\u8FD9\u4E5F\u662F\u7C7B\u52A0\u8F7D\u5668\u7684\u5DE5\u4F5C)\u3002<code>forName()</code> \u662F <code>Class</code> \u7C7B\u7684\u4E00\u4E2A\u9759\u6001\u65B9\u6CD5\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 <code>forName()</code> \u6839\u636E\u76EE\u6807\u7C7B\u7684\u7C7B\u540D\uFF08<code>String</code>\uFF09\u5F97\u5230\u8BE5\u7C7B\u7684 <code>Class</code> \u5BF9\u8C61\u3002\u4E0A\u9762\u7684\u4EE3\u7801\u5FFD\u7565\u4E86 <code>forName()</code> \u7684\u8FD4\u56DE\u503C\uFF0C\u56E0\u4E3A\u90A3\u4E2A\u8C03\u7528\u662F\u4E3A\u4E86\u5F97\u5230\u5B83\u4EA7\u751F\u7684\u201C\u526F\u4F5C\u7528\u201D\u3002\u4ECE\u7ED3\u679C\u53EF\u4EE5\u770B\u51FA\uFF0C<code>forName()</code> \u6267\u884C\u7684\u526F\u4F5C\u7528\u662F\u5982\u679C <code>Gum</code> \u7C7B\u6CA1\u6709\u88AB\u52A0\u8F7D\u5C31\u52A0\u8F7D\u5B83\uFF0C\u800C\u5728\u52A0\u8F7D\u7684\u8FC7\u7A0B\u4E2D\uFF0C<code>Gum</code> \u7684 <code>static</code> \u521D\u59CB\u5316\u5757\u88AB\u6267\u884C\u4E86\u3002</p><p>\u8FD8\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5982\u679C <code>Class.forName()</code> \u627E\u4E0D\u5230\u8981\u52A0\u8F7D\u7684\u7C7B\uFF0C\u5B83\u5C31\u4F1A\u629B\u51FA\u5F02\u5E38 <code>ClassNotFoundException</code>\u3002\u4E0A\u9762\u7684\u4F8B\u5B50\u4E2D\u6211\u4EEC\u53EA\u662F\u7B80\u5355\u5730\u62A5\u544A\u4E86\u95EE\u9898\uFF0C\u4F46\u5728\u66F4\u4E25\u5BC6\u7684\u7A0B\u5E8F\u91CC\uFF0C\u5C31\u8981\u8003\u8651\u5728\u5F02\u5E38\u5904\u7406\u7A0B\u5E8F\u4E2D\u628A\u95EE\u9898\u89E3\u51B3\u6389\uFF08\u5177\u4F53\u4F8B\u5B50\u8BE6\u89C1<a href="./25-Patterns">\u8BBE\u8BA1\u6A21\u5F0F</a>\u7AE0\u8282\uFF09\u3002</p><p>\u65E0\u8BBA\u4F55\u65F6\uFF0C\u53EA\u8981\u4F60\u60F3\u5728\u8FD0\u884C\u65F6\u4F7F\u7528\u7C7B\u578B\u4FE1\u606F\uFF0C\u5C31\u5FC5\u987B\u5148\u5F97\u5230\u90A3\u4E2A <code>Class</code> \u5BF9\u8C61\u7684\u5F15\u7528\u3002<code>Class.forName()</code> \u5C31\u662F\u5B9E\u73B0\u8FD9\u4E2A\u529F\u80FD\u7684\u4E00\u4E2A\u4FBF\u6377\u9014\u5F84\uFF0C\u56E0\u4E3A\u4F7F\u7528\u8BE5\u65B9\u6CD5\u4F60\u4E0D\u9700\u8981\u5148\u6301\u6709\u8FD9\u4E2A\u7C7B\u578B \u7684\u5BF9\u8C61\u3002\u4F46\u662F\uFF0C\u5982\u679C\u4F60\u5DF2\u7ECF\u62E5\u6709\u4E86\u76EE\u6807\u7C7B\u7684\u5BF9\u8C61\uFF0C\u90A3\u5C31\u53EF\u4EE5\u901A\u8FC7\u8C03\u7528 <code>getClass()</code> \u65B9\u6CD5\u6765\u83B7\u53D6 <code>Class</code> \u5F15\u7528\u4E86\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u6765\u81EA\u6839\u7C7B <code>Object</code>\uFF0C\u5B83\u5C06\u8FD4\u56DE\u8868\u793A\u8BE5\u5BF9\u8C61\u5B9E\u9645\u7C7B\u578B\u7684 <code>Class</code> \u5BF9\u8C61\u7684\u5F15\u7528\u3002<code>Class</code> \u5305\u542B\u5F88\u591A\u6709\u7528\u7684\u65B9\u6CD5\uFF0C\u4E0B\u9762\u4EE3\u7801\u5C55\u793A\u4E86\u5176\u4E2D\u7684\u4E00\u90E8\u5206\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/toys/ToyTest.java</span>
<span class="token comment">// \u6D4B\u8BD5 Class \u7C7B</span>
<span class="token comment">// {java typeinfo.toys.ToyTest}</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>toys</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">HasBatteries</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Waterproof</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Shoots</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Toy</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6CE8\u91CA\u4E0B\u9762\u7684\u65E0\u53C2\u6570\u6784\u9020\u5668\u4F1A\u5F15\u8D77 NoSuchMethodError \u9519\u8BEF</span>
    <span class="token class-name">Toy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token class-name">Toy</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FancyToy</span> <span class="token keyword">extends</span> <span class="token class-name">Toy</span>
<span class="token keyword">implements</span> <span class="token class-name">HasBatteries</span><span class="token punctuation">,</span> <span class="token class-name">Waterproof</span><span class="token punctuation">,</span> <span class="token class-name">Shoots</span> <span class="token punctuation">{</span>
    <span class="token class-name">FancyToy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ToyTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printInfo</span><span class="token punctuation">(</span><span class="token class-name">Class</span> cc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Class name: &quot;</span> <span class="token operator">+</span> cc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token string">&quot; is interface? [&quot;</span> <span class="token operator">+</span> cc<span class="token punctuation">.</span><span class="token function">isInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
            <span class="token string">&quot;Simple name: &quot;</span> <span class="token operator">+</span> cc<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
            <span class="token string">&quot;Canonical name : &quot;</span> <span class="token operator">+</span> cc<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span> c <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            c <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;typeinfo.toys.FancyToy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Can&#39;t find FancyToy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">printInfo</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Class</span> face <span class="token operator">:</span> c<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">printInfo</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span> up <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// Requires no-arg constructor:</span>
            obj <span class="token operator">=</span> up<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InstantiationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot instantiate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot access&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">printInfo</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Class name: typeinfo.toys.FancyToy is interface?
[false]
Simple name: FancyToy
Canonical name : typeinfo.toys.FancyToy
Class name: typeinfo.toys.HasBatteries is interface?
[true]
Simple name: HasBatteries
Canonical name : typeinfo.toys.HasBatteries
Class name: typeinfo.toys.Waterproof is interface?
[true]
Simple name: Waterproof
Canonical name : typeinfo.toys.Waterproof
Class name: typeinfo.toys.Shoots is interface? [true]
Simple name: Shoots
Canonical name : typeinfo.toys.Shoots
Class name: typeinfo.toys.Toy is interface? [false]
Simple name: Toy
Canonical name : typeinfo.toys.Toy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>FancyToy</code> \u7EE7\u627F\u81EA <code>Toy</code> \u5E76\u5B9E\u73B0\u4E86 <code>HasBatteries</code>\u3001<code>Waterproof</code> \u548C <code>Shoots</code> \u63A5\u53E3\u3002\u5728 <code>main</code> \u65B9\u6CD5\u4E2D\uFF0C\u6211\u4EEC\u521B\u5EFA\u4E86\u4E00\u4E2A <code>Class</code> \u5F15\u7528\uFF0C\u7136\u540E\u5728 <code>try</code> \u8BED\u53E5\u91CC\u8FB9\u7528 <code>forName()</code> \u65B9\u6CD5\u521B\u5EFA\u4E86\u4E00\u4E2A <code>FancyToy</code> \u7684\u7C7B\u5BF9\u8C61\u5E76\u8D4B\u503C\u7ED9\u8BE5\u5F15\u7528\u3002\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u4F20\u9012\u7ED9 <code>forName()</code> \u7684\u5B57\u7B26\u4E32\u5FC5\u987B\u4F7F\u7528\u7C7B\u7684\u5168\u9650\u5B9A\u540D\uFF08\u5305\u542B\u5305\u540D\uFF09\u3002</p><p><code>printInfo()</code> \u51FD\u6570\u4F7F\u7528 <code>getName()</code> \u6765\u4EA7\u751F\u5B8C\u6574\u7C7B\u540D\uFF0C\u4F7F\u7528 <code>getSimpleName()</code> \u4EA7\u751F\u4E0D\u5E26\u5305\u540D\u7684\u7C7B\u540D\uFF0C<code>getCanonicalName()</code> \u4E5F\u662F\u4EA7\u751F\u5B8C\u6574\u7C7B\u540D\uFF08\u9664\u5185\u90E8\u7C7B\u548C\u6570\u7EC4\u5916\uFF0C\u5BF9\u5927\u90E8\u5206\u7C7B\u4EA7\u751F\u7684\u7ED3\u679C\u4E0E <code>getName()</code> \u76F8\u540C\uFF09\u3002<code>isInterface()</code> \u7528\u4E8E\u5224\u65AD\u67D0\u4E2A <code>Class</code> \u5BF9\u8C61\u4EE3\u8868\u7684\u662F\u5426\u4E3A\u4E00\u4E2A\u63A5\u53E3\u3002\u56E0\u6B64\uFF0C\u901A\u8FC7 <code>Class</code> \u5BF9\u8C61\uFF0C\u4F60\u53EF\u4EE5\u5F97\u5230\u5173\u4E8E\u8BE5\u7C7B\u578B\u7684\u6240\u6709\u4FE1\u606F\u3002</p><p>\u5728\u4E3B\u65B9\u6CD5\u4E2D\u8C03\u7528\u7684 <code>Class.getInterfaces()</code> \u65B9\u6CD5\u8FD4\u56DE\u7684\u662F\u5B58\u653E <code>Class</code> \u5BF9\u8C61\u7684\u6570\u7EC4\uFF0C\u91CC\u9762\u7684 <code>Class</code> \u5BF9\u8C61\u8868\u793A\u7684\u662F\u90A3\u4E2A\u7C7B\u5B9E\u73B0\u7684\u63A5\u53E3\u3002</p><p>\u53E6\u5916\uFF0C\u4F60\u8FD8\u53EF\u4EE5\u8C03\u7528 <code>getSuperclass()</code> \u65B9\u6CD5\u6765\u5F97\u5230\u7236\u7C7B\u7684 <code>Class</code> \u5BF9\u8C61\uFF0C\u518D\u7528\u7236\u7C7B\u7684 <code>Class</code> \u5BF9\u8C61\u8C03\u7528\u8BE5\u65B9\u6CD5\uFF0C\u91CD\u590D\u591A\u6B21\uFF0C\u4F60\u5C31\u53EF\u4EE5\u5F97\u5230\u4E00\u4E2A\u5BF9\u8C61\u5B8C\u6574\u7684\u7C7B\u7EE7\u627F\u7ED3\u6784\u3002</p><p><code>Class</code> \u5BF9\u8C61\u7684 <code>newInstance()</code> \u65B9\u6CD5\u662F\u5B9E\u73B0\u201C\u865A\u62DF\u6784\u9020\u5668\u201D\u7684\u4E00\u79CD\u9014\u5F84\uFF0C\u865A\u62DF\u6784\u9020\u5668\u53EF\u4EE5\u8BA9\u4F60\u5728\u4E0D\u77E5\u9053\u4E00\u4E2A\u7C7B\u7684\u786E\u5207\u7C7B\u578B\u7684\u65F6\u5019\uFF0C\u521B\u5EFA\u8FD9\u4E2A\u7C7B\u7684\u5BF9\u8C61\u3002\u5728\u524D\u9762\u7684\u4F8B\u5B50\u4E2D\uFF0C<code>up</code> \u53EA\u662F\u4E00\u4E2A <code>Class</code> \u5BF9\u8C61\u7684\u5F15\u7528\uFF0C\u5728\u7F16\u8BD1\u671F\u5E76\u4E0D\u77E5\u9053\u8FD9\u4E2A\u5F15\u7528\u4F1A\u6307\u5411\u54EA\u4E2A\u7C7B\u7684 <code>Class</code> \u5BF9\u8C61\u3002\u5F53\u4F60\u521B\u5EFA\u65B0\u5B9E\u4F8B\u65F6\uFF0C\u4F1A\u5F97\u5230\u4E00\u4E2A <code>Object</code> \u5F15\u7528\uFF0C\u4F46\u662F\u8FD9\u4E2A\u5F15\u7528\u6307\u5411\u7684\u662F <code>Toy</code> \u5BF9\u8C61\u3002\u5F53\u7136\uFF0C\u7531\u4E8E\u5F97\u5230\u7684\u662F <code>Object</code> \u5F15\u7528\uFF0C\u76EE\u524D\u4F60\u53EA\u80FD\u7ED9\u5B83\u53D1\u9001 <code>Object</code> \u5BF9\u8C61\u80FD\u591F\u63A5\u53D7\u7684\u8C03\u7528\u3002\u800C\u5982\u679C\u4F60\u60F3\u8BF7\u6C42\u5177\u4F53\u5BF9\u8C61\u624D\u6709\u7684\u8C03\u7528\uFF0C\u4F60\u5C31\u5F97\u5148\u83B7\u53D6\u8BE5\u5BF9\u8C61\u66F4\u591A\u7684\u7C7B\u578B\u4FE1\u606F\uFF0C\u5E76\u6267\u884C\u67D0\u79CD\u8F6C\u578B\u3002\u53E6\u5916\uFF0C\u4F7F\u7528 <code>newInstance()</code> \u6765\u521B\u5EFA\u7684\u7C7B\uFF0C\u5FC5\u987B\u5E26\u6709\u65E0\u53C2\u6570\u7684\u6784\u9020\u5668\u3002\u5728\u672C\u7AE0\u7A0D\u540E\u90E8\u5206\uFF0C\u4F60\u5C06\u4F1A\u770B\u5230\u5982\u4F55\u901A\u8FC7 Java \u7684\u53CD\u5C04 API\uFF0C\u7528\u4EFB\u610F\u7684\u6784\u9020\u5668\u6765\u52A8\u6001\u5730\u521B\u5EFA\u7C7B\u7684\u5BF9\u8C61\u3002</p><h3 id="\u7C7B\u5B57\u9762\u5E38\u91CF" tabindex="-1"><a class="header-anchor" href="#\u7C7B\u5B57\u9762\u5E38\u91CF" aria-hidden="true">#</a> \u7C7B\u5B57\u9762\u5E38\u91CF</h3><p>Java \u8FD8\u63D0\u4F9B\u4E86\u53E6\u4E00\u79CD\u65B9\u6CD5\u6765\u751F\u6210\u7C7B\u5BF9\u8C61\u7684\u5F15\u7528\uFF1A<strong>\u7C7B\u5B57\u9762\u5E38\u91CF</strong>\u3002\u5BF9\u4E0A\u8FF0\u7A0B\u5E8F\u6765\u8BF4\uFF0C\u5C31\u50CF\u8FD9\u6837\uFF1A<code>FancyToy.class;</code>\u3002\u8FD9\u6837\u505A\u4E0D\u4EC5\u66F4\u7B80\u5355\uFF0C\u800C\u4E14\u66F4\u5B89\u5168\uFF0C\u56E0\u4E3A\u5B83\u5728\u7F16\u8BD1\u65F6\u5C31\u4F1A\u53D7\u5230\u68C0\u67E5\uFF08\u56E0\u6B64\u4E0D\u5FC5\u653E\u5728 <code>try</code> \u8BED\u53E5\u5757\u4E2D\uFF09\u3002\u5E76\u4E14\u5B83\u6839\u9664\u4E86\u5BF9 <code>forName()</code> \u65B9\u6CD5\u7684\u8C03\u7528\uFF0C\u6240\u4EE5\u6548\u7387\u66F4\u9AD8\u3002</p><p>\u7C7B\u5B57\u9762\u5E38\u91CF\u4E0D\u4EC5\u53EF\u4EE5\u5E94\u7528\u4E8E\u666E\u901A\u7C7B\uFF0C\u4E5F\u53EF\u4EE5\u5E94\u7528\u4E8E\u63A5\u53E3\u3001\u6570\u7EC4\u4EE5\u53CA\u57FA\u672C\u6570\u636E\u7C7B\u578B\u3002\u53E6\u5916\uFF0C\u5BF9\u4E8E\u57FA\u672C\u6570\u636E\u7C7B\u578B\u7684\u5305\u88C5\u7C7B\uFF0C\u8FD8\u6709\u4E00\u4E2A\u6807\u51C6\u5B57\u6BB5 <code>TYPE</code>\u3002<code>TYPE</code> \u5B57\u6BB5\u662F\u4E00\u4E2A\u5F15\u7528\uFF0C\u6307\u5411\u5BF9\u5E94\u7684\u57FA\u672C\u6570\u636E\u7C7B\u578B\u7684 <code>Class</code> \u5BF9\u8C61\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><figure><table style="text-align:center;"><thead><tr><th colspan="2">...\u7B49\u4EF7\u4E8E...</th></tr></thead><tbody><tr><td>boolean.class</td><td>Boolean.TYPE</td></tr><tr><td>char.class</td><td>Character.TYPE</td></tr><tr><td>byte.class</td><td>Byte.TYPE</td></tr><tr><td>short.class</td><td>Short.TYPE</td></tr><tr><td>int.class</td><td>Integer.TYPE</td></tr><tr><td>long.class</td><td>Long.TYPE</td></tr><tr><td>float.class</td><td>Float.TYPE</td></tr><tr><td>double.class</td><td>Double.TYPE</td></tr><tr><td>void.class</td><td>Void.TYPE</td></tr></tbody></table></figure><p>\u6211\u7684\u5EFA\u8BAE\u662F\u4F7F\u7528 <code>.class</code> \u7684\u5F62\u5F0F\uFF0C\u4EE5\u4FDD\u6301\u4E0E\u666E\u901A\u7C7B\u7684\u4E00\u81F4\u6027\u3002</p><p>\u6CE8\u610F\uFF0C\u6709\u4E00\u70B9\u5F88\u6709\u8DA3\uFF1A\u5F53\u4F7F\u7528 <code>.class</code> \u6765\u521B\u5EFA\u5BF9 <code>Class</code> \u5BF9\u8C61\u7684\u5F15\u7528\u65F6\uFF0C\u4E0D\u4F1A\u81EA\u52A8\u5730\u521D\u59CB\u5316\u8BE5 <code>Class</code> \u5BF9\u8C61\u3002\u4E3A\u4E86\u4F7F\u7528\u7C7B\u800C\u505A\u7684\u51C6\u5907\u5DE5\u4F5C\u5B9E\u9645\u5305\u542B\u4E09\u4E2A\u6B65\u9AA4\uFF1A</p><ol><li><p><strong>\u52A0\u8F7D</strong>\uFF0C\u8FD9\u662F\u7531\u7C7B\u52A0\u8F7D\u5668\u6267\u884C\u7684\u3002\u8BE5\u6B65\u9AA4\u5C06\u67E5\u627E\u5B57\u8282\u7801\uFF08\u901A\u5E38\u5728 classpath \u6240\u6307\u5B9A\u7684\u8DEF\u5F84\u4E2D\u67E5\u627E\uFF0C\u4F46\u8FD9\u5E76\u975E\u662F\u5FC5\u987B\u7684\uFF09\uFF0C\u5E76\u4ECE\u8FD9\u4E9B\u5B57\u8282\u7801\u4E2D\u521B\u5EFA\u4E00\u4E2A <code>Class</code> \u5BF9\u8C61\u3002</p></li><li><p><strong>\u94FE\u63A5</strong>\u3002\u5728\u94FE\u63A5\u9636\u6BB5\u5C06\u9A8C\u8BC1\u7C7B\u4E2D\u7684\u5B57\u8282\u7801\uFF0C\u4E3A <code>static</code> \u5B57\u6BB5\u5206\u914D\u5B58\u50A8\u7A7A\u95F4\uFF0C\u5E76\u4E14\u5982\u679C\u9700\u8981\u7684\u8BDD\uFF0C\u5C06\u89E3\u6790\u8FD9\u4E2A\u7C7B\u521B\u5EFA\u7684\u5BF9\u5176\u4ED6\u7C7B\u7684\u6240\u6709\u5F15\u7528\u3002</p></li><li><p><strong>\u521D\u59CB\u5316</strong>\u3002\u5982\u679C\u8BE5\u7C7B\u5177\u6709\u8D85\u7C7B\uFF0C\u5219\u5148\u521D\u59CB\u5316\u8D85\u7C7B\uFF0C\u6267\u884C <code>static</code> \u521D\u59CB\u5316\u5668\u548C <code>static</code> \u521D\u59CB\u5316\u5757\u3002</p></li></ol><p>\u76F4\u5230\u7B2C\u4E00\u6B21\u5F15\u7528\u4E00\u4E2A <code>static</code> \u65B9\u6CD5\uFF08\u6784\u9020\u5668\u9690\u5F0F\u5730\u662F <code>static</code>\uFF09\u6216\u8005\u975E\u5E38\u91CF\u7684 <code>static</code> \u5B57\u6BB5\uFF0C\u624D\u4F1A\u8FDB\u884C\u7C7B\u521D\u59CB\u5316\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/ClassInitialization.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Initable</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATIC_FINAL <span class="token operator">=</span> <span class="token number">47</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATIC_FINAL2 <span class="token operator">=</span>
        <span class="token class-name">ClassInitialization</span><span class="token punctuation">.</span>rand<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Initializing Initable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Initable2</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> staticNonFinal <span class="token operator">=</span> <span class="token number">147</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Initializing Initable2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Initable3</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> staticNonFinal <span class="token operator">=</span> <span class="token number">74</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Initializing Initable3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassInitialization</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Random</span> rand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span>
    <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span> initable <span class="token operator">=</span> <span class="token class-name">Initable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After creating Initable ref&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Does not trigger initialization:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Initable</span><span class="token punctuation">.</span>STATIC_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Does trigger initialization:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Initable</span><span class="token punctuation">.</span>STATIC_FINAL2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Does trigger initialization:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Initable2</span><span class="token punctuation">.</span>staticNonFinal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span> initable3 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;Initable3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;After creating Initable3 ref&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Initable3</span><span class="token punctuation">.</span>staticNonFinal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>After creating Initable ref
47
Initializing Initable
258
Initializing Initable2
147
Initializing Initable3
After creating Initable3 ref
74
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521D\u59CB\u5316\u6709\u6548\u5730\u5B9E\u73B0\u4E86\u5C3D\u53EF\u80FD\u7684\u201C\u60F0\u6027\u201D\uFF0C\u4ECE\u5BF9 <code>initable</code> \u5F15\u7528\u7684\u521B\u5EFA\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u4EC5\u4F7F\u7528 <code>.class</code> \u8BED\u6CD5\u6765\u83B7\u5F97\u5BF9\u7C7B\u5BF9\u8C61\u7684\u5F15\u7528\u4E0D\u4F1A\u5F15\u53D1\u521D\u59CB\u5316\u3002\u4F46\u4E0E\u6B64\u76F8\u53CD\uFF0C\u4F7F\u7528 <code>Class.forName()</code> \u6765\u4EA7\u751F <code>Class</code> \u5F15\u7528\u4F1A\u7ACB\u5373\u5C31\u8FDB\u884C\u521D\u59CB\u5316\uFF0C\u5982 <code>initable3</code>\u3002</p><p>\u5982\u679C\u4E00\u4E2A <code>static final</code> \u503C\u662F\u201C\u7F16\u8BD1\u671F\u5E38\u91CF\u201D\uFF08\u5982 <code>Initable.staticFinal</code>\uFF09\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u503C\u4E0D\u9700\u8981\u5BF9 <code>Initable</code> \u7C7B\u8FDB\u884C\u521D\u59CB\u5316\u5C31\u53EF\u4EE5\u88AB\u8BFB\u53D6\u3002\u4F46\u662F\uFF0C\u5982\u679C\u53EA\u662F\u5C06\u4E00\u4E2A\u5B57\u6BB5\u8BBE\u7F6E\u6210\u4E3A <code>static</code> \u548C <code>final</code>\uFF0C\u8FD8\u4E0D\u8DB3\u4EE5\u786E\u4FDD\u8FD9\u79CD\u884C\u4E3A\u3002\u4F8B\u5982\uFF0C\u5BF9 <code>Initable.staticFinal2</code> \u7684\u8BBF\u95EE\u5C06\u5F3A\u5236\u8FDB\u884C\u7C7B\u7684\u521D\u59CB\u5316\uFF0C\u56E0\u4E3A\u5B83\u4E0D\u662F\u4E00\u4E2A\u7F16\u8BD1\u671F\u5E38\u91CF\u3002</p><p>\u5982\u679C\u4E00\u4E2A <code>static</code> \u5B57\u6BB5\u4E0D\u662F <code>final</code> \u7684\uFF0C\u90A3\u4E48\u5728\u5BF9\u5B83\u8BBF\u95EE\u65F6\uFF0C\u603B\u662F\u8981\u6C42\u5728\u5B83\u88AB\u8BFB\u53D6\u4E4B\u524D\uFF0C\u8981\u5148\u8FDB\u884C\u94FE\u63A5\uFF08\u4E3A\u8FD9\u4E2A\u5B57\u6BB5\u5206\u914D\u5B58\u50A8\u7A7A\u95F4\uFF09\u548C\u521D\u59CB\u5316\uFF08\u521D\u59CB\u5316\u8BE5\u5B58\u50A8\u7A7A\u95F4\uFF09\uFF0C\u5C31\u50CF\u5728\u5BF9 <code>Initable2.staticNonFinal</code> \u7684\u8BBF\u95EE\u4E2D\u6240\u770B\u5230\u7684\u90A3\u6837\u3002</p><h3 id="\u6CDB\u5316\u7684-class-\u5F15\u7528" tabindex="-1"><a class="header-anchor" href="#\u6CDB\u5316\u7684-class-\u5F15\u7528" aria-hidden="true">#</a> \u6CDB\u5316\u7684 <code>Class</code> \u5F15\u7528</h3><p><code>Class</code> \u5F15\u7528\u603B\u662F\u6307\u5411\u67D0\u4E2A <code>Class</code> \u5BF9\u8C61\uFF0C\u800C <code>Class</code> \u5BF9\u8C61\u53EF\u4EE5\u7528\u4E8E\u4EA7\u751F\u7C7B\u7684\u5B9E\u4F8B\uFF0C\u5E76\u4E14\u5305\u542B\u53EF\u4F5C\u7528\u4E8E\u8FD9\u4E9B\u5B9E\u4F8B\u7684\u6240\u6709\u65B9\u6CD5\u4EE3\u7801\u3002\u5B83\u8FD8\u5305\u542B\u8BE5\u7C7B\u7684 <code>static</code> \u6210\u5458\uFF0C\u56E0\u6B64 <code>Class</code> \u5F15\u7528\u8868\u660E\u4E86\u5B83\u6240\u6307\u5411\u5BF9\u8C61\u7684\u786E\u5207\u7C7B\u578B\uFF0C\u800C\u8BE5\u5BF9\u8C61\u4FBF\u662F <code>Class</code> \u7C7B\u7684\u4E00\u4E2A\u5BF9\u8C61\u3002</p><p>\u4F46\u662F\uFF0CJava \u8BBE\u8BA1\u8005\u770B\u51C6\u673A\u4F1A\uFF0C\u5C06\u5B83\u7684\u7C7B\u578B\u53D8\u5F97\u66F4\u5177\u4F53\u4E86\u4E00\u4E9B\u3002Java \u5F15\u5165\u6CDB\u578B\u8BED\u6CD5\u4E4B\u540E\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u6CDB\u578B\u5BF9 <code>Class</code> \u5F15\u7528\u6240\u6307\u5411\u7684 <code>Class</code> \u5BF9\u8C61\u7684\u7C7B\u578B\u8FDB\u884C\u9650\u5B9A\u3002\u5728\u4E0B\u9762\u7684\u5B9E\u4F8B\u4E2D\uFF0C\u4E24\u79CD\u8BED\u6CD5\u90FD\u662F\u6B63\u786E\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/GenericClassReferences.java</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericClassReferences</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span> intClass <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> genericIntClass <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        genericIntClass <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span> <span class="token comment">// \u540C\u4E00\u4E2A\u4E1C\u897F</span>
        intClass <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token comment">// genericIntClass = double.class; // \u975E\u6CD5</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u666E\u901A\u7684\u7C7B\u5F15\u7528\u4E0D\u4F1A\u4EA7\u751F\u8B66\u544A\u4FE1\u606F\u3002\u4F60\u53EF\u4EE5\u770B\u5230\uFF0C\u666E\u901A\u7684\u7C7B\u5F15\u7528\u53EF\u4EE5\u91CD\u65B0\u8D4B\u503C\u6307\u5411\u4EFB\u4F55\u5176\u4ED6\u7684 <code>Class</code> \u5BF9\u8C61\uFF0C\u4F46\u662F\u4F7F\u7528\u6CDB\u578B\u9650\u5B9A\u7684\u7C7B\u5F15\u7528\u53EA\u80FD\u6307\u5411\u5176\u58F0\u660E\u7684\u7C7B\u578B\u3002\u901A\u8FC7\u4F7F\u7528\u6CDB\u578B\u8BED\u6CD5\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8BA9\u7F16\u8BD1\u5668\u5F3A\u5236\u6267\u884C\u989D\u5916\u7684\u7C7B\u578B\u68C0\u67E5\u3002</p><p>\u90A3\u5982\u679C\u6211\u4EEC\u5E0C\u671B\u7A0D\u5FAE\u653E\u677E\u4E00\u4E9B\u9650\u5236\uFF0C\u5E94\u8BE5\u600E\u4E48\u529E\u5462\uFF1F\u4E4D\u4E00\u770B\uFF0C\u4E0B\u9762\u7684\u64CD\u4F5C\u597D\u50CF\u662F\u53EF\u4EE5\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Number</span><span class="token punctuation">&gt;</span></span> geenericNumberClass <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u770B\u8D77\u6765\u4F3C\u4E4E\u662F\u8D77\u4F5C\u7528\u7684\uFF0C\u56E0\u4E3A <code>Integer</code> \u7EE7\u627F\u81EA <code>Number</code>\u3002\u4F46\u4E8B\u5B9E\u5374\u662F\u4E0D\u884C\uFF0C\u56E0\u4E3A <code>Integer</code> \u7684 <code>Class</code> \u5BF9\u8C61\u5E76\u4E0D\u662F <code>Number</code>\u7684 <code>Class</code> \u5BF9\u8C61\u7684\u5B50\u7C7B\uFF08\u8FD9\u770B\u8D77\u6765\u53EF\u80FD\u6709\u70B9\u8BE1\u5F02\uFF0C\u6211\u4EEC\u5C06\u5728<a href="./20-Generics">\u6CDB\u578B</a>\u8FD9\u4E00\u7AE0\u8BE6\u7EC6\u8BA8\u8BBA\uFF09\u3002</p><p>\u4E3A\u4E86\u5728\u4F7F\u7528 <code>Class</code> \u5F15\u7528\u65F6\u653E\u677E\u9650\u5236\uFF0C\u6211\u4EEC\u4F7F\u7528\u4E86\u901A\u914D\u7B26\uFF0C\u5B83\u662F Java \u6CDB\u578B\u4E2D\u7684\u4E00\u90E8\u5206\u3002\u901A\u914D\u7B26\u5C31\u662F <code>?</code>\uFF0C\u8868\u793A\u201C\u4EFB\u4F55\u4E8B\u7269\u201D\u3002\u56E0\u6B64\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728\u4E0A\u4F8B\u7684\u666E\u901A <code>Class</code> \u5F15\u7528\u4E2D\u6DFB\u52A0\u901A\u914D\u7B26\uFF0C\u5E76\u4EA7\u751F\u76F8\u540C\u7684\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/WildcardClassReferences.java</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WildcardClassReferences</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> intClass <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        intClass <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 <code>Class&lt;?&gt;</code> \u6BD4\u5355\u7EAF\u4F7F\u7528 <code>Class</code> \u8981\u597D\uFF0C\u867D\u7136\u5B83\u4EEC\u662F\u7B49\u4EF7\u7684\uFF0C\u5E76\u4E14\u5355\u7EAF\u4F7F\u7528 <code>Class</code> \u4E0D\u4F1A\u4EA7\u751F\u7F16\u8BD1\u5668\u8B66\u544A\u4FE1\u606F\u3002\u4F7F\u7528 <code>Class&lt;?&gt;</code> \u7684\u597D\u5904\u662F\u5B83\u8868\u793A\u4F60\u5E76\u975E\u662F\u78B0\u5DE7\u6216\u8005\u7531\u4E8E\u758F\u5FFD\u624D\u4F7F\u7528\u4E86\u4E00\u4E2A\u975E\u5177\u4F53\u7684\u7C7B\u5F15\u7528\uFF0C\u800C\u662F\u7279\u610F\u4E3A\u4E4B\u3002</p><p>\u4E3A\u4E86\u521B\u5EFA\u4E00\u4E2A\u9650\u5B9A\u6307\u5411\u67D0\u79CD\u7C7B\u578B\u6216\u5176\u5B50\u7C7B\u7684 <code>Class</code> \u5F15\u7528\uFF0C\u6211\u4EEC\u9700\u8981\u5C06\u901A\u914D\u7B26\u4E0E <code>extends</code> \u5173\u952E\u5B57\u914D\u5408\u4F7F\u7528\uFF0C\u521B\u5EFA\u4E00\u4E2A\u8303\u56F4\u9650\u5B9A\u3002\u8FD9\u4E0E\u4EC5\u4EC5\u58F0\u660E <code>Class&lt;Number&gt;</code> \u4E0D\u540C\uFF0C\u73B0\u5728\u505A\u5982\u4E0B\u58F0\u660E\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/BoundedClassReferences.java</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoundedClassReferences</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Number</span><span class="token punctuation">&gt;</span></span> bounded <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        bounded <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        bounded <span class="token operator">=</span> <span class="token class-name">Number</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token comment">// Or anything else derived from Number.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5411 <code>Class</code> \u5F15\u7528\u6DFB\u52A0\u6CDB\u578B\u8BED\u6CD5\u7684\u539F\u56E0\u53EA\u662F\u4E3A\u4E86\u63D0\u4F9B\u7F16\u8BD1\u671F\u7C7B\u578B\u68C0\u67E5\uFF0C\u56E0\u6B64\u5982\u679C\u4F60\u64CD\u4F5C\u6709\u8BEF\uFF0C\u7A0D\u540E\u5C31\u4F1A\u53D1\u73B0\u8FD9\u70B9\u3002\u4F7F\u7528\u666E\u901A\u7684 <code>Class</code> \u5F15\u7528\u4F60\u8981\u786E\u4FDD\u81EA\u5DF1\u4E0D\u4F1A\u72AF\u9519\uFF0C\u56E0\u4E3A\u4E00\u65E6\u4F60\u72AF\u4E86\u9519\u8BEF\uFF0C\u5C31\u8981\u7B49\u5230\u8FD0\u884C\u65F6\u624D\u80FD\u53D1\u73B0\u5B83\uFF0C\u5F88\u4E0D\u65B9\u4FBF\u3002</p><p>\u4E0B\u9762\u7684\u793A\u4F8B\u4F7F\u7528\u4E86\u6CDB\u578B\u8BED\u6CD5\uFF0C\u5B83\u4FDD\u5B58\u4E86\u4E00\u4E2A\u7C7B\u5F15\u7528\uFF0C\u7A0D\u540E\u53C8\u7528 <code>newInstance()</code> \u65B9\u6CD5\u4EA7\u751F\u7C7B\u7684\u5BF9\u8C61\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/DynamicSupplier.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CountedInteger</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> counter<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">long</span> id <span class="token operator">=</span> counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">DynamicSupplier</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> type<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InstantiationException</span> <span class="token operator">|</span>
                        <span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">DynamicSupplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">CountedInteger</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>10
11
12
13
14
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\uFF0C\u8FD9\u4E2A\u7C7B\u5FC5\u987B\u5047\u8BBE\u4E0E\u5B83\u4E00\u8D77\u5DE5\u4F5C\u7684\u4EFB\u4F55\u7C7B\u578B\u90FD\u6709\u4E00\u4E2A\u65E0\u53C2\u6784\u9020\u5668\uFF0C\u5426\u5219\u8FD0\u884C\u65F6\u4F1A\u629B\u51FA\u5F02\u5E38\u3002\u7F16\u8BD1\u671F\u5BF9\u8BE5\u7A0B\u5E8F\u4E0D\u4F1A\u4EA7\u751F\u4EFB\u4F55\u8B66\u544A\u4FE1\u606F\u3002</p><p>\u5F53\u4F60\u5C06\u6CDB\u578B\u8BED\u6CD5\u7528\u4E8E <code>Class</code> \u5BF9\u8C61\u65F6\uFF0C<code>newInstance()</code> \u5C06\u8FD4\u56DE\u8BE5\u5BF9\u8C61\u7684\u786E\u5207\u7C7B\u578B\uFF0C\u800C\u4E0D\u4EC5\u4EC5\u53EA\u662F\u5728 <code>ToyTest.java</code> \u4E2D\u770B\u5230\u7684\u57FA\u7C7B <code>Object</code>\u3002\u7136\u800C\uFF0C\u8FD9\u5728\u67D0\u79CD\u7A0B\u5EA6\u4E0A\u6709\u4E9B\u53D7\u9650\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/toys/GenericToyTest.java</span>
<span class="token comment">// \u6D4B\u8BD5 Class \u7C7B</span>
<span class="token comment">// {java typeinfo.toys.GenericToyTest}</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>toys</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericToyTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span>
    <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FancyToy</span><span class="token punctuation">&gt;</span></span> ftClass <span class="token operator">=</span> <span class="token class-name">FancyToy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token comment">// Produces exact type:</span>
        <span class="token class-name">FancyToy</span> fancyToy <span class="token operator">=</span> ftClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">FancyToy</span><span class="token punctuation">&gt;</span></span> up <span class="token operator">=</span>
            ftClass<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// This won&#39;t compile:</span>
        <span class="token comment">// Class&lt;Toy&gt; up2 = ftClass.getSuperclass();</span>
        <span class="token comment">// Only produces Object:</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> up<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C\u4F60\u624B\u5934\u7684\u662F\u8D85\u7C7B\uFF0C\u90A3\u7F16\u8BD1\u5668\u5C06\u53EA\u5141\u8BB8\u4F60\u58F0\u660E\u8D85\u7C7B\u5F15\u7528\u4E3A\u201C\u67D0\u4E2A\u7C7B\uFF0C\u5B83\u662F <code>FancyToy</code> \u7684\u8D85\u7C7B\u201D\uFF0C\u5C31\u50CF\u5728\u8868\u8FBE\u5F0F <code>Class&lt;? super FancyToy&gt;</code> \u4E2D\u6240\u770B\u5230\u7684\u90A3\u6837\u3002\u800C\u4E0D\u4F1A\u63A5\u6536 <code>Class&lt;Toy&gt;</code> \u8FD9\u6837\u7684\u58F0\u660E\u3002\u8FD9\u770B\u4E0A\u53BB\u663E\u5F97\u6709\u4E9B\u602A\uFF0C\u56E0\u4E3A <code>getSuperClass()</code> \u65B9\u6CD5\u8FD4\u56DE\u7684\u662F\u57FA\u7C7B\uFF08\u4E0D\u662F\u63A5\u53E3\uFF09\uFF0C\u5E76\u4E14\u7F16\u8BD1\u5668\u5728\u7F16\u8BD1\u671F\u5C31\u77E5\u9053\u5B83\u662F\u4EC0\u4E48\u7C7B\u578B\u4E86\uFF08\u5728\u672C\u4F8B\u4E2D\u5C31\u662F <code>Toy.class</code>\uFF09\uFF0C\u800C\u4E0D\u4EC5\u4EC5\u53EA\u662F&quot;\u67D0\u4E2A\u7C7B&quot;\u3002\u4E0D\u7BA1\u600E\u6837\uFF0C\u6B63\u662F\u7531\u4E8E\u8FD9\u79CD\u542B\u7CCA\u6027\uFF0C<code>up.newInstance</code> \u7684\u8FD4\u56DE\u503C\u4E0D\u662F\u7CBE\u786E\u7C7B\u578B\uFF0C\u800C\u53EA\u662F <code>Object</code>\u3002</p><h3 id="cast-\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#cast-\u65B9\u6CD5" aria-hidden="true">#</a> <code>cast()</code> \u65B9\u6CD5</h3><p>Java \u4E2D\u8FD8\u6709\u7528\u4E8E <code>Class</code> \u5F15\u7528\u7684\u8F6C\u578B\u8BED\u6CD5\uFF0C\u5373 <code>cast()</code> \u65B9\u6CD5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/ClassCasts.java</span>

<span class="token keyword">class</span> <span class="token class-name">Building</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">House</span> <span class="token keyword">extends</span> <span class="token class-name">Building</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassCasts</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Building</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">House</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">House</span><span class="token punctuation">&gt;</span></span> houseType <span class="token operator">=</span> <span class="token class-name">House</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token class-name">House</span> h <span class="token operator">=</span> houseType<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        h <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">House</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span> <span class="token comment">// ... \u6216\u8005\u8FD9\u6837\u505A.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>cast()</code> \u65B9\u6CD5\u63A5\u53D7\u53C2\u6570\u5BF9\u8C61\uFF0C\u5E76\u5C06\u5176\u7C7B\u578B\u8F6C\u6362\u4E3A <code>Class</code> \u5F15\u7528\u7684\u7C7B\u578B\u3002\u4F46\u662F\uFF0C\u5982\u679C\u89C2\u5BDF\u4E0A\u9762\u7684\u4EE3\u7801\uFF0C\u4F60\u5C31\u4F1A\u53D1\u73B0\uFF0C\u4E0E\u5B9E\u73B0\u4E86\u76F8\u540C\u529F\u80FD\u7684 <code>main</code> \u65B9\u6CD5\u4E2D\u6700\u540E\u4E00\u884C\u76F8\u6BD4\uFF0C\u8FD9\u79CD\u8F6C\u578B\u597D\u50CF\u505A\u4E86\u5F88\u591A\u989D\u5916\u7684\u5DE5\u4F5C\u3002</p><p><code>cast()</code> \u5728\u65E0\u6CD5\u4F7F\u7528\u666E\u901A\u7C7B\u578B\u8F6C\u6362\u7684\u60C5\u51B5\u4E0B\u4F1A\u663E\u5F97\u975E\u5E38\u6709\u7528\uFF0C\u5728\u4F60\u7F16\u5199\u6CDB\u578B\u4EE3\u7801\uFF08\u4F60\u5C06\u5728<a href="./20-Generics">\u6CDB\u578B</a>\u8FD9\u4E00\u7AE0\u5B66\u4E60\u5230\uFF09\u65F6\uFF0C\u5982\u679C\u4F60\u4FDD\u5B58\u4E86 <code>Class</code> \u5F15\u7528\uFF0C\u5E76\u5E0C\u671B\u4EE5\u540E\u901A\u8FC7\u8FD9\u4E2A\u5F15\u7528\u6765\u6267\u884C\u8F6C\u578B\uFF0C\u4F60\u5C31\u9700\u8981\u7528\u5230 <code>cast()</code>\u3002\u4F46\u4E8B\u5B9E\u5374\u662F\u8FD9\u79CD\u60C5\u51B5\u975E\u5E38\u5C11\u89C1\uFF0C\u6211\u53D1\u73B0\u6574\u4E2A Java \u7C7B\u5E93\u4E2D\uFF0C\u53EA\u6709\u4E00\u5904\u4F7F\u7528\u4E86 <code>cast()</code>\uFF08\u5728 <code>com.sun.mirror.util.DeclarationFilter</code> \u4E2D\uFF09\u3002</p><p>Java \u7C7B\u5E93\u4E2D\u53E6\u4E00\u4E2A\u6CA1\u6709\u4EFB\u4F55\u7528\u5904\u7684\u7279\u6027\u5C31\u662F <code>Class.asSubclass()</code>\uFF0C\u8BE5\u65B9\u6CD5\u5141\u8BB8\u4F60\u5C06\u4E00\u4E2A <code>Class</code> \u5BF9\u8C61\u8F6C\u578B\u4E3A\u66F4\u52A0\u5177\u4F53\u7684\u7C7B\u578B\u3002</p><h2 id="\u7C7B\u578B\u8F6C\u6362\u68C0\u6D4B" tabindex="-1"><a class="header-anchor" href="#\u7C7B\u578B\u8F6C\u6362\u68C0\u6D4B" aria-hidden="true">#</a> \u7C7B\u578B\u8F6C\u6362\u68C0\u6D4B</h2><p>\u76F4\u5230\u73B0\u5728\uFF0C\u6211\u4EEC\u5DF2\u77E5\u7684 RTTI \u7C7B\u578B\u5305\u62EC\uFF1A</p><ol><li><p>\u4F20\u7EDF\u7684\u7C7B\u578B\u8F6C\u6362\uFF0C\u5982 \u201C<code>(Shape)</code>\u201D\uFF0C\u7531 RTTI \u786E\u4FDD\u8F6C\u6362\u7684\u6B63\u786E\u6027\uFF0C\u5982\u679C\u6267\u884C\u4E86\u4E00\u4E2A\u9519\u8BEF\u7684\u7C7B\u578B\u8F6C\u6362\uFF0C\u5C31\u4F1A\u629B\u51FA\u4E00\u4E2A <code>ClassCastException</code> \u5F02\u5E38\u3002</p></li><li><p>\u4EE3\u8868\u5BF9\u8C61\u7C7B\u578B\u7684 <code>Class</code> \u5BF9\u8C61. \u901A\u8FC7\u67E5\u8BE2 <code>Class</code> \u5BF9\u8C61\u53EF\u4EE5\u83B7\u53D6\u8FD0\u884C\u65F6\u6240\u9700\u7684\u4FE1\u606F.</p></li></ol><p>\u5728 C++ \u4E2D\uFF0C\u7ECF\u5178\u7684\u7C7B\u578B\u8F6C\u6362 \u201C<code>(Shape)</code>\u201D \u5E76\u4E0D\u4F7F\u7528 RTTI\u3002\u5B83\u53EA\u662F\u7B80\u5355\u5730\u544A\u8BC9\u7F16\u8BD1\u5668\u5C06\u8FD9\u4E2A\u5BF9\u8C61\u4F5C\u4E3A\u65B0\u7684\u7C7B\u578B\u5BF9\u5F85. \u800C Java \u4F1A\u8FDB\u884C\u7C7B\u578B\u68C0\u67E5\uFF0C\u8FD9\u79CD\u7C7B\u578B\u8F6C\u6362\u4E00\u822C\u88AB\u79F0\u4F5C\u201C\u7C7B\u578B\u5B89\u5168\u7684\u5411\u4E0B\u8F6C\u578B\u201D\u3002\u4E4B\u6240\u4EE5\u79F0\u4F5C\u201C\u5411\u4E0B\u8F6C\u578B\u201D\uFF0C\u662F\u56E0\u4E3A\u4F20\u7EDF\u4E0A\u7C7B\u7EE7\u627F\u56FE\u662F\u8FD9\u4E48\u753B\u7684\u3002\u5C06 <code>Circle</code> \u8F6C\u6362\u4E3A <code>Shape</code> \u662F\u4E00\u6B21\u5411\u4E0A\u8F6C\u578B, \u5C06 <code>Shape</code> \u8F6C\u6362\u4E3A <code>Circle</code> \u662F\u4E00\u6B21\u5411\u4E0B\u8F6C\u578B\u3002\u4F46\u662F, \u56E0\u4E3A\u6211\u4EEC\u77E5\u9053 <code>Circle</code> \u80AF\u5B9A\u662F\u4E00\u4E2A <code>Shape</code>\uFF0C\u6240\u4EE5\u7F16\u8BD1\u5668\u5141\u8BB8\u6211\u4EEC\u81EA\u7531\u5730\u505A\u5411\u4E0A\u8F6C\u578B\u7684\u8D4B\u503C\u64CD\u4F5C\uFF0C\u4E14\u4E0D\u9700\u8981\u4EFB\u4F55\u663E\u5F0F\u7684\u8F6C\u578B\u64CD\u4F5C\u3002\u5F53\u4F60\u7ED9\u7F16\u8BD1\u5668\u4E00\u4E2A <code>Shape</code> \u7684\u65F6\u5019\uFF0C\u7F16\u8BD1\u5668\u5E76\u4E0D\u77E5\u9053\u5B83\u5230\u5E95\u662F\u4EC0\u4E48\u7C7B\u578B\u7684 <code>Shape</code>\u2014\u2014\u5B83\u53EF\u80FD\u662F <code>Shape</code>\uFF0C\u4E5F\u53EF\u80FD\u662F <code>Shape</code> \u7684\u5B50\u7C7B\u578B\uFF0C\u4F8B\u5982 <code>Circle</code>\u3001<code>Square</code>\u3001<code>Triangle</code> \u6216\u67D0\u79CD\u5176\u4ED6\u7684\u7C7B\u578B\u3002\u5728\u7F16\u8BD1\u671F\uFF0C\u7F16\u8BD1\u5668\u53EA\u80FD\u77E5\u9053\u5B83\u662F <code>Shape</code>\u3002\u56E0\u6B64\uFF0C\u4F60\u9700\u8981\u4F7F\u7528\u663E\u5F0F\u5730\u8FDB\u884C\u7C7B\u578B\u8F6C\u6362\uFF0C\u4EE5\u544A\u77E5\u7F16\u8BD1\u5668\u4F60\u60F3\u8F6C\u6362\u7684\u7279\u5B9A\u7C7B\u578B\uFF0C\u5426\u5219\u7F16\u8BD1\u5668\u5C31\u4E0D\u5141\u8BB8\u4F60\u6267\u884C\u5411\u4E0B\u8F6C\u578B\u8D4B\u503C\u3002 \uFF08\u7F16\u8BD1\u5668\u5C06\u4F1A\u68C0\u67E5\u5411\u4E0B\u8F6C\u578B\u662F\u5426\u5408\u7406\uFF0C\u56E0\u6B64\u5B83\u4E0D\u5141\u8BB8\u5411\u4E0B\u8F6C\u578B\u5230\u5B9E\u9645\u4E0D\u662F\u5F85\u8F6C\u578B\u7C7B\u578B\u7684\u5B50\u7C7B\u7C7B\u578B\u4E0A\uFF09\u3002</p><p>RTTI \u5728 Java \u4E2D\u8FD8\u6709\u7B2C\u4E09\u79CD\u5F62\u5F0F\uFF0C\u90A3\u5C31\u662F\u5173\u952E\u5B57 <code>instanceof</code>\u3002\u5B83\u8FD4\u56DE\u4E00\u4E2A\u5E03\u5C14\u503C\uFF0C\u544A\u8BC9\u6211\u4EEC\u5BF9\u8C61\u662F\u4E0D\u662F\u67D0\u4E2A\u7279\u5B9A\u7C7B\u578B\u7684\u5B9E\u4F8B\uFF0C\u53EF\u4EE5\u7528\u63D0\u95EE\u7684\u65B9\u5F0F\u4F7F\u7528\u5B83\uFF0C\u5C31\u50CF\u8FD9\u4E2A\u6837\u5B50\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">Dog</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Dog</span><span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u5C06 <code>x</code> \u7684\u7C7B\u578B\u8F6C\u6362\u4E3A <code>Dog</code> \u4E4B\u524D\uFF0C<code>if</code> \u8BED\u53E5\u4F1A\u5148\u68C0\u67E5 <code>x</code> \u662F\u5426\u662F <code>Dog</code> \u7C7B\u578B\u7684\u5BF9\u8C61\u3002\u8FDB\u884C\u5411\u4E0B\u8F6C\u578B\u524D\uFF0C\u5982\u679C\u6CA1\u6709\u5176\u4ED6\u4FE1\u606F\u53EF\u4EE5\u544A\u8BC9\u4F60\u8FD9\u4E2A\u5BF9\u8C61\u662F\u4EC0\u4E48\u7C7B\u578B\uFF0C\u90A3\u4E48\u4F7F\u7528 <code>instanceof</code> \u662F\u975E\u5E38\u91CD\u8981\u7684\uFF0C\u5426\u5219\u4F1A\u5F97\u5230\u4E00\u4E2A <code>ClassCastException</code> \u5F02\u5E38\u3002</p><p>\u4E00\u822C\uFF0C\u53EF\u80FD\u60F3\u8981\u67E5\u627E\u67D0\u79CD\u7C7B\u578B\uFF08\u6BD4\u5982\u8981\u627E\u4E09\u89D2\u5F62\uFF0C\u5E76\u586B\u5145\u4E3A\u7D2B\u8272\uFF09\uFF0C\u8FD9\u65F6\u53EF\u4EE5\u8F7B\u677E\u5730\u4F7F\u7528 <code>instanceof</code> \u6765\u5EA6\u91CF\u6240\u6709\u5BF9\u8C61\u3002\u4E3E\u4E2A\u4F8B\u5B50\uFF0C\u5047\u5982\u4F60\u6709\u4E00\u4E2A\u7C7B\u7684\u7EE7\u627F\u4F53\u7CFB\uFF0C\u63CF\u8FF0\u4E86 <code>Pet</code>\uFF08\u4EE5\u53CA\u5B83\u4EEC\u7684\u4E3B\u4EBA\uFF0C\u5728\u540E\u9762\u4E00\u4E2A\u4F8B\u5B50\u4E2D\u4F1A\u7528\u5230\u8FD9\u4E2A\u7279\u6027\uFF09\u3002\u5728\u8FD9\u4E2A\u7EE7\u627F\u4F53\u7CFB\u4E2D\u7684\u6BCF\u4E2A <code>Individual</code> \u90FD\u6709\u4E00\u4E2A <code>id</code> \u548C\u4E00\u4E2A\u53EF\u9009\u7684\u540D\u5B57\u3002\u5C3D\u7BA1\u4E0B\u9762\u7684\u7C7B\u90FD\u7EE7\u627F\u81EA <code>Individual</code>\uFF0C\u4F46\u662F <code>Individual</code> \u7C7B\u590D\u6742\u6027\u8F83\u9AD8\uFF0C\u56E0\u6B64\u5176\u4EE3\u7801\u5C06\u653E\u5728<a href="./Appendix-Collection-Topics">\u9644\u5F55\uFF1A\u5BB9\u5668</a>\u4E2D\u8FDB\u884C\u89E3\u91CA\u8BF4\u660E\u3002\u6B63\u5982\u4F60\u6240\u770B\u5230\u7684\uFF0C\u6B64\u5904\u5E76\u4E0D\u9700\u8981\u53BB\u4E86\u89E3 <code>Individual</code> \u7684\u4EE3\u7801\u2014\u2014\u4F60\u53EA\u9700\u4E86\u89E3\u4F60\u53EF\u4EE5\u521B\u5EFA\u5176\u5177\u540D\u6216\u4E0D\u5177\u540D\u7684\u5BF9\u8C61\uFF0C\u5E76\u4E14\u6BCF\u4E2A <code>Individual</code> \u90FD\u6709\u4E00\u4E2A <code>id()</code> \u65B9\u6CD5\uFF0C\u5982\u679C\u4F60\u6CA1\u6709\u4E3A <code>Individual</code> \u63D0\u4F9B\u540D\u5B57\uFF0C<code>toString()</code> \u65B9\u6CD5\u53EA\u4EA7\u751F\u7C7B\u578B\u540D\u3002</p><p>\u4E0B\u9762\u662F\u7EE7\u627F\u81EA <code>Individual</code> \u7684\u7C7B\u7684\u7EE7\u627F\u4F53\u7CFB\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Person.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Individual</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Pet.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pet</span> <span class="token keyword">extends</span> <span class="token class-name">Individual</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Pet</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Pet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Dog.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Mutt.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mutt</span> <span class="token keyword">extends</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Mutt</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Mutt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Pug.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pug</span> <span class="token keyword">extends</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Pug</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Pug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Cat.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/EgyptianMau.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EgyptianMau</span> <span class="token keyword">extends</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">EgyptianMau</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">EgyptianMau</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Manx.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Manx</span> <span class="token keyword">extends</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Manx</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Manx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Cymric.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cymric</span> <span class="token keyword">extends</span> <span class="token class-name">Manx</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Cymric</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Cymric</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Rodent.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rodent</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Rodent</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Rodent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Rat.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rat</span> <span class="token keyword">extends</span> <span class="token class-name">Rodent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Rat</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Rat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Mouse.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mouse</span> <span class="token keyword">extends</span> <span class="token class-name">Rodent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Mouse</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Mouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Hamster.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hamster</span> <span class="token keyword">extends</span> <span class="token class-name">Rodent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Hamster</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Hamster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u5FC5\u987B\u663E\u5F0F\u5730\u4E3A\u6BCF\u4E00\u4E2A\u5B50\u7C7B\u7F16\u5199\u65E0\u53C2\u6784\u9020\u5668\u3002\u56E0\u4E3A\u6211\u4EEC\u6709\u4E00\u4E2A\u5E26\u4E00\u4E2A\u53C2\u6570\u7684\u6784\u9020\u5668\uFF0C\u6240\u4EE5\u7F16\u8BD1\u5668\u4E0D\u4F1A\u81EA\u52A8\u5730\u4E3A\u6211\u4EEC\u52A0\u4E0A\u65E0\u53C2\u6784\u9020\u5668\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u9700\u8981\u4E00\u4E2A\u7C7B\uFF0C\u5B83\u53EF\u4EE5\u968F\u673A\u5730\u521B\u5EFA\u4E0D\u540C\u7C7B\u578B\u7684\u5BA0\u7269\uFF0C\u540C\u65F6\uFF0C\u5B83\u8FD8\u53EF\u4EE5\u521B\u5EFA\u5BA0\u7269\u6570\u7EC4\u548C\u6301\u6709\u5BA0\u7269\u7684 <code>List</code>\u3002\u4E3A\u4E86\u4F7F\u8FD9\u4E2A\u7C7B\u66F4\u52A0\u666E\u904D\u9002\u7528\uFF0C\u6211\u4EEC\u5C06\u5176\u5B9A\u4E49\u4E3A\u62BD\u8C61\u7C7B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/PetCreator.java</span>
<span class="token comment">// Creates random sequences of Pets</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">PetCreator</span> <span class="token keyword">implements</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pet</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Random</span> rand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// The List of the different types of Pet to create:</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Pet</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Create one random Pet</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> rand<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InstantiationException</span> <span class="token operator">|</span>
                <span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u62BD\u8C61\u7684 <code>types()</code> \u65B9\u6CD5\u9700\u8981\u5B50\u7C7B\u6765\u5B9E\u73B0\uFF0C\u4EE5\u6B64\u6765\u83B7\u53D6 <code>Class</code> \u5BF9\u8C61\u6784\u6210\u7684 <code>List</code>\uFF08\u8FD9\u662F\u6A21\u677F\u65B9\u6CD5\u8BBE\u8BA1\u6A21\u5F0F\u7684\u4E00\u79CD\u53D8\u4F53\uFF09\u3002\u6CE8\u610F\uFF0C\u5176\u4E2D\u7C7B\u7684\u7C7B\u578B\u88AB\u5B9A\u4E49\u4E3A\u201C\u4EFB\u4F55\u4ECE <code>Pet</code> \u5BFC\u51FA\u7684\u7C7B\u578B\u201D\uFF0C\u56E0\u6B64 <code>newInstance()</code> \u4E0D\u9700\u8981\u8F6C\u578B\u5C31\u53EF\u4EE5\u4EA7\u751F <code>Pet</code>\u3002<code>get()</code> \u968F\u673A\u7684\u9009\u53D6\u51FA\u4E00\u4E2A <code>Class</code> \u5BF9\u8C61\uFF0C\u7136\u540E\u53EF\u4EE5\u901A\u8FC7 <code>Class.newInstance()</code> \u6765\u751F\u6210\u8BE5\u7C7B\u7684\u65B0\u5B9E\u4F8B\u3002</p><p>\u5728\u8C03\u7528 <code>newInstance()</code> \u65F6\uFF0C\u53EF\u80FD\u4F1A\u51FA\u73B0\u4E24\u79CD\u5F02\u5E38\u3002\u5728\u7D27\u8DDF <code>try</code> \u8BED\u53E5\u5757\u540E\u9762\u7684 <code>catch</code> \u5B50\u53E5\u4E2D\u53EF\u4EE5\u770B\u5230\u5BF9\u5B83\u4EEC\u7684\u5904\u7406\u3002\u5F02\u5E38\u7684\u540D\u5B57\u518D\u6B21\u6210\u4E3A\u4E86\u4E00\u79CD\u5BF9\u9519\u8BEF\u7C7B\u578B\u76F8\u5BF9\u6BD4\u8F83\u6709\u7528\u7684\u89E3\u91CA\uFF08<code>IllegalAccessException</code> \u8FDD\u53CD\u4E86 Java \u5B89\u5168\u673A\u5236\uFF0C\u5728\u672C\u4F8B\u4E2D\uFF0C\u8868\u793A\u9ED8\u8BA4\u6784\u9020\u5668\u4E3A <code>private</code> \u7684\u60C5\u51B5\uFF09\u3002</p><p>\u5F53\u4F60\u521B\u5EFA <code>PetCreator</code> \u7684\u5B50\u7C7B\u65F6\uFF0C\u4F60\u9700\u8981\u4E3A <code>get()</code> \u65B9\u6CD5\u63D0\u4F9B <code>Pet</code> \u7C7B\u578B\u7684 <code>List</code>\u3002<code>types()</code> \u65B9\u6CD5\u4F1A\u7B80\u5355\u5730\u8FD4\u56DE\u4E00\u4E2A\u9759\u6001 <code>List</code> \u7684\u5F15\u7528\u3002\u4E0B\u9762\u662F\u4F7F\u7528 <code>forName()</code> \u7684\u4E00\u4E2A\u5177\u4F53\u5B9E\u73B0\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/ForNameCreator.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForNameCreator</span> <span class="token keyword">extends</span> <span class="token class-name">PetCreator</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> types <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u9700\u8981\u968F\u673A\u751F\u6210\u7684\u7C7B\u578B\u540D:</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> typeNames <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;typeinfo.pets.Mutt&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;typeinfo.pets.Pug&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;typeinfo.pets.EgyptianMau&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;typeinfo.pets.Manx&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;typeinfo.pets.Cymric&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;typeinfo.pets.Rat&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;typeinfo.pets.Mouse&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;typeinfo.pets.Hamster&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> typeNames<span class="token punctuation">)</span>
                types<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
                        <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> types<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>loader()</code> \u65B9\u6CD5\u4F7F\u7528 <code>Class.forName()</code> \u521B\u5EFA\u4E86 <code>Class</code> \u5BF9\u8C61\u7684 <code>List</code>\u3002\u8FD9\u53EF\u80FD\u4F1A\u5BFC\u81F4 <code>ClassNotFoundException</code> \u5F02\u5E38\uFF0C\u56E0\u4E3A\u4F60\u4F20\u5165\u7684\u662F\u4E00\u4E2A <code>String</code> \u7C7B\u578B\u7684\u53C2\u6570\uFF0C\u5B83\u4E0D\u80FD\u5728\u7F16\u8BD1\u671F\u95F4\u88AB\u786E\u8BA4\u662F\u5426\u5408\u7406\u3002\u7531\u4E8E <code>Pet</code> \u76F8\u5173\u7684\u6587\u4EF6\u5728 <code>typeinfo</code> \u5305\u91CC\u9762\uFF0C\u6240\u4EE5\u4F7F\u7528\u5B83\u4EEC\u7684\u65F6\u5019\u9700\u8981\u586B\u5199\u5B8C\u6574\u7684\u5305\u540D\u3002</p><p>\u4E3A\u4E86\u4F7F\u5F97 <code>List</code> \u88C5\u5165\u7684\u662F\u5177\u4F53\u7684 <code>Class</code> \u5BF9\u8C61\uFF0C\u7C7B\u578B\u8F6C\u6362\u662F\u5FC5\u987B\u7684\uFF0C\u5B83\u4F1A\u4EA7\u751F\u4E00\u4E2A\u7F16\u8BD1\u65F6\u8B66\u544A\u3002<code>loader()</code> \u65B9\u6CD5\u662F\u5206\u5F00\u7F16\u5199\u7684\uFF0C\u7136\u540E\u5B83\u88AB\u653E\u5165\u5230\u4E00\u4E2A\u9759\u6001\u4EE3\u7801\u5757\u91CC\uFF0C\u56E0\u4E3A <code>@SuppressWarning</code> \u6CE8\u89E3\u4E0D\u80FD\u591F\u76F4\u63A5\u653E\u7F6E\u5728\u9759\u6001\u4EE3\u7801\u5757\u4E4B\u4E0A\u3002</p><p>\u4E3A\u4E86\u5BF9 <code>Pet</code> \u8FDB\u884C\u8BA1\u6570\uFF0C\u6211\u4EEC\u9700\u8981\u4E00\u4E2A\u80FD\u8DDF\u8E2A\u4E0D\u540C\u7C7B\u578B\u7684 <code>Pet</code> \u7684\u5DE5\u5177\u3002<code>Map</code> \u662F\u8FD9\u4E2A\u9700\u6C42\u7684\u9996\u9009\uFF0C\u6211\u4EEC\u5C06 <code>Pet</code> \u7C7B\u578B\u540D\u4F5C\u4E3A\u952E\uFF0C\u5C06\u4FDD\u5B58 <code>Pet</code> \u6570\u91CF\u7684 <code>Integer</code> \u4F5C\u4E3A\u503C\u3002\u901A\u8FC7\u8FD9\u79CD\u65B9\u5F0F\uFF0C\u4F60\u5C31\u53EF\u4EE5\u8BE2\u95EE\uFF1A\u201C\u6709\u591A\u5C11\u4E2A <code>Hamster</code> \u5BF9\u8C61\uFF1F\u201D\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 <code>instanceof</code> \u6765\u5BF9 <code>Pet</code> \u8FDB\u884C\u8BA1\u6570\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/PetCount.java</span>
<span class="token comment">// \u4F7F\u7528 instanceof</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>pets<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PetCount</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Integer</span> quantity <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>quantity <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token function">put</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">put</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> quantity <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span>
    <span class="token function">countPets</span><span class="token punctuation">(</span><span class="token class-name">PetCreator</span> creator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Counter</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Pet</span> pet <span class="token operator">:</span> <span class="token class-name">Pets</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// List each individual pet:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>
                    pet<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Pet</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Pet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Dog</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Dog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Mutt</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Mutt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Pug</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Pug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Cat</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Cat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">EgyptianMau</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;EgyptianMau&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Manx</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Manx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Cymric</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Cymric&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Rodent</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Rodent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Rat</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Rat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Mouse</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Mouse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pet <span class="token keyword">instanceof</span> <span class="token class-name">Hamster</span><span class="token punctuation">)</span>
                counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token string">&quot;Hamster&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Show the counts:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">countPets</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ForNameCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Rat Manx Cymric Mutt Pug Cymric Pug Manx Cymric Rat
EgyptianMau Hamster EgyptianMau Mutt Mutt Cymric Mouse
Pug Mouse Cymric
{EgyptianMau=2, Pug=3, Rat=2, Cymric=5, Mouse=2, Cat=9,
Manx=7, Rodent=5, Mutt=3, Dog=6, Pet=20, Hamster=1}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 <code>countPets()</code> \u4E2D\uFF0C\u4E00\u4E2A\u7B80\u77ED\u7684\u9759\u6001\u65B9\u6CD5 <code>Pets.array()</code> \u751F\u4EA7\u51FA\u4E86\u4E00\u4E2A\u968F\u673A\u52A8\u7269\u7684\u96C6\u5408\u3002\u6BCF\u4E2A <code>Pet</code> \u90FD\u88AB <code>instanceof</code> \u68C0\u6D4B\u5230\u5E76\u8BA1\u7B97\u4E86\u4E00\u904D\u3002</p><p><code>instanceof</code> \u6709\u4E00\u4E2A\u4E25\u683C\u7684\u9650\u5236\uFF1A\u53EA\u53EF\u4EE5\u5C06\u5B83\u4E0E\u547D\u540D\u7C7B\u578B\u8FDB\u884C\u6BD4\u8F83\uFF0C\u800C\u4E0D\u80FD\u4E0E <code>Class</code> \u5BF9\u8C61\u4F5C\u6BD4\u8F83\u3002\u5728\u524D\u9762\u7684\u4F8B\u5B50\u4E2D\uFF0C\u4F60\u53EF\u80FD\u4F1A\u89C9\u5F97\u5199\u51FA\u4E00\u5927\u5806 <code>instanceof</code> \u8868\u8FBE\u5F0F\u5F88\u4E4F\u5473\uFF0C\u4E8B\u5B9E\u4E5F\u662F\u5982\u6B64\u3002\u4F46\u662F\uFF0C\u4E5F\u6CA1\u6709\u529E\u6CD5\u8BA9 <code>instanceof</code> \u806A\u660E\u8D77\u6765\uFF0C\u8BA9\u5B83\u80FD\u591F\u81EA\u52A8\u5730\u521B\u5EFA\u4E00\u4E2A <code>Class</code> \u5BF9\u8C61\u7684\u6570\u7EC4\uFF0C\u7136\u540E\u5C06\u76EE\u6807\u4E0E\u8FD9\u4E2A\u6570\u7EC4\u4E2D\u7684\u5BF9\u8C61\u9010\u4E00\u8FDB\u884C\u6BD4\u8F83\uFF08\u7A0D\u540E\u4F1A\u770B\u5230\u4E00\u79CD\u66FF\u4EE3\u65B9\u6848\uFF09\u3002\u5176\u5B9E\u8FD9\u5E76\u4E0D\u662F\u90A3\u4E48\u5927\u7684\u9650\u5236\uFF0C\u5982\u679C\u4F60\u5728\u7A0B\u5E8F\u4E2D\u5199\u4E86\u5927\u91CF\u7684 <code>instanceof</code>\uFF0C\u90A3\u5C31\u8BF4\u660E\u4F60\u7684\u8BBE\u8BA1\u53EF\u80FD\u5B58\u5728\u7455\u75B5\u3002</p><h3 id="\u4F7F\u7528\u7C7B\u5B57\u9762\u91CF" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u7C7B\u5B57\u9762\u91CF" aria-hidden="true">#</a> \u4F7F\u7528\u7C7B\u5B57\u9762\u91CF</h3><p>\u5982\u679C\u6211\u4EEC\u4F7F\u7528\u7C7B\u5B57\u9762\u91CF\u91CD\u65B0\u5B9E\u73B0 <code>PetCreator</code> \u7C7B\u7684\u8BDD\uFF0C\u5176\u7ED3\u679C\u5728\u5F88\u591A\u65B9\u9762\u90FD\u4F1A\u66F4\u6E05\u6670\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/LiteralPetCreator.java</span>
<span class="token comment">// \u4F7F\u7528\u7C7B\u5B57\u9762\u91CF</span>
<span class="token comment">// {java typeinfo.pets.LiteralPetCreator}</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LiteralPetCreator</span> <span class="token keyword">extends</span> <span class="token class-name">PetCreator</span> <span class="token punctuation">{</span>
    <span class="token comment">// try \u4EE3\u7801\u5757\u4E0D\u518D\u9700\u8981</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> ALL_TYPES <span class="token operator">=</span>
            <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
                    <span class="token class-name">Pet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Cat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Rodent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                    <span class="token class-name">Mutt</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Pug</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">EgyptianMau</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                    <span class="token class-name">Manx</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Cymric</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Rat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                    <span class="token class-name">Mouse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Hamster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u7528\u4E8E\u968F\u673A\u521B\u5EFA\u7684\u7C7B\u578B:</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> TYPES <span class="token operator">=</span>
            ALL_TYPES<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span>ALL_TYPES<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token class-name">Mutt</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    ALL_TYPES<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">types</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TYPES<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>TYPES<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[class typeinfo.pets.Mutt, class typeinfo.pets.Pug,
class typeinfo.pets.EgyptianMau, class
typeinfo.pets.Manx, class typeinfo.pets.Cymric, class
typeinfo.pets.Rat, class typeinfo.pets.Mouse, class
typeinfo.pets.Hamster]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u5373\u5C06\u5230\u6765\u7684 <code>PetCount3.java</code> \u793A\u4F8B\u4E2D\uFF0C\u6211\u4EEC\u7528\u6240\u6709 <code>Pet</code> \u7C7B\u578B\u9884\u5148\u52A0\u8F7D\u4E00\u4E2A <code>Map</code>\uFF08\u4E0D\u4EC5\u4EC5\u662F\u968F\u673A\u751F\u6210\u7684\uFF09\uFF0C\u56E0\u6B64 <code>ALL_TYPES</code> \u7C7B\u578B\u7684\u5217\u8868\u662F\u5FC5\u8981\u7684\u3002<code>types</code> \u5217\u8868\u662F <code>ALL_TYPES</code> \u7C7B\u578B\uFF08\u4F7F\u7528 <code>List.subList()</code> \u521B\u5EFA\uFF09\u7684\u4E00\u90E8\u5206\uFF0C\u5B83\u5305\u542B\u7CBE\u786E\u7684\u5BA0\u7269\u7C7B\u578B\uFF0C\u56E0\u6B64\u7528\u4E8E\u968F\u673A\u751F\u6210 <code>Pet</code>\u3002</p><p>\u8FD9\u6B21\uFF0C<code>types</code> \u7684\u521B\u5EFA\u6CA1\u6709\u88AB <code>try</code> \u5757\u5305\u56F4\uFF0C\u56E0\u4E3A\u5B83\u662F\u5728\u7F16\u8BD1\u65F6\u8BA1\u7B97\u7684\uFF0C\u56E0\u6B64\u4E0D\u4F1A\u5F15\u53D1\u4EFB\u4F55\u5F02\u5E38\uFF0C\u4E0D\u50CF <code>Class.forName()</code>\u3002</p><p>\u6211\u4EEC\u73B0\u5728\u5728 <code>typeinfo.pets</code> \u5E93\u4E2D\u6709\u4E24\u4E2A <code>PetCreator</code> \u7684\u5B9E\u73B0\u3002\u4E3A\u4E86\u63D0\u4F9B\u7B2C\u4E8C\u4E2A\u4F5C\u4E3A\u9ED8\u8BA4\u5B9E\u73B0\uFF0C\u6211\u4EEC\u53EF\u4EE5\u521B\u5EFA\u4E00\u4E2A\u4F7F\u7528 <code>LiteralPetCreator</code> \u7684 <em>\u5916\u89C2\u6A21\u5F0F</em>\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/pets/Pets.java</span>
<span class="token comment">// Facade to produce a default PetCreator</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>pets</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pets</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PetCreator</span> CREATOR <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LiteralPetCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Pet</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> CREATOR<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Pet</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">array</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pet</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pet</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> CREATOR<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pet</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pet</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token function">array</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pet</span><span class="token punctuation">&gt;</span></span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>CREATOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u8FD8\u63D0\u4F9B\u4E86\u5BF9 <code>get()</code>\u3001<code>array()</code> \u548C <code>list()</code> \u7684\u95F4\u63A5\u8C03\u7528\uFF0C\u4EE5\u53CA\u751F\u6210 <code>Stream&lt;Pet&gt;</code> \u7684\u65B0\u65B9\u6CD5\u3002</p><p>\u56E0\u4E3A <code>PetCount.countPets()</code> \u91C7\u7528\u4E86 <code>PetCreator</code> \u53C2\u6570\uFF0C\u6240\u4EE5\u6211\u4EEC\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u6D4B\u8BD5 <code>LiteralPetCreator</code>\uFF08\u901A\u8FC7\u4E0A\u9762\u7684\u5916\u89C2\u6A21\u5F0F\uFF09\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/PetCount2.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>pets<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PetCount2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PetCount</span><span class="token punctuation">.</span><span class="token function">countPets</span><span class="token punctuation">(</span><span class="token class-name">Pets</span><span class="token punctuation">.</span>CREATOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Rat Manx Cymric Mutt Pug Cymric Pug Manx Cymric Rat
EgyptianMau Hamster EgyptianMau Mutt Mutt Cymric Mouse
Pug Mouse Cymric
{EgyptianMau=2, Pug=3, Rat=2, Cymric=5, Mouse=2, Cat=9,
Manx=7, Rodent=5, Mutt=3, Dog=6, Pet=20, Hamster=1}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u4E0E <code>PetCount.java</code> \u7684\u8F93\u51FA\u76F8\u540C\u3002</p><h3 id="\u4E00\u4E2A\u52A8\u6001-instanceof-\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#\u4E00\u4E2A\u52A8\u6001-instanceof-\u51FD\u6570" aria-hidden="true">#</a> \u4E00\u4E2A\u52A8\u6001 <code>instanceof</code> \u51FD\u6570</h3><p><code>Class.isInstance()</code> \u65B9\u6CD5\u63D0\u4F9B\u4E86\u4E00\u79CD\u52A8\u6001\u6D4B\u8BD5\u5BF9\u8C61\u7C7B\u578B\u7684\u65B9\u6CD5\u3002\u56E0\u6B64\uFF0C\u6240\u6709\u8FD9\u4E9B\u7E41\u7410\u7684 <code>instanceof</code> \u8BED\u53E5\u90FD\u53EF\u4EE5\u4ECE <code>PetCount.java</code> \u4E2D\u5220\u9664\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/PetCount3.java</span>
<span class="token comment">// \u4F7F\u7528 isInstance() \u65B9\u6CD5</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>pets<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PetCount3</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span>
            <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Pet</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">LiteralPetCreator</span><span class="token punctuation">.</span>ALL_TYPES<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>lpc <span class="token operator">-&gt;</span> <span class="token class-name">Pair</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span>lpc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Pair</span><span class="token operator">::</span><span class="token function">key</span><span class="token punctuation">,</span> <span class="token class-name">Pair</span><span class="token operator">::</span><span class="token function">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">Pet</span> pet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Class.isInstance() \u66FF\u6362 instanceof:</span>
            <span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>pair <span class="token operator">-&gt;</span> pair<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInstance</span><span class="token punctuation">(</span>pet<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>pair <span class="token operator">-&gt;</span>
                            <span class="token function">put</span><span class="token punctuation">(</span>pair<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pair<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>pair <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s=%s&quot;</span><span class="token punctuation">,</span>
                            pair<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            pair<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;{&quot;</span> <span class="token operator">+</span> result <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Counter</span> petCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pets</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>petCount<span class="token operator">::</span><span class="token function">count</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>
                        p<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;n&quot;</span> <span class="token operator">+</span> petCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Rat Manx Cymric Mutt Pug Cymric Pug Manx Cymric Rat
EgyptianMau Hamster EgyptianMau Mutt Mutt Cymric Mouse
Pug Mouse Cymric
{Rat=2, Pug=3, Mutt=3, Mouse=2, Cat=9, Dog=6, Cymric=5,
EgyptianMau=2, Rodent=5, Hamster=1, Manx=7, Pet=20}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3A\u4E86\u8BA1\u7B97\u6240\u6709\u4E0D\u540C\u7C7B\u578B\u7684 <code>Pet</code>\uFF0C<code>Counter Map</code> \u9884\u5148\u52A0\u8F7D\u4E86\u6765\u81EA <code>LiteralPetCreator.ALL_TYPES</code> \u7684\u7C7B\u578B\u3002\u5982\u679C\u4E0D\u9884\u5148\u52A0\u8F7D <code>Map</code>\uFF0C\u5C06\u53EA\u8BA1\u6570\u968F\u673A\u751F\u6210\u7684\u7C7B\u578B\uFF0C\u800C\u4E0D\u662F\u50CF <code>Pet</code> \u548C <code>Cat</code> \u8FD9\u6837\u7684\u57FA\u672C\u7C7B\u578B\u3002</p><p><code>isInstance()</code> \u65B9\u6CD5\u6D88\u9664\u4E86\u5BF9 <code>instanceof</code> \u8868\u8FBE\u5F0F\u7684\u9700\u8981\u3002\u6B64\u5916\uFF0C\u8FD9\u610F\u5473\u7740\u4F60\u53EF\u4EE5\u901A\u8FC7\u66F4\u6539 <code>LiteralPetCreator.types</code> \u6570\u7EC4\u6765\u6DFB\u52A0\u65B0\u7C7B\u578B\u7684 <code>Pet</code>\uFF1B\u7A0B\u5E8F\u7684\u5176\u4F59\u90E8\u5206\u4E0D\u9700\u8981\u4FEE\u6539\uFF08\u5C31\u50CF\u4F7F\u7528 <code>instanceof</code> \u8868\u8FBE\u5F0F\u65F6\u90A3\u6837\uFF09\u3002</p><p><code>toString()</code> \u65B9\u6CD5\u88AB\u91CD\u8F7D\uFF0C\u4EE5\u4FBF\u66F4\u5BB9\u6613\u8BFB\u53D6\u8F93\u51FA\uFF0C\u8BE5\u8F93\u51FA\u4ECD\u4E0E\u6253\u5370 <code>Map</code> \u65F6\u770B\u5230\u7684\u5178\u578B\u8F93\u51FA\u5339\u914D\u3002</p><h3 id="\u9012\u5F52\u8BA1\u6570" tabindex="-1"><a class="header-anchor" href="#\u9012\u5F52\u8BA1\u6570" aria-hidden="true">#</a> \u9012\u5F52\u8BA1\u6570</h3><p><code>PetCount3.Counter</code> \u4E2D\u7684 <code>Map</code> \u9884\u5148\u52A0\u8F7D\u4E86\u6240\u6709\u4E0D\u540C\u7684 <code>Pet</code> \u7C7B\u3002\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 <code>Class.isAssignableFrom()</code> \u800C\u4E0D\u662F\u9884\u52A0\u8F7D <code>Map</code> \uFF0C\u5E76\u521B\u5EFA\u4E00\u4E2A\u4E0D\u9650\u4E8E\u8BA1\u6570 <code>Pet</code> \u7684\u901A\u7528\u5DE5\u5177\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// onjava/TypeCounter.java</span>
<span class="token comment">// \u8BA1\u7B97\u7C7B\u578B\u5BB6\u65CF\u7684\u5B9E\u4F8B\u6570</span>
<span class="token keyword">package</span> <span class="token namespace">onjava</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TypeCounter</span> <span class="token keyword">extends</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> baseType<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TypeCounter</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> baseType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>baseType <span class="token operator">=</span> baseType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> type <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>baseType<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>
                obj <span class="token operator">+</span> <span class="token string">&quot; incorrect type: &quot;</span> <span class="token operator">+</span> type <span class="token operator">+</span>
                <span class="token string">&quot;, should be type or subtype of &quot;</span> <span class="token operator">+</span> baseType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">countClass</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">countClass</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> quantity <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">put</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> quantity <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> quantity <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> superClass <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>superClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
               baseType<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>superClass<span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token function">countClass</span><span class="token punctuation">(</span>superClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>pair <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s=%s&quot;</span><span class="token punctuation">,</span>
                pair<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                pair<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;{&quot;</span> <span class="token operator">+</span> result <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>count()</code> \u65B9\u6CD5\u83B7\u53D6\u5176\u53C2\u6570\u7684 <code>Class</code>\uFF0C\u5E76\u4F7F\u7528 <code>isAssignableFrom()</code> \u8FDB\u884C\u8FD0\u884C\u65F6\u68C0\u67E5\uFF0C\u4EE5\u9A8C\u8BC1\u4F20\u9012\u7684\u5BF9\u8C61\u5B9E\u9645\u4E0A\u5C5E\u4E8E\u611F\u5174\u8DA3\u7684\u5C42\u6B21\u7ED3\u6784\u3002<code>countClass()</code> \u9996\u5148\u8BA1\u7B97\u7C7B\u7684\u786E\u5207\u7C7B\u578B\u3002\u7136\u540E\uFF0C\u5982\u679C <code>baseType</code> \u53EF\u4EE5\u4ECE\u8D85\u7C7B\u8D4B\u503C\uFF0C\u5219\u5728\u8D85\u7C7B\u4E0A\u9012\u5F52\u8C03\u7528 <code>countClass()</code>\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/PetCount4.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>pets<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PetCount4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TypeCounter</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeCounter</span><span class="token punctuation">(</span><span class="token class-name">Pet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pets</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>counter<span class="token operator">::</span><span class="token function">count</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>
                p<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;n&quot;</span> <span class="token operator">+</span> counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Rat Manx Cymric Mutt Pug Cymric Pug Manx Cymric Rat
EgyptianMau Hamster EgyptianMau Mutt Mutt Cymric Mouse
Pug Mouse Cymric
{Dog=6, Manx=7, Cat=9, Rodent=5, Hamster=1, Rat=2,
Pug=3, Mutt=3, Cymric=5, EgyptianMau=2, Pet=20,
Mouse=2}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u8868\u660E\u4E24\u4E2A\u57FA\u7C7B\u578B\u4EE5\u53CA\u7CBE\u786E\u7C7B\u578B\u90FD\u88AB\u8BA1\u6570\u4E86\u3002</p><h2 id="\u6CE8\u518C\u5DE5\u5382" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u518C\u5DE5\u5382" aria-hidden="true">#</a> \u6CE8\u518C\u5DE5\u5382</h2><p>\u4ECE <code>Pet</code> \u5C42\u6B21\u7ED3\u6784\u751F\u6210\u5BF9\u8C61\u7684\u95EE\u9898\u662F\uFF0C\u6BCF\u5F53\u5411\u5C42\u6B21\u7ED3\u6784\u4E2D\u6DFB\u52A0\u4E00\u79CD\u65B0\u7C7B\u578B\u7684 <code>Pet</code> \u65F6\uFF0C\u5FC5\u987B\u8BB0\u4F4F\u5C06\u5176\u6DFB\u52A0\u5230 <code>LiteralPetCreator.java</code> \u7684\u6761\u76EE\u4E2D\u3002\u5728\u4E00\u4E2A\u5B9A\u671F\u6DFB\u52A0\u66F4\u591A\u7C7B\u7684\u7CFB\u7EDF\u4E2D\uFF0C\u8FD9\u53EF\u80FD\u4F1A\u6210\u4E3A\u95EE\u9898\u3002</p><p>\u4F60\u53EF\u80FD\u4F1A\u8003\u8651\u5411\u6BCF\u4E2A\u5B50\u7C7B\u6DFB\u52A0\u9759\u6001\u521D\u59CB\u503C\u8BBE\u5B9A\u9879\uFF0C\u56E0\u6B64\u521D\u59CB\u503C\u8BBE\u5B9A\u9879\u4F1A\u5C06\u5176\u7C7B\u6DFB\u52A0\u5230\u67D0\u4E2A\u5217\u8868\u4E2D\u3002\u4E0D\u5E78\u7684\u662F\uFF0C\u9759\u6001\u521D\u59CB\u503C\u8BBE\u5B9A\u9879\u4EC5\u5728\u9996\u6B21\u52A0\u8F7D\u7C7B\u65F6\u8C03\u7528\uFF0C\u56E0\u6B64\u5B58\u5728\u9E21\u548C\u86CB\u7684\u95EE\u9898\uFF1A\u751F\u6210\u5668\u7684\u5217\u8868\u4E2D\u6CA1\u6709\u7C7B\uFF0C\u56E0\u6B64\u5B83\u65E0\u6CD5\u521B\u5EFA\u8BE5\u7C7B\u7684\u5BF9\u8C61\uFF0C\u56E0\u6B64\u7C7B\u4E0D\u4F1A\u88AB\u52A0\u8F7D\u5E76\u653E\u5165\u5217\u8868\u4E2D\u3002</p><p>\u57FA\u672C\u4E0A\uFF0C\u4F60\u5FC5\u987B\u81EA\u5DF1\u624B\u5DE5\u521B\u5EFA\u5217\u8868\uFF08\u9664\u975E\u4F60\u7F16\u5199\u4E86\u4E00\u4E2A\u5DE5\u5177\u6765\u641C\u7D22\u548C\u5206\u6790\u6E90\u4EE3\u7801\uFF0C\u7136\u540E\u521B\u5EFA\u548C\u7F16\u8BD1\u5217\u8868\uFF09\u3002\u6240\u4EE5\u4F60\u80FD\u505A\u7684\u6700\u597D\u7684\u4E8B\u60C5\u5C31\u662F\u628A\u5217\u8868\u96C6\u4E2D\u653E\u5728\u4E00\u4E2A\u660E\u663E\u7684\u5730\u65B9\u3002\u5C42\u6B21\u7ED3\u6784\u7684\u57FA\u7C7B\u53EF\u80FD\u662F\u6700\u597D\u7684\u5730\u65B9\u3002</p><p>\u6211\u4EEC\u5728\u8FD9\u91CC\u6240\u505A\u7684\u53E6\u4E00\u4E2A\u66F4\u6539\u662F\u4F7F\u7528<em>\u5DE5\u5382\u65B9\u6CD5</em>\u8BBE\u8BA1\u6A21\u5F0F\u5C06\u5BF9\u8C61\u7684\u521B\u5EFA\u63A8\u8FDF\u5230\u7C7B\u672C\u8EAB\u3002\u5DE5\u5382\u65B9\u6CD5\u53EF\u4EE5\u4EE5\u591A\u6001\u65B9\u5F0F\u8C03\u7528\uFF0C\u5E76\u4E3A\u4F60\u521B\u5EFA\u9002\u5F53\u7C7B\u578B\u7684\u5BF9\u8C61\u3002\u4E8B\u5B9E\u8BC1\u660E\uFF0C<code>java.util.function.Supplier</code> \u7528 <code>T get()</code> \u63CF\u8FF0\u4E86\u539F\u578B\u5DE5\u5382\u65B9\u6CD5\u3002\u534F\u53D8\u8FD4\u56DE\u7C7B\u578B\u5141\u8BB8 <code>get()</code> \u4E3A <code>Supplier</code> \u7684\u6BCF\u4E2A\u5B50\u7C7B\u5B9E\u73B0\u8FD4\u56DE\u4E0D\u540C\u7684\u7C7B\u578B\u3002</p><p>\u5728\u672C\u4F8B\u4E2D\uFF0C\u57FA\u7C7B <code>Part</code> \u5305\u542B\u4E00\u4E2A\u5DE5\u5382\u5BF9\u8C61\u7684\u9759\u6001\u5217\u8868\uFF0C\u5217\u8868\u6210\u5458\u7C7B\u578B\u4E3A <code>Supplier&lt;Part&gt;</code>\u3002\u5BF9\u4E8E\u5E94\u8BE5\u7531 <code>get()</code> \u65B9\u6CD5\u751F\u6210\u7684\u7C7B\u578B\u7684\u5DE5\u5382\uFF0C\u901A\u8FC7\u5C06\u5B83\u4EEC\u6DFB\u52A0\u5230 <code>prototypes</code> \u5217\u8868\u5411\u57FA\u7C7B\u201C\u6CE8\u518C\u201D\u3002\u5947\u602A\u7684\u662F\uFF0C\u8FD9\u4E9B\u5DE5\u5382\u672C\u8EAB\u5C31\u662F\u5BF9\u8C61\u7684\u5B9E\u4F8B\u3002\u6B64\u5217\u8868\u4E2D\u7684\u6BCF\u4E2A\u5BF9\u8C61\u90FD\u662F\u7528\u4E8E\u521B\u5EFA\u5176\u4ED6\u5BF9\u8C61\u7684<em>\u539F\u578B</em>\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/RegisteredFactories.java</span>
<span class="token comment">// \u6CE8\u518C\u5DE5\u5382\u5230\u57FA\u7840\u7C7B</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Part</span> <span class="token keyword">implements</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Part</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Supplier</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Part</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> prototypes <span class="token operator">=</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
          <span class="token keyword">new</span> <span class="token class-name">FuelFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">AirFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">CabinAirFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">OilFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">FanBelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">PowerSteeringBelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">GeneratorBelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Random</span> rand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Part</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> rand<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>prototypes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> prototypes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Filter</span> <span class="token keyword">extends</span> <span class="token class-name">Part</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FuelFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FuelFilter</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FuelFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">AirFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">AirFilter</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AirFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CabinAirFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CabinAirFilter</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CabinAirFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">OilFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">OilFilter</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OilFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Belt</span> <span class="token keyword">extends</span> <span class="token class-name">Part</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FanBelt</span> <span class="token keyword">extends</span> <span class="token class-name">Belt</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FanBelt</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanBelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">GeneratorBelt</span> <span class="token keyword">extends</span> <span class="token class-name">Belt</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GeneratorBelt</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GeneratorBelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">PowerSteeringBelt</span> <span class="token keyword">extends</span> <span class="token class-name">Belt</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PowerSteeringBelt</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PowerSteeringBelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegisteredFactories</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Part</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GeneratorBelt
CabinAirFilter
GeneratorBelt
AirFilter
PowerSteeringBelt
CabinAirFilter
FuelFilter
PowerSteeringBelt
PowerSteeringBelt
FuelFilter
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5E76\u975E\u5C42\u6B21\u7ED3\u6784\u4E2D\u7684\u6240\u6709\u7C7B\u90FD\u5E94\u5B9E\u4F8B\u5316\uFF1B\u8FD9\u91CC\u7684 <code>Filter</code> \u548C <code>Belt</code> \u53EA\u662F\u5206\u7C7B\u5668\uFF0C\u8FD9\u6837\u4F60\u5C31\u4E0D\u4F1A\u521B\u5EFA\u4EFB\u4F55\u4E00\u4E2A\u7C7B\u7684\u5B9E\u4F8B\uFF0C\u800C\u662F\u53EA\u521B\u5EFA\u5B83\u4EEC\u7684\u5B50\u7C7B\uFF08\u8BF7\u6CE8\u610F\uFF0C\u5982\u679C\u5C1D\u8BD5\u8FD9\u6837\u505A\uFF0C\u4F60\u5C06\u83B7\u5F97 <code>Part</code> \u57FA\u7C7B\u7684\u884C\u4E3A\uFF09\u3002</p><p>\u56E0\u4E3A <code>Part implements Supplier&lt;Part&gt;</code>\uFF0C<code>Part</code> \u901A\u8FC7\u5176 <code>get()</code> \u65B9\u6CD5\u4F9B\u5E94\u5176\u4ED6 <code>Part</code>\u3002\u5982\u679C\u4E3A\u57FA\u7C7B <code>Part</code> \u8C03\u7528 <code>get()</code>\uFF08\u6216\u8005\u5982\u679C <code>generate()</code> \u8C03\u7528 <code>get()</code>\uFF09\uFF0C\u5B83\u5C06\u521B\u5EFA\u968F\u673A\u7279\u5B9A\u7684 <code>Part</code> \u5B50\u7C7B\u578B\uFF0C\u6BCF\u4E2A\u5B50\u7C7B\u578B\u6700\u7EC8\u90FD\u4ECE <code>Part</code> \u7EE7\u627F\uFF0C\u5E76\u91CD\u5199\u76F8\u5E94\u7684 <code>get()</code> \u4EE5\u751F\u6210\u5B83\u4EEC\u4E2D\u7684\u4E00\u4E2A\u3002</p><h2 id="\u7C7B\u7684\u7B49\u4EF7\u6BD4\u8F83" tabindex="-1"><a class="header-anchor" href="#\u7C7B\u7684\u7B49\u4EF7\u6BD4\u8F83" aria-hidden="true">#</a> \u7C7B\u7684\u7B49\u4EF7\u6BD4\u8F83</h2><p>\u5F53\u4F60\u67E5\u8BE2\u7C7B\u578B\u4FE1\u606F\u65F6\uFF0C\u9700\u8981\u6CE8\u610F\uFF1Ainstanceof \u7684\u5F62\u5F0F(\u5373 <code>instanceof</code> \u6216 <code>isInstance()</code> \uFF0C\u8FD9\u4E24\u8005\u4EA7\u751F\u7684\u7ED3\u679C\u76F8\u540C) \u548C \u4E0E Class \u5BF9\u8C61\u76F4\u63A5\u6BD4\u8F83 \u8FD9\u4E24\u8005\u95F4\u5B58\u5728\u91CD\u8981\u533A\u522B\u3002\u4E0B\u9762\u7684\u4F8B\u5B50\u5C55\u793A\u4E86\u8FD9\u79CD\u533A\u522B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/FamilyVsExactType.java</span>
<span class="token comment">// instanceof \u4E0E class \u7684\u5DEE\u522B</span>
<span class="token comment">// {java typeinfo.FamilyVsExactType}</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token keyword">extends</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FamilyVsExactType</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Object</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;Testing x of type &quot;</span> <span class="token operator">+</span> x<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;x instanceof Base &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">Base</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;x instanceof Derived &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">Derived</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;Base.isInstance(x) &quot;</span> <span class="token operator">+</span> <span class="token class-name">Base</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isInstance</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;Derived.isInstance(x) &quot;</span> <span class="token operator">+</span>
              <span class="token class-name">Derived</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isInstance</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;x.getClass() == Base.class &quot;</span> <span class="token operator">+</span>
              <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Base</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;x.getClass() == Derived.class &quot;</span> <span class="token operator">+</span>
              <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Derived</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;x.getClass().equals(Base.class)) &quot;</span><span class="token operator">+</span>
              <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Base</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
              <span class="token string">&quot;x.getClass().equals(Derived.class)) &quot;</span> <span class="token operator">+</span>
              <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Derived</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Testing x of type class typeinfo.Base
x instanceof Base true
x instanceof Derived false
Base.isInstance(x) true
Derived.isInstance(x) false
x.getClass() == Base.class true
x.getClass() == Derived.class false
x.getClass().equals(Base.class)) true
x.getClass().equals(Derived.class)) false
Testing x of type class typeinfo.Derived
x instanceof Base true
x instanceof Derived true
Base.isInstance(x) true
Derived.isInstance(x) true
x.getClass() == Base.class false
x.getClass() == Derived.class true
x.getClass().equals(Base.class)) false
x.getClass().equals(Derived.class)) true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>test()</code> \u65B9\u6CD5\u4F7F\u7528\u4E24\u79CD\u5F62\u5F0F\u7684 <code>instanceof</code> \u5BF9\u5176\u53C2\u6570\u6267\u884C\u7C7B\u578B\u68C0\u67E5\u3002\u7136\u540E\uFF0C\u5B83\u83B7\u53D6 <code>Class</code> \u5F15\u7528\uFF0C\u5E76\u4F7F\u7528 <code>==</code> \u548C <code>equals()</code> \u6D4B\u8BD5 <code>Class</code> \u5BF9\u8C61\u7684\u76F8\u7B49\u6027\u3002\u4EE4\u4EBA\u653E\u5FC3\u7684\u662F\uFF0C<code>instanceof</code> \u548C <code>isInstance()</code> \u4EA7\u751F\u7684\u7ED3\u679C\u76F8\u540C\uFF0C <code>equals()</code> \u548C <code>==</code> \u4EA7\u751F\u7684\u7ED3\u679C\u4E5F\u76F8\u540C\u3002\u4F46\u6D4B\u8BD5\u672C\u8EAB\u5F97\u51FA\u4E86\u4E0D\u540C\u7684\u7ED3\u8BBA\u3002\u4E0E\u7C7B\u578B\u7684\u6982\u5FF5\u4E00\u81F4\uFF0C<code>instanceof</code> \u8BF4\u7684\u662F\u201C\u4F60\u662F\u8FD9\u4E2A\u7C7B\uFF0C\u8FD8\u662F\u4ECE\u8FD9\u4E2A\u7C7B\u6D3E\u751F\u7684\u7C7B\uFF1F\u201D\u3002\u800C\u5982\u679C\u4F7F\u7528 <code>==</code> \u6BD4\u8F83\u5B9E\u9645\u7684<code>Class</code> \u5BF9\u8C61\uFF0C\u5219\u4E0E\u7EE7\u627F\u65E0\u5173 \u2014\u2014 \u5B83\u8981\u4E48\u662F\u786E\u5207\u7684\u7C7B\u578B\uFF0C\u8981\u4E48\u4E0D\u662F\u3002</p><h2 id="\u53CD\u5C04-\u8FD0\u884C\u65F6\u7C7B\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#\u53CD\u5C04-\u8FD0\u884C\u65F6\u7C7B\u4FE1\u606F" aria-hidden="true">#</a> \u53CD\u5C04\uFF1A\u8FD0\u884C\u65F6\u7C7B\u4FE1\u606F</h2><p>\u5982\u679C\u4F60\u4E0D\u77E5\u9053\u5BF9\u8C61\u7684\u786E\u5207\u7C7B\u578B\uFF0CRTTI \u4F1A\u544A\u8BC9\u4F60\u3002\u4F46\u662F\uFF0C\u6709\u4E00\u4E2A\u9650\u5236\uFF1A\u5FC5\u987B\u5728\u7F16\u8BD1\u65F6\u77E5\u9053\u7C7B\u578B\uFF0C\u624D\u80FD\u4F7F\u7528 RTTI \u68C0\u6D4B\u5B83\uFF0C\u5E76\u5BF9\u4FE1\u606F\u505A\u4E00\u4E9B\u6709\u7528\u7684\u4E8B\u60C5\u3002\u6362\u53E5\u8BDD\u8BF4\uFF0C\u7F16\u8BD1\u5668\u5FC5\u987B\u77E5\u9053\u4F60\u4F7F\u7528\u7684\u6240\u6709\u7C7B\u3002</p><p>\u8D77\u521D\uFF0C\u8FD9\u770B\u8D77\u6765\u5E76\u6CA1\u6709\u90A3\u4E48\u5927\u7684\u9650\u5236\uFF0C\u4F46\u662F\u5047\u8BBE\u4F60\u5F15\u7528\u4E86\u4E00\u4E2A\u4E0D\u5728\u7A0B\u5E8F\u7A7A\u95F4\u4E2D\u7684\u5BF9\u8C61\u3002\u5B9E\u9645\u4E0A\uFF0C\u8BE5\u5BF9\u8C61\u7684\u7C7B\u5728\u7F16\u8BD1\u65F6\u751A\u81F3\u5BF9\u7A0B\u5E8F\u90FD\u4E0D\u53EF\u7528\u3002\u4E5F\u8BB8\u4F60\u4ECE\u78C1\u76D8\u6587\u4EF6\u6216\u7F51\u7EDC\u8FDE\u63A5\u4E2D\u83B7\u5F97\u4E86\u5927\u91CF\u7684\u5B57\u8282\uFF0C\u5E76\u88AB\u544A\u77E5\u8FD9\u4E9B\u5B57\u8282\u4EE3\u8868\u4E00\u4E2A\u7C7B\u3002\u7531\u4E8E\u8FD9\u4E2A\u7C7B\u5728\u7F16\u8BD1\u5668\u4E3A\u4F60\u7684\u7A0B\u5E8F\u751F\u6210\u4EE3\u7801\u540E\u5F88\u957F\u65F6\u95F4\u624D\u4F1A\u51FA\u73B0\uFF0C\u4F60\u5982\u4F55\u4F7F\u7528\u8FD9\u6837\u7684\u7C7B\uFF1F</p><p>\u5728\u4F20\u7EDF\u7F16\u7A0B\u73AF\u5883\u4E2D\uFF0C\u8FD9\u662F\u4E00\u4E2A\u7275\u5F3A\u7684\u573A\u666F\u3002\u4F46\u662F\uFF0C\u5F53\u6211\u4EEC\u8FDB\u5165\u4E00\u4E2A\u66F4\u5927\u7684\u7F16\u7A0B\u4E16\u754C\u65F6\uFF0C\u4F1A\u6709\u4E00\u4E9B\u91CD\u8981\u7684\u60C5\u51B5\u53D1\u751F\u3002\u7B2C\u4E00\u4E2A\u662F\u57FA\u4E8E\u7EC4\u4EF6\u7684\u7F16\u7A0B\uFF0C\u4F60\u53EF\u4EE5\u5728\u5E94\u7528\u7A0B\u5E8F\u6784\u5EFA\u5668<em>\u96C6\u6210\u5F00\u53D1\u73AF\u5883</em>\u4E2D\u4F7F\u7528<em>\u5FEB\u901F\u5E94\u7528\u7A0B\u5E8F\u5F00\u53D1</em>\uFF08RAD\uFF09\u6784\u5EFA\u9879\u76EE\u3002\u8FD9\u662F\u4E00\u79CD\u901A\u8FC7\u5C06\u8868\u793A\u7EC4\u4EF6\u7684\u56FE\u6807\u79FB\u52A8\u5230\u7A97\u4F53\u4E0A\u6765\u521B\u5EFA\u7A0B\u5E8F\u7684\u53EF\u89C6\u5316\u65B9\u6CD5\u3002\u7136\u540E\uFF0C\u901A\u8FC7\u5728\u7F16\u7A0B\u65F6\u8BBE\u7F6E\u8FD9\u4E9B\u7EC4\u4EF6\u7684\u4E00\u4E9B\u503C\u6765\u914D\u7F6E\u8FD9\u4E9B\u7EC4\u4EF6\u3002\u8FD9\u79CD\u8BBE\u8BA1\u65F6\u914D\u7F6E\u8981\u6C42\u4EFB\u4F55\u7EC4\u4EF6\u90FD\u662F\u53EF\u5B9E\u4F8B\u5316\u7684\uFF0C\u5B83\u516C\u5F00\u81EA\u5DF1\u7684\u90E8\u5206\uFF0C\u5E76\u4E14\u5141\u8BB8\u8BFB\u53D6\u548C\u4FEE\u6539\u5176\u5C5E\u6027\u3002\u6B64\u5916\uFF0C\u5904\u7406<em>\u56FE\u5F62\u7528\u6237\u754C\u9762</em>\uFF08GUI\uFF09\u4E8B\u4EF6\u7684\u7EC4\u4EF6\u5FC5\u987B\u516C\u5F00\u6709\u5173\u9002\u5F53\u65B9\u6CD5\u7684\u4FE1\u606F\uFF0C\u4EE5\u4FBF IDE \u53EF\u4EE5\u5E2E\u52A9\u7A0B\u5E8F\u5458\u8986\u5199\u8FD9\u4E9B\u4E8B\u4EF6\u5904\u7406\u65B9\u6CD5\u3002\u53CD\u5C04\u63D0\u4F9B\u4E86\u68C0\u6D4B\u53EF\u7528\u65B9\u6CD5\u5E76\u751F\u6210\u65B9\u6CD5\u540D\u79F0\u7684\u673A\u5236\u3002</p><p>\u5728\u8FD0\u884C\u65F6\u53D1\u73B0\u7C7B\u4FE1\u606F\u7684\u53E6\u4E00\u4E2A\u4EE4\u4EBA\u4FE1\u670D\u7684\u52A8\u673A\u662F\u63D0\u4F9B\u8DE8\u7F51\u7EDC\u5728\u8FDC\u7A0B\u5E73\u53F0\u4E0A\u521B\u5EFA\u548C\u6267\u884C\u5BF9\u8C61\u7684\u80FD\u529B\u3002\u8FD9\u79F0\u4E3A<em>\u8FDC\u7A0B\u65B9\u6CD5\u8C03\u7528</em>\uFF08RMI\uFF09\uFF0C\u5B83\u4F7F Java \u7A0B\u5E8F\u7684\u5BF9\u8C61\u5206\u5E03\u5728\u8BB8\u591A\u673A\u5668\u4E0A\u3002\u8FD9\u79CD\u5206\u5E03\u6709\u591A\u79CD\u539F\u56E0\u3002\u5982\u679C\u4F60\u60F3\u52A0\u901F\u4E00\u4E2A\u8BA1\u7B97\u5BC6\u96C6\u578B\u7684\u4EFB\u52A1\uFF0C\u4F60\u53EF\u4EE5\u628A\u5B83\u5206\u89E3\u6210\u5C0F\u5757\u653E\u5230\u7A7A\u95F2\u7684\u673A\u5668\u4E0A\u3002\u6216\u8005\u4F60\u53EF\u4EE5\u5C06\u5904\u7406\u7279\u5B9A\u7C7B\u578B\u4EFB\u52A1\u7684\u4EE3\u7801\uFF08\u4F8B\u5982\uFF0C\u591A\u5C42\u6B21\u5BA2\u6237\u673A/\u670D\u52A1\u5668\u4F53\u7CFB\u7ED3\u6784\u4E2D\u7684\u201C\u4E1A\u52A1\u89C4\u5219\u201D\uFF09\u653E\u5728\u7279\u5B9A\u7684\u673A\u5668\u4E0A\uFF0C\u8FD9\u6837\u673A\u5668\u5C31\u6210\u4E3A\u63CF\u8FF0\u8FD9\u4E9B\u64CD\u4F5C\u7684\u516C\u5171\u5B58\u50A8\u5E93\uFF0C\u5E76\u4E14\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u66F4\u6539\u5B83\u4EE5\u5F71\u54CD\u7CFB\u7EDF\u4E2D\u7684\u6BCF\u4E2A\u4EBA\u3002\u5206\u5E03\u5F0F\u8BA1\u7B97\u8FD8\u652F\u6301\u4E13\u95E8\u7684\u786C\u4EF6\uFF0C\u8FD9\u4E9B\u786C\u4EF6\u53EF\u80FD\u64C5\u957F\u4E8E\u67D0\u4E2A\u7279\u5B9A\u7684\u4EFB\u52A1\u2014\u2014\u4F8B\u5982\u77E9\u9635\u8F6C\u6362\u2014\u2014\u4F46\u5BF9\u4E8E\u901A\u7528\u7F16\u7A0B\u6765\u8BF4\u4E0D\u5408\u9002\u6216\u8FC7\u4E8E\u6602\u8D35\u3002</p><p>\u7C7B <code>Class</code> \u652F\u6301<em>\u53CD\u5C04</em>\u7684\u6982\u5FF5\uFF0C <code>java.lang.reflect</code> \u5E93\u4E2D\u5305\u542B\u7C7B <code>Field</code>\u3001<code>Method</code> \u548C <code>Constructor</code>\uFF08\u6BCF\u4E00\u4E2A\u90FD\u5B9E\u73B0\u4E86 <code>Member</code> \u63A5\u53E3\uFF09\u3002\u8FD9\u4E9B\u7C7B\u578B\u7684\u5BF9\u8C61\u7531 JVM \u5728\u8FD0\u884C\u65F6\u521B\u5EFA\uFF0C\u4EE5\u8868\u793A\u672A\u77E5\u7C7B\u4E2D\u7684\u5BF9\u5E94\u6210\u5458\u3002\u7136\u540E\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>Constructor</code> \u521B\u5EFA\u65B0\u5BF9\u8C61\uFF0C<code>get()</code> \u548C <code>set()</code> \u65B9\u6CD5\u8BFB\u53D6\u548C\u4FEE\u6539\u4E0E <code>Field</code> \u5BF9\u8C61\u5173\u8054\u7684\u5B57\u6BB5\uFF0C<code>invoke()</code> \u65B9\u6CD5\u8C03\u7528\u4E0E <code>Method</code> \u5BF9\u8C61\u5173\u8054\u7684\u65B9\u6CD5\u3002\u6B64\u5916\uFF0C\u8FD8\u53EF\u4EE5\u8C03\u7528\u4FBF\u5229\u65B9\u6CD5 <code>getFields()</code>\u3001<code>getMethods()</code>\u3001<code>getConstructors()</code> \u7B49\uFF0C\u4EE5\u8FD4\u56DE\u8868\u793A\u5B57\u6BB5\u3001\u65B9\u6CD5\u548C\u6784\u9020\u51FD\u6570\u7684\u5BF9\u8C61\u6570\u7EC4\u3002\uFF08\u4F60\u53EF\u4EE5\u901A\u8FC7\u5728 JDK \u6587\u6863\u4E2D\u67E5\u627E\u7C7B <code>Class</code> \u6765\u4E86\u89E3\u66F4\u591A\u4FE1\u606F\u3002\uFF09\u56E0\u6B64\uFF0C\u533F\u540D\u5BF9\u8C61\u7684\u7C7B\u4FE1\u606F\u53EF\u4EE5\u5728\u8FD0\u884C\u65F6\u5B8C\u5168\u786E\u5B9A\uFF0C\u7F16\u8BD1\u65F6\u4E0D\u9700\u8981\u77E5\u9053\u4EFB\u4F55\u4FE1\u606F\u3002</p><p>\u91CD\u8981\u7684\u662F\u8981\u610F\u8BC6\u5230\u53CD\u5C04\u6CA1\u6709\u4EC0\u4E48\u9B54\u529B\u3002\u5F53\u4F60\u4F7F\u7528\u53CD\u5C04\u4E0E\u672A\u77E5\u7C7B\u578B\u7684\u5BF9\u8C61\u4EA4\u4E92\u65F6\uFF0CJVM \u5C06\u67E5\u770B\u8BE5\u5BF9\u8C61\uFF0C\u5E76\u770B\u5230\u5B83\u5C5E\u4E8E\u7279\u5B9A\u7684\u7C7B\uFF08\u5C31\u50CF\u666E\u901A\u7684 RTTI\uFF09\u3002\u5728\u5BF9\u5176\u6267\u884C\u4EFB\u4F55\u64CD\u4F5C\u4E4B\u524D\uFF0C\u5FC5\u987B\u52A0\u8F7D <code>Class</code> \u5BF9\u8C61\u3002\u56E0\u6B64\uFF0C\u8BE5\u7279\u5B9A\u7C7B\u578B\u7684 <code>.class</code> \u6587\u4EF6\u5FC5\u987B\u5728\u672C\u5730\u8BA1\u7B97\u673A\u4E0A\u6216\u901A\u8FC7\u7F51\u7EDC\u5BF9 JVM \u4ECD\u7136\u53EF\u7528\u3002\u56E0\u6B64\uFF0CRTTI \u548C\u53CD\u5C04\u7684\u771F\u6B63\u533A\u522B\u5728\u4E8E\uFF0C\u4F7F\u7528 RTTI \u65F6\uFF0C\u7F16\u8BD1\u5668\u5728\u7F16\u8BD1\u65F6\u4F1A\u6253\u5F00\u5E76\u68C0\u67E5 <code>.class</code> \u6587\u4EF6\u3002\u6362\u53E5\u8BDD\u8BF4\uFF0C\u4F60\u53EF\u4EE5\u7528\u201C\u6B63\u5E38\u201D\u7684\u65B9\u5F0F\u8C03\u7528\u4E00\u4E2A\u5BF9\u8C61\u7684\u6240\u6709\u65B9\u6CD5\u3002\u901A\u8FC7\u53CD\u5C04\uFF0C<code>.class</code> \u6587\u4EF6\u5728\u7F16\u8BD1\u65F6\u4E0D\u53EF\u7528\uFF1B\u5B83\u7531\u8FD0\u884C\u65F6\u73AF\u5883\u6253\u5F00\u5E76\u68C0\u67E5\u3002</p><h3 id="\u7C7B\u65B9\u6CD5\u63D0\u53D6\u5668" tabindex="-1"><a class="header-anchor" href="#\u7C7B\u65B9\u6CD5\u63D0\u53D6\u5668" aria-hidden="true">#</a> \u7C7B\u65B9\u6CD5\u63D0\u53D6\u5668</h3><p>\u901A\u5E38\uFF0C\u4F60\u4E0D\u4F1A\u76F4\u63A5\u4F7F\u7528\u53CD\u5C04\u5DE5\u5177\uFF0C\u4F46\u5B83\u4EEC\u53EF\u4EE5\u5E2E\u52A9\u4F60\u521B\u5EFA\u66F4\u591A\u7684\u52A8\u6001\u4EE3\u7801\u3002\u53CD\u5C04\u662F\u7528\u6765\u652F\u6301\u5176\u4ED6 Java \u7279\u6027\u7684\uFF0C\u4F8B\u5982\u5BF9\u8C61\u5E8F\u5217\u5316\uFF08\u53C2\u89C1<a href="https://lingcoder.github.io/OnJava8/#/book/Appendix-Object-Serialization" target="_blank" rel="noopener noreferrer">\u9644\u5F55\uFF1A\u5BF9\u8C61\u5E8F\u5217\u5316</a>\uFF09\u3002\u4F46\u662F\uFF0C\u6709\u65F6\u52A8\u6001\u63D0\u53D6\u6709\u5173\u7C7B\u7684\u4FE1\u606F\u5F88\u6709\u7528\u3002</p><p>\u8003\u8651\u4E00\u4E2A\u7C7B\u65B9\u6CD5\u63D0\u53D6\u5668\u3002\u67E5\u770B\u7C7B\u5B9A\u4E49\u7684\u6E90\u4EE3\u7801\u6216 JDK \u6587\u6863\uFF0C\u53EA\u663E\u793A<em>\u5728\u8BE5\u7C7B\u5B9A\u4E49\u4E2D</em>\u5B9A\u4E49\u6216\u91CD\u5199\u7684\u65B9\u6CD5\u3002\u4F46\u662F\uFF0C\u53EF\u80FD\u8FD8\u6709\u51E0\u5341\u4E2A\u6765\u81EA\u57FA\u7C7B\u7684\u53EF\u7528\u65B9\u6CD5\u3002\u627E\u5230\u5B83\u4EEC\u65E2\u5355\u8C03\u53C8\u8D39\u65F6[^1]\u3002\u5E78\u8FD0\u7684\u662F\uFF0C\u53CD\u5C04\u63D0\u4F9B\u4E86\u4E00\u79CD\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u7B80\u5355\u5730\u7F16\u5199\u4E00\u4E2A\u5DE5\u5177\u7C7B\u81EA\u52A8\u5730\u5411\u4F60\u5C55\u793A\u6240\u6709\u7684\u63A5\u53E3\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/ShowMethods.java</span>
<span class="token comment">// \u4F7F\u7528\u53CD\u5C04\u5C55\u793A\u4E00\u4E2A\u7C7B\u7684\u6240\u6709\u65B9\u6CD5\uFF0C\u751A\u81F3\u5305\u62EC\u5B9A\u4E49\u5728\u57FA\u7C7B\u4E2D\u65B9\u6CD5</span>
<span class="token comment">// {java ShowMethods ShowMethods}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShowMethods</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> usage <span class="token operator">=</span>
            <span class="token string">&quot;usage:\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;ShowMethods qualified.class.name\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;To show all methods in class or:\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;ShowMethods qualified.class.name word\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;To search for methods involving &#39;word&#39;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\w+\\\\.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>usage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> lines <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Constructor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ctors <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> methods<span class="token punctuation">)</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                            p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>
                                    method<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Constructor</span> ctor <span class="token operator">:</span> ctors<span class="token punctuation">)</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                            p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>ctor<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                lines <span class="token operator">=</span> methods<span class="token punctuation">.</span>length <span class="token operator">+</span> ctors<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> methods<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>
                                method<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        lines<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Constructor</span> ctor <span class="token operator">:</span> ctors<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctor<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>
                                ctor<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        lines<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;No such class: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public static void main(String[])
public final void wait() throws InterruptedException
public final void wait(long,int) throws
InterruptedException
public final native void wait(long) throws
InterruptedException
public boolean equals(Object)
public String toString()
public native int hashCode()
public final native Class getClass()
public final native void notify()
public final native void notifyAll()
public ShowMethods()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Class</code> \u65B9\u6CD5 <code>getmethods()</code> \u548C <code>getconstructors()</code> \u5206\u522B\u8FD4\u56DE <code>Method</code> \u6570\u7EC4\u548C <code>Constructor</code> \u6570\u7EC4\u3002\u8FD9\u4E9B\u7C7B\u4E2D\u7684\u6BCF\u4E00\u4E2A\u90FD\u6709\u8FDB\u4E00\u6B65\u7684\u65B9\u6CD5\u6765\u89E3\u6790\u5B83\u4EEC\u6240\u8868\u793A\u7684\u65B9\u6CD5\u7684\u540D\u79F0\u3001\u53C2\u6570\u548C\u8FD4\u56DE\u503C\u3002\u4F46\u4F60\u4E5F\u53EF\u4EE5\u50CF\u8FD9\u91CC\u6240\u505A\u7684\u90A3\u6837\uFF0C\u4F7F\u7528 <code>toString()</code>\uFF0C\u751F\u6210\u5E26\u6709\u6574\u4E2A\u65B9\u6CD5\u7B7E\u540D\u7684 <code>String</code>\u3002\u4EE3\u7801\u7684\u5176\u4F59\u90E8\u5206\u63D0\u53D6\u547D\u4EE4\u884C\u4FE1\u606F\uFF0C\u786E\u5B9A\u7279\u5B9A\u7B7E\u540D\u662F\u5426\u4E0E\u76EE\u6807 <code>String</code>\uFF08\u4F7F\u7528 <code>indexOf()</code>\uFF09\u5339\u914D\uFF0C\u5E76\u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\uFF08\u5728 <a href="#ch021.xhtml#strings">Strings</a> \u4E00\u7AE0\u4E2D\u4ECB\u7ECD\uFF09\u5220\u9664\u540D\u79F0\u9650\u5B9A\u7B26\u3002</p><p>\u7F16\u8BD1\u65F6\u65E0\u6CD5\u77E5\u9053 <code>Class.forName()</code> \u751F\u6210\u7684\u7ED3\u679C\uFF0C\u56E0\u6B64\u6240\u6709\u65B9\u6CD5\u7B7E\u540D\u4FE1\u606F\u90FD\u662F\u5728\u8FD0\u884C\u65F6\u63D0\u53D6\u7684\u3002\u5982\u679C\u4F60\u7814\u7A76 JDK \u53CD\u5C04\u6587\u6863\uFF0C\u4F60\u5C06\u770B\u5230\u6709\u8DB3\u591F\u7684\u652F\u6301\u6765\u5B9E\u9645\u8BBE\u7F6E\u548C\u5BF9\u7F16\u8BD1\u65F6\u5B8C\u5168\u672A\u77E5\u7684\u5BF9\u8C61\u8FDB\u884C\u65B9\u6CD5\u8C03\u7528\uFF08\u672C\u4E66\u540E\u9762\u6709\u8FD9\u6837\u7684\u4F8B\u5B50\uFF09\u3002\u867D\u7136\u6700\u521D\u4F60\u53EF\u80FD\u8BA4\u4E3A\u4F60\u6C38\u8FDC\u90FD\u4E0D\u9700\u8981\u8FD9\u6837\u505A\uFF0C\u4F46\u662F\u53CD\u5C04\u7684\u5168\u90E8\u4EF7\u503C\u53EF\u80FD\u4F1A\u4EE4\u4EBA\u60CA\u8BB6\u3002</p><p>\u4E0A\u9762\u7684\u8F93\u51FA\u6765\u81EA\u547D\u4EE4\u884C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>java <span class="token class-name">ShowMethods</span> <span class="token class-name">ShowMethods</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8F93\u51FA\u5305\u542B\u4E00\u4E2A <code>public</code> \u65E0\u53C2\u6570\u6784\u9020\u51FD\u6570\uFF0C\u5373\u4F7F\u672A\u5B9A\u4E49\u6784\u9020\u51FD\u6570\u3002\u4F60\u770B\u5230\u7684\u6784\u9020\u51FD\u6570\u662F\u7531\u7F16\u8BD1\u5668\u81EA\u52A8\u5408\u6210\u7684\u3002\u5982\u679C\u5C06 <code>ShowMethods</code> \u8BBE\u7F6E\u4E3A\u975E <code>public</code> \u7C7B\uFF08\u5373\u53EA\u6709\u5305\u7EA7\u8BBF\u95EE\u6743\uFF09\uFF0C\u5219\u5408\u6210\u7684\u65E0\u53C2\u6570\u6784\u9020\u51FD\u6570\u5C06\u4E0D\u518D\u663E\u793A\u5728\u8F93\u51FA\u4E2D\u3002\u81EA\u52A8\u4E3A\u5408\u6210\u7684\u65E0\u53C2\u6570\u6784\u9020\u51FD\u6570\u6388\u4E88\u4E0E\u7C7B\u76F8\u540C\u7684\u8BBF\u95EE\u6743\u3002</p><p>\u5C1D\u8BD5\u8FD0\u884C <code>java ShowMethods java.lang.String</code>\uFF0C\u5E76\u9644\u52A0\u4E00\u4E2A <code>char</code>\u3001<code>int</code>\u3001<code>String</code> \u7B49\u53C2\u6570\u3002</p><p>\u7F16\u7A0B\u65F6\uFF0C\u5F53\u4F60\u4E0D\u8BB0\u5F97\u67D0\u4E2A\u7C7B\u662F\u5426\u6709\u7279\u5B9A\u7684\u65B9\u6CD5\uFF0C\u5E76\u4E14\u4E0D\u60F3\u5728 JDK \u6587\u6863\u4E2D\u641C\u7D22\u7D22\u5F15\u6216\u7C7B\u5C42\u6B21\u7ED3\u6784\u65F6\uFF0C\u6216\u8005\u5982\u679C\u4F60\u4E0D\u77E5\u9053\u8BE5\u7C7B\u662F\u5426\u53EF\u4EE5\u5BF9 <code>Color</code> \u5BF9\u8C61\u6267\u884C\u4EFB\u4F55\u64CD\u4F5C\u65F6\uFF0C\u8BE5\u5DE5\u5177\u80FD\u8282\u7701\u4E0D\u5C11\u65F6\u95F4\u3002</p><h2 id="\u52A8\u6001\u4EE3\u7406" tabindex="-1"><a class="header-anchor" href="#\u52A8\u6001\u4EE3\u7406" aria-hidden="true">#</a> \u52A8\u6001\u4EE3\u7406</h2><p><em>\u4EE3\u7406</em>\u662F\u57FA\u672C\u7684\u8BBE\u8BA1\u6A21\u5F0F\u4E4B\u4E00\u3002\u4E00\u4E2A\u5BF9\u8C61\u5C01\u88C5\u771F\u5B9E\u5BF9\u8C61\uFF0C\u4EE3\u66FF\u5176\u63D0\u4F9B\u5176\u4ED6\u6216\u4E0D\u540C\u7684\u64CD\u4F5C---\u8FD9\u4E9B\u64CD\u4F5C\u901A\u5E38\u6D89\u53CA\u5230\u4E0E\u201C\u771F\u5B9E\u201D\u5BF9\u8C61\u7684\u901A\u4FE1\uFF0C\u56E0\u6B64\u4EE3\u7406\u901A\u5E38\u5145\u5F53\u4E2D\u95F4\u5BF9\u8C61\u3002\u8FD9\u662F\u4E00\u4E2A\u7B80\u5355\u7684\u793A\u4F8B\uFF0C\u663E\u793A\u4EE3\u7406\u7684\u7ED3\u6784\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/SimpleProxyDemo.java</span>

<span class="token keyword">interface</span> <span class="token class-name">Interface</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">somethingElse</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">RealObject</span> <span class="token keyword">implements</span> <span class="token class-name">Interface</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;doSomething&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">somethingElse</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;somethingElse &quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SimpleProxy</span> <span class="token keyword">implements</span> <span class="token class-name">Interface</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Interface</span> proxied<span class="token punctuation">;</span>

    <span class="token class-name">SimpleProxy</span><span class="token punctuation">(</span><span class="token class-name">Interface</span> proxied<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>proxied <span class="token operator">=</span> proxied<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SimpleProxy doSomething&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxied<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">somethingElse</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                <span class="token string">&quot;SimpleProxy somethingElse &quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxied<span class="token punctuation">.</span><span class="token function">somethingElse</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SimpleProxyDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token class-name">Interface</span> iface<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iface<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iface<span class="token punctuation">.</span><span class="token function">somethingElse</span><span class="token punctuation">(</span><span class="token string">&quot;bonobo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RealObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleProxy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RealObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>doSomething
somethingElse bonobo
SimpleProxy doSomething
doSomething
SimpleProxy somethingElse bonobo
somethingElse bonobo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56E0\u4E3A <code>consumer()</code> \u63A5\u53D7 <code>Interface</code>\uFF0C\u6240\u4EE5\u5B83\u4E0D\u77E5\u9053\u83B7\u5F97\u7684\u662F <code>RealObject</code> \u8FD8\u662F <code>SimpleProxy</code>\uFF0C\u56E0\u4E3A\u4E24\u8005\u90FD\u5B9E\u73B0\u4E86 <code>Interface</code>\u3002 \u4F46\u662F\uFF0C\u5728\u5BA2\u6237\u7AEF\u548C <code>RealObject</code> \u4E4B\u95F4\u63D2\u5165\u7684 <code>SimpleProxy</code> \u6267\u884C\u64CD\u4F5C\uFF0C\u7136\u540E\u5728 <code>RealObject</code> \u4E0A\u8C03\u7528\u76F8\u540C\u7684\u65B9\u6CD5\u3002</p><p>\u5F53\u4F60\u5E0C\u671B\u5C06\u989D\u5916\u7684\u64CD\u4F5C\u4E0E\u201C\u771F\u5B9E\u5BF9\u8C61\u201D\u505A\u5206\u79BB\u65F6\uFF0C\u4EE3\u7406\u53EF\u80FD\u4F1A\u6709\u6240\u5E2E\u52A9\uFF0C\u5C24\u5176\u662F\u5F53\u4F60\u60F3\u8981\u8F7B\u677E\u5730\u542F\u7528\u989D\u5916\u7684\u64CD\u4F5C\u65F6\uFF0C\u53CD\u4E4B\u4EA6\u7136\uFF08\u8BBE\u8BA1\u6A21\u5F0F\u5C31\u662F\u5C01\u88C5\u53D8\u66F4---\u6240\u4EE5\u4F60\u5FC5\u987B\u6539\u53D8\u4E00\u4E9B\u4E1C\u897F\u4EE5\u8BC1\u660E\u6A21\u5F0F\u7684\u5408\u7406\u6027\uFF09\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u4F60\u60F3\u8DDF\u8E2A\u5BF9 <code>RealObject</code> \u4E2D\u65B9\u6CD5\u7684\u8C03\u7528\uFF0C\u6216\u8861\u91CF\u6B64\u7C7B\u8C03\u7528\u7684\u5F00\u9500\uFF0C\u8BE5\u600E\u4E48\u529E\uFF1F\u4F60\u4E0D\u60F3\u8FD9\u90E8\u5206\u4EE3\u7801\u8026\u5408\u5230\u4F60\u7684\u7A0B\u5E8F\u4E2D\uFF0C\u800C\u4EE3\u7406\u80FD\u4F7F\u4F60\u53EF\u4EE5\u5F88\u8F7B\u677E\u5730\u6DFB\u52A0\u6216\u5220\u9664\u5B83\u3002</p><p>Java \u7684<em>\u52A8\u6001\u4EE3\u7406</em>\u66F4\u8FDB\u4E00\u6B65\uFF0C\u4E0D\u4EC5\u52A8\u6001\u521B\u5EFA\u4EE3\u7406\u5BF9\u8C61\u800C\u4E14\u52A8\u6001\u5904\u7406\u5BF9\u4EE3\u7406\u65B9\u6CD5\u7684\u8C03\u7528\u3002\u5728\u52A8\u6001\u4EE3\u7406\u4E0A\u8FDB\u884C\u7684\u6240\u6709\u8C03\u7528\u90FD\u88AB\u91CD\u5B9A\u5411\u5230\u5355\u4E2A<em>\u8C03\u7528\u5904\u7406\u7A0B\u5E8F</em>\uFF0C\u8BE5\u5904\u7406\u7A0B\u5E8F\u8D1F\u8D23\u53D1\u73B0\u8C03\u7528\u7684\u5185\u5BB9\u5E76\u51B3\u5B9A\u5982\u4F55\u5904\u7406\u3002\u8FD9\u662F <code>SimpleProxyDemo.java</code> \u4F7F\u7528\u52A8\u6001\u4EE3\u7406\u91CD\u5199\u7684\u4F8B\u5B50\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/SimpleDynamicProxy.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DynamicProxyHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> proxied<span class="token punctuation">;</span>

    <span class="token class-name">DynamicProxyHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxied<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>proxied <span class="token operator">=</span> proxied<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                <span class="token string">&quot;**** proxy: &quot;</span> <span class="token operator">+</span> proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                        <span class="token string">&quot;, method: &quot;</span> <span class="token operator">+</span> method <span class="token operator">+</span> <span class="token string">&quot;, args: &quot;</span> <span class="token operator">+</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> arg <span class="token operator">:</span> args<span class="token punctuation">)</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;  &quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>proxied<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SimpleDynamicProxy</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token class-name">Interface</span> iface<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iface<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iface<span class="token punctuation">.</span><span class="token function">somethingElse</span><span class="token punctuation">(</span><span class="token string">&quot;bonobo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RealObject</span> real <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">consumer</span><span class="token punctuation">(</span>real<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Insert a proxy and call again:</span>
        <span class="token class-name">Interface</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Interface</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                <span class="token class-name">Interface</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">Interface</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">DynamicProxyHandler</span><span class="token punctuation">(</span>real<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">consumer</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>doSomething
somethingElse bonobo
**** proxy: class $Proxy0, method: public abstract void
Interface.doSomething(), args: null
doSomething
**** proxy: class $Proxy0, method: public abstract void
Interface.somethingElse(java.lang.String), args:
[Ljava.lang.Object;@6bc7c054
  bonobo
somethingElse bonobo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u901A\u8FC7\u8C03\u7528\u9759\u6001\u65B9\u6CD5 <code>Proxy.newProxyInstance()</code> \u6765\u521B\u5EFA\u52A8\u6001\u4EE3\u7406\uFF0C\u8BE5\u65B9\u6CD5\u9700\u8981\u4E00\u4E2A\u7C7B\u52A0\u8F7D\u5668\uFF08\u901A\u5E38\u53EF\u4EE5\u4ECE\u5DF2\u52A0\u8F7D\u7684\u5BF9\u8C61\u4E2D\u83B7\u53D6\uFF09\uFF0C\u5E0C\u671B\u4EE3\u7406\u5B9E\u73B0\u7684\u63A5\u53E3\u5217\u8868\uFF08\u4E0D\u662F\u7C7B\u6216\u62BD\u8C61\u7C7B\uFF09\uFF0C\u4EE5\u53CA\u63A5\u53E3 <code>InvocationHandler</code> \u7684\u4E00\u4E2A\u5B9E\u73B0\u3002\u52A8\u6001\u4EE3\u7406\u4F1A\u5C06\u6240\u6709\u8C03\u7528\u91CD\u5B9A\u5411\u5230\u8C03\u7528\u5904\u7406\u7A0B\u5E8F\uFF0C\u56E0\u6B64\u901A\u5E38\u4E3A\u8C03\u7528\u5904\u7406\u7A0B\u5E8F\u7684\u6784\u9020\u51FD\u6570\u63D0\u4F9B\u5BF9\u201C\u771F\u5B9E\u201D\u5BF9\u8C61\u7684\u5F15\u7528\uFF0C\u4EE5\u4FBF\u4E00\u65E6\u6267\u884C\u4E2D\u4ECB\u4EFB\u52A1\u4FBF\u53EF\u4EE5\u8F6C\u53D1\u8BF7\u6C42\u3002</p><p><code>invoke()</code> \u65B9\u6CD5\u88AB\u4F20\u9012\u7ED9\u4EE3\u7406\u5BF9\u8C61\uFF0C\u4EE5\u9632\u4E07\u4E00\u4F60\u5FC5\u987B\u533A\u5206\u8BF7\u6C42\u7684\u6765\u6E90---\u4F46\u662F\u5728\u5F88\u591A\u60C5\u51B5\u4E0B\u90FD\u65E0\u9700\u5173\u5FC3\u3002\u4F46\u662F\uFF0C\u5728 <code>invoke()</code> \u5185\u7684\u4EE3\u7406\u4E0A\u8C03\u7528\u65B9\u6CD5\u65F6\u8981\u5C0F\u5FC3\uFF0C\u56E0\u4E3A\u63A5\u53E3\u7684\u8C03\u7528\u662F\u901A\u8FC7\u4EE3\u7406\u91CD\u5B9A\u5411\u7684\u3002</p><p>\u901A\u5E38\u6267\u884C\u4EE3\u7406\u64CD\u4F5C\uFF0C\u7136\u540E\u4F7F\u7528 <code>Method.invoke()</code> \u5C06\u8BF7\u6C42\u8F6C\u53D1\u7ED9\u88AB\u4EE3\u7406\u5BF9\u8C61\uFF0C\u5E76\u643A\u5E26\u5FC5\u8981\u7684\u53C2\u6570\u3002\u8FD9\u5728\u4E00\u5F00\u59CB\u770B\u8D77\u6765\u662F\u6709\u9650\u5236\u7684\uFF0C\u597D\u50CF\u4F60\u53EA\u80FD\u6267\u884C\u4E00\u822C\u7684\u64CD\u4F5C\u3002\u4F46\u662F\uFF0C\u53EF\u4EE5\u8FC7\u6EE4\u67D0\u4E9B\u65B9\u6CD5\u8C03\u7528\uFF0C\u540C\u65F6\u4F20\u9012\u5176\u4ED6\u65B9\u6CD5\u8C03\u7528\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/SelectingMethods.java</span>
<span class="token comment">// Looking for particular methods in a dynamic proxy</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MethodSelector</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> proxied<span class="token punctuation">;</span>

    <span class="token class-name">MethodSelector</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxied<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>proxied <span class="token operator">=</span> proxied<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;interesting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;Proxy detected the interesting method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>proxied<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">SomeMethods</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">boring1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">boring2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">interesting</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">boring3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Implementation</span> <span class="token keyword">implements</span> <span class="token class-name">SomeMethods</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">boring1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;boring1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">boring2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;boring2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interesting</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;interesting &quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">boring3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;boring3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SelectingMethods</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SomeMethods</span> proxy <span class="token operator">=</span>
                <span class="token punctuation">(</span><span class="token class-name">SomeMethods</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                        <span class="token class-name">SomeMethods</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token class-name">SomeMethods</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">MethodSelector</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Implementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">boring1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">boring2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">interesting</span><span class="token punctuation">(</span><span class="token string">&quot;bonobo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">boring3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>boring1
boring2
Proxy detected the interesting method
interesting bonobo
boring3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u8FD9\u4E2A\u793A\u4F8B\u91CC\uFF0C\u6211\u4EEC\u53EA\u662F\u5728\u5BFB\u627E\u65B9\u6CD5\u540D\uFF0C\u4F46\u662F\u4F60\u4E5F\u53EF\u4EE5\u5BFB\u627E\u65B9\u6CD5\u7B7E\u540D\u7684\u5176\u4ED6\u65B9\u9762\uFF0C\u751A\u81F3\u53EF\u4EE5\u641C\u7D22\u7279\u5B9A\u7684\u53C2\u6570\u503C\u3002</p>`,214),r=n("\u52A8\u6001\u4EE3\u7406\u4E0D\u662F\u4F60\u6BCF\u5929\u90FD\u4F1A\u4F7F\u7528\u7684\u5DE5\u5177\uFF0C\u4F46\u662F\u5B83\u53EF\u4EE5\u5F88\u597D\u5730\u89E3\u51B3\u67D0\u4E9B\u7C7B\u578B\u7684\u95EE\u9898\u3002\u4F60\u53EF\u4EE5\u5728 Erich Gamma \u7B49\u4EBA\u7684"),v=s("em",null,"\u8BBE\u8BA1\u6A21\u5F0F",-1),m=n("\u4E2D\u4E86\u89E3\u6709\u5173"),b=s("em",null,"\u4EE3\u7406",-1),y=n("\u548C\u5176\u4ED6\u8BBE\u8BA1\u6A21\u5F0F\u7684\u66F4\u591A\u4FE1\u606F\u3002 \uFF08Addison-Wesley\uFF0C1995\u5E74\uFF09\uFF0C\u4EE5\u53CA"),g=n("\u8BBE\u8BA1\u6A21\u5F0F"),w=n("\u4E00\u7AE0\u3002"),f=s("h2",{id:"optional\u7C7B",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#optional\u7C7B","aria-hidden":"true"},"#"),n(" Optional\u7C7B")],-1),h=n("\u5982\u679C\u4F60\u4F7F\u7528\u5185\u7F6E\u7684 "),S=s("code",null,"null",-1),C=n(" \u6765\u8868\u793A\u6CA1\u6709\u5BF9\u8C61\uFF0C\u6BCF\u6B21\u4F7F\u7528\u5F15\u7528\u7684\u65F6\u5019\u5C31\u5FC5\u987B\u6D4B\u8BD5\u4E00\u4E0B\u5F15\u7528\u662F\u5426\u4E3A "),q=s("code",null,"null",-1),x=n("\uFF0C\u8FD9\u663E\u5F97\u6709\u70B9\u67AF\u71E5\uFF0C\u800C\u4E14\u52BF\u5FC5\u4F1A\u4EA7\u751F\u76F8\u5F53\u4E4F\u5473\u7684\u4EE3\u7801\u3002\u95EE\u9898\u5728\u4E8E "),j=s("code",null,"null",-1),P=n(" \u6CA1\u4EC0\u4E48\u81EA\u5DF1\u7684\u884C\u4E3A\uFF0C\u53EA\u4F1A\u5728\u4F60\u60F3\u7528\u5B83\u6267\u884C\u4EFB\u4F55\u64CD\u4F5C\u7684\u65F6\u5019\u4EA7\u751F "),T=s("code",null,"NullPointException",-1),I=n("\u3002"),M=s("code",null,"java.util.Optional",-1),R=n("\uFF08\u9996\u6B21\u51FA\u73B0\u662F\u5728"),E=n("\u51FD\u6570\u5F0F\u7F16\u7A0B"),O=n("\u8FD9\u7AE0\uFF09\u4E3A "),A=s("code",null,"null",-1),N=n(" \u503C\u63D0\u4F9B\u4E86\u4E00\u4E2A\u8F7B\u91CF\u7EA7\u4EE3\u7406\uFF0C"),F=s("code",null,"Optional",-1),_=n(" \u5BF9\u8C61\u53EF\u4EE5\u9632\u6B62\u4F60\u7684\u4EE3\u7801\u76F4\u63A5\u629B\u51FA "),B=s("code",null,"NullPointException",-1),L=n("\u3002"),H=e(`<p>\u867D\u7136 <code>Optional</code> \u662F Java 8 \u4E3A\u4E86\u652F\u6301\u6D41\u5F0F\u7F16\u7A0B\u624D\u5F15\u5165\u7684\uFF0C\u4F46\u5176\u5B9E\u5B83\u662F\u4E00\u4E2A\u901A\u7528\u7684\u5DE5\u5177\u3002\u4E3A\u4E86\u8BC1\u660E\u8FD9\u70B9\uFF0C\u5728\u672C\u8282\u4E2D\uFF0C\u6211\u4EEC\u4F1A\u628A\u5B83\u7528\u5728\u666E\u901A\u7684\u7C7B\u4E2D\u3002\u56E0\u4E3A\u6D89\u53CA\u4E00\u4E9B\u8FD0\u884C\u65F6\u68C0\u6D4B\uFF0C\u6240\u4EE5\u628A\u8FD9\u4E00\u5C0F\u8282\u653E\u5728\u4E86\u672C\u7AE0\u3002</p><p>\u5B9E\u9645\u4E0A\uFF0C\u5728\u6240\u6709\u5730\u65B9\u90FD\u4F7F\u7528 <code>Optional</code> \u662F\u6CA1\u6709\u610F\u4E49\u7684\uFF0C\u6709\u65F6\u5019\u68C0\u67E5\u4E00\u4E0B\u662F\u4E0D\u662F <code>null</code> \u4E5F\u633A\u597D\u7684\uFF0C\u6216\u8005\u6709\u65F6\u6211\u4EEC\u53EF\u4EE5\u5408\u7406\u5730\u5047\u8BBE\u4E0D\u4F1A\u51FA\u73B0 <code>null</code>\uFF0C\u751A\u81F3\u6709\u65F6\u5019\u68C0\u67E5 <code>NullPointException</code> \u5F02\u5E38\u4E5F\u662F\u53EF\u4EE5\u63A5\u53D7\u7684\u3002<code>Optional</code> \u6700\u6709\u7528\u6B66\u4E4B\u5730\u7684\u662F\u5728\u90A3\u4E9B\u201C\u66F4\u63A5\u8FD1\u6570\u636E\u201D\u7684\u5730\u65B9\uFF0C\u5728\u95EE\u9898\u7A7A\u95F4\u4E2D\u4EE3\u8868\u5B9E\u4F53\u7684\u5BF9\u8C61\u4E0A\u3002\u4E3E\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\uFF0C\u5F88\u591A\u7CFB\u7EDF\u4E2D\u90FD\u6709 <code>Person</code> \u7C7B\u578B\uFF0C\u4EE3\u7801\u4E2D\u6709\u4E9B\u60C5\u51B5\u4E0B\u4F60\u53EF\u80FD\u6CA1\u6709\u4E00\u4E2A\u5B9E\u9645\u7684 <code>Person</code> \u5BF9\u8C61\uFF08\u6216\u8005\u53EF\u80FD\u6709\uFF0C\u4F46\u662F\u4F60\u8FD8\u6CA1\u7528\u5173\u4E8E\u90A3\u4E2A\u4EBA\u7684\u6240\u6709\u4FE1\u606F\uFF09\u3002\u8FD9\u65F6\uFF0C\u5728\u4F20\u7EDF\u65B9\u6CD5\u4E0B\uFF0C\u4F60\u4F1A\u7528\u5230\u4E00\u4E2A <code>null</code> \u5F15\u7528\uFF0C\u5E76\u4E14\u5728\u4F7F\u7528\u7684\u65F6\u5019\u6D4B\u8BD5\u5B83\u662F\u4E0D\u662F <code>null</code>\u3002\u800C\u73B0\u5728\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 <code>Optional</code>\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/Person.java</span>
<span class="token comment">// Using Optional with regular classes</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> first<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> last<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> address<span class="token punctuation">;</span>
    <span class="token comment">// etc.</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Boolean</span> empty<span class="token punctuation">;</span>

    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> first<span class="token punctuation">,</span> <span class="token class-name">String</span> last<span class="token punctuation">,</span> <span class="token class-name">String</span> address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        empty <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>last<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>address<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> first<span class="token punctuation">,</span> <span class="token class-name">String</span> last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> last<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> last<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>empty<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">&quot;&lt;Empty&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> last<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> address<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Smith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;11 Degree Lane, Frostbite Falls, MN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;Empty&gt;
Smith
Bob Smith
Bob Smith 11 Degree Lane, Frostbite Falls, MN
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Person</code> \u7684\u8BBE\u8BA1\u6709\u65F6\u5019\u53C8\u53EB\u201C\u6570\u636E\u4F20\u8F93\u5BF9\u8C61\uFF08DTO\uFF0Cdata-transfer object\uFF09\u201D\u3002\u6CE8\u610F\uFF0C\u6240\u6709\u5B57\u6BB5\u90FD\u662F <code>public</code> \u548C <code>final</code> \u7684\uFF0C\u6240\u4EE5\u6CA1\u6709 <code>getter</code> \u548C <code>setter</code> \u65B9\u6CD5\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C<code>Person</code> \u662F\u4E0D\u53EF\u53D8\u7684\uFF0C\u4F60\u53EA\u80FD\u901A\u8FC7\u6784\u9020\u5668\u7ED9\u5B83\u8D4B\u503C\uFF0C\u4E4B\u540E\u5C31\u53EA\u80FD\u8BFB\u800C\u4E0D\u80FD\u4FEE\u6539\u5B83\u7684\u503C\uFF08\u5B57\u7B26\u4E32\u672C\u8EAB\u5C31\u662F\u4E0D\u53EF\u53D8\u7684\uFF0C\u56E0\u6B64\u4F60\u65E0\u6CD5\u4FEE\u6539\u5B57\u7B26\u4E32\u7684\u5185\u5BB9\uFF0C\u4E5F\u65E0\u6CD5\u7ED9\u5B83\u7684\u5B57\u6BB5\u91CD\u65B0\u8D4B\u503C\uFF09\u3002\u5982\u679C\u4F60\u60F3\u4FEE\u6539\u4E00\u4E2A <code>Person</code>\uFF0C\u4F60\u53EA\u80FD\u7528\u4E00\u4E2A\u65B0\u7684 <code>Person</code> \u5BF9\u8C61\u6765\u66FF\u6362\u5B83\u3002<code>empty</code> \u5B57\u6BB5\u5728\u5BF9\u8C61\u521B\u5EFA\u7684\u65F6\u5019\u88AB\u8D4B\u503C\uFF0C\u7528\u4E8E\u5FEB\u901F\u5224\u65AD\u8FD9\u4E2A <code>Person</code> \u5BF9\u8C61\u662F\u4E0D\u662F\u7A7A\u5BF9\u8C61\u3002</p><p>\u5982\u679C\u60F3\u4F7F\u7528 <code>Person</code>\uFF0C\u5C31\u5FC5\u987B\u4F7F\u7528 <code>Optional</code> \u63A5\u53E3\u624D\u80FD\u8BBF\u95EE\u5B83\u7684 <code>String</code> \u5B57\u6BB5\uFF0C\u8FD9\u6837\u5C31\u4E0D\u4F1A\u610F\u5916\u89E6\u53D1 <code>NullPointException</code> \u4E86\u3002</p><p>\u73B0\u5728\u5047\u8BBE\u4F60\u5DF2\u7ECF\u56E0\u4F60\u60CA\u4EBA\u7684\u7406\u5FF5\u800C\u83B7\u5F97\u4E86\u4E00\u5927\u7B14\u98CE\u9669\u6295\u8D44\uFF0C\u73B0\u5728\u4F60\u8981\u62DB\u5175\u4E70\u9A6C\u4E86\uFF0C\u4F46\u662F\u5728\u865A\u4F4D\u4EE5\u5F85\u65F6\uFF0C\u4F60\u53EF\u4EE5\u5C06 <code>Person Optional</code> \u5BF9\u8C61\u653E\u5728\u6BCF\u4E2A <code>Position</code> \u4E0A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/Position.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">EmptyTitleException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Position</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">;</span>

    <span class="token class-name">Position</span><span class="token punctuation">(</span><span class="token class-name">String</span> jobTitle<span class="token punctuation">,</span> <span class="token class-name">Person</span> employee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTitle</span><span class="token punctuation">(</span>jobTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setPerson</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Position</span><span class="token punctuation">(</span><span class="token class-name">String</span> jobTitle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>jobTitle<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> newTitle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Throws EmptyTitleException if newTitle is null:</span>
        title <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>newTitle<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token class-name">EmptyTitleException</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> person<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPerson</span><span class="token punctuation">(</span><span class="token class-name">Person</span> newPerson<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Uses empty Person if newPerson is null:</span>
        person <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>newPerson<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Position: &quot;</span> <span class="token operator">+</span> title <span class="token operator">+</span>
                <span class="token string">&quot;, Employee: &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Position</span><span class="token punctuation">(</span><span class="token string">&quot;CEO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Position</span><span class="token punctuation">(</span><span class="token string">&quot;Programmer&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Arthur&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Fonzarelli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Position</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;caught &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Position: CEO, Employee: &lt;Empty&gt;
Position: Programmer, Employee: Arthur Fonzarelli
caught EmptyTitleException
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u4F7F\u7528 <code>Optional</code> \u7684\u65B9\u5F0F\u4E0D\u592A\u4E00\u6837\u3002\u8BF7\u6CE8\u610F\uFF0C<code>title</code> \u548C <code>person</code> \u90FD\u662F\u666E\u901A\u5B57\u6BB5\uFF0C\u4E0D\u53D7 <code>Optional</code> \u7684\u4FDD\u62A4\u3002\u4F46\u662F\uFF0C\u4FEE\u6539\u8FD9\u4E9B\u5B57\u6BB5\u7684\u552F\u4E00\u9014\u5F84\u662F\u8C03\u7528 <code>setTitle()</code> \u548C <code>setPerson()</code> \u65B9\u6CD5\uFF0C\u8FD9\u4E24\u4E2A\u90FD\u501F\u52A9 <code>Optional</code> \u5BF9\u5B57\u6BB5\u8FDB\u884C\u4E86\u4E25\u683C\u7684\u9650\u5236\u3002</p><p>\u540C\u65F6\uFF0C\u6211\u4EEC\u60F3\u4FDD\u8BC1 <code>title</code> \u5B57\u6BB5\u6C38\u8FDC\u4E0D\u4F1A\u53D8\u6210 <code>null</code> \u503C\u3002\u4E3A\u6B64\uFF0C\u6211\u4EEC\u53EF\u4EE5\u81EA\u5DF1\u5728 <code>setTitle()</code> \u65B9\u6CD5\u91CC\u8FB9\u68C0\u67E5\u53C2\u6570 <code>newTitle</code> \u7684\u503C\u3002\u4F46\u5176\u5B9E\u8FD8\u6709\u66F4\u597D\u7684\u505A\u6CD5\uFF0C\u51FD\u6570\u5F0F\u7F16\u7A0B\u4E00\u5927\u4F18\u52BF\u5C31\u662F\u53EF\u4EE5\u8BA9\u6211\u4EEC\u91CD\u7528\u7ECF\u8FC7\u9A8C\u8BC1\u7684\u529F\u80FD\uFF08\u5373\u4FBF\u662F\u4E2A\u5F88\u5C0F\u7684\u529F\u80FD\uFF09\uFF0C\u4EE5\u51CF\u5C11\u81EA\u5DF1\u624B\u52A8\u7F16\u5199\u4EE3\u7801\u53EF\u80FD\u4EA7\u751F\u7684\u4E00\u4E9B\u5C0F\u9519\u8BEF\u3002\u6240\u4EE5\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u7528 <code>ofNullable()</code> \u628A <code>newTitle</code> \u8F6C\u6362\u4E00\u4E2A <code>Optional</code>\uFF08\u5982\u679C\u4F20\u5165\u7684\u503C\u4E3A <code>null</code>\uFF0C<code>ofNullable()</code> \u8FD4\u56DE\u7684\u5C06\u662F <code>Optional.empty()</code>\uFF09\u3002\u7D27\u63A5\u7740\u6211\u4EEC\u8C03\u7528\u4E86 <code>orElseThrow()</code> \u65B9\u6CD5\uFF0C\u6240\u4EE5\u5982\u679C <code>newTitle</code> \u7684\u503C\u662F <code>null</code>\uFF0C\u4F60\u5C06\u4F1A\u5F97\u5230\u4E00\u4E2A\u5F02\u5E38\u3002\u8FD9\u91CC\u6211\u4EEC\u5E76\u6CA1\u6709\u628A <code>title</code> \u4FDD\u5B58\u6210 <code>Optional</code>\uFF0C\u4F46\u901A\u8FC7\u5E94\u7528 <code>Optional</code> \u7684\u529F\u80FD\uFF0C\u6211\u4EEC\u4ECD\u7136\u5982\u613F\u4EE5\u507F\u5730\u5BF9\u8FD9\u4E2A\u5B57\u6BB5\u65BD\u52A0\u4E86\u7EA6\u675F\u3002</p><p><code>EmptyTitleException</code> \u662F\u4E00\u4E2A <code>RuntimeException</code>\uFF0C\u56E0\u4E3A\u5B83\u610F\u5473\u7740\u7A0B\u5E8F\u5B58\u5728\u9519\u8BEF\u3002\u5728\u8FD9\u4E2A\u65B9\u6848\u91CC\u8FB9\uFF0C\u4F60\u4ECD\u7136\u53EF\u80FD\u4F1A\u5F97\u5230\u4E00\u4E2A\u5F02\u5E38\u3002\u4F46\u4E0D\u540C\u7684\u662F\uFF0C\u5728\u9519\u8BEF\u4EA7\u751F\u7684\u90A3\u4E00\u523B\uFF08\u5411 <code>setTitle()</code> \u4F20 <code>null</code> \u503C\u65F6\uFF09\u5C31\u4F1A\u629B\u51FA\u5F02\u5E38\uFF0C\u800C\u4E0D\u662F\u53D1\u751F\u5728\u5176\u5B83\u65F6\u523B\uFF0C\u9700\u8981\u4F60\u901A\u8FC7\u8C03\u8BD5\u624D\u80FD\u53D1\u73B0\u95EE\u9898\u6240\u5728\u3002\u53E6\u5916\uFF0C\u4F7F\u7528 <code>EmptyTitleException</code> \u8FD8\u6709\u52A9\u4E8E\u5B9A\u4F4D BUG\u3002</p><p><code>Person</code> \u5B57\u6BB5\u7684\u9650\u5236\u53C8\u4E0D\u592A\u4E00\u6837\uFF1A\u5982\u679C\u4F60\u628A\u5B83\u7684\u503C\u8BBE\u4E3A <code>null</code>\uFF0C\u7A0B\u5E8F\u4F1A\u81EA\u52A8\u628A\u5C06\u5B83\u8D4B\u503C\u6210\u4E00\u4E2A\u7A7A\u7684 <code>Person</code> \u5BF9\u8C61\u3002\u5148\u524D\u6211\u4EEC\u4E5F\u7528\u8FC7\u7C7B\u4F3C\u7684\u65B9\u6CD5\u628A\u5B57\u6BB5\u8F6C\u6362\u6210 <code>Optional</code>\uFF0C\u4F46\u8FD9\u91CC\u6211\u4EEC\u662F\u5728\u8FD4\u56DE\u7ED3\u679C\u7684\u65F6\u5019\u4F7F\u7528 <code>orElse(new Person())</code> \u63D2\u5165\u4E00\u4E2A\u7A7A\u7684 <code>Person</code> \u5BF9\u8C61\u66FF\u4EE3\u4E86 <code>null</code>\u3002</p><p>\u5728 <code>Position</code> \u91CC\u8FB9\uFF0C\u6211\u4EEC\u6CA1\u6709\u521B\u5EFA\u4E00\u4E2A\u8868\u793A\u201C\u7A7A\u201D\u7684\u6807\u5FD7\u4F4D\u6216\u8005\u65B9\u6CD5\uFF0C\u56E0\u4E3A <code>person</code> \u5B57\u6BB5\u7684 <code>Person</code> \u5BF9\u8C61\u4E3A\u7A7A\uFF0C\u5C31\u8868\u793A\u8FD9\u4E2A <code>Position</code> \u662F\u4E2A\u7A7A\u7F3A\u4F4D\u7F6E\u3002\u4E4B\u540E\uFF0C\u4F60\u53EF\u80FD\u4F1A\u53D1\u73B0\u4F60\u5FC5\u987B\u6DFB\u52A0\u4E00\u4E2A\u663E\u5F0F\u7684\u8868\u793A\u201C\u7A7A\u4F4D\u201D\u7684\u65B9\u6CD5\uFF0C\u4F46\u662F\u6B63\u5982 YAGNI[^2] (You Aren&#39;t Going to Need It\uFF0C\u4F60\u6C38\u8FDC\u4E0D\u9700\u8981\u5B83)\u6240\u8A00\uFF0C\u5728\u521D\u7A3F\u65F6\u201C\u5B9E\u73B0\u5C3D\u6700\u5927\u53EF\u80FD\u7684\u7B80\u5355\u201D\uFF0C\u76F4\u5230\u7A0B\u5E8F\u5728\u67D0\u4E9B\u65B9\u9762\u8981\u6C42\u4F60\u4E3A\u5176\u6DFB\u52A0\u4E00\u4E9B\u989D\u5916\u7684\u7279\u6027\uFF0C\u800C\u4E0D\u662F\u5047\u8BBE\u8FD9\u662F\u5FC5\u8981\u7684\u3002</p><p>\u8BF7\u6CE8\u610F\uFF0C\u867D\u7136\u4F60\u6E05\u695A\u4F60\u4F7F\u7528\u4E86 <code>Optional</code>\uFF0C\u53EF\u4EE5\u514D\u53D7 <code>NullPointerExceptions</code> \u7684\u56F0\u6270\uFF0C\u4F46\u662F <code>Staff</code> \u7C7B\u5374\u5BF9\u6B64\u6BEB\u4E0D\u77E5\u60C5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/Staff.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Staff</span> <span class="token keyword">extends</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Position</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Position</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> person<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> titles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> title <span class="token operator">:</span> titles<span class="token punctuation">)</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Position</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Staff</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> titles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">add</span><span class="token punctuation">(</span>titles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">positionAvailable</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Position</span> position <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                    position<span class="token punctuation">.</span><span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>empty<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fillPosition</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">Person</span> hire<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Position</span> position <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                    position<span class="token punctuation">.</span><span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>empty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                position<span class="token punctuation">.</span><span class="token function">setPerson</span><span class="token punctuation">(</span>hire<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Position &quot;</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">&quot; not available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Staff</span> staff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Staff</span><span class="token punctuation">(</span><span class="token string">&quot;President&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CTO&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Marketing Manager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Product Manager&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Project Lead&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Test Engineer&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Technical Writer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        staff<span class="token punctuation">.</span><span class="token function">fillPosition</span><span class="token punctuation">(</span><span class="token string">&quot;President&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Me&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Last&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;The Top, Lonely At&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        staff<span class="token punctuation">.</span><span class="token function">fillPosition</span><span class="token punctuation">(</span><span class="token string">&quot;Project Lead&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Janet&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Planner&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;The Burbs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>staff<span class="token punctuation">.</span><span class="token function">positionAvailable</span><span class="token punctuation">(</span><span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            staff<span class="token punctuation">.</span><span class="token function">fillPosition</span><span class="token punctuation">(</span><span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>
                            <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Coder&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bright Light City&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Position: President, Employee: Me Last The Top, Lonely
At, Position: CTO, Employee: &lt;Empty&gt;, Position:
Marketing Manager, Employee: &lt;Empty&gt;, Position: Product
Manager, Employee: &lt;Empty&gt;, Position: Project Lead,
Employee: Janet Planner The Burbs, Position: Software
Engineer, Employee: Bob Coder Bright Light City,
Position: Software Engineer, Employee: &lt;Empty&gt;,
Position: Software Engineer, Employee: &lt;Empty&gt;,
Position: Software Engineer, Employee: &lt;Empty&gt;,
Position: Test Engineer, Employee: &lt;Empty&gt;, Position:
Technical Writer, Employee: &lt;Empty&gt;]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\uFF0C\u5728\u6709\u4E9B\u5730\u65B9\u4F60\u53EF\u80FD\u8FD8\u662F\u8981\u6D4B\u8BD5\u5F15\u7528\u662F\u4E0D\u662F <code>Optional</code>\uFF0C\u8FD9\u8DDF\u68C0\u67E5\u662F\u5426\u4E3A <code>null</code> \u6CA1\u4EC0\u4E48\u4E0D\u540C\u3002\u4F46\u662F\u5728\u5176\u5B83\u5730\u65B9\uFF08\u4F8B\u5982\u672C\u4F8B\u4E2D\u7684 <code>toString()</code> \u8F6C\u6362\uFF09\uFF0C\u4F60\u5C31\u4E0D\u5FC5\u6267\u884C\u989D\u5916\u7684\u6D4B\u8BD5\u4E86\uFF0C\u800C\u53EF\u4EE5\u76F4\u63A5\u5047\u8BBE\u6240\u6709\u5BF9\u8C61\u90FD\u662F\u6709\u6548\u7684\u3002</p><h3 id="\u6807\u8BB0\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#\u6807\u8BB0\u63A5\u53E3" aria-hidden="true">#</a> \u6807\u8BB0\u63A5\u53E3</h3><p>\u6709\u65F6\u5019\u4F7F\u7528\u4E00\u4E2A<strong>\u6807\u8BB0\u63A5\u53E3</strong>\u6765\u8868\u793A\u7A7A\u503C\u4F1A\u66F4\u65B9\u4FBF\u3002\u6807\u8BB0\u63A5\u53E3\u91CC\u8FB9\u4EC0\u4E48\u90FD\u6CA1\u6709\uFF0C\u4F60\u53EA\u8981\u628A\u5B83\u7684\u540D\u5B57\u5F53\u505A\u6807\u7B7E\u6765\u7528\u5C31\u53EF\u4EE5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// onjava/Null.java</span>
<span class="token keyword">package</span> <span class="token namespace">onjava</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Null</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C\u4F60\u7528\u63A5\u53E3\u53D6\u4EE3\u5177\u4F53\u7C7B\uFF0C\u90A3\u4E48\u5C31\u53EF\u4EE5\u4F7F\u7528 <code>DynamicProxy</code> \u6765\u81EA\u52A8\u5730\u521B\u5EFA <code>Null</code> \u5BF9\u8C61\u3002\u5047\u8BBE\u6211\u4EEC\u6709\u4E00\u4E2A <code>Robot</code> \u63A5\u53E3\uFF0C\u5B83\u5B9A\u4E49\u4E86\u4E00\u4E2A\u540D\u5B57\u3001\u4E00\u4E2A\u6A21\u578B\u548C\u4E00\u4E2A\u63CF\u8FF0 <code>Robot</code> \u884C\u4E3A\u80FD\u529B\u7684 <code>List&lt;Operation&gt;</code>\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/Robot.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Operation</span><span class="token punctuation">&gt;</span></span> <span class="token function">operations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Robot</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token keyword">instanceof</span> <span class="token class-name">Null</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[Null Robot]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Robot name: &quot;</span> <span class="token operator">+</span> r<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Robot model: &quot;</span> <span class="token operator">+</span> r<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Operation</span> operation <span class="token operator">:</span> r<span class="token punctuation">.</span><span class="token function">operations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>operation<span class="token punctuation">.</span>description<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            operation<span class="token punctuation">.</span>command<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F60\u53EF\u4EE5\u901A\u8FC7\u8C03\u7528 <code>operations()</code> \u6765\u8BBF\u95EE <code>Robot</code> \u7684\u670D\u52A1\u3002<code>Robot</code> \u91CC\u8FB9\u8FD8\u6709\u4E00\u4E2A <code>static</code> \u65B9\u6CD5\u6765\u6267\u884C\u6D4B\u8BD5\u3002</p><p><code>Operation</code> \u5305\u542B\u4E00\u4E2A\u63CF\u8FF0\u548C\u4E00\u4E2A\u547D\u4EE4\uFF08\u8FD9\u7528\u5230\u4E86<strong>\u547D\u4EE4\u6A21\u5F0F</strong>\uFF09\u3002\u5B83\u4EEC\u88AB\u5B9A\u4E49\u6210\u51FD\u6570\u5F0F\u63A5\u53E3\u7684\u5F15\u7528\uFF0C\u6240\u4EE5\u53EF\u4EE5\u628A lambda \u8868\u8FBE\u5F0F\u6216\u8005\u65B9\u6CD5\u7684\u5F15\u7528\u4F20\u7ED9 <code>Operation</code> \u7684\u6784\u9020\u5668\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/Operation.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Operation</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> description<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Runnable</span> command<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Operation</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> descr<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> cmd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        description <span class="token operator">=</span> descr<span class="token punctuation">;</span>
        command <span class="token operator">=</span> cmd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u73B0\u5728\u6211\u4EEC\u53EF\u4EE5\u521B\u5EFA\u4E00\u4E2A\u626B\u96EA <code>Robot</code>\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/SnowRemovalRobot.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SnowRemovalRobot</span> <span class="token keyword">implements</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SnowRemovalRobot</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;SnowBot Series 11&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Operation</span><span class="token punctuation">&gt;</span></span> ops <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Operation</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> name <span class="token operator">+</span> <span class="token string">&quot; can shovel snow&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                            name <span class="token operator">+</span> <span class="token string">&quot; shoveling snow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">Operation</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> name <span class="token operator">+</span> <span class="token string">&quot; can chip ice&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">&quot; chipping ice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">Operation</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> name <span class="token operator">+</span> <span class="token string">&quot; can clear the roof&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                            name <span class="token operator">+</span> <span class="token string">&quot; clearing roof&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Operation</span><span class="token punctuation">&gt;</span></span> <span class="token function">operations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ops<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Robot</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SnowRemovalRobot</span><span class="token punctuation">(</span><span class="token string">&quot;Slusher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Robot name: Slusher
Robot model: SnowBot Series 11
Slusher can shovel snow
Slusher shoveling snow
Slusher can chip ice
Slusher chipping ice
Slusher can clear the roof
Slusher clearing roof
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5047\u8BBE\u5B58\u5728\u8BB8\u591A\u4E0D\u540C\u7C7B\u578B\u7684 <code>Robot</code>\uFF0C\u6211\u4EEC\u60F3\u8BA9\u6BCF\u79CD <code>Robot</code> \u90FD\u521B\u5EFA\u4E00\u4E2A <code>Null</code> \u5BF9\u8C61\u6765\u6267\u884C\u4E00\u4E9B\u7279\u6B8A\u7684\u64CD\u4F5C\u2014\u2014\u5728\u672C\u4F8B\u4E2D\uFF0C\u5373\u63D0\u4F9B <code>Null</code> \u5BF9\u8C61\u6240\u4EE3\u8868 <code>Robot</code> \u7684\u786E\u5207\u7C7B\u578B\u4FE1\u606F\u3002\u8FD9\u4E9B\u4FE1\u606F\u662F\u901A\u8FC7\u52A8\u6001\u4EE3\u7406\u6355\u83B7\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/NullRobot.java</span>
<span class="token comment">// Using a dynamic proxy to create an Optional</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">NullRobotProxyHandler</span>
        <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nullName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Robot</span> proxied <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NRobot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">NullRobotProxyHandler</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        nullName <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; NullRobot&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">NRobot</span> <span class="token keyword">implements</span> <span class="token class-name">Null</span><span class="token punctuation">,</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> nullName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> nullName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Operation</span><span class="token punctuation">&gt;</span></span> <span class="token function">operations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>proxied<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NullRobot</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Robot</span>
    <span class="token function">newNullRobot</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Robot</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                <span class="token class-name">NullRobot</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">Null</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Robot</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">NullRobotProxyHandler</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">SnowRemovalRobot</span><span class="token punctuation">(</span><span class="token string">&quot;SnowBee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">newNullRobot</span><span class="token punctuation">(</span><span class="token class-name">SnowRemovalRobot</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Robot</span><span class="token operator">::</span><span class="token function">test</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Robot name: SnowBee
Robot model: SnowBot Series 11
SnowBee can shovel snow
SnowBee shoveling snow
SnowBee can chip ice
SnowBee chipping ice
SnowBee can clear the roof
SnowBee clearing roof
[Null Robot]
Robot name: SnowRemovalRobot NullRobot
Robot model: SnowRemovalRobot NullRobot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u65E0\u8BBA\u4F55\u65F6\uFF0C\u5982\u679C\u4F60\u9700\u8981\u4E00\u4E2A\u7A7A <code>Robot</code> \u5BF9\u8C61\uFF0C\u53EA\u9700\u8981\u8C03\u7528 <code>newNullRobot()</code>\uFF0C\u5E76\u4F20\u9012\u9700\u8981\u4EE3\u7406\u7684 <code>Robot</code> \u7684\u7C7B\u578B\u3002\u8FD9\u4E2A\u4EE3\u7406\u6EE1\u8DB3\u4E86 <code>Robot</code> \u548C <code>Null</code> \u63A5\u53E3\u7684\u9700\u8981\uFF0C\u5E76\u63D0\u4F9B\u4E86\u5B83\u6240\u4EE3\u7406\u7684\u7C7B\u578B\u7684\u786E\u5207\u540D\u5B57\u3002</p><h3 id="mock-\u5BF9\u8C61\u548C\u6869" tabindex="-1"><a class="header-anchor" href="#mock-\u5BF9\u8C61\u548C\u6869" aria-hidden="true">#</a> Mock \u5BF9\u8C61\u548C\u6869</h3><p><strong>Mock \u5BF9\u8C61</strong>\u548C **\u6869\uFF08Stub\uFF09**\u5728\u903B\u8F91\u4E0A\u90FD\u662F <code>Optional</code> \u7684\u53D8\u4F53\u3002\u4ED6\u4EEC\u90FD\u662F\u6700\u7EC8\u7A0B\u5E8F\u4E2D\u6240\u4F7F\u7528\u7684\u201C\u5B9E\u9645\u201D\u5BF9\u8C61\u7684\u4EE3\u7406\u3002\u4E0D\u8FC7\uFF0CMock \u5BF9\u8C61\u548C\u6869\u90FD\u662F\u5047\u626E\u6210\u90A3\u4E9B\u53EF\u4EE5\u4F20\u9012\u5B9E\u9645\u4FE1\u606F\u7684\u5B9E\u9645\u5BF9\u8C61\uFF0C\u800C\u4E0D\u662F\u50CF <code>Optional</code> \u90A3\u6837\u628A\u5305\u542B\u6F5C\u5728 <code>null</code> \u503C\u7684\u5BF9\u8C61\u9690\u85CF\u3002</p><p>Mock \u5BF9\u8C61\u548C\u6869\u4E4B\u95F4\u7684\u7684\u5DEE\u522B\u5728\u4E8E\u7A0B\u5EA6\u4E0D\u540C\u3002Mock \u5BF9\u8C61\u5F80\u5F80\u662F\u8F7B\u91CF\u7EA7\u7684\uFF0C\u4E14\u7528\u4E8E\u81EA\u6D4B\u8BD5\u3002\u901A\u5E38\uFF0C\u4E3A\u4E86\u5904\u7406\u5404\u79CD\u4E0D\u540C\u7684\u6D4B\u8BD5\u573A\u666F\uFF0C\u6211\u4EEC\u4F1A\u521B\u5EFA\u51FA\u5F88\u591A Mock \u5BF9\u8C61\u3002\u800C\u6869\u53EA\u662F\u8FD4\u56DE\u6869\u6570\u636E\uFF0C\u5B83\u901A\u5E38\u662F\u91CD\u91CF\u7EA7\u7684\uFF0C\u5E76\u4E14\u7ECF\u5E38\u5728\u591A\u4E2A\u6D4B\u8BD5\u4E2D\u88AB\u590D\u7528\u3002\u6869\u53EF\u4EE5\u6839\u636E\u5B83\u4EEC\u88AB\u8C03\u7528\u7684\u65B9\u5F0F\uFF0C\u901A\u8FC7\u914D\u7F6E\u8FDB\u884C\u4FEE\u6539\u3002\u56E0\u6B64\uFF0C\u6869\u662F\u4E00\u79CD\u590D\u6742\u5BF9\u8C61\uFF0C\u5B83\u53EF\u4EE5\u505A\u5F88\u591A\u4E8B\u60C5\u3002\u81F3\u4E8E Mock \u5BF9\u8C61\uFF0C\u5982\u679C\u4F60\u8981\u505A\u5F88\u591A\u4E8B\uFF0C\u901A\u5E38\u4F1A\u521B\u5EFA\u5927\u91CF\u53C8\u5C0F\u53C8\u7B80\u5355\u7684 Mock \u5BF9\u8C61\u3002</p><h2 id="\u63A5\u53E3\u548C\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#\u63A5\u53E3\u548C\u7C7B\u578B" aria-hidden="true">#</a> \u63A5\u53E3\u548C\u7C7B\u578B</h2><p><code>interface</code> \u5173\u952E\u5B57\u7684\u4E00\u4E2A\u91CD\u8981\u76EE\u6807\u5C31\u662F\u5141\u8BB8\u7A0B\u5E8F\u5458\u9694\u79BB\u7EC4\u4EF6\uFF0C\u8FDB\u800C\u964D\u4F4E\u8026\u5408\u5EA6\u3002\u4F7F\u7528\u63A5\u53E3\u53EF\u4EE5\u5B9E\u73B0\u8FD9\u4E00\u76EE\u6807\uFF0C\u4F46\u662F\u901A\u8FC7\u7C7B\u578B\u4FE1\u606F\uFF0C\u8FD9\u79CD\u8026\u5408\u6027\u8FD8\u662F\u4F1A\u4F20\u64AD\u51FA\u53BB\u2014\u2014\u63A5\u53E3\u5E76\u4E0D\u662F\u5BF9\u89E3\u8026\u7684\u4E00\u79CD\u65E0\u61C8\u53EF\u51FB\u7684\u4FDD\u969C\u3002\u6BD4\u5982\u6211\u4EEC\u5148\u5199\u4E00\u4E2A\u63A5\u53E3\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/interfacea/A.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>interfacea</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u5B9E\u73B0\u8FD9\u4E2A\u63A5\u53E3\uFF0C\u4F60\u53EF\u4EE5\u770B\u5230\u5176\u4EE3\u7801\u662F\u600E\u4E48\u4ECE\u5B9E\u9645\u7C7B\u578B\u5F00\u59CB\u987A\u85E4\u6478\u74DC\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/InterfaceViolation.java</span>
<span class="token comment">// Sneaking around an interface</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>interfacea<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">implements</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterfaceViolation</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// a.g(); // Compile error</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token keyword">instanceof</span> <span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">B</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">)</span> a<span class="token punctuation">;</span>
            b<span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>B
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u901A\u8FC7\u4F7F\u7528 RTTI\uFF0C\u6211\u4EEC\u53D1\u73B0 <code>a</code> \u662F\u7528 <code>B</code> \u5B9E\u73B0\u7684\u3002\u901A\u8FC7\u5C06\u5176\u8F6C\u578B\u4E3A <code>B</code>\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8C03\u7528\u4E0D\u5728 <code>A</code> \u4E2D\u7684\u65B9\u6CD5\u3002</p><p>\u8FD9\u6837\u7684\u64CD\u4F5C\u5B8C\u5168\u662F\u5408\u60C5\u5408\u7406\u7684\uFF0C\u4F46\u662F\u4F60\u4E5F\u8BB8\u5E76\u4E0D\u60F3\u8BA9\u5BA2\u6237\u7AEF\u5F00\u53D1\u8005\u8FD9\u4E48\u505A\uFF0C\u56E0\u4E3A\u8FD9\u7ED9\u4E86\u4ED6\u4EEC\u4E00\u4E2A\u673A\u4F1A\uFF0C\u4F7F\u5F97\u4ED6\u4EEC\u7684\u4EE3\u7801\u4E0E\u4F60\u7684\u4EE3\u7801\u7684\u8026\u5408\u5EA6\u8D85\u8FC7\u4E86\u4F60\u7684\u9884\u671F\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u4F60\u53EF\u80FD\u8BA4\u4E3A <code>interface</code> \u5173\u952E\u5B57\u6B63\u5728\u4FDD\u62A4\u4F60\uFF0C\u4F46\u5176\u5B9E\u5E76\u6CA1\u6709\u3002\u53E6\u5916\uFF0C\u5728\u672C\u4F8B\u4E2D\u4F7F\u7528 <code>B</code> \u6765\u5B9E\u73B0 <code>A</code> \u8FD9\u79CD\u60C5\u51B5\u662F\u6709\u516C\u5F00\u6848\u4F8B\u53EF\u67E5\u7684[^3]\u3002</p><p>\u4E00\u79CD\u89E3\u51B3\u65B9\u6848\u662F\u76F4\u63A5\u58F0\u660E\uFF0C\u5982\u679C\u5F00\u53D1\u8005\u51B3\u5B9A\u4F7F\u7528\u5B9E\u9645\u7684\u7C7B\u800C\u4E0D\u662F\u63A5\u53E3\uFF0C\u4ED6\u4EEC\u9700\u8981\u81EA\u5DF1\u5BF9\u81EA\u5DF1\u8D1F\u8D23\u3002\u8FD9\u5728\u5F88\u591A\u60C5\u51B5\u4E0B\u90FD\u662F\u53EF\u884C\u7684\uFF0C\u4F46\u201C\u53EF\u80FD\u201D\u8FD8\u4E0D\u591F\uFF0C\u4F60\u6216\u8BB8\u5E0C\u671B\u80FD\u6709\u4E00\u4E9B\u66F4\u4E25\u683C\u7684\u63A7\u5236\u65B9\u5F0F\u3002</p><p>\u6700\u7B80\u5355\u7684\u65B9\u5F0F\u662F\u8BA9\u5B9E\u73B0\u7C7B\u53EA\u5177\u6709\u5305\u8BBF\u95EE\u6743\u9650\uFF0C\u8FD9\u6837\u5728\u5305\u5916\u90E8\u7684\u5BA2\u6237\u7AEF\u5C31\u770B\u4E0D\u5230\u5B83\u4E86\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/packageaccess/HiddenC.java</span>
<span class="token keyword">package</span> <span class="token namespace">typeinfo<span class="token punctuation">.</span>packageaccess</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>interfacea<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token keyword">implements</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;public C.f()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;public C.g()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">u</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;package C.u()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;protected C.v()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;private C.w()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HiddenC</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">A</span> <span class="token function">makeA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u8FD9\u4E2A\u5305\u4E2D\u552F\u4E00 <code>public</code> \u7684\u90E8\u5206\u5C31\u662F <code>HiddenC</code>\uFF0C\u5728\u88AB\u8C03\u7528\u65F6\u5C06\u4EA7\u751F <code>A</code>\u63A5\u53E3\u7C7B\u578B\u7684\u5BF9\u8C61\u3002\u8FD9\u91CC\u6709\u8DA3\u4E4B\u5904\u5728\u4E8E\uFF1A\u5373\u4F7F\u4F60\u4ECE <code>makeA()</code> \u8FD4\u56DE\u7684\u662F <code>C</code> \u7C7B\u578B\uFF0C\u4F60\u5728\u5305\u7684\u5916\u90E8\u4ECD\u65E7\u4E0D\u80FD\u4F7F\u7528 <code>A</code> \u4E4B\u5916\u7684\u4EFB\u4F55\u65B9\u6CD5\uFF0C\u56E0\u4E3A\u4F60\u4E0D\u80FD\u5728\u5305\u7684\u5916\u90E8\u547D\u540D <code>C</code>\u3002</p><p>\u73B0\u5728\u5982\u679C\u4F60\u8BD5\u7740\u5C06\u5176\u5411\u4E0B\u8F6C\u578B\u4E3A <code>C</code>\uFF0C\u5219\u5C06\u88AB\u7981\u6B62\uFF0C\u56E0\u4E3A\u5728\u5305\u7684\u5916\u90E8\u6CA1\u6709\u4EFB\u4F55 <code>C</code> \u7C7B\u578B\u53EF\u7528\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/HiddenImplementation.java</span>
<span class="token comment">// Sneaking around package hiding</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>interfacea<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>packageaccess<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HiddenImplementation</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token class-name">HiddenC</span><span class="token punctuation">.</span><span class="token function">makeA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Compile error: cannot find symbol &#39;C&#39;:</span>
        <span class="token comment">/* if(a instanceof C) {
            C c = (C)a;
            c.g();
        } */</span>
        <span class="token comment">// Oops! Reflection still allows us to call g():</span>
        <span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// And even less accessible methods!</span>
        <span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">callHiddenMethod</span><span class="token punctuation">(</span><span class="token class-name">Object</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> methodName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Method</span> g <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        g<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        g<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public C.f()
typeinfo.packageaccess.C
public C.g()
package C.u()
protected C.v()
private C.w()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B63\u5982\u4F60\u6240\u770B\u5230\u7684\uFF0C\u901A\u8FC7\u4F7F\u7528\u53CD\u5C04\uFF0C\u4ECD\u7136\u53EF\u4EE5\u8C03\u7528\u6240\u6709\u65B9\u6CD5\uFF0C\u751A\u81F3\u662F <code>private</code> \u65B9\u6CD5\uFF01\u5982\u679C\u77E5\u9053\u65B9\u6CD5\u540D\uFF0C\u4F60\u5C31\u53EF\u4EE5\u5728\u5176 <code>Method</code> \u5BF9\u8C61\u4E0A\u8C03\u7528 <code>setAccessible(true)</code>\uFF0C\u5C31\u50CF\u5728 <code>callHiddenMethod()</code> \u4E2D\u770B\u5230\u7684\u90A3\u6837\u3002</p><p>\u4F60\u53EF\u80FD\u89C9\u5F97\uFF0C\u53EF\u4EE5\u901A\u8FC7\u53EA\u53D1\u5E03\u7F16\u8BD1\u540E\u7684\u4EE3\u7801\u6765\u963B\u6B62\u8FD9\u79CD\u60C5\u51B5\uFF0C\u4F46\u5176\u5B9E\u8FD9\u5E76\u4E0D\u80FD\u89E3\u51B3\u95EE\u9898\u3002\u56E0\u4E3A\u53EA\u9700\u8981\u8FD0\u884C <code>javap</code>\uFF08\u4E00\u4E2A\u968F JDK \u53D1\u5E03\u7684\u53CD\u7F16\u8BD1\u5668\uFF09\u5373\u53EF\u7A81\u7834\u8FD9\u4E00\u9650\u5236\u3002\u4E0B\u9762\u662F\u4E00\u4E2A\u4F7F\u7528 <code>javap</code> \u7684\u547D\u4EE4\u884C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>javap -private C
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>-private</code> \u6807\u5FD7\u8868\u793A\u6240\u6709\u7684\u6210\u5458\u90FD\u5E94\u8BE5\u663E\u793A\uFF0C\u751A\u81F3\u5305\u62EC\u79C1\u6709\u6210\u5458\u3002\u4E0B\u9762\u662F\u8F93\u51FA\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>class typeinfo.packageaccess.C extends
java.lang.Object implements typeinfo.interfacea.A {
  typeinfo.packageaccess.C();
  public void f();
  public void g();
  void u();
  protected void v();
  private void w();
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56E0\u6B64\uFF0C\u4EFB\u4F55\u4EBA\u90FD\u53EF\u4EE5\u83B7\u53D6\u4F60\u6700\u79C1\u6709\u7684\u65B9\u6CD5\u7684\u540D\u5B57\u548C\u7B7E\u540D\uFF0C\u7136\u540E\u8C03\u7528\u5B83\u4EEC\u3002</p><p>\u90A3\u5982\u679C\u628A\u63A5\u53E3\u5B9E\u73B0\u4E3A\u4E00\u4E2A\u79C1\u6709\u5185\u90E8\u7C7B\uFF0C\u53C8\u4F1A\u600E\u4E48\u6837\u5462\uFF1F\u4E0B\u9762\u5C55\u793A\u4E86\u8FD9\u79CD\u60C5\u51B5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/InnerImplementation.java</span>
<span class="token comment">// Private inner classes can&#39;t hide from reflection</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>interfacea<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">InnerA</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token keyword">implements</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;public C.f()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;public C.g()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">void</span> <span class="token function">u</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;package C.u()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;protected C.v()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;private C.w()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">A</span> <span class="token function">makeA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InnerImplementation</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span>
    <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token class-name">InnerA</span><span class="token punctuation">.</span><span class="token function">makeA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Reflection still gets into the private class:</span>
        <span class="token class-name">HiddenImplementation</span><span class="token punctuation">.</span><span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HiddenImplementation</span><span class="token punctuation">.</span><span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HiddenImplementation</span><span class="token punctuation">.</span><span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HiddenImplementation</span><span class="token punctuation">.</span><span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public C.f()
InnerA$C
public C.g()
package C.u()
protected C.v()
private C.w()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u5BF9\u53CD\u5C04\u4ECD\u7136\u6CA1\u6709\u4EFB\u4F55\u4E1C\u897F\u53EF\u4EE5\u9690\u85CF\u3002\u90A3\u4E48\u5982\u679C\u662F\u533F\u540D\u7C7B\u5462\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/AnonymousImplementation.java</span>
<span class="token comment">// Anonymous inner classes can&#39;t hide from reflection</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">typeinfo<span class="token punctuation">.</span>interfacea<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AnonymousA</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">A</span> <span class="token function">makeA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;public C.f()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;public C.g()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">void</span> <span class="token function">u</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;package C.u()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;protected C.v()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;private C.w()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnonymousImplementation</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span>
    <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token class-name">AnonymousA</span><span class="token punctuation">.</span><span class="token function">makeA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Reflection still gets into the anonymous class:</span>
        <span class="token class-name">HiddenImplementation</span><span class="token punctuation">.</span><span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HiddenImplementation</span><span class="token punctuation">.</span><span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;u&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HiddenImplementation</span><span class="token punctuation">.</span><span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HiddenImplementation</span><span class="token punctuation">.</span><span class="token function">callHiddenMethod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public C.f()
AnonymousA$1
public C.g()
package C.u()
protected C.v()
private C.w()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u770B\u8D77\u6765\u4EFB\u4F55\u65B9\u5F0F\u90FD\u6CA1\u6CD5\u963B\u6B62\u53CD\u5C04\u8C03\u7528\u90A3\u4E9B\u975E\u516C\u5171\u8BBF\u95EE\u6743\u9650\u7684\u65B9\u6CD5\u3002\u5BF9\u4E8E\u5B57\u6BB5\u6765\u8BF4\u4E5F\u662F\u8FD9\u6837\uFF0C\u5373\u4FBF\u662F <code>private</code> \u5B57\u6BB5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// typeinfo/ModifyingPrivateFields.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">WithPrivateFinalField</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;I&#39;m totally safe&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;Am I safe?&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;i = &quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> s2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ModifyingPrivateFields</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">WithPrivateFinalField</span> pf <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">WithPrivateFinalField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Field</span> f <span class="token operator">=</span> pf<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;i&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                <span class="token string">&quot;f.getInt(pf): &quot;</span> <span class="token operator">+</span> f<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span>pf<span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        f <span class="token operator">=</span> pf<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;f.get(pf): &quot;</span> <span class="token operator">+</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>pf<span class="token punctuation">,</span> <span class="token string">&quot;No, you&#39;re not!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        f <span class="token operator">=</span> pf<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;s2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;f.get(pf): &quot;</span> <span class="token operator">+</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>pf<span class="token punctuation">,</span> <span class="token string">&quot;No, you&#39;re not!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>i = 1, I&#39;m totally safe, Am I safe?
f.getInt(pf): 1
i = 47, I&#39;m totally safe, Am I safe?
f.get(pf): I&#39;m totally safe
i = 47, I&#39;m totally safe, Am I safe?
f.get(pf): Am I safe?
i = 47, I&#39;m totally safe, No, you&#39;re not!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F46\u5B9E\u9645\u4E0A <code>final</code> \u5B57\u6BB5\u5728\u88AB\u4FEE\u6539\u65F6\u662F\u5B89\u5168\u7684\u3002\u8FD0\u884C\u65F6\u7CFB\u7EDF\u4F1A\u5728\u4E0D\u629B\u51FA\u5F02\u5E38\u7684\u60C5\u51B5\u4E0B\u63A5\u53D7\u4EFB\u4F55\u4FEE\u6539\u7684\u5C1D\u8BD5\uFF0C\u4F46\u662F\u5B9E\u9645\u4E0A\u4E0D\u4F1A\u53D1\u751F\u4EFB\u4F55\u4FEE\u6539\u3002</p><p>\u901A\u5E38\uFF0C\u6240\u6709\u8FD9\u4E9B\u8FDD\u53CD\u8BBF\u95EE\u6743\u9650\u7684\u64CD\u4F5C\u5E76\u4E0D\u662F\u4EC0\u4E48\u5341\u6076\u4E0D\u8D66\u7684\u3002\u5982\u679C\u6709\u4EBA\u4F7F\u7528\u8FD9\u6837\u7684\u6280\u672F\u53BB\u8C03\u7528\u6807\u5FD7\u4E3A <code>private</code> \u6216\u5305\u8BBF\u95EE\u6743\u9650\u7684\u65B9\u6CD5\uFF08\u5F88\u660E\u663E\u8FD9\u4E9B\u8BBF\u95EE\u6743\u9650\u8868\u793A\u8FD9\u4E9B\u4EBA\u4E0D\u5E94\u8BE5\u8C03\u7528\u5B83\u4EEC\uFF09\uFF0C\u90A3\u4E48\u5BF9\u4ED6\u4EEC\u6765\u8BF4\uFF0C\u5982\u679C\u4F60\u4FEE\u6539\u4E86\u8FD9\u4E9B\u65B9\u6CD5\u7684\u67D0\u4E9B\u5730\u65B9\uFF0C\u4ED6\u4EEC\u4E0D\u5E94\u8BE5\u62B1\u6028\u3002\u53E6\u4E00\u65B9\u9762\uFF0C\u603B\u662F\u5728\u7C7B\u4E2D\u7559\u4E0B\u540E\u95E8\uFF0C\u4E5F\u8BB8\u4F1A\u5E2E\u52A9\u4F60\u89E3\u51B3\u67D0\u4E9B\u7279\u5B9A\u7C7B\u578B\u7684\u95EE\u9898\uFF08\u8FD9\u4E9B\u95EE\u9898\u5F80\u5F80\u9664\u6B64\u4E4B\u5916\uFF0C\u522B\u65E0\u5B83\u6CD5\uFF09\u3002\u603B\u4E4B\uFF0C\u4E0D\u53EF\u5426\u8BA4\uFF0C\u53CD\u5C04\u7ED9\u6211\u4EEC\u5E26\u6765\u4E86\u5F88\u591A\u597D\u5904\u3002</p><p>\u7A0B\u5E8F\u5458\u5F80\u5F80\u5BF9\u7F16\u7A0B\u8BED\u8A00\u63D0\u4F9B\u7684\u8BBF\u95EE\u63A7\u5236\u8FC7\u4E8E\u81EA\u4FE1\uFF0C\u751A\u81F3\u8BA4\u4E3A Java \u5728\u5B89\u5168\u6027\u4E0A\u6BD4\u5176\u5B83\u63D0\u4F9B\u4E86\uFF08\u660E\u663E\uFF09\u66F4\u5BBD\u677E\u7684\u8BBF\u95EE\u63A7\u5236\u7684\u8BED\u8A00\u8981\u4F18\u8D8A[^4]\u3002\u7136\u800C\uFF0C\u6B63\u5982\u4F60\u6240\u770B\u5230\u7684\uFF0C\u4E8B\u5B9E\u5E76\u4E0D\u662F\u8FD9\u6837\u3002</p><h2 id="\u672C\u7AE0\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u672C\u7AE0\u5C0F\u7ED3" aria-hidden="true">#</a> \u672C\u7AE0\u5C0F\u7ED3</h2><p>RTTI \u5141\u8BB8\u901A\u8FC7\u533F\u540D\u7C7B\u7684\u5F15\u7528\u6765\u83B7\u53D6\u7C7B\u578B\u4FE1\u606F\u3002\u521D\u5B66\u8005\u6781\u6613\u8BEF\u7528\u5B83\uFF0C\u56E0\u4E3A\u5728\u5B66\u4F1A\u4F7F\u7528\u591A\u6001\u8C03\u7528\u65B9\u6CD5\u4E4B\u524D\uFF0C\u8FD9\u4E48\u505A\u4E5F\u5F88\u6709\u6548\u3002\u6709\u8FC7\u7A0B\u5316\u7F16\u7A0B\u80CC\u666F\u7684\u4EBA\u5F88\u5BB9\u6613\u628A\u7A0B\u5E8F\u7EC4\u7EC7\u6210\u4E00\u7CFB\u5217 <code>switch</code> \u8BED\u53E5\uFF0C\u4F60\u53EF\u4EE5\u7528 RTTI \u548C <code>switch</code> \u5B9E\u73B0\u529F\u80FD\uFF0C\u4F46\u8FD9\u6837\u5C31\u635F\u5931\u4E86\u591A\u6001\u673A\u5236\u5728\u4EE3\u7801\u5F00\u53D1\u548C\u7EF4\u62A4\u8FC7\u7A0B\u4E2D\u7684\u91CD\u8981\u4EF7\u503C\u3002\u9762\u5411\u5BF9\u8C61\u7F16\u7A0B\u8BED\u8A00\u662F\u60F3\u8BA9\u6211\u4EEC\u5C3D\u53EF\u80FD\u5730\u4F7F\u7528\u591A\u6001\u673A\u5236\uFF0C\u53EA\u5728\u975E\u7528\u4E0D\u53EF\u7684\u65F6\u5019\u624D\u4F7F\u7528 RTTI\u3002</p><p>\u7136\u800C\u4F7F\u7528\u591A\u6001\u673A\u5236\u7684\u65B9\u6CD5\u8C03\u7528\uFF0C\u8981\u6C42\u6211\u4EEC\u62E5\u6709\u57FA\u7C7B\u5B9A\u4E49\u7684\u63A7\u5236\u6743\u3002\u56E0\u4E3A\u5728\u4F60\u6269\u5C55\u7A0B\u5E8F\u7684\u65F6\u5019\uFF0C\u53EF\u80FD\u4F1A\u53D1\u73B0\u57FA\u7C7B\u5E76\u672A\u5305\u542B\u6211\u4EEC\u60F3\u8981\u7684\u65B9\u6CD5\u3002\u5982\u679C\u57FA\u7C7B\u6765\u81EA\u522B\u4EBA\u7684\u5E93\uFF0C\u8FD9\u65F6 RTTI \u4FBF\u662F\u4E00\u79CD\u89E3\u51B3\u4E4B\u9053\uFF1A\u53EF\u7EE7\u627F\u4E00\u4E2A\u65B0\u7C7B\uFF0C\u7136\u540E\u6DFB\u52A0\u4F60\u9700\u8981\u7684\u65B9\u6CD5\u3002\u5728\u4EE3\u7801\u7684\u5176\u5B83\u5730\u65B9\uFF0C\u53EF\u4EE5\u68C0\u67E5\u4F60\u81EA\u5DF1\u7279\u5B9A\u7684\u7C7B\u578B\uFF0C\u5E76\u8C03\u7528\u4F60\u81EA\u5DF1\u7684\u65B9\u6CD5\u3002\u8FD9\u6837\u505A\u4E0D\u4F1A\u7834\u574F\u591A\u6001\u6027\u4EE5\u53CA\u7A0B\u5E8F\u7684\u6269\u5C55\u80FD\u529B\uFF0C\u56E0\u4E3A\u8FD9\u6837\u6DFB\u52A0\u4E00\u4E2A\u65B0\u7684\u7C7B\u5E76\u4E0D\u9700\u8981\u4FEE\u6539\u7A0B\u5E8F\u4E2D\u7684 <code>switch</code> \u8BED\u53E5\u3002\u4F46\u5982\u679C\u60F3\u5728\u7A0B\u5E8F\u4E2D\u589E\u52A0\u5177\u6709\u65B0\u7279\u6027\u7684\u4EE3\u7801\uFF0C\u4F60\u5C31\u5FC5\u987B\u4F7F\u7528 RTTI \u6765\u68C0\u67E5\u8FD9\u4E2A\u7279\u5B9A\u7684\u7C7B\u578B\u3002</p><p>\u5982\u679C\u53EA\u662F\u4E3A\u4E86\u65B9\u4FBF\u67D0\u4E2A\u7279\u5B9A\u7684\u7C7B\uFF0C\u5C31\u5C06\u67D0\u4E2A\u7279\u6027\u653E\u8FDB\u57FA\u7C7B\u91CC\u8FB9\uFF0C\u8FD9\u5C06\u4F7F\u5F97\u4ECE\u90A3\u4E2A\u57FA\u7C7B\u6D3E\u751F\u51FA\u7684\u6240\u6709\u5176\u5B83\u5B50\u7C7B\u90FD\u5E26\u6709\u8FD9\u4E9B\u53EF\u80FD\u6BEB\u65E0\u610F\u4E49\u7684\u4E1C\u897F\u3002\u8FD9\u4F1A\u5BFC\u81F4\u63A5\u53E3\u66F4\u52A0\u4E0D\u6E05\u6670\uFF0C\u56E0\u4E3A\u6211\u4EEC\u5FC5\u987B\u8986\u76D6\u4ECE\u57FA\u7C7B\u7EE7\u627F\u800C\u6765\u7684\u6240\u6709\u62BD\u8C61\u65B9\u6CD5\uFF0C\u4E8B\u60C5\u5C31\u53D8\u5F97\u5F88\u9EBB\u70E6\u3002\u4E3E\u4E2A\u4F8B\u5B50\uFF0C\u73B0\u5728\u6709\u4E00\u4E2A\u8868\u793A\u4E50\u5668 <code>Instrument</code> \u7684\u7C7B\u5C42\u6B21\u7ED3\u6784\u3002\u5047\u8BBE\u6211\u4EEC\u60F3\u6E05\u7406\u7BA1\u5F26\u4E50\u961F\u4E2D\u67D0\u4E9B\u4E50\u5668\u6B8B\u7559\u7684\u53E3\u6C34\uFF0C\u4E00\u79CD\u529E\u6CD5\u662F\u5728\u57FA\u7C7B <code>Instrument</code> \u4E2D\u653E\u5165 <code>clearSpitValve()</code> \u65B9\u6CD5\u3002\u4F46\u8FD9\u6837\u505A\u4F1A\u5BFC\u81F4\u7C7B\u7ED3\u6784\u6DF7\u4E71\uFF0C\u56E0\u4E3A\u8FD9\u610F\u5473\u7740\u6253\u51FB\u4E50\u5668 <code>Percussion</code>\u3001\u5F26\u4E50\u5668 <code>Stringed</code> \u548C\u7535\u5B50\u4E50\u5668 <code>Electronic</code> \u4E5F\u9700\u8981\u6E05\u7406\u53E3\u6C34\u3002\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0CRTTI \u53EF\u4EE5\u63D0\u4F9B\u4E00\u79CD\u66F4\u5408\u7406\u7684\u89E3\u51B3\u65B9\u6848\u3002\u53EF\u4EE5\u5C06 <code>clearSpitValve()</code> \u653E\u5728\u67D0\u4E2A\u5408\u9002\u7684\u7C7B\u4E2D\uFF0C\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\u662F\u7BA1\u4E50\u5668 <code>Wind</code>\u3002\u4E0D\u8FC7\uFF0C\u5728\u8FD9\u91CC\u4F60\u53EF\u80FD\u4F1A\u53D1\u73B0\u8FD8\u6709\u66F4\u597D\u7684\u89E3\u51B3\u65B9\u6CD5\uFF0C\u5C31\u662F\u5C06 <code>prepareInstrument()</code> \u653E\u5728\u57FA\u7C7B\u4E2D\uFF0C\u4F46\u662F\u521D\u6B21\u9762\u5BF9\u8FD9\u4E2A\u95EE\u9898\u7684\u8BFB\u8005\u53EF\u80FD\u60F3\u4E0D\u5230\u8FD8\u6709\u8FD9\u6837\u7684\u89E3\u51B3\u65B9\u6848\uFF0C\u800C\u8BEF\u8BA4\u4E3A\u5FC5\u987B\u4F7F\u7528 RTTI\u3002</p><p>\u6700\u540E\u4E00\u70B9\uFF0CRTTI \u6709\u65F6\u5019\u4E5F\u80FD\u89E3\u51B3\u6548\u7387\u95EE\u9898\u3002\u5047\u8BBE\u4F60\u7684\u4EE3\u7801\u8FD0\u7528\u4E86\u591A\u6001\uFF0C\u4F46\u662F\u4E3A\u4E86\u5B9E\u73B0\u591A\u6001\uFF0C\u5BFC\u81F4\u5176\u4E2D\u67D0\u4E2A\u5BF9\u8C61\u7684\u6548\u7387\u975E\u5E38\u4F4E\u3002\u8FD9\u65F6\u5019\uFF0C\u4F60\u5C31\u53EF\u4EE5\u6311\u51FA\u90A3\u4E2A\u7C7B\uFF0C\u4F7F\u7528 RTTI \u4E3A\u5B83\u7F16\u5199\u4E00\u6BB5\u7279\u522B\u7684\u4EE3\u7801\u4EE5\u63D0\u9AD8\u6548\u7387\u3002\u7136\u800C\u5FC5\u987B\u6CE8\u610F\u7684\u662F\uFF0C\u4E0D\u8981\u592A\u65E9\u5730\u5173\u6CE8\u7A0B\u5E8F\u7684\u6548\u7387\u95EE\u9898\uFF0C\u8FD9\u662F\u4E2A\u8BF1\u4EBA\u7684\u9677\u9631\u3002\u6700\u597D\u5148\u8BA9\u7A0B\u5E8F\u80FD\u8DD1\u8D77\u6765\uFF0C\u7136\u540E\u518D\u53BB\u770B\u770B\u7A0B\u5E8F\u80FD\u4E0D\u80FD\u8DD1\u5F97\u66F4\u5FEB\uFF0C\u4E0B\u4E00\u6B65\u624D\u662F\u53BB\u89E3\u51B3\u6548\u7387\u95EE\u9898\uFF08\u6BD4\u5982\u4F7F\u7528 Profiler\uFF09[^5]\u3002</p><p>\u6211\u4EEC\u5DF2\u7ECF\u770B\u5230\uFF0C\u53CD\u5C04\uFF0C\u56E0\u5176\u66F4\u52A0\u52A8\u6001\u7684\u7F16\u7A0B\u98CE\u683C\uFF0C\u4E3A\u6211\u4EEC\u5F00\u521B\u4E86\u7F16\u7A0B\u7684\u65B0\u4E16\u754C\u3002\u4F46\u5BF9\u6709\u4E9B\u4EBA\u6765\u8BF4\uFF0C\u53CD\u5C04\u7684\u52A8\u6001\u7279\u6027\u5374\u662F\u4E00\u79CD\u56F0\u6270\u3002\u5BF9\u90A3\u4E9B\u5DF2\u7ECF\u4E60\u60EF\u4E8E\u9759\u6001\u7C7B\u578B\u68C0\u67E5\u7684\u5B89\u5168\u6027\u7684\u4EBA\u6765\u8BF4\uFF0CJava \u4E2D\u5141\u8BB8\u8FD9\u79CD\u52A8\u6001\u7C7B\u578B\u68C0\u67E5\uFF08\u53EA\u5728\u8FD0\u884C\u65F6\u624D\u80FD\u68C0\u67E5\u5230\uFF0C\u5E76\u4EE5\u5F02\u5E38\u7684\u5F62\u5F0F\u4E0A\u62A5\u68C0\u67E5\u7ED3\u679C\uFF09\u7684\u64CD\u4F5C\u4F3C\u4E4E\u662F\u4E00\u79CD\u9519\u8BEF\u7684\u65B9\u5411\u3002\u6709\u4E9B\u4EBA\u60F3\u5F97\u66F4\u8FDC\uFF0C\u4ED6\u4EEC\u8BA4\u4E3A\u5F15\u5165\u8FD0\u884C\u65F6\u5F02\u5E38\u672C\u8EAB\u5C31\u662F\u4E00\u79CD\u6307\u793A\uFF0C\u6307\u793A\u6211\u4EEC\u5E94\u8BE5\u907F\u514D\u8FD9\u79CD\u4EE3\u7801\u3002\u6211\u53D1\u73B0\u8FD9\u79CD\u610F\u4E49\u7684\u5B89\u5168\u662F\u4E00\u79CD\u9519\u89C9\uFF0C\u56E0\u4E3A\u603B\u662F\u6709\u4E9B\u4E8B\u60C5\u662F\u5728\u8FD0\u884C\u65F6\u624D\u53D1\u751F\u5E76\u629B\u51FA\u5F02\u5E38\u7684\uFF0C\u5373\u4F7F\u662F\u5728\u90A3\u4E9B\u4E0D\u5305\u542B\u4EFB\u4F55 <code>try</code> \u8BED\u53E5\u5757\u6216\u5F02\u5E38\u58F0\u660E\u7684\u7A0B\u5E8F\u4E2D\u4E5F\u662F\u5982\u6B64\u3002\u56E0\u6B64\uFF0C\u6211\u8BA4\u4E3A\u4E00\u81F4\u6027\u9519\u8BEF\u62A5\u544A\u6A21\u578B\u7684\u5B58\u5728\u4F7F\u6211\u4EEC\u80FD\u591F\u901A\u8FC7\u4F7F\u7528\u53CD\u5C04\u7F16\u5199\u52A8\u6001\u4EE3\u7801\u3002\u5F53\u7136\uFF0C\u5C3D\u529B\u7F16\u5199\u80FD\u591F\u8FDB\u884C\u9759\u6001\u68C0\u67E5\u7684\u4EE3\u7801\u662F\u6709\u4EF7\u503C\u7684\uFF0C\u53EA\u8981\u4F60\u6709\u8FD9\u6837\u7684\u80FD\u529B\u3002\u4F46\u662F\u6211\u76F8\u4FE1\u52A8\u6001\u4EE3\u7801\u662F\u5C06 Java \u4E0E\u5176\u5B83\u8BF8\u5982 C++ \u8FD9\u6837\u7684\u8BED\u8A00\u533A\u5206\u5F00\u7684\u91CD\u8981\u5DE5\u5177\u4E4B\u4E00\u3002</p><p>[^1]: \u7279\u522B\u662F\u5728\u8FC7\u53BB\u3002\u4F46\u73B0\u5728 Java \u7684 HTML \u6587\u6863\u6709\u4E86\u5F88\u5927\u7684\u63D0\u5347\uFF0C\u8981\u67E5\u770B\u57FA\u7C7B\u7684\u65B9\u6CD5\u5DF2\u7ECF\u53D8\u5F97\u5F88\u5BB9\u6613\u4E86\u3002</p><p>[^2]: \u8FD9\u662F\u6781\u9650\u7F16\u7A0B\uFF08XP\uFF0CExtreme Programming\uFF09\u7684\u539F\u5219\u4E4B\u4E00\uFF1A\u201CTry the simplest thing that could possibly work\uFF0C\u5B9E\u73B0\u5C3D\u6700\u5927\u53EF\u80FD\u7684\u7B80\u5355\u3002\u201D</p><p>[^3]: \u6700\u8457\u540D\u7684\u4F8B\u5B50\u662F Windows \u64CD\u4F5C\u7CFB\u7EDF\uFF0CWindows \u4E3A\u5F00\u53D1\u8005\u63D0\u4F9B\u4E86\u516C\u5F00\u7684 API\uFF0C\u4F46\u662F\u5F00\u53D1\u8005\u8FD8\u53EF\u4EE5\u627E\u5230\u4E00\u4E9B\u975E\u516C\u5F00\u4F46\u662F\u53EF\u4EE5\u8C03\u7528\u7684\u51FD\u6570\u3002\u4E3A\u4E86\u89E3\u51B3\u95EE\u9898\uFF0C\u5F88\u591A\u7A0B\u5E8F\u5458\u4F7F\u7528\u4E86\u9690\u85CF\u7684 API \u51FD\u6570\u3002\u8FD9\u5C31\u8FEB\u4F7F\u5FAE\u8F6F\u516C\u53F8\u8981\u50CF\u7EF4\u62A4\u516C\u5F00 API \u4E00\u6837\u7EF4\u62A4\u8FD9\u4E9B\u9690\u85CF\u7684 API\uFF0C\u6D88\u8017\u4E86\u5DE8\u5927\u7684\u6210\u672C\u548C\u7CBE\u529B\u3002</p><p>[^4]: \u6BD4\u5982\uFF0CPython \u4E2D\u5728\u5143\u7D20\u524D\u9762\u6DFB\u52A0\u53CC\u4E0B\u5212\u7EBF <code>__</code>\uFF0C\u5C31\u8868\u793A\u4F60\u60F3\u9690\u85CF\u8FD9\u4E2A\u5143\u7D20\u3002\u5982\u679C\u4F60\u5728\u7C7B\u6216\u8005\u5305\u5916\u9762\u8C03\u7528\u4E86\u8FD9\u4E2A\u5143\u7D20\uFF0C\u8FD0\u884C\u73AF\u5883\u5C31\u4F1A\u62A5\u9519\u3002</p><p>[^5]: \u8BD1\u8005\u6CE8\uFF1AJava Profiler \u662F\u4E00\u79CD Java \u6027\u80FD\u5206\u6790\u5DE5\u5177\uFF0C\u7528\u4E8E\u5728 JVM \u7EA7\u522B\u76D1\u89C6 Java \u5B57\u8282\u7801\u7684\u6784\u9020\u548C\u6267\u884C\u3002\u4E3B\u6D41\u7684 Profiler \u6709 JProfiler\u3001YourKit \u548C Java VisualVM \u7B49\u3002</p><div style="page-break-after:always;"></div>`,91);function D(J,G){const a=c("RouterLink");return l(),i("div",null,[d,s("p",null,[r,v,m,b,y,t(a,{to:"/docs/reprint/onjava8/book/25-Patterns.html"},{default:p(()=>[g]),_:1}),w]),f,s("p",null,[h,S,C,q,x,j,P,T,I,M,R,t(a,{to:"/docs/reprint/onjava8/book/docs/book/13-Functional-Programming.html"},{default:p(()=>[E]),_:1}),O,A,N,F,_,B,L]),H])}var Y=o(k,[["render",D],["__file","19-Type-Information.html.vue"]]);export{Y as default};
