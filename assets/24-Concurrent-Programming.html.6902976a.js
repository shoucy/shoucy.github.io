import{_ as o,r as c,o as l,c as i,a as s,b as p,w as t,e,d as n}from"./app.205a3d76.js";const u={},k=e('<p>[TOC]</p><h1 id="\u7B2C\u4E8C\u5341\u56DB\u7AE0-\u5E76\u53D1\u7F16\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E8C\u5341\u56DB\u7AE0-\u5E76\u53D1\u7F16\u7A0B" aria-hidden="true">#</a> \u7B2C\u4E8C\u5341\u56DB\u7AE0 \u5E76\u53D1\u7F16\u7A0B</h1><blockquote><p>\u7231\u4E3D\u4E1D\uFF1A\u201C\u6211\u53EF\u4E0D\u60F3\u5230\u75AF\u5B50\u4E2D\u95F4\u53BB\u201D</p><p>\u732B\u54AA\uFF1A\u201C\u554A\uFF0C\u90A3\u6CA1\u8F99\u4E86\uFF0C\u6211\u4EEC\u8FD9\u90FD\u662F\u75AF\u5B50\u3002\u6211\u75AF\u4E86\uFF0C\u4F60\u4E5F\u75AF\u4E86\u201D</p><p>\u7231\u4E3D\u4E1D\uFF1A\u201C\u4F60\u600E\u4E48\u77E5\u9053\u6211\u75AF\u4E86\u201D\u3002</p><p>\u732B\u54AA\uFF1A\u201C\u4F60\u4E00\u5B9A\u662F\u75AF\u4E86\uFF0C\u5426\u5219\u4F60\u5C31\u4E0D\u4F1A\u6765\u8FD9\u513F\u201D \u2014\u2014\u7231\u4E3D\u4E1D\u68A6\u6E38\u4ED9\u5883 \u7B2C 6 \u7AE0\u3002</p></blockquote><p>\u5728\u672C\u7AE0\u4E4B\u524D\uFF0C\u6211\u4EEC\u60EF\u7528\u4E00\u79CD\u7B80\u5355\u987A\u5E8F\u7684\u53D9\u4E8B\u65B9\u5F0F\u6765\u7F16\u7A0B\uFF0C\u6709\u70B9\u7C7B\u4F3C\u6587\u5B66\u4E2D\u7684\u610F\u8BC6\u6D41\uFF1A\u7B2C\u4E00\u4EF6\u4E8B\u53D1\u751F\u4E86\uFF0C\u7136\u540E\u662F\u7B2C\u4E8C\u4EF6\uFF0C\u7B2C\u4E09\u4EF6\u2026\u2026\u603B\u4E4B\uFF0C\u6211\u4EEC\u5B8C\u5168\u638C\u63E1\u7740\u4E8B\u60C5\u53D1\u751F\u7684\u8FDB\u5C55\u548C\u987A\u5E8F\u3002\u5982\u679C\u6211\u4EEC\u5C06\u4E00\u4E2A\u503C\u8BBE\u7F6E\u4E3A 5\uFF0C\u518D\u770B\u65F6\u5B83\u5DF2\u53D8\u6210 47 \u7684\u8BDD\uFF0C\u8FD9\u5C31\u4EE4\u4EBA\u532A\u5937\u6240\u601D\u4E86\u3002</p><p>\u73B0\u5728\uFF0C\u6211\u4EEC\u6765\u5230\u4E86\u964C\u751F\u7684\u5E76\u53D1\u4E16\u754C\uFF0C\u5728\u8FD9\u91CC\u8FD9\u6837\u7684\u7ED3\u679C\u4E00\u70B9\u90FD\u4E0D\u5947\u602A\u3002\u4F60\u539F\u6765\u76F8\u4FE1\u7684\u4E00\u5207\u90FD\u4E0D\u518D\u53EF\u9760\u3002\u539F\u6709\u7684\u89C4\u5219\u53EF\u80FD\u751F\u6548\u4E5F\u53EF\u80FD\u5931\u6548\u3002\u66F4\u53EF\u80FD\u7684\u662F\u539F\u6709\u7684\u89C4\u5219\u53EA\u4F1A\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\u751F\u6548\u3002\u6211\u4EEC\u53EA\u6709\u5B8C\u5168\u4E86\u89E3\u8FD9\u4E9B\u60C5\u51B5\uFF0C\u624D\u80FD\u51B3\u5B9A\u6211\u4EEC\u5904\u7406\u4E8B\u60C5\u7684\u65B9\u5F0F\u3002</p><p>\u6BD4\u5982\uFF0C\u6211\u4EEC\u6B63\u5E38\u7684\u751F\u6D3B\u7684\u4E16\u754C\u662F\u9075\u5FAA\u7ECF\u5178\u725B\u987F\u529B\u5B66\u7684\u3002\u7269\u4F53\u5177\u6709\u8D28\u91CF\uFF1A\u4F1A\u5760\u843D\u5E76\u4E14\u8F6C\u79FB\u52A8\u80FD\u3002\u7535\u7EBF\u6709\u7535\u963B\uFF0C\u5149\u6CBF\u76F4\u7EBF\u4F20\u64AD\u3002\u5047\u5982\u6211\u4EEC\u8FDB\u5165\u5230\u6781\u5C0F\u3001\u6781\u5927\u3001\u6781\u51B7\u6216\u8005\u6781\u70ED\uFF08\u90A3\u4E9B\u6211\u4EEC\u65E0\u6CD5\u751F\u5B58\u7684\u4E16\u754C\uFF09\uFF0C\u8FD9\u4E9B\u73B0\u8C61\u5C31\u4F1A\u53D1\u751F\u6539\u53D8\u3002\u6211\u4EEC\u65E0\u6CD5\u5224\u65AD\u67D0\u7269\u4F53\u662F\u7C92\u5B50\u8FD8\u662F\u6CE2\uFF0C\u5149\u662F\u5426\u53D7\u5230\u91CD\u529B\u5F71\u54CD\uFF0C\u4E00\u4E9B\u7269\u8D28\u8FD8\u4F1A\u53D8\u4E3A\u8D85\u5BFC\u4F53\u3002</p><p>\u5047\u8BBE\u6211\u4EEC\u5904\u5728\u591A\u6761\u6545\u4E8B\u7EBF\u5E76\u884C\u7684\u95F4\u8C0D\u5C0F\u8BF4\u91CC\uFF0C\u975E\u5355\u4E00\u610F\u8BC6\u6D41\u5730\u53D9\u4E8B\uFF1A\u7B2C\u4E00\u4E2A\u95F4\u8C0D\u5728\u5CA9\u77F3\u5E95\u7559\u4E0B\u4E86\u5FAE\u7F29\u80F6\u7247\u3002\u5F53\u7B2C\u4E8C\u4E2A\u95F4\u8C0D\u6765\u53D6\u65F6\uFF0C\u80F6\u7247\u53EF\u80FD\u5DF2\u88AB\u7B2C\u4E09\u4E2A\u95F4\u8C0D\u62FF\u8D70\u3002\u5C0F\u8BF4\u5E76\u6CA1\u6709\u4EA4\u4EE3\u6B64\u5904\u7684\u7EC6\u8282\u3002\u6240\u4EE5\u76F4\u5230\u6545\u4E8B\u7ED3\u5C3E\uFF0C\u6211\u4EEC\u90FD\u6CA1\u641E\u6E05\u695A\u5230\u5E95\u53D1\u751F\u4E86\u4EC0\u4E48\u3002</p><p>\u6784\u5EFA\u5E76\u53D1\u7A0B\u5E8F\u597D\u6BD4\u73A9<a href="https://en.wikipedia.org/wiki/Jenga" target="_blank" rel="noopener noreferrer">\u642D\u79EF\u6728</a>\u6E38\u620F\u3002\u6BCF\u62C9\u51FA\u4E00\u5757\u653E\u5728\u5854\u9876\u65F6\u90FD\u6709\u5D29\u584C\u7684\u53EF\u80FD\u3002\u6BCF\u4E2A\u79EF\u6728\u5854\u548C\u5E94\u7528\u7A0B\u5E8F\u90FD\u662F\u72EC\u4E00\u65E0\u4E8C\u7684\uFF0C\u6709\u7740\u81EA\u5DF1\u7684\u4F5C\u7528\u3002\u4F60\u5728\u67D0\u4E2A\u7CFB\u7EDF\u6784\u5EFA\u4E2D\u5B66\u5230\u7684\u77E5\u8BC6\u5E76\u4E0D\u4E00\u5B9A\u9002\u7528\u4E8E\u4E0B\u4E00\u4E2A\u7CFB\u7EDF\u3002</p><p>\u672C\u7AE0\u662F\u5BF9\u5E76\u53D1\u6982\u5FF5\u6700\u57FA\u672C\u7684\u4ECB\u7ECD\u3002\u867D\u7136\u6211\u4EEC\u7528\u5230\u4E86\u73B0\u4EE3\u7684 Java 8 \u5DE5\u5177\u6765\u6F14\u793A\u539F\u7406\uFF0C\u4F46\u8FD8\u8FDC\u672A\u53CA\u5168\u9762\u8BBA\u8FF0\u5E76\u53D1\u3002\u6211\u7684\u76EE\u6807\u662F\u4E3A\u4F60\u63D0\u4F9B\u8DB3\u591F\u7684\u57FA\u7840\u77E5\u8BC6\uFF0C\u4F7F\u4F60\u80FD\u591F\u628A\u63E1\u95EE\u9898\u7684\u590D\u6742\u6027\u548C\u5371\u9669\u6027\uFF0C\u4ECE\u800C\u5B89\u5168\u5730\u6E21\u8FC7\u8FD9\u7247\u9CA8\u9C7C\u8086\u8650\u7684\u56F0\u96BE\u6C34\u57DF\u3002</p><p>\u66F4\u591A\u7E41\u7410\u548C\u5E95\u5C42\u7684\u7EC6\u8282\uFF0C\u8BF7\u53C2\u9605\u9644\u5F55\uFF1A<a href="https://github.com/LingCoder/OnJava8/blob/master/docs/book/Appendix-Low-Level-Concurrency.md" target="_blank" rel="noopener noreferrer">\u5E76\u53D1\u5E95\u5C42\u539F\u7406</a>\u3002\u8981\u8FDB\u4E00\u6B65\u6DF1\u5165\u8FD9\u4E2A\u9886\u57DF\uFF0C\u4F60\u8FD8\u5FC5\u987B\u9605\u8BFB <em>Brian Goetz</em> \u7B49\u4EBA\u7684 \u300AJava Concurrency in Practice\u300B\u3002\u5728\u64B0\u5199\u672C\u6587\u65F6\uFF0C\u8BE5\u4E66\u5DF2\u6709\u5341\u591A\u5E74\u7684\u5386\u53F2\u4E86\uFF0C\u4F46\u5B83\u4ECD\u5305\u542B\u6211\u4EEC\u5FC5\u987B\u8981\u4E86\u89E3\u548C\u660E\u767D\u7684\u77E5\u8BC6\u8981\u70B9\u3002\u7406\u60F3\u60C5\u51B5\u4E0B\uFF0C\u672C\u7AE0\u548C\u4E0A\u8FF0\u9644\u5F55\u662F\u9605\u8BFB\u8BE5\u4E66\u7684\u826F\u597D\u524D\u63D0\u3002\u53E6\u5916\uFF0C<em>Bill Venner</em> \u7684 \u300AInside the Java Virtual Machine\u300B\u4E5F\u5F88\u503C\u5F97\u4E00\u770B\u3002\u5B83\u8BE6\u7EC6\u63CF\u8FF0\u4E86\u5305\u62EC\u7EBF\u7A0B\u5728\u5185\u7684 JVM \u7684\u5185\u90E8\u5DE5\u4F5C\u65B9\u5F0F\u3002</p><h2 id="\u672F\u8BED\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u672F\u8BED\u95EE\u9898" aria-hidden="true">#</a> \u672F\u8BED\u95EE\u9898</h2><p>\u672F\u8BED\u201C\u5E76\u53D1\u201D\uFF0C\u201C\u5E76\u884C\u201D\uFF0C\u201C\u591A\u4EFB\u52A1\u201D\uFF0C\u201C\u591A\u5904\u7406\u201D\uFF0C\u201C\u591A\u7EBF\u7A0B\u201D\uFF0C\u5206\u5E03\u5F0F\u7CFB\u7EDF\uFF08\u53EF\u80FD\u8FD8\u6709\u5176\u4ED6\uFF09\u5728\u6574\u4E2A\u7F16\u7A0B\u6587\u732E\u4E2D\u90FD\u4EE5\u591A\u79CD\u76F8\u4E92\u51B2\u7A81\u7684\u65B9\u5F0F\u4F7F\u7528\uFF0C\u5E76\u4E14\u7ECF\u5E38\u88AB\u6DF7\u4E3A\u4E00\u8C08\u3002 <em>Brian Goetz</em> \u5728\u4ED6 2016 \u5E74\u300A\u4ECE\u5E76\u53D1\u5230\u5E76\u884C\u300B\u7684\u6F14\u8BB2\u4E2D\u6307\u51FA\u4E86\u8FD9\u4E00\u70B9\uFF0C\u4E4B\u540E\u63D0\u51FA\u4E86\u5408\u7406\u7684\u533A\u5206\uFF1A</p><ul><li>\u5E76\u53D1\u662F\u5173\u4E8E\u6B63\u786E\u6709\u6548\u5730\u63A7\u5236\u5BF9\u5171\u4EAB\u8D44\u6E90\u7684\u8BBF\u95EE\u3002</li><li>\u5E76\u884C\u662F\u4F7F\u7528\u989D\u5916\u7684\u8D44\u6E90\u6765\u66F4\u5FEB\u5730\u4EA7\u751F\u7ED3\u679C\u3002</li></ul><p>\u8FD9\u4E9B\u5B9A\u4E49\u5F88\u597D\uFF0C\u4F46\u662F\u6211\u4EEC\u5DF2\u6709\u51E0\u5341\u5E74\u6DF7\u4E71\u4F7F\u7528\u548C\u6297\u62D2\u89E3\u51B3\u6B64\u95EE\u9898\u7684\u5386\u53F2\u4E86\u3002\u4E00\u822C\u6765\u8BF4\uFF0C\u5F53\u4EBA\u4EEC\u4F7F\u7528\u201C\u5E76\u53D1\u201D\u8FD9\u4E2A\u8BCD\u65F6\uFF0C\u4ED6\u4EEC\u7684\u610F\u601D\u662F\u201C\u6240\u6709\u7684\u4E00\u5207\u201D\u3002\u4E8B\u5B9E\u4E0A\uFF0C\u6211\u81EA\u5DF1\u4E5F\u7ECF\u5E38\u9677\u5165\u8FD9\u6837\u7684\u60F3\u6CD5\u3002\u5728\u5927\u591A\u6570\u4E66\u7C4D\u4E2D\uFF0C\u5305\u62EC <em>Brian Goetz</em> \u7684 \u300AJava Concurrency in Practice\u300B\uFF0C\u90FD\u5728\u6807\u9898\u4E2D\u4F7F\u7528\u8FD9\u4E2A\u8BCD\u3002</p><p>\u201C\u5E76\u53D1\u201D\u901A\u5E38\u8868\u793A\uFF1A\u201D\u4E0D\u6B62\u4E00\u4E2A\u4EFB\u52A1\u6B63\u5728\u6267\u884C\u201C\u3002\u800C\u201C\u5E76\u884C\u201D\u51E0\u4E4E\u603B\u662F\u4EE3\u8868\uFF1A\u201D\u4E0D\u6B62\u4E00\u4E2A\u4EFB\u52A1\u540C\u65F6\u6267\u884C\u201C\u3002\u73B0\u5728\u6211\u4EEC\u80FD\u7ACB\u5373\u770B\u51FA\u8FD9\u4E9B\u5B9A\u4E49\u4E2D\u7684\u95EE\u9898\u6240\u5728\uFF1A\u201C\u5E76\u884C\u201D\u4E5F\u6709\u4E0D\u6B62\u4E00\u4E2A\u4EFB\u52A1\u6B63\u5728\u6267\u884C\u7684\u8BED\u4E49\u5728\u91CC\u9762\u3002\u533A\u522B\u5C31\u5728\u4E8E\u7EC6\u8282\uFF1A\u7A76\u7ADF\u662F\u600E\u4E48\u201C\u6267\u884C\u201D\u7684\u3002\u6B64\u5916\u8FD8\u6709\u4E00\u4E9B\u91CD\u53E0\uFF1A\u4E3A\u5E76\u884C\u7F16\u5199\u7684\u7A0B\u5E8F\u4F9D\u65E7\u53EF\u4EE5\u5728\u5355\u5904\u7406\u5668\u4E0A\u8FD0\u884C\uFF0C\u800C\u5E76\u53D1\u7F16\u5199\u7684\u7CFB\u7EDF\u4E5F\u53EF\u4EE5\u5229\u7528\u591A\u4E2A\u5904\u7406\u5668\u3002</p><p>\u8FD8\u6709\u53E6\u4E00\u79CD\u65B9\u5F0F\uFF0C\u56F4\u7ED5\u201D\u7F13\u6162\u201C\u51FA\u73B0\u7684\u60C5\u51B5\u5199\u4E0B\u5B9A\u4E49\uFF1A</p><p><strong>\u5E76\u53D1</strong></p><p>\u540C\u65F6\u5B8C\u6210\u591A\u4EFB\u52A1\u3002\u65E0\u9700\u7B49\u5F85\u5F53\u524D\u4EFB\u52A1\u5B8C\u6210\u5373\u53EF\u6267\u884C\u5176\u4ED6\u4EFB\u52A1\u3002\u201C\u5E76\u53D1\u201D\u89E3\u51B3\u4E86\u7A0B\u5E8F\u56E0\u5916\u90E8\u63A7\u5236\u800C\u65E0\u6CD5\u8FDB\u4E00\u6B65\u6267\u884C\u7684\u963B\u585E\u95EE\u9898\u3002\u6700\u5E38\u89C1\u7684\u4F8B\u5B50\u5C31\u662F I/O \u64CD\u4F5C\uFF0C\u4EFB\u52A1\u5FC5\u987B\u7B49\u5F85\u6570\u636E\u8F93\u5165\uFF08\u5728\u4E00\u4E9B\u4F8B\u5B50\u4E2D\u4E5F\u79F0\u963B\u585E\uFF09\u3002\u8FD9\u4E2A\u95EE\u9898\u5E38\u89C1\u4E8E I/O \u5BC6\u96C6\u578B\u4EFB\u52A1\u3002</p><p><strong>\u5E76\u884C</strong></p><p>\u540C\u65F6\u5728\u591A\u4E2A\u4F4D\u7F6E\u5B8C\u6210\u591A\u4EFB\u52A1\u3002\u8FD9\u89E3\u51B3\u4E86\u6240\u8C13\u7684 CPU \u5BC6\u96C6\u578B\u95EE\u9898\uFF1A\u5C06\u7A0B\u5E8F\u5206\u4E3A\u591A\u90E8\u5206\uFF0C\u5728\u591A\u4E2A\u5904\u7406\u5668\u4E0A\u540C\u65F6\u5904\u7406\u4E0D\u540C\u90E8\u5206\u6765\u52A0\u5FEB\u7A0B\u5E8F\u6267\u884C\u6548\u7387\u3002</p><p>\u4E0A\u9762\u7684\u5B9A\u4E49\u8BF4\u660E\u4E86\u8FD9\u4E24\u4E2A\u672F\u8BED\u4EE4\u4EBA\u56F0\u60D1\u7684\u539F\u56E0\uFF1A\u4E24\u8005\u7684\u6838\u5FC3\u90FD\u662F\u201C\u540C\u65F6\u5B8C\u6210\u591A\u4E2A\u4EFB\u52A1\u201D\uFF0C\u4E0D\u8FC7\u5E76\u884C\u589E\u52A0\u4E86\u8DE8\u591A\u4E2A\u5904\u7406\u5668\u7684\u5206\u5E03\u3002\u66F4\u91CD\u8981\u7684\u662F\uFF0C\u5B83\u4EEC\u53EF\u4EE5\u89E3\u51B3\u4E0D\u540C\u7C7B\u578B\u7684\u95EE\u9898\uFF1A\u5E76\u884C\u53EF\u80FD\u5BF9\u89E3\u51B3 I / O \u5BC6\u96C6\u578B\u95EE\u9898\u6CA1\u6709\u4EFB\u4F55\u597D\u5904\uFF0C\u56E0\u4E3A\u95EE\u9898\u4E0D\u5728\u4E8E\u7A0B\u5E8F\u7684\u6574\u4F53\u6267\u884C\u901F\u5EA6\uFF0C\u800C\u5728\u4E8E I/O \u963B\u585E\u3002\u800C\u5C1D\u8BD5\u5728\u5355\u4E2A\u5904\u7406\u5668\u4E0A\u4F7F\u7528\u5E76\u53D1\u6765\u89E3\u51B3\u8BA1\u7B97\u5BC6\u96C6\u578B\u95EE\u9898\u4E5F\u53EF\u80FD\u662F\u6D6A\u8D39\u65F6\u95F4\u3002\u4E24\u79CD\u65B9\u6CD5\u90FD\u8BD5\u56FE\u5728\u66F4\u77ED\u7684\u65F6\u95F4\u5185\u5B8C\u6210\u66F4\u591A\u5DE5\u4F5C\uFF0C\u4F46\u662F\u5B83\u4EEC\u5B9E\u73B0\u52A0\u901F\u7684\u65B9\u5F0F\u6709\u6240\u4E0D\u540C\uFF0C\u8FD9\u53D6\u51B3\u4E8E\u95EE\u9898\u65BD\u52A0\u7684\u7EA6\u675F\u3002</p><p>\u8FD9\u4E24\u4E2A\u6982\u5FF5\u6DF7\u5408\u5728\u4E00\u8D77\u7684\u4E00\u4E2A\u4E3B\u8981\u539F\u56E0\u662F\u5305\u62EC Java \u5728\u5185\u7684\u8BB8\u591A\u7F16\u7A0B\u8BED\u8A00\u4F7F\u7528\u76F8\u540C\u7684\u673A\u5236 - <strong>\u7EBF\u7A0B</strong>\u6765\u5B9E\u73B0\u5E76\u53D1\u548C\u5E76\u884C\u3002</p><p>\u6211\u4EEC\u751A\u81F3\u53EF\u4EE5\u5C1D\u8BD5\u4EE5\u66F4\u7EC6\u7684\u7C92\u5EA6\u53BB\u8FDB\u884C\u5B9A\u4E49\uFF08\u7136\u800C\u8FD9\u5E76\u4E0D\u662F\u6807\u51C6\u5316\u7684\u672F\u8BED\uFF09\uFF1A</p><ul><li><p><strong>\u7EAF\u5E76\u53D1</strong>\uFF1A\u4ECD\u7136\u5728\u5355\u4E2A CPU \u4E0A\u8FD0\u884C\u4EFB\u52A1\u3002\u7EAF\u5E76\u53D1\u7CFB\u7EDF\u6BD4\u65F6\u5E8F\u7CFB\u7EDF\u66F4\u5FEB\u5730\u4EA7\u751F\u7ED3\u679C\uFF0C\u4F46\u662F\u5B83\u7684\u8FD0\u884C\u901F\u5EA6\u4E0D\u4F1A\u56E0\u4E3A\u5904\u7406\u5668\u7684\u589E\u52A0\u800C\u53D8\u5F97\u66F4\u5FEB\u3002</p></li><li><p><strong>\u5E76\u53D1-\u5E76\u884C</strong>\uFF1A\u4F7F\u7528\u5E76\u53D1\u6280\u672F\uFF0C\u7ED3\u679C\u7A0B\u5E8F\u53EF\u4EE5\u5229\u7528\u591A\u5904\u7406\u5668\u66F4\u5FEB\u5730\u4EA7\u751F\u7ED3\u679C\u3002</p></li><li><p><strong>\u5E76\u884C-\u5E76\u53D1</strong>\uFF1A\u4F7F\u7528\u5E76\u884C\u7F16\u7A0B\u6280\u672F\u7F16\u5199\uFF0C\u5373\u4F7F\u53EA\u6709\u4E00\u4E2A\u5904\u7406\u5668\uFF0C\u7ED3\u679C\u7A0B\u5E8F\u4ECD\u7136\u53EF\u4EE5\u8FD0\u884C\uFF08Java 8 <strong>Streams</strong> \u5C31\u662F\u4E00\u4E2A\u5F88\u597D\u7684\u4F8B\u5B50\uFF09\u3002</p></li><li><p><strong>\u7EAF\u5E76\u884C</strong>\uFF1A\u53EA\u6709\u591A\u4E2A\u5904\u7406\u5668\u7684\u60C5\u51B5\u4E0B\u624D\u80FD\u8FD0\u884C\u3002</p></li></ul><p>\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u8FD9\u662F\u4E00\u4E2A\u6709\u6548\u7684\u5206\u7C7B\u6CD5\u3002</p><p>\u652F\u6301\u5E76\u53D1\u6027\u7684\u8BED\u8A00\u548C\u5E93\u4F3C\u4E4E\u662F<a href="https://en.wikipedia.org/wiki/Leaky_abstraction" target="_blank" rel="noopener noreferrer">\u62BD\u8C61\u6CC4\u9732\uFF08Leaky Abstraction</a>\u4E00\u8BCD\u7684\u5B8C\u7F8E\u5019\u9009\u3002\u62BD\u8C61\u7684\u76EE\u6807\u662F\u201C\u62BD\u8C61\u201D\u6389\u90A3\u4E9B\u5BF9\u624B\u5934\u7684\u60F3\u6CD5\u4E0D\u91CD\u8981\u7684\u90E8\u5206\uFF0C\u4EE5\u5C4F\u853D\u4E0D\u5FC5\u8981\u7684\u7EC6\u8282\u6240\u5E26\u6765\u7684\u5F71\u54CD\u3002\u5982\u679C\u62BD\u8C61\u53D1\u751F\u6CC4\u9732\uFF0C\u90A3\u4E48\u5373\u4F7F\u8D39\u5F88\u5927\u529F\u592B\u53BB\u9690\u85CF\u5B83\u4EEC\uFF0C\u8FD9\u4E9B\u7EC6\u679D\u672B\u8282\u4E5F\u603B\u4F1A\u4E0D\u65AD\u51F8\u663E\u51FA\u81EA\u5DF1\u662F\u91CD\u8981\u7684\u3002</p><p>\u4E8E\u662F\u6211\u5F00\u59CB\u6000\u7591\u662F\u5426\u771F\u7684\u6709\u9AD8\u5EA6\u5730\u62BD\u8C61\u3002\u56E0\u4E3A\u5F53\u7F16\u5199\u8FD9\u7C7B\u7A0B\u5E8F\u65F6\uFF0C\u5E95\u5C42\u7684\u7CFB\u7EDF\u3001\u5DE5\u5177\uFF0C\u751A\u81F3\u662F\u5173\u4E8E CPU \u7F13\u5B58\u5982\u4F55\u5DE5\u4F5C\u7684\u7EC6\u8282\uFF0C\u90FD\u6C38\u8FDC\u4E0D\u4F1A\u88AB\u5C4F\u853D\u3002\u6700\u540E\uFF0C\u5373\u4F7F\u4F60\u5DF2\u975E\u5E38\u8C28\u614E\uFF0C\u4F60\u5F00\u53D1\u7684\u7A0B\u5E8F\u4E5F\u4E0D\u4E00\u5B9A\u5728\u6240\u6709\u60C5\u51B5\u4E0B\u8FD0\u884C\u6B63\u5E38\u3002\u6709\u65F6\u662F\u56E0\u4E3A\u4E24\u53F0\u673A\u5668\u7684\u914D\u7F6E\u4E0D\u540C\uFF0C\u6709\u65F6\u662F\u7A0B\u5E8F\u7684\u9884\u8BA1\u8D1F\u8F7D\u4E0D\u540C\u3002\u8FD9\u4E0D\u662F Java \u7279\u6709\u7684 - \u8FD9\u662F\u5E76\u53D1\u548C\u5E76\u884C\u7F16\u7A0B\u7684\u672C\u8D28\u3002</p><p>\u4F60\u53EF\u80FD\u4F1A\u8BA4\u4E3A<a href="https://en.wikipedia.org/wiki/Purely_functional" target="_blank" rel="noopener noreferrer">\u7EAF\u51FD\u6570\u5F0F</a>\u8BED\u8A00\u6CA1\u6709\u8FD9\u4E9B\u9650\u5236\u3002\u5B9E\u9645\u4E0A\uFF0C\u7EAF\u51FD\u6570\u5F0F\u8BED\u8A00\u7684\u786E\u89E3\u51B3\u4E86\u5927\u91CF\u5E76\u53D1\u95EE\u9898\u3002\u5982\u679C\u4F60\u6B63\u5728\u89E3\u51B3\u4E00\u4E2A\u56F0\u96BE\u7684\u5E76\u53D1\u95EE\u9898\uFF0C\u53EF\u4EE5\u8003\u8651\u7528\u7EAF\u51FD\u6570\u8BED\u8A00\u7F16\u5199\u8FD9\u4E2A\u90E8\u5206\u3002\u4F46\u662F\uFF0C\u5982\u679C\u4F60\u7F16\u5199\u4E00\u4E2A\u4F7F\u7528\u961F\u5217\u7684\u7CFB\u7EDF\uFF0C\u4F8B\u5982\uFF0C\u5982\u679C\u8BE5\u7CFB\u7EDF\u6CA1\u6709\u88AB\u5408\u7406\u5730\u8C03\u4F18\uFF0C\u5E76\u4E14\u8F93\u5165\u901F\u7387\u4E5F\u6CA1\u6709\u88AB\u6B63\u786E\u5730\u4F30\u8BA1\u6216\u9650\u5236\uFF08\u5728\u4E0D\u540C\u7684\u60C5\u51B5\u4E0B\uFF0C\u9650\u5236\u610F\u5473\u7740\u5177\u6709\u4E0D\u540C\u7684\u5F71\u54CD\u7684\u4E0D\u540C\u4E1C\u897F\uFF09\uFF0C\u8BE5\u961F\u5217\u8981\u4E48\u88AB\u586B\u6EE1\u5E76\u963B\u585E\uFF0C\u8981\u4E48\u6EA2\u51FA\u3002\u6700\u540E\uFF0C\u4F60\u5FC5\u987B\u4E86\u89E3\u6240\u6709\u53EF\u80FD\u4F1A\u7834\u574F\u4F60\u7684\u7CFB\u7EDF\u7684\u7EC6\u8282\u548C\u95EE\u9898\u3002\u8FD9\u662F\u4E00\u79CD\u975E\u5E38\u4E0D\u540C\u7684\u7F16\u7A0B\u65B9\u5F0F\u3002</p><h2 id="\u5E76\u53D1\u7684\u65B0\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#\u5E76\u53D1\u7684\u65B0\u5B9A\u4E49" aria-hidden="true">#</a> \u5E76\u53D1\u7684\u65B0\u5B9A\u4E49</h2><p>\u51E0\u5341\u5E74\u6765\uFF0C\u6211\u4E00\u76F4\u5728\u52AA\u529B\u89E3\u51B3\u5404\u79CD\u5F62\u5F0F\u7684\u5E76\u53D1\u95EE\u9898\uFF0C\u5176\u4E2D\u4E00\u4E2A\u6700\u5927\u7684\u6311\u6218\u662F\u7B80\u6D01\u7684\u5B9A\u4E49\u5B83\u3002\u5728\u64B0\u5199\u672C\u7AE0\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u6211\u7EC8\u4E8E\u6709\u4E86\u8FD9\u6837\u7684\u6D1E\u5BDF\u529B\uFF0C\u6211\u5C06\u5176\u5B9A\u4E49\u4E3A\uFF1A</p><blockquote><p>\u5E76\u53D1\u6027\u662F\u4E00\u7CFB\u5217\u4E13\u6CE8\u4E8E\u51CF\u5C11\u7B49\u5F85\u7684\u6027\u80FD\u6280\u672F</p></blockquote><p>\u8FD9\u5B9E\u9645\u4E0A\u662F\u4E00\u4E2A\u76F8\u5F53\u590D\u6742\u7684\u8868\u8FF0\uFF0C\u6240\u4EE5\u6211\u5C06\u5176\u5206\u89E3\uFF1A</p><ul><li>\u8FD9\u662F\u4E00\u4E2A\u96C6\u5408\uFF1A\u5305\u542B\u8BB8\u591A\u4E0D\u540C\u7684\u65B9\u6CD5\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002\u56E0\u4E3A\u6280\u672F\u5DEE\u5F02\u5F88\u5927\uFF0C\u8FD9\u662F\u4F7F\u5B9A\u4E49\u5E76\u53D1\u6027\u5982\u6B64\u5177\u6709\u6311\u6218\u6027\u7684\u95EE\u9898\u4E4B\u4E00\u3002</li><li>\u8FD9\u4E9B\u662F\u6027\u80FD\u6280\u672F\uFF1A\u5C31\u662F\u8FD9\u6837\u3002\u5E76\u53D1\u7684\u5173\u952E\u70B9\u5728\u4E8E\u8BA9\u4F60\u7684\u7A0B\u5E8F\u8FD0\u884C\u5F97\u66F4\u5FEB\u3002\u5728 Java \u4E2D\uFF0C\u5E76\u53D1\u662F\u975E\u5E38\u68D8\u624B\u548C\u56F0\u96BE\u7684\uFF0C\u6240\u4EE5\u7EDD\u5BF9\u4E0D\u8981\u4F7F\u7528\u5B83\uFF0C\u9664\u975E\u4F60\u6709\u4E00\u4E2A\u91CD\u5927\u7684\u6027\u80FD\u95EE\u9898 - \u5373\u4F7F\u8FD9\u6837\uFF0C\u4F7F\u7528\u6700\u7B80\u5355\u7684\u65B9\u6CD5\u4EA7\u751F\u4F60\u9700\u8981\u7684\u6027\u80FD\uFF0C\u56E0\u4E3A\u5E76\u53D1\u5F88\u5FEB\u53D8\u5F97\u96BE\u4EE5\u7BA1\u7406\u3002</li><li>\u201C\u51CF\u5C11\u7B49\u5F85\u201D\u90E8\u5206\u5F88\u91CD\u8981\u800C\u4E14\u5FAE\u5999\u3002\u65E0\u8BBA\uFF08\u4F8B\u5982\uFF09\u4F60\u7684\u7A0B\u5E8F\u8FD0\u884C\u5728\u591A\u5C11\u4E2A\u5904\u7406\u5668\u4E0A\uFF0C\u4F60\u53EA\u80FD\u5728\u7B49\u5F85\u53D1\u751F\u65F6\u4EA7\u751F\u6548\u76CA\u3002\u5982\u679C\u4F60\u53D1\u8D77 I/O \u8BF7\u6C42\u5E76\u7ACB\u5373\u83B7\u5F97\u7ED3\u679C\uFF0C\u6CA1\u6709\u5EF6\u8FDF\uFF0C\u56E0\u6B64\u65E0\u9700\u6539\u8FDB\u3002\u5982\u679C\u4F60\u5728\u591A\u4E2A\u5904\u7406\u5668\u4E0A\u8FD0\u884C\u591A\u4E2A\u4EFB\u52A1\uFF0C\u5E76\u4E14\u6BCF\u4E2A\u5904\u7406\u5668\u90FD\u4EE5\u6EE1\u5BB9\u91CF\u8FD0\u884C\uFF0C\u5E76\u4E14\u6CA1\u6709\u4EFB\u52A1\u9700\u8981\u7B49\u5F85\u5176\u4ED6\u4EFB\u52A1\uFF0C\u90A3\u4E48\u5C1D\u8BD5\u63D0\u9AD8\u541E\u5410\u91CF\u662F\u6CA1\u6709\u610F\u4E49\u7684\u3002\u5E76\u53D1\u7684\u552F\u4E00\u673A\u4F1A\u662F\u7A0B\u5E8F\u7684\u67D0\u4E9B\u90E8\u5206\u88AB\u8FEB\u7B49\u5F85\u3002\u7B49\u5F85\u4F1A\u4EE5\u591A\u79CD\u5F62\u5F0F\u51FA\u73B0 - \u8FD9\u89E3\u91CA\u4E86\u4E3A\u4EC0\u4E48\u5B58\u5728\u591A\u79CD\u4E0D\u540C\u7684\u5E76\u53D1\u65B9\u6CD5\u3002</li></ul><p>\u503C\u5F97\u5F3A\u8C03\u7684\u662F\uFF0C\u8FD9\u4E2A\u5B9A\u4E49\u7684\u6709\u6548\u6027\u53D6\u51B3\u4E8E\u201C\u7B49\u5F85\u201D\u8FD9\u4E2A\u8BCD\u3002\u5982\u679C\u6CA1\u6709\u4EC0\u4E48\u53EF\u4EE5\u7B49\u5F85\uFF0C\u90A3\u5C31\u6CA1\u6709\u673A\u4F1A\u53BB\u52A0\u901F\u3002\u5982\u679C\u6709\u4EC0\u4E48\u4E1C\u897F\u5728\u7B49\u5F85\uFF0C\u90A3\u4E48\u5C31\u4F1A\u6709\u5F88\u591A\u65B9\u6CD5\u53EF\u4EE5\u52A0\u5FEB\u901F\u5EA6\uFF0C\u8FD9\u53D6\u51B3\u4E8E\u591A\u79CD\u56E0\u7D20\uFF0C\u5305\u62EC\u7CFB\u7EDF\u8FD0\u884C\u7684\u914D\u7F6E\uFF0C\u4F60\u8981\u89E3\u51B3\u7684\u95EE\u9898\u7C7B\u578B\u4EE5\u53CA\u5176\u4ED6\u8BB8\u591A\u95EE\u9898\u3002</p><h2 id="\u5E76\u53D1\u7684\u8D85\u80FD\u529B" tabindex="-1"><a class="header-anchor" href="#\u5E76\u53D1\u7684\u8D85\u80FD\u529B" aria-hidden="true">#</a> \u5E76\u53D1\u7684\u8D85\u80FD\u529B</h2><p>\u60F3\u8C61\u4E00\u4E0B\uFF0C\u4F60\u7F6E\u8EAB\u4E8E\u4E00\u90E8\u79D1\u5E7B\u7535\u5F71\u3002\u4F60\u5FC5\u987B\u5728\u4E00\u680B\u5927\u697C\u4E2D\u627E\u5230\u4E00\u4E2A\u4E1C\u897F\uFF0C\u5B83\u88AB\u5C0F\u5FC3\u800C\u5DE7\u5999\u5730\u9690\u85CF\u5728\u5927\u697C\u5343\u4E07\u4E2A\u623F\u95F4\u4E2D\u7684\u4E00\u95F4\u3002\u4F60\u8FDB\u5165\u5927\u697C\uFF0C\u6CBF\u7740\u8D70\u5ECA\u8D70\u4E0B\u53BB\u3002\u8D70\u5ECA\u662F\u5206\u5F00\u7684\u3002</p><p>\u4E00\u4E2A\u4EBA\u5B8C\u6210\u8FD9\u9879\u4EFB\u52A1\u8981\u82B1\u4E0A\u4E00\u767E\u8F88\u5B50\u7684\u65F6\u95F4\u3002</p><p>\u73B0\u5728\u5047\u8BBE\u4F60\u6709\u4E00\u4E2A\u5947\u602A\u7684\u8D85\u80FD\u529B\u3002\u4F60\u53EF\u4EE5\u5C06\u81EA\u5DF1\u4E00\u5206\u4E3A\u4E8C\uFF0C\u7136\u540E\u5728\u7EE7\u7EED\u524D\u8FDB\u7684\u540C\u65F6\u5C06\u53E6\u4E00\u534A\u9001\u5230\u53E6\u4E00\u4E2A\u8D70\u5ECA\u3002\u6BCF\u5F53\u4F60\u5728\u8D70\u5ECA\u6216\u697C\u68AF\u4E0A\u9047\u5230\u5206\u9694\u5230\u4E0B\u4E00\u5C42\u65F6\uFF0C\u4F60\u90FD\u4F1A\u91CD\u590D\u8FD9\u4E2A\u5206\u88C2\u7684\u6280\u5DE7\u3002\u6700\u7EC8\uFF0C\u6574\u4E2A\u5EFA\u7B51\u4E2D\u7684\u6BCF\u4E2A\u8D70\u5ECA\u7684\u7EC8\u70B9\u90FD\u6709\u4E00\u4E2A\u4F60\u3002</p><p>\u6BCF\u4E2A\u8D70\u5ECA\u90FD\u6709\u4E00\u5343\u4E2A\u623F\u95F4\u3002\u6B64\u65F6\u4F60\u7684\u8D85\u80FD\u529B\u53D8\u5F97\u5F31\u4E86\u4E00\u70B9\uFF0C\u4F60\u53EA\u80FD\u514B\u9686 50 \u4E2A\u81EA\u5DF1\u6765\u5E76\u53D1\u641C\u7D22\u8D70\u5ECA\u91CC\u9762\u7684\u623F\u95F4\u3002</p><p>\u4E00\u65E6\u514B\u9686\u4F53\u8FDB\u5165\u623F\u95F4\uFF0C\u5B83\u5FC5\u987B\u641C\u7D22\u623F\u95F4\u7684\u6BCF\u4E2A\u89D2\u843D\u3002\u8FD9\u65F6\u5B83\u5207\u6362\u5230\u4E86\u7B2C\u4E8C\u79CD\u8D85\u80FD\u529B\u3002\u5B83\u5206\u88C2\u6210\u4E86\u4E00\u767E\u4E07\u4E2A\u7EB3\u7C73\u673A\u5668\u4EBA\uFF0C\u6BCF\u4E2A\u673A\u5668\u4EBA\u90FD\u4F1A\u98DE\u5230\u6216\u722C\u5230\u623F\u95F4\u91CC\u4E00\u4E9B\u770B\u4E0D\u89C1\u7684\u5730\u65B9\u3002\u4F60\u4E0D\u9700\u8981\u4E86\u89E3\u8FD9\u79CD\u529F\u80FD - \u4E00\u65E6\u4F60\u5F00\u542F\u5B83\u5C31\u4F1A\u81EA\u52A8\u5DE5\u4F5C\u3002\u5728\u4ED6\u4EEC\u81EA\u5DF1\u7684\u63A7\u5236\u4E0B\uFF0C\u7EB3\u7C73\u673A\u5668\u4EBA\u5F00\u59CB\u884C\u52A8\uFF0C\u641C\u7D22\u623F\u95F4\u7136\u540E\u56DE\u6765\u91CD\u65B0\u7EC4\u88C5\u6210\u4F60\uFF0C\u7A81\u7136\u95F4\uFF0C\u4E0D\u77E5\u600E\u4E48\u7684\uFF0C\u4F60\u5C31\u77E5\u9053\u8FD9\u95F4\u623F\u95F4\u91CC\u6709\u6CA1\u6709\u90A3\u4E2A\u4E1C\u897F\u3002</p><p>\u6211\u5F88\u60F3\u8BF4\uFF0C\u201C\u5E76\u53D1\u5C31\u662F\u521A\u624D\u63CF\u8FF0\u7684\u7F6E\u8EAB\u4E8E\u79D1\u5E7B\u7535\u5F71\u4E2D\u7684\u8D85\u80FD\u529B\u201C\u3002\u5C31\u50CF\u4F60\u81EA\u5DF1\u53EF\u4EE5\u4E00\u5206\u4E3A\u4E8C\u7136\u540E\u89E3\u51B3\u66F4\u591A\u7684\u95EE\u9898\u4E00\u6837\u7B80\u5355\u3002\u4F46\u662F\u95EE\u9898\u5728\u4E8E\uFF0C\u6211\u4EEC\u6765\u63CF\u8FF0\u8FD9\u79CD\u73B0\u8C61\u7684\u4EFB\u4F55\u6A21\u578B\u6700\u7EC8\u90FD\u662F\u62BD\u8C61\u6CC4\u9732\u7684\uFF08leaky abstraction)\u3002</p><p>\u4EE5\u4E0B\u662F\u5176\u4E2D\u4E00\u4E2A\u6CC4\u9732\uFF1A\u5728\u7406\u60F3\u7684\u4E16\u754C\u4E2D\uFF0C\u6BCF\u6B21\u514B\u9686\u81EA\u5DF1\u65F6\uFF0C\u4E5F\u4F1A\u590D\u5236\u4E00\u4E2A\u7269\u7406\u5904\u7406\u5668\u6765\u8FD0\u884C\u514B\u9686\u641C\u7D22\u8005\u3002\u8FD9\u5F53\u7136\u662F\u4E0D\u73B0\u5B9E\u7684\u2014\u2014\u5B9E\u9645\u4E0A\uFF0C\u4F60\u7684\u673A\u5668\u4E0A\u4E00\u822C\u53EA\u6709 4 \u4E2A\u6216 8 \u4E2A\u5904\u7406\u5668\u6838\u5FC3\uFF08\u7F16\u5199\u672C\u6587\u65F6\u7684\u5178\u578B\u60C5\u51B5\uFF09\u3002\u6216\u8BB8\u4F60\u62E5\u6709\u66F4\u591A\u7684\u5904\u7406\u5668\uFF0C\u4F46\u4ECD\u6709\u5F88\u591A\u60C5\u51B5\u4E0B\u53EA\u6709\u4E00\u4E2A\u5355\u6838\u5904\u7406\u5668\u3002\u5728\u5173\u4E8E\u62BD\u8C61\u7684\u8BA8\u8BBA\u4E2D\uFF0C\u5206\u914D\u7269\u7406\u5904\u7406\u5668\u6838\u5FC3\u8FD9\u672C\u8EAB\u5C31\u662F\u62BD\u8C61\u7684\u6CC4\u9732\uFF0C\u751A\u81F3\u4E5F\u53EF\u4EE5\u652F\u914D\u4F60\u7684\u51B3\u7B56\u3002</p><p>\u8BA9\u6211\u4EEC\u5728\u79D1\u5E7B\u7535\u5F71\u4E2D\u6539\u53D8\u4E00\u4E9B\u4E1C\u897F\u3002\u73B0\u5728\u5F53\u6BCF\u4E2A\u514B\u9686\u641C\u7D22\u8005\u6700\u7EC8\u5230\u8FBE\u4E00\u6247\u95E8\u65F6\uFF0C\u4ED6\u4EEC\u5FC5\u987B\u6572\u95E8\u5E76\u7B49\u5230\u6709\u4EBA\u5F00\u95E8\u3002\u5982\u679C\u6BCF\u4E2A\u641C\u7D22\u8005\u90FD\u6709\u4E00\u4E2A\u5904\u7406\u5668\u6838\u5FC3\uFF0C\u8FD9\u6CA1\u6709\u95EE\u9898\u2014\u2014\u53EA\u662F\u7A7A\u95F2\u7B49\u5F85\u76F4\u5230\u6709\u4EBA\u5F00\u95E8\u3002\u4F46\u662F\u5982\u679C\u6211\u4EEC\u53EA\u6709 8 \u4E2A\u5904\u7406\u5668\u6838\u5FC3\u5374\u6709\u51E0\u5343\u4E2A\u641C\u7D22\u8005\uFF0C\u6211\u4EEC\u4E0D\u5E0C\u671B\u5904\u7406\u5668\u4EC5\u4EC5\u56E0\u4E3A\u67D0\u4E2A\u641C\u7D22\u8005\u6070\u597D\u5728\u7B49\u5F85\u56DE\u7B54\u4E2D\u88AB\u9501\u4F4F\u800C\u95F2\u7F6E\u4E0B\u6765\u3002\u76F8\u53CD\uFF0C\u6211\u4EEC\u5E0C\u671B\u5C06\u5904\u7406\u5668\u5E94\u7528\u4E8E\u53EF\u4EE5\u771F\u6B63\u6267\u884C\u5DE5\u4F5C\u7684\u641C\u7D22\u8005\u8EAB\u4E0A\uFF0C\u56E0\u6B64\u9700\u8981\u5C06\u5904\u7406\u5668\u4ECE\u4E00\u4E2A\u4EFB\u52A1\u5207\u6362\u5230\u53E6\u4E00\u4E2A\u4EFB\u52A1\u7684\u673A\u5236\u3002</p><p>\u8BB8\u591A\u6A21\u578B\u80FD\u591F\u6709\u6548\u5730\u9690\u85CF\u5904\u7406\u5668\u7684\u6570\u91CF\uFF0C\u5141\u8BB8\u4F60\u5047\u88C5\u6709\u5F88\u591A\u4E2A\u5904\u7406\u5668\u3002\u4F46\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u5F53\u4F60\u5FC5\u987B\u660E\u786E\u77E5\u9053\u5904\u7406\u5668\u6570\u91CF\u4EE5\u4FBF\u4E8E\u5DE5\u4F5C\u7684\u65F6\u5019\uFF0C\u8FD9\u4E9B\u6A21\u578B\u5C31\u4F1A\u5931\u6548\u3002</p><p>\u6700\u5927\u7684\u5F71\u54CD\u4E4B\u4E00\u53D6\u51B3\u4E8E\u662F\u4F7F\u7528\u5355\u6838\u5904\u7406\u5668\u8FD8\u662F\u591A\u6838\u5904\u7406\u5668\u3002\u5982\u679C\u4F60\u53EA\u6709\u5355\u6838\u5904\u7406\u5668\uFF0C\u90A3\u4E48\u4EFB\u52A1\u5207\u6362\u7684\u6210\u672C\u4E5F\u7531\u8BE5\u6838\u5FC3\u627F\u62C5\uFF0C\u5C06\u5E76\u53D1\u6280\u672F\u5E94\u7528\u4E8E\u4F60\u7684\u7CFB\u7EDF\u4F1A\u4F7F\u5B83\u8FD0\u884C\u5F97\u66F4\u6162\u3002</p><p>\u8FD9\u53EF\u80FD\u4F1A\u8BA9\u4F60\u4EE5\u4E3A\uFF0C\u5728\u5355\u6838\u5904\u7406\u5668\u7684\u60C5\u51B5\u4E0B\uFF0C\u7F16\u5199\u5E76\u53D1\u4EE3\u7801\u662F\u6CA1\u6709\u610F\u4E49\u7684\u3002\u7136\u800C\uFF0C\u6709\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u5E76\u53D1\u6A21\u578B\u4F1A\u4EA7\u751F\u66F4\u7B80\u5355\u7684\u4EE3\u7801\uFF0C\u5149\u662F\u4E3A\u4E86\u8FD9\u4E2A\u76EE\u7684\u5C31\u503C\u5F97\u820D\u5F03\u4E00\u4E9B\u6027\u80FD\u3002</p><p>\u5728\u514B\u9686\u4F53\u6572\u95E8\u7B49\u5F85\u7684\u60C5\u51B5\u4E0B\uFF0C\u5373\u4F7F\u5355\u6838\u5904\u7406\u5668\u7CFB\u7EDF\u4E5F\u80FD\u4ECE\u5E76\u53D1\u4E2D\u53D7\u76CA\uFF0C\u56E0\u4E3A\u5B83\u53EF\u4EE5\u4ECE\u7B49\u5F85\uFF08\u963B\u585E\uFF09\u7684\u4EFB\u52A1\u5207\u6362\u5230\u51C6\u5907\u8FD0\u884C\u7684\u4EFB\u52A1\u3002\u4F46\u662F\u5982\u679C\u6240\u6709\u4EFB\u52A1\u90FD\u53EF\u4EE5\u4E00\u76F4\u8FD0\u884C\u90A3\u4E48\u5207\u6362\u7684\u6210\u672C\u53CD\u800C\u4F1A\u4F7F\u4EFB\u52A1\u53D8\u6162\uFF0C\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u5E76\u53D1\u53EA\u5728\u5982\u679C\u4F60\u6709\u591A\u4E2A\u5904\u7406\u5668\u7684\u60C5\u51B5\u4E0B\u6709\u610F\u4E49\u3002</p><p>\u5047\u8BBE\u4F60\u6B63\u5728\u5C1D\u8BD5\u7834\u89E3\u67D0\u79CD\u5BC6\u7801\uFF0C\u5728\u540C\u4E00\u65F6\u95F4\u5185\u53C2\u4E0E\u7834\u89E3\u7684\u7EBF\u7A0B\u8D8A\u591A\uFF0C\u4F60\u8D8A\u5FEB\u5F97\u5230\u7B54\u6848\u7684\u53EF\u80FD\u6027\u5C31\u8D8A\u5927\u3002\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u80FD\u6301\u7EED\u4F7F\u7528\u4F60\u6240\u5206\u914D\u7684\u5904\u7406\u5668\u65F6\u95F4\uFF0C\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF08CPU \u5BC6\u96C6\u578B\u95EE\u9898\uFF09\uFF0C\u4F60\u4EE3\u7801\u4E2D\u7684\u7EBF\u7A0B\u6570\u5E94\u8BE5\u548C\u4F60\u62E5\u6709\u7684\u5904\u7406\u5668\u7684\u6838\u5FC3\u6570\u4FDD\u6301\u4E00\u81F4\u3002</p><p>\u5728\u63A5\u542C\u7535\u8BDD\u7684\u5BA2\u6237\u670D\u52A1\u90E8\u95E8\uFF0C\u4F60\u53EA\u6709\u4E00\u5B9A\u6570\u91CF\u7684\u5458\u5DE5\uFF0C\u4F46\u662F\u4F60\u7684\u90E8\u95E8\u53EF\u80FD\u4F1A\u6536\u5230\u5F88\u591A\u7535\u8BDD\u3002\u8FD9\u4E9B\u5458\u5DE5\uFF08\u5904\u7406\u5668\uFF09\u4E00\u6B21\u53EA\u80FD\u63A5\u542C\u4E00\u4E2A\u7535\u8BDD\u76F4\u5230\u6253\u5B8C\uFF0C\u6B64\u65F6\u5176\u5B83\u6253\u6765\u7684\u7535\u8BDD\u5FC5\u987B\u6392\u961F\u7B49\u5F85\u3002</p><p>\u5728\u201C\u978B\u5320\u548C\u7CBE\u7075\u201D\u7684\u7AE5\u8BDD\u6545\u4E8B\u4E2D\uFF0C\u978B\u5320\u6709\u5F88\u591A\u5DE5\u4F5C\u8981\u505A\uFF0C\u5F53\u4ED6\u7761\u7740\u65F6\uFF0C\u51FA\u73B0\u4E86\u4E00\u7FA4\u7CBE\u7075\u6765\u4E3A\u4ED6\u5236\u4F5C\u978B\u5B50\u3002\u8FD9\u91CC\u7684\u5DE5\u4F5C\u662F\u5206\u5E03\u5F0F\u7684\uFF0C\u4F46\u5373\u4F7F\u4F7F\u7528\u5927\u91CF\u7684\u7269\u7406\u5904\u7406\u5668\uFF0C\u5728\u5236\u9020\u978B\u5B50\u7684\u67D0\u4E9B\u90E8\u4EF6\u65F6\u4E5F\u4F1A\u4EA7\u751F\u9650\u5236\u2014\u2014\u4F8B\u5982\uFF0C\u5982\u679C\u978B\u5E95\u7684\u5236\u4F5C\u65F6\u95F4\u6700\u957F\uFF0C\u8FD9\u5C31\u9650\u5236\u4E86\u978B\u5B50\u7684\u5236\u4F5C\u901F\u5EA6\uFF0C\u8FD9\u4E5F\u4F1A\u6539\u53D8\u4F60\u8BBE\u8BA1\u89E3\u51B3\u65B9\u6848\u7684\u65B9\u5F0F\u3002</p><p>\u56E0\u6B64\uFF0C\u4F60\u8981\u89E3\u51B3\u7684\u95EE\u9898\u9A71\u52A8\u4E86\u65B9\u6848\u7684\u8BBE\u8BA1\u3002\u5C06\u4E00\u4E2A\u95EE\u9898\u5206\u89E3\u6210\u201C\u72EC\u7ACB\u8FD0\u884C\u201D\u7684\u5B50\u4EFB\u52A1\uFF0C\u8FD9\u662F\u4E00\u79CD\u7F8E\u597D\u7684\u62BD\u8C61\uFF0C\u7136\u540E\u5C31\u662F\u5B9E\u9645\u53D1\u751F\u7684\u73B0\u5B9E\uFF1A\u7269\u7406\u73B0\u5B9E\u4E0D\u65AD\u5E72\u6270\u548C\u52A8\u6447\u8FD9\u4E2A\u62BD\u8C61\u3002</p><p>\u8FD9\u53EA\u662F\u95EE\u9898\u7684\u4E00\u90E8\u5206\uFF1A\u8003\u8651\u4E00\u4E2A\u5236\u4F5C\u86CB\u7CD5\u7684\u5DE5\u5382\u3002\u6211\u4EEC\u4EE5\u67D0\u79CD\u65B9\u5F0F\u628A\u5236\u4F5C\u86CB\u7CD5\u7684\u4EFB\u52A1\u5206\u7ED9\u4E86\u5DE5\u4EBA\u4EEC\uFF0C\u73B0\u5728\u662F\u65F6\u5019\u8BA9\u5DE5\u4EBA\u628A\u86CB\u7CD5\u653E\u5728\u76D2\u5B50\u91CC\u4E86\u3002\u90A3\u91CC\u6709\u4E00\u4E2A\u51C6\u5907\u5B58\u653E\u86CB\u7CD5\u7684\u76D2\u5B50\u3002\u4F46\u662F\u5728\u4E00\u4E2A\u5DE5\u4EBA\u628A\u86CB\u7CD5\u653E\u8FDB\u76D2\u5B50\u4E4B\u524D\uFF0C\u53E6\u4E00\u4E2A\u5DE5\u4EBA\u5C31\u51B2\u8FC7\u53BB\uFF0C\u628A\u86CB\u7CD5\u653E\u8FDB\u76D2\u5B50\u91CC\uFF0C\u7830\uFF01\u8FD9\u4E24\u4E2A\u86CB\u7CD5\u649E\u5230\u4E00\u8D77\u7838\u574F\u4E86\u3002\u8FD9\u662F\u5E38\u89C1\u7684\u201C\u5171\u4EAB\u5185\u5B58\u201D\u95EE\u9898\uFF0C\u4F1A\u4EA7\u751F\u6240\u8C13\u7684\u7ADE\u6001\u6761\u4EF6\uFF08race condition\uFF09\uFF0C\u5176\u7ED3\u679C\u53D6\u51B3\u4E8E\u54EA\u4E2A\u5DE5\u4EBA\u80FD\u5148\u628A\u86CB\u7CD5\u653E\u8FDB\u76D2\u5B50\u91CC\uFF08\u901A\u5E38\u4F7F\u7528\u9501\u673A\u5236\u6765\u89E3\u51B3\u95EE\u9898\uFF0C\u56E0\u6B64\u4E00\u4E2A\u5DE5\u4F5C\u4EBA\u5458\u53EF\u4EE5\u5148\u6293\u4F4F\u4E00\u4E2A\u76D2\u5B50\u5E76\u9632\u6B62\u86CB\u7CD5\u88AB\u7838\u70C2\uFF09\u3002</p><p>\u5F53\u201C\u540C\u65F6\u201D\u6267\u884C\u7684\u4EFB\u52A1\u76F8\u4E92\u5E72\u6270\u65F6\uFF0C\u5C31\u4F1A\u51FA\u73B0\u95EE\u9898\u3002\u8FD9\u53EF\u80FD\u4EE5\u4E00\u79CD\u5FAE\u5999\u800C\u5076\u7136\u7684\u65B9\u5F0F\u53D1\u751F\uFF0C\u56E0\u6B64\u53EF\u4EE5\u8BF4\u5E76\u53D1\u662F\u201C\u53EF\u4EE5\u8BBA\u8BC1\u7684\u786E\u5B9A\u6027\uFF0C\u4F46\u5B9E\u9645\u4E0A\u662F\u4E0D\u786E\u5B9A\u6027\u7684\u201D\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5047\u8BBE\u4F60\u5F88\u5C0F\u5FC3\u5730\u7F16\u5199\u5E76\u53D1\u7A0B\u5E8F\uFF0C\u800C\u4E14\u901A\u8FC7\u4E86\u4EE3\u7801\u68C0\u67E5\u53EF\u4EE5\u6B63\u786E\u8FD0\u884C\u3002\u7136\u800C\u5B9E\u9645\u4E0A\uFF0C\u6211\u4EEC\u7F16\u5199\u7684\u5E76\u53D1\u7A0B\u5E8F\u5927\u90E8\u5206\u60C5\u51B5\u4E0B\u90FD\u80FD\u6B63\u5E38\u8FD0\u884C\uFF0C\u4F46\u662F\u5728\u4E00\u4E9B\u7279\u5B9A\u60C5\u51B5\u4E0B\u4F1A\u5931\u8D25\u3002\u8FD9\u4E9B\u60C5\u51B5\u53EF\u80FD\u6C38\u8FDC\u4E0D\u4F1A\u53D1\u751F\uFF0C\u6216\u8005\u5728\u4F60\u5728\u6D4B\u8BD5\u671F\u95F4\u51E0\u4E4E\u5F88\u96BE\u53D1\u73B0\u5B83\u4EEC\u3002\u5B9E\u9645\u4E0A\uFF0C\u7F16\u5199\u6D4B\u8BD5\u4EE3\u7801\u901A\u5E38\u65E0\u6CD5\u4E3A\u5E76\u53D1\u7A0B\u5E8F\u751F\u6210\u6545\u969C\u6761\u4EF6\u3002\u7531\u6B64\u4EA7\u751F\u7684\u5931\u8D25\u53EA\u4F1A\u5076\u5C14\u53D1\u751F\uFF0C\u56E0\u6B64\u5B83\u4EEC\u4EE5\u5BA2\u6237\u6295\u8BC9\u7684\u5F62\u5F0F\u51FA\u73B0\u3002\u8FD9\u662F\u5B66\u4E60\u5E76\u53D1\u4E2D\u6700\u5F3A\u6709\u529B\u7684\u8BBA\u70B9\u4E4B\u4E00\uFF1A\u5982\u679C\u4F60\u5FFD\u7565\u5B83\uFF0C\u4F60\u53EF\u80FD\u4F1A\u53D7\u4F24\u3002</p><p>\u56E0\u6B64\uFF0C\u5E76\u53D1\u4F3C\u4E4E\u5145\u6EE1\u4E86\u5371\u9669\uFF0C\u5982\u679C\u8FD9\u8BA9\u4F60\u6709\u70B9\u5BB3\u6015\uFF0C\u8FD9\u53EF\u80FD\u662F\u4E00\u4EF6\u597D\u4E8B\u3002\u5C3D\u7BA1 Java 8 \u5728\u5E76\u53D1\u6027\u65B9\u9762\u505A\u51FA\u4E86\u5F88\u5927\u6539\u8FDB\uFF0C\u4F46\u4ECD\u7136\u6CA1\u6709\u50CF\u7F16\u8BD1\u65F6\u9A8C\u8BC1 (compile-time verification) \u6216\u53D7\u68C0\u67E5\u7684\u5F02\u5E38 (checked exceptions) \u90A3\u6837\u7684\u5B89\u5168\u7F51\u6765\u544A\u8BC9\u4F60\u4F55\u65F6\u51FA\u73B0\u9519\u8BEF\u3002\u5173\u4E8E\u5E76\u53D1\uFF0C\u4F60\u53EA\u80FD\u4F9D\u9760\u81EA\u5DF1\uFF0C\u53EA\u6709\u77E5\u8BC6\u6E0A\u535A\u3001\u4FDD\u6301\u6000\u7591\u548C\u79EF\u6781\u8FDB\u53D6\u7684\u4EBA\uFF0C\u624D\u80FD\u7528 Java \u7F16\u5199\u53EF\u9760\u7684\u5E76\u53D1\u4EE3\u7801\u3002</p><h2 id="\u5E76\u53D1\u4E3A\u901F\u5EA6\u800C\u751F" tabindex="-1"><a class="header-anchor" href="#\u5E76\u53D1\u4E3A\u901F\u5EA6\u800C\u751F" aria-hidden="true">#</a> \u5E76\u53D1\u4E3A\u901F\u5EA6\u800C\u751F</h2><p>\u5728\u542C\u8BF4\u5E76\u53D1\u7F16\u7A0B\u7684\u95EE\u9898\u4E4B\u540E\uFF0C\u4F60\u53EF\u80FD\u4F1A\u60F3\u77E5\u9053\u5B83\u662F\u5426\u503C\u5F97\u8FD9\u4E48\u9EBB\u70E6\u3002\u7B54\u6848\u662F\u201C\u4E0D\uFF0C\u9664\u975E\u4F60\u7684\u7A0B\u5E8F\u8FD0\u884C\u901F\u5EA6\u4E0D\u591F\u5FEB\u3002\u201D\u5E76\u4E14\u5728\u51B3\u5B9A\u7528\u5B83\u4E4B\u524D\u4F60\u4F1A\u60F3\u8981\u4ED4\u7EC6\u601D\u8003\u3002\u4E0D\u8981\u968F\u4FBF\u8DF3\u8FDB\u5E76\u53D1\u7F16\u7A0B\u7684\u60B2\u75DB\u4E4B\u4E2D\u3002\u5982\u679C\u6709\u4E00\u79CD\u65B9\u6CD5\u53EF\u4EE5\u5728\u66F4\u5FEB\u7684\u673A\u5668\u4E0A\u8FD0\u884C\u4F60\u7684\u7A0B\u5E8F\uFF0C\u6216\u8005\u5982\u679C\u4F60\u53EF\u4EE5\u5BF9\u5176\u8FDB\u884C\u5206\u6790\u5E76\u53D1\u73B0\u74F6\u9888\u5E76\u5728\u8BE5\u4F4D\u7F6E\u66FF\u6362\u66F4\u5FEB\u7684\u7B97\u6CD5\uFF0C\u90A3\u4E48\u8BF7\u6267\u884C\u6B64\u64CD\u4F5C\u3002\u53EA\u6709\u5728\u663E\u7136\u6CA1\u6709\u5176\u4ED6\u9009\u62E9\u65F6\u624D\u5F00\u59CB\u4F7F\u7528\u5E76\u53D1\uFF0C\u7136\u540E\u4EC5\u5728\u5FC5\u8981\u7684\u5730\u65B9\u53BB\u4F7F\u7528\u5B83\u3002</p><p>\u901F\u5EA6\u95EE\u9898\u4E00\u5F00\u59CB\u542C\u8D77\u6765\u5F88\u7B80\u5355\uFF1A\u5982\u679C\u4F60\u60F3\u8981\u4E00\u4E2A\u7A0B\u5E8F\u8FD0\u884C\u5F97\u66F4\u5FEB\uFF0C\u5C06\u5176\u5206\u89E3\u4E3A\u591A\u4E2A\u90E8\u5206\uFF0C\u5E76\u5728\u5355\u72EC\u7684\u5904\u7406\u5668\u4E0A\u8FD0\u884C\u6BCF\u4E2A\u90E8\u5206\u3002\u968F\u7740\u6211\u4EEC\u63D0\u9AD8\u65F6\u949F\u901F\u5EA6\u7684\u80FD\u529B\u8017\u5C3D\uFF08\u81F3\u5C11\u5BF9\u4F20\u7EDF\u82AF\u7247\u800C\u8A00\uFF09\uFF0C\u901F\u5EA6\u7684\u63D0\u9AD8\u662F\u51FA\u73B0\u5728\u591A\u6838\u5904\u7406\u5668\u7684\u5F62\u5F0F\u800C\u4E0D\u662F\u66F4\u5FEB\u7684\u82AF\u7247\u3002\u4E3A\u4E86\u4F7F\u7A0B\u5E8F\u8FD0\u884C\u5F97\u66F4\u5FEB\uFF0C\u4F60\u5FC5\u987B\u5B66\u4F1A\u5229\u7528\u90A3\u4E9B\u989D\u5916\u7684\u5904\u7406\u5668\uFF08\u8BD1\u8005\u6CE8\uFF1A\u5904\u7406\u5668\u4E00\u822C\u4EE3\u8868 CPU \u7684\u4E00\u4E2A\u903B\u8F91\u6838\u5FC3\uFF09\uFF0C\u8FD9\u662F\u5E76\u53D1\u6240\u5E26\u6765\u7684\u597D\u5904\u4E4B\u4E00\u3002</p><p>\u5BF9\u4E8E\u591A\u5904\u7406\u5668\u673A\u5668\uFF0C\u53EF\u4EE5\u5728\u8FD9\u4E9B\u5904\u7406\u5668\u4E4B\u95F4\u5206\u914D\u591A\u4E2A\u4EFB\u52A1\uFF0C\u8FD9\u53EF\u4EE5\u663E\u8457\u63D0\u9AD8\u541E\u5410\u91CF\u3002\u5F3A\u5927\u7684\u591A\u5904\u7406\u5668 Web \u670D\u52A1\u5668\u901A\u5E38\u5C31\u662F\u8FD9\u79CD\u60C5\u51B5\uFF0C\u5B83\u53EF\u4EE5\u5728\u7A0B\u5E8F\u4E2D\u4E3A CPU \u5206\u914D\u5927\u91CF\u7528\u6237\u8BF7\u6C42\uFF0C\u6BCF\u4E2A\u8BF7\u6C42\u5206\u914D\u4E00\u4E2A\u7EBF\u7A0B\u3002</p><p>\u4F46\u662F\uFF0C\u5E76\u53D1\u901A\u5E38\u53EF\u4EE5\u63D0\u9AD8\u5728\u5355\u5904\u7406\u5668\u4E0A\u8FD0\u884C\u7684\u7A0B\u5E8F\u7684\u6027\u80FD\u3002\u8FD9\u542C\u8D77\u6765\u6709\u70B9\u8FDD\u53CD\u76F4\u89C9\u3002\u5982\u679C\u4F60\u4ED4\u7EC6\u60F3\u60F3\uFF0C\u7531\u4E8E\u4E0A\u4E0B\u6587\u5207\u6362\u7684\u6210\u672C\u589E\u52A0\uFF08\u4ECE\u4E00\u4E2A\u4EFB\u52A1\u5207\u6362\u5230\u53E6\u4E00\u4E2A\u4EFB\u52A1\uFF09\uFF0C\u5728\u5355\u4E2A\u5904\u7406\u5668\u4E0A\u8FD0\u884C\u7684\u5E76\u53D1\u7A0B\u5E8F\u5B9E\u9645\u4E0A\u5E94\u8BE5\u6BD4\u7A0B\u5E8F\u7684\u6240\u6709\u90E8\u5206\u987A\u5E8F\u8FD0\u884C\u5177\u6709\u66F4\u591A\u7684\u5F00\u9500\u3002\u4ECE\u8868\u9762\u4E0A\u770B\uFF0C\u5C06\u7A0B\u5E8F\u7684\u6240\u6709\u90E8\u5206\u4F5C\u4E3A\u5355\u4E2A\u4EFB\u52A1\u8FD0\u884C\uFF0C\u5E76\u4E14\u8282\u7701\u4E0A\u4E0B\u6587\u5207\u6362\u7684\u6210\u672C\uFF0C\u8FD9\u6837\u770B\u4F3C\u4E4E\u66F4\u5212\u7B97\u3002</p><p>\u4F7F\u8FD9\u4E2A\u95EE\u9898\u53D8\u5F97\u6709\u4E9B\u4E0D\u540C\u7684\u662F\u963B\u585E\u3002\u5982\u679C\u7A0B\u5E8F\u4E2D\u7684\u67D0\u4E2A\u4EFB\u52A1\u7531\u4E8E\u7A0B\u5E8F\u63A7\u5236\u4E4B\u5916\u7684\u67D0\u79CD\u60C5\u51B5\u800C\u65E0\u6CD5\u7EE7\u7EED\uFF08\u901A\u5E38\u662F I/O\uFF09\uFF0C\u6211\u4EEC\u5C31\u79F0\u8BE5\u4EFB\u52A1\u6216\u7EBF\u7A0B\u5DF2\u963B\u585E\uFF08\u5728\u6211\u4EEC\u7684\u79D1\u5E7B\u6545\u4E8B\u4E2D\uFF0C\u5C31\u662F\u514B\u9686\u4EBA\u5DF2\u7ECF\u6572\u95E8\u5E76\u7B49\u5F85\u5B83\u6253\u5F00\uFF09\u3002\u5982\u679C\u6CA1\u6709\u5E76\u53D1\uFF0C\u6574\u4E2A\u7A0B\u5E8F\u5C31\u4F1A\u505C\u4E0B\u6765\uFF0C\u76F4\u5230\u5916\u90E8\u6761\u4EF6\u53D1\u751F\u53D8\u5316\u3002\u4F46\u662F\uFF0C\u5982\u679C\u4F7F\u7528\u5E76\u53D1\u7F16\u5199\u7A0B\u5E8F\uFF0C\u5219\u5F53\u4E00\u4E2A\u4EFB\u52A1\u88AB\u963B\u585E\u65F6\uFF0C\u7A0B\u5E8F\u4E2D\u7684\u5176\u4ED6\u4EFB\u52A1\u53EF\u4EE5\u7EE7\u7EED\u6267\u884C\uFF0C\u56E0\u6B64\u6574\u4E2A\u7A0B\u5E8F\u5F97\u4EE5\u7EE7\u7EED\u8FD0\u884C\u3002\u4E8B\u5B9E\u4E0A\uFF0C\u4ECE\u6027\u80FD\u7684\u89D2\u5EA6\u6765\u770B\uFF0C\u5982\u679C\u6CA1\u6709\u4EFB\u52A1\u4F1A\u963B\u585E\uFF0C\u90A3\u4E48\u5728\u5355\u5904\u7406\u5668\u673A\u5668\u4E0A\u4F7F\u7528\u5E76\u53D1\u662F\u6CA1\u6709\u610F\u4E49\u7684\u3002</p><p>\u5355\u5904\u7406\u5668\u7CFB\u7EDF\u4E2D\u6027\u80FD\u6539\u8FDB\u7684\u4E00\u4E2A\u5E38\u89C1\u4F8B\u5B50\u662F\u4E8B\u4EF6\u9A71\u52A8\u7F16\u7A0B\uFF0C\u7279\u522B\u662F\u7528\u6237\u754C\u9762\u7F16\u7A0B\u3002\u8003\u8651\u4E00\u4E2A\u7A0B\u5E8F\u6267\u884C\u4E00\u4E9B\u8017\u65F6\u64CD\u4F5C\uFF0C\u6700\u7EC8\u5FFD\u7565\u7528\u6237\u8F93\u5165\u5BFC\u81F4\u65E0\u54CD\u5E94\u3002\u5982\u679C\u4F60\u6709\u4E00\u4E2A\u201C\u9000\u51FA\u201D\u6309\u94AE\uFF0C\u4F60\u4E0D\u60F3\u5728\u4F60\u7F16\u5199\u7684\u6BCF\u6BB5\u4EE3\u7801\u4E2D\u90FD\u68C0\u67E5\u5B83\u7684\u72B6\u6001\uFF08\u8F6E\u8BE2\uFF09\u3002\u8FD9\u4F1A\u4EA7\u751F\u7B28\u62D9\u7684\u4EE3\u7801\uFF0C\u4E5F\u65E0\u6CD5\u4FDD\u8BC1\u7A0B\u5E8F\u5458\u4E0D\u4F1A\u5FD8\u4E86\u68C0\u67E5\u3002\u6CA1\u6709\u5E76\u53D1\uFF0C\u751F\u6210\u53EF\u54CD\u5E94\u7528\u6237\u754C\u9762\u7684\u552F\u4E00\u65B9\u6CD5\u662F\u8BA9\u6240\u6709\u4EFB\u52A1\u90FD\u5B9A\u671F\u68C0\u67E5\u7528\u6237\u8F93\u5165\u3002\u901A\u8FC7\u521B\u5EFA\u5355\u72EC\u7684\u7EBF\u7A0B\u4EE5\u6267\u884C\u7528\u6237\u8F93\u5165\u7684\u54CD\u5E94\uFF0C\u80FD\u591F\u8BA9\u7A0B\u5E8F\u4FDD\u8BC1\u4E00\u5B9A\u7A0B\u5EA6\u7684\u54CD\u5E94\u80FD\u529B\u3002</p><p>\u5B9E\u73B0\u5E76\u53D1\u7684\u4E00\u79CD\u7B80\u5355\u65B9\u5F0F\u662F\u4F7F\u7528\u64CD\u4F5C\u7CFB\u7EDF\u7EA7\u522B\u7684\u8FDB\u7A0B\u3002\u4E0E\u7EBF\u7A0B\u4E0D\u540C\uFF0C\u8FDB\u7A0B\u662F\u5728\u5176\u81EA\u5DF1\u7684\u5730\u5740\u7A7A\u95F4\u4E2D\u8FD0\u884C\u7684\u72EC\u7ACB\u7A0B\u5E8F\u3002\u8FDB\u7A0B\u7684\u4F18\u52BF\u5728\u4E8E\uFF0C\u56E0\u4E3A\u64CD\u4F5C\u7CFB\u7EDF\u901A\u5E38\u5C06\u4E00\u4E2A\u8FDB\u7A0B\u4E0E\u53E6\u4E00\u4E2A\u8FDB\u7A0B\u9694\u79BB\uFF0C\u56E0\u6B64\u5B83\u4EEC\u4E0D\u4F1A\u76F8\u4E92\u5E72\u6270\uFF0C\u8FD9\u4F7F\u5F97\u8FDB\u7A0B\u7F16\u7A0B\u76F8\u5BF9\u5BB9\u6613\u3002\u76F8\u6BD4\u4E4B\u4E0B\uFF0C\u7EBF\u7A0B\u4E4B\u95F4\u4F1A\u5171\u4EAB\u5185\u5B58\u548C I/O \u7B49\u8D44\u6E90\uFF0C\u56E0\u6B64\u7F16\u5199\u591A\u7EBF\u7A0B\u7A0B\u5E8F\u6700\u57FA\u672C\u7684\u56F0\u96BE\uFF0C\u5728\u4E8E\u534F\u8C03\u4E0D\u540C\u7EBF\u7A0B\u9A71\u52A8\u7684\u4EFB\u52A1\u4E4B\u95F4\u5BF9\u8FD9\u4E9B\u8D44\u6E90\u7684\u4F7F\u7528\uFF0C\u4EE5\u514D\u8FD9\u4E9B\u8D44\u6E90\u540C\u65F6\u88AB\u591A\u4E2A\u4EFB\u52A1\u8BBF\u95EE\u3002</p><p>\u6709\u4E9B\u4EBA\u751A\u81F3\u63D0\u5021\u5C06\u8FDB\u7A0B\u4F5C\u4E3A\u552F\u4E00\u5408\u7406\u7684\u5E76\u53D1\u5B9E\u73B0\u65B9\u5F0F[^1]\uFF0C\u4F46\u9057\u61BE\u7684\u662F\uFF0C\u901A\u5E38\u5B58\u5728\u6570\u91CF\u548C\u5F00\u9500\u65B9\u9762\u7684\u9650\u5236\uFF0C\u4ECE\u800C\u963B\u6B62\u4E86\u8FDB\u7A0B\u5728\u5E76\u53D1\u8303\u56F4\u5185\u7684\u9002\u7528\u6027\uFF08\u6700\u7EC8\u4F60\u4F1A\u4E60\u60EF\u6807\u51C6\u7684\u5E76\u53D1\u9650\u5236\uFF0C\u201C\u8FD9\u79CD\u65B9\u6CD5\u9002\u7528\u4E8E\u4E00\u4E9B\u60C5\u51B5\u4F46\u4E0D\u9002\u7528\u4E8E\u5176\u4ED6\u60C5\u51B5\u201D\uFF09</p><p>\u4E00\u4E9B\u7F16\u7A0B\u8BED\u8A00\u65E8\u5728\u5C06\u5E76\u53D1\u4EFB\u52A1\u5F7C\u6B64\u9694\u79BB\u3002\u8FD9\u4E9B\u901A\u5E38\u88AB\u79F0\u4E3A_\u51FD\u6570\u5F0F\u8BED\u8A00_\uFF0C\u5176\u4E2D\u6BCF\u4E2A\u51FD\u6570\u8C03\u7528\u4E0D\u4EA7\u751F\u526F\u4F5C\u7528\uFF08\u4E0D\u4F1A\u5E72\u6270\u5230\u5176\u5B83\u51FD\u6570\uFF09\uFF0C\u6240\u4EE5\u53EF\u4EE5\u4F5C\u4E3A\u72EC\u7ACB\u7684\u4EFB\u52A1\u6765\u9A71\u52A8\u3002Erlang \u5C31\u662F\u8FD9\u6837\u4E00\u79CD\u8BED\u8A00\uFF0C\u5B83\u5305\u62EC\u4E00\u4E2A\u4EFB\u52A1\u4E0E\u53E6\u4E00\u4E2A\u4EFB\u52A1\u8FDB\u884C\u901A\u4FE1\u7684\u5B89\u5168\u673A\u5236\u3002\u5982\u679C\u53D1\u73B0\u7A0B\u5E8F\u7684\u67D0\u4E00\u90E8\u5206\u5FC5\u987B\u5927\u91CF\u4F7F\u7528\u5E76\u53D1\uFF0C\u5E76\u4E14\u5728\u5C1D\u8BD5\u6784\u5EFA\u8BE5\u90E8\u5206\u65F6\u9047\u5230\u4E86\u8FC7\u591A\u7684\u95EE\u9898\uFF0C\u90A3\u4E48\u53EF\u4EE5\u8003\u8651\u4F7F\u7528\u8FD9\u4E9B\u4E13\u7528\u7684\u5E76\u53D1\u8BED\u8A00\u521B\u5EFA\u7A0B\u5E8F\u7684\u8FD9\u4E2A\u90E8\u5206\u3002</p><p>Java \u91C7\u7528\u4E86\u66F4\u4F20\u7EDF\u7684\u65B9\u6CD5[^2]\uFF0C\u5373\u5728\u987A\u5E8F\u8BED\u8A00\u4E4B\u4E0A\u6DFB\u52A0\u5BF9\u7EBF\u7A0B\u7684\u652F\u6301\u800C\u4E0D\u662F\u5728\u591A\u4EFB\u52A1\u64CD\u4F5C\u7CFB\u7EDF\u4E2D\u5206\u53C9\u5916\u90E8\u8FDB\u7A0B\uFF0C\u7EBF\u7A0B\u662F\u5728\u8868\u793A\u6267\u884C\u7A0B\u5E8F\u7684\u5355\u4E2A\u8FDB\u7A0B\u5185\u521B\u5EFA\u4EFB\u52A1\u3002</p><p>\u5E76\u53D1\u4F1A\u5E26\u6765\u5404\u79CD\u6210\u672C\uFF0C\u5305\u62EC\u590D\u6742\u6027\u6210\u672C\uFF0C\u4F46\u53EF\u4EE5\u88AB\u7A0B\u5E8F\u8BBE\u8BA1\u3001\u8D44\u6E90\u5E73\u8861\u548C\u7528\u6237\u4FBF\u5229\u6027\u65B9\u9762\u7684\u6539\u8FDB\u6240\u62B5\u6D88\u3002\u901A\u5E38\uFF0C\u5E76\u53D1\u6027\u4F7F\u4F60\u80FD\u591F\u521B\u5EFA\u66F4\u4F4E\u8026\u5408\u7684\u8BBE\u8BA1\uFF1B\u53E6\u4E00\u65B9\u9762\uFF0C\u4F60\u5FC5\u987B\u7279\u522B\u5173\u6CE8\u90A3\u4E9B\u4F7F\u7528\u4E86\u5E76\u53D1\u64CD\u4F5C\u7684\u4EE3\u7801\u3002</p><h2 id="java-\u5E76\u53D1\u7684\u56DB\u53E5\u683C\u8A00" tabindex="-1"><a class="header-anchor" href="#java-\u5E76\u53D1\u7684\u56DB\u53E5\u683C\u8A00" aria-hidden="true">#</a> Java \u5E76\u53D1\u7684\u56DB\u53E5\u683C\u8A00</h2><p>\u5728\u7ECF\u5386\u4E86\u591A\u5E74 Java \u5E76\u53D1\u7684\u5B9E\u8DF5\u4E4B\u540E\uFF0C\u6211\u603B\u7ED3\u4E86\u4EE5\u4E0B\u56DB\u4E2A\u683C\u8A00\uFF1A</p><blockquote><p>1.\u4E0D\u8981\u7528\u5B83\uFF08\u907F\u514D\u4F7F\u7528\u5E76\u53D1\uFF09</p><p>2.\u6CA1\u6709\u4EC0\u4E48\u662F\u771F\u7684\uFF0C\u4E00\u5207\u53EF\u80FD\u90FD\u6709\u95EE\u9898</p><p>3.\u4EC5\u4EC5\u662F\u5B83\u80FD\u8FD0\u884C\uFF0C\u5E76\u4E0D\u610F\u5473\u7740\u5B83\u6CA1\u6709\u95EE\u9898</p><p>4.\u4F60\u5FC5\u987B\u7406\u89E3\u5B83\uFF08\u9003\u4E0D\u6389\u5E76\u53D1\uFF09</p></blockquote><p>\u8FD9\u4E9B\u683C\u8A00\u4E13\u95E8\u9488\u5BF9 Java \u7684\u5E76\u53D1\u8BBE\u8BA1\u95EE\u9898\uFF0C\u5C3D\u7BA1\u5B83\u4EEC\u4E5F\u53EF\u4EE5\u9002\u7528\u4E8E\u5176\u4ED6\u4E00\u4E9B\u8BED\u8A00\u3002\u4F46\u662F\uFF0C\u786E\u5B9E\u5B58\u5728\u65E8\u5728\u9632\u6B62\u8FD9\u4E9B\u95EE\u9898\u7684\u8BED\u8A00\u3002</p><h3 id="_1-\u4E0D\u8981\u7528\u5B83" tabindex="-1"><a class="header-anchor" href="#_1-\u4E0D\u8981\u7528\u5B83" aria-hidden="true">#</a> 1.\u4E0D\u8981\u7528\u5B83</h3><p>\uFF08\u800C\u4E14\u4E0D\u8981\u81EA\u5DF1\u53BB\u5B9E\u73B0\u5B83\uFF09</p><p>\u907F\u514D\u9677\u5165\u5E76\u53D1\u6240\u5E26\u6765\u7684\u7384\u5965\u95EE\u9898\u7684\u6700\u7B80\u5355\u65B9\u6CD5\u5C31\u662F\u4E0D\u8981\u7528\u5B83\u3002\u5C3D\u7BA1\u5C1D\u8BD5\u4E00\u4E9B\u7B80\u5355\u7684\u4E1C\u897F\u53EF\u80FD\u5F88\u8BF1\u4EBA\uFF0C\u4E5F\u4F3C\u4E4E\u8DB3\u591F\u5B89\u5168\uFF0C\u4F46\u662F\u9677\u9631\u5374\u662F\u65E0\u7A77\u4E14\u5FAE\u5999\u7684\u3002\u5982\u679C\u4F60\u80FD\u907F\u514D\u4F7F\u7528\u5B83\uFF0C\u4F60\u7684\u751F\u6D3B\u5C06\u4F1A\u8F7B\u677E\u5F97\u591A\u3002</p><p>\u4F7F\u7528\u5E76\u53D1\u552F\u4E00\u7684\u6B63\u5F53\u7406\u7531\u662F\u901F\u5EA6\u3002\u5982\u679C\u4F60\u7684\u7A0B\u5E8F\u8FD0\u884C\u901F\u5EA6\u4E0D\u591F\u5FEB\u2014\u2014\u8FD9\u91CC\u8981\u5C0F\u5FC3\uFF0C\u56E0\u4E3A\u4EC5\u4EC5\u60F3\u8BA9\u5B83\u8FD0\u884C\u5F97\u66F4\u5FEB\u4E0D\u662F\u6B63\u5F53\u7406\u7531\u2014\u2014\u5E94\u8BE5\u9996\u5148\u7528\u4E00\u4E2A\u5206\u6790\u5668\uFF08\u53C2\u89C1\u4EE3\u7801\u6821\u9A8C\u7AE0\u4E2D\u5206\u6790\u548C\u4F18\u5316\uFF09\u6765\u53D1\u73B0\u4F60\u662F\u5426\u53EF\u4EE5\u6267\u884C\u5176\u4ED6\u4E00\u4E9B\u4F18\u5316\u3002</p><p>\u5982\u679C\u4F60\u88AB\u8FEB\u4F7F\u7528\u5E76\u53D1\uFF0C\u8BF7\u91C7\u53D6\u6700\u7B80\u5355\uFF0C\u6700\u5B89\u5168\u7684\u65B9\u6CD5\u6765\u89E3\u51B3\u95EE\u9898\u3002\u4F7F\u7528\u77E5\u540D\u7684\u5E93\u5E76\u5C3D\u53EF\u80FD\u5C11\u5730\u81EA\u5DF1\u7F16\u5199\u4EE3\u7801\u3002\u5BF9\u4E8E\u5E76\u53D1\uFF0C\u5C31\u6CA1\u6709\u201C\u592A\u7B80\u5355\u4E86\u201D\u2014\u2014\u81EA\u4F5C\u806A\u660E\u662F\u4F60\u7684\u654C\u4EBA\u3002</p><h3 id="_2-\u6CA1\u6709\u4EC0\u4E48\u662F\u771F\u7684-\u4E00\u5207\u53EF\u80FD\u90FD\u6709\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_2-\u6CA1\u6709\u4EC0\u4E48\u662F\u771F\u7684-\u4E00\u5207\u53EF\u80FD\u90FD\u6709\u95EE\u9898" aria-hidden="true">#</a> 2.\u6CA1\u6709\u4EC0\u4E48\u662F\u771F\u7684\uFF0C\u4E00\u5207\u53EF\u80FD\u90FD\u6709\u95EE\u9898</h3><p>\u4E0D\u4F7F\u7528\u5E76\u53D1\u7F16\u7A0B\uFF0C\u4F60\u5DF2\u7ECF\u9884\u6599\u5230\u4F60\u7684\u4E16\u754C\u5177\u6709\u786E\u5B9A\u7684\u987A\u5E8F\u548C\u4E00\u81F4\u6027\u3002\u5BF9\u4E8E\u53D8\u91CF\u8D4B\u503C\u8FD9\u6837\u7B80\u5355\u7684\u64CD\u4F5C\uFF0C\u5F88\u660E\u663E\u5B83\u5E94\u8BE5\u603B\u662F\u80FD\u591F\u6B63\u5E38\u5DE5\u4F5C\u3002</p><p>\u5728\u5E76\u53D1\u9886\u57DF\uFF0C\u6709\u4E9B\u4E8B\u60C5\u53EF\u80FD\u662F\u771F\u7684\u800C\u6709\u4E9B\u4E8B\u60C5\u5374\u4E0D\u662F\uFF0C\u4EE5\u81F3\u4E8E\u4F60\u5FC5\u987B\u5047\u8BBE\u6CA1\u6709\u4EC0\u4E48\u662F\u771F\u7684\u3002\u4F60\u5FC5\u987B\u8D28\u7591\u4E00\u5207\u3002\u5373\u4F7F\u5C06\u53D8\u91CF\u8BBE\u7F6E\u4E3A\u67D0\u4E2A\u503C\u4E5F\u53EF\u80FD\u4E0D\u4F1A\u6309\u9884\u671F\u7684\u65B9\u5F0F\u5DE5\u4F5C\uFF0C\u4E8B\u60C5\u4ECE\u8FD9\u91CC\u5F00\u59CB\u8FC5\u901F\u6076\u5316\u3002\u6211\u5DF2\u7ECF\u719F\u6089\u4E86\u8FD9\u6837\u4E00\u79CD\u611F\u89C9\uFF1A\u6211\u8BA4\u4E3A\u5E94\u8BE5\u660E\u663E\u594F\u6548\u7684\u4E1C\u897F\uFF0C\u5B9E\u9645\u4E0A\u5374\u884C\u4E0D\u901A\u3002</p><p>\u5728\u975E\u5E76\u53D1\u7F16\u7A0B\u4E2D\u4F60\u53EF\u4EE5\u5FFD\u7565\u7684\u5404\u79CD\u4E8B\u60C5\uFF0C\u5728\u5E76\u53D1\u4E0B\u7A81\u7136\u53D8\u5F97\u5F88\u91CD\u8981\u3002\u4F8B\u5982\uFF0C\u4F60\u5FC5\u987B\u4E86\u89E3\u5904\u7406\u5668\u7F13\u5B58\u4EE5\u53CA\u4FDD\u6301\u672C\u5730\u7F13\u5B58\u4E0E\u4E3B\u5185\u5B58\u4E00\u81F4\u7684\u95EE\u9898\uFF0C\u4F60\u5FC5\u987B\u7406\u89E3\u5BF9\u8C61\u6784\u9020\u7684\u6DF1\u5C42\u590D\u6742\u6027\uFF0C\u8FD9\u6837\u4F60\u7684\u6784\u9020\u51FD\u6570\u5C31\u4E0D\u4F1A\u610F\u5916\u5730\u66B4\u9732\u6570\u636E\uFF0C\u4EE5\u81F4\u4E8E\u88AB\u5176\u5B83\u7EBF\u7A0B\u66F4\u6539\u3002\u8FD9\u6837\u7684\u4F8B\u5B50\u4E0D\u80DC\u679A\u4E3E\u3002</p><p>\u867D\u7136\u8FD9\u4E9B\u4E3B\u9898\u8FC7\u4E8E\u590D\u6742\uFF0C\u65E0\u6CD5\u5728\u672C\u7AE0\u4E2D\u7ED9\u4F60\u63D0\u4F9B\u4E13\u4E1A\u77E5\u8BC6\uFF08\u540C\u6837\uFF0C\u8BF7\u53C2\u89C1 Java Concurrency in Practice\uFF09\uFF0C\u4F46\u4F60\u5FC5\u987B\u4E86\u89E3\u5B83\u4EEC\u3002</p><h3 id="_3-\u4EC5\u4EC5\u662F\u5B83\u80FD\u8FD0\u884C-\u5E76\u4E0D\u610F\u5473\u7740\u5B83\u6CA1\u6709\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3-\u4EC5\u4EC5\u662F\u5B83\u80FD\u8FD0\u884C-\u5E76\u4E0D\u610F\u5473\u7740\u5B83\u6CA1\u6709\u95EE\u9898" aria-hidden="true">#</a> 3.\u4EC5\u4EC5\u662F\u5B83\u80FD\u8FD0\u884C\uFF0C\u5E76\u4E0D\u610F\u5473\u7740\u5B83\u6CA1\u6709\u95EE\u9898</h3><p>\u6211\u4EEC\u5F88\u5BB9\u6613\u7F16\u5199\u51FA\u4E00\u4E2A\u770B\u4F3C\u6B63\u5E38\u5B9E\u5219\u6709\u95EE\u9898\u7684\u5E76\u53D1\u7A0B\u5E8F\uFF0C\u800C\u4E14\u95EE\u9898\u53EA\u6709\u5728\u6781\u5C11\u7684\u60C5\u51B5\u4E0B\u624D\u4F1A\u663E\u73B0\u51FA\u6765\u2014\u2014\u5728\u7A0B\u5E8F\u90E8\u7F72\u540E\u4E0D\u53EF\u907F\u514D\u5730\u4F1A\u6210\u4E3A\u7528\u6237\u95EE\u9898\uFF08\u6295\u8BC9\uFF09\u3002</p><ul><li>\u4F60\u4E0D\u80FD\u9A8C\u8BC1\u51FA\u5E76\u53D1\u7A0B\u5E8F\u662F\u6B63\u786E\u7684\uFF0C\u4F60\u53EA\u80FD\uFF08\u6709\u65F6\uFF09\u9A8C\u8BC1\u51FA\u5B83\u662F\u4E0D\u6B63\u786E\u7684\u3002</li><li>\u5927\u591A\u6570\u60C5\u51B5\u4E0B\u4F60\u751A\u81F3\u6CA1\u529E\u6CD5\u9A8C\u8BC1\uFF1A\u5982\u679C\u5B83\u51FA\u95EE\u9898\u4E86\uFF0C\u4F60\u53EF\u80FD\u65E0\u6CD5\u68C0\u6D4B\u5230\u5B83\u3002</li><li>\u4F60\u901A\u5E38\u65E0\u6CD5\u7F16\u5199\u6709\u7528\u7684\u6D4B\u8BD5\uFF0C\u56E0\u6B64\u4F60\u5FC5\u987B\u4F9D\u9760\u4EE3\u7801\u68C0\u67E5\u548C\u5BF9\u5E76\u53D1\u7684\u6DF1\u5165\u4E86\u89E3\u6765\u53D1\u73B0\u9519\u8BEF\u3002</li><li>\u5373\u4F7F\u662F\u6709\u6548\u7684\u7A0B\u5E8F\u4E5F\u53EA\u80FD\u5728\u5176\u8BBE\u8BA1\u53C2\u6570\u4E0B\u5DE5\u4F5C\u3002\u5F53\u8D85\u51FA\u8FD9\u4E9B\u8BBE\u8BA1\u53C2\u6570\u65F6\uFF0C\u5927\u591A\u6570\u5E76\u53D1\u7A0B\u5E8F\u4F1A\u4EE5\u67D0\u79CD\u65B9\u5F0F\u5931\u8D25\u3002</li></ul><p>\u5728\u5176\u4ED6 Java \u4E3B\u9898\u4E2D\uFF0C\u6211\u4EEC\u517B\u6210\u4E86\u51B3\u5B9A\u8BBA\u7684\u89C2\u5FF5\u3002\u4E00\u5207\u90FD\u6309\u7167\u8BED\u8A00\u7684\u627F\u8BFA\u7684\uFF08\u6216\u6697\u793A\u7684\uFF09\u53D1\u751F\uFF0C\u8FD9\u662F\u4EE4\u4EBA\u6B23\u6170\u7684\u4E5F\u662F\u4EBA\u4EEC\u6240\u671F\u5F85\u7684\u2014\u2014\u6BD5\u7ADF\uFF0C\u7F16\u7A0B\u8BED\u8A00\u7684\u610F\u4E49\u5C31\u662F\u8BA9\u673A\u5668\u505A\u6211\u4EEC\u60F3\u8981\u5B83\u505A\u7684\u4E8B\u60C5\u3002\u4ECE\u786E\u5B9A\u6027\u7F16\u7A0B\u7684\u4E16\u754C\u8FDB\u5165\u5E76\u53D1\u7F16\u7A0B\u9886\u57DF\uFF0C\u6211\u4EEC\u9047\u5230\u4E86\u4E00\u79CD\u79F0\u4E3A <a href="https://en.wikipedia.org/wiki/Dunning%E2%80%93Kruger_effect" target="_blank" rel="noopener noreferrer">\u9093\u5B81-\u514B\u9C81\u683C\u6548\u5E94</a> \u7684\u8BA4\u77E5\u504F\u5DEE\uFF0C\u53EF\u4EE5\u6982\u62EC\u4E3A\u201C\u65E0\u77E5\u8005\u65E0\u754F\u201D\uFF0C\u610F\u601D\u662F\uFF1A\u201C\u76F8\u5BF9\u4E0D\u719F\u7EC3\u7684\u4EBA\u62E5\u6709\u7740\u865A\u5E7B\u7684\u4F18\u8D8A\u611F\uFF0C\u9519\u8BEF\u5730\u8BC4\u4F30\u4ED6\u4EEC\u7684\u80FD\u529B\u8FDC\u9AD8\u4E8E\u5B9E\u9645\u3002</p><p>\u6211\u81EA\u5DF1\u7684\u7ECF\u9A8C\u662F\uFF0C\u65E0\u8BBA\u4F60\u662F\u591A\u4E48\u786E\u5B9A\u4F60\u7684\u4EE3\u7801\u662F_\u7EBF\u7A0B\u5B89\u5168_\u7684\uFF0C\u5B83\u90FD\u53EF\u80FD\u662F\u6709\u95EE\u9898\u7684\u3002\u4F60\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u4E86\u89E3\u6240\u6709\u7684\u95EE\u9898\uFF0C\u7136\u540E\u51E0\u4E2A\u6708\u6216\u51E0\u5E74\u540E\u4F60\u4F1A\u53D1\u73B0\u4E00\u4E9B\u6982\u5FF5\uFF0C\u8BA9\u4F60\u610F\u8BC6\u5230\u4F60\u7F16\u5199\u7684\u5927\u591A\u6570\u4EE3\u7801\u5B9E\u9645\u4E0A\u90FD\u5BB9\u6613\u53D7\u5230\u5E76\u53D1 bug \u7684\u5F71\u54CD\u3002\u5F53\u67D0\u4E9B\u4EE3\u7801\u4E0D\u6B63\u786E\u65F6\uFF0C\u7F16\u8BD1\u5668\u4E0D\u4F1A\u544A\u8BC9\u4F60\u3002\u4E3A\u4E86\u4F7F\u5B83\u6B63\u786E\uFF0C\u5728\u7814\u7A76\u4EE3\u7801\u65F6\uFF0C\u5FC5\u987B\u5C06\u5E76\u53D1\u6027\u7684\u6240\u6709\u95EE\u9898\u90FD\u653E\u5728\u524D\u8111\u4E2D\u3002</p><p>\u5728 Java \u7684\u6240\u6709\u975E\u5E76\u53D1\u9886\u57DF\uFF0C\u201C\u6CA1\u6709\u660E\u663E\u7684 bug \u800C\u4E14\u6CA1\u6709\u7F16\u8BD1\u62A5\u9519\u201C\u4F3C\u4E4E\u610F\u5473\u7740\u4E00\u5207\u90FD\u597D\u3002\u4F46\u5BF9\u4E8E\u5E76\u53D1\uFF0C\u5B83\u6CA1\u6709\u4EFB\u4F55\u610F\u4E49\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4F60\u6700\u7CDF\u7CD5\u7684\u8868\u73B0\u5C31\u662F\u201C\u81EA\u4FE1\u201D\u3002</p><h3 id="_4-\u4F60\u5FC5\u987B\u7406\u89E3\u5B83" tabindex="-1"><a class="header-anchor" href="#_4-\u4F60\u5FC5\u987B\u7406\u89E3\u5B83" aria-hidden="true">#</a> 4.\u4F60\u5FC5\u987B\u7406\u89E3\u5B83</h3><p>\u5728\u683C\u8A00 1-3 \u4E4B\u540E\uFF0C\u4F60\u53EF\u80FD\u4F1A\u5BF9\u5E76\u53D1\u6027\u611F\u5230\u5BB3\u6015\uFF0C\u5E76\u4E14\u8BA4\u4E3A\uFF0C\u201C\u5230\u76EE\u524D\u4E3A\u6B62\uFF0C\u6211\u5DF2\u7ECF\u907F\u514D\u4E86\u5B83\uFF0C\u4E5F\u8BB8\u6211\u53EF\u4EE5\u7EE7\u7EED\u907F\u514D\u5B83\u3002</p><p>\u8FD9\u662F\u4E00\u79CD\u7406\u6027\u7684\u53CD\u5E94\u3002\u4F60\u53EF\u80FD\u77E5\u9053\u5176\u4ED6\u66F4\u597D\u5730\u88AB\u8BBE\u8BA1\u7528\u4E8E\u6784\u5EFA\u5E76\u53D1\u7A0B\u5E8F\u7684\u7F16\u7A0B\u8BED\u8A00\u2014\u2014\u751A\u81F3\u662F\u5728 JVM \u4E0A\u8FD0\u884C\u7684\u8BED\u8A00\uFF08\u4ECE\u800C\u63D0\u4F9B\u4E0E Java \u7684\u8F7B\u677E\u901A\u4FE1\uFF09\uFF0C\u4F8B\u5982 Clojure \u6216 Scala\u3002\u4E3A\u4EC0\u4E48\u4E0D\u7528\u8FD9\u4E9B\u8BED\u8A00\u6765\u7F16\u5199\u5E76\u53D1\u90E8\u5206\uFF0C\u7136\u540E\u7528Java\u6765\u505A\u5176\u4ED6\u7684\u4E8B\u60C5\u5462?</p><p>\u5509\uFF0C\u4F60\u4E0D\u80FD\u8F7B\u6613\u9003\u8131\uFF1A</p><ul><li>\u5373\u4F7F\u4F60\u4ECE\u672A\u663E\u793A\u5730\u521B\u5EFA\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u4F60\u4F7F\u7528\u7684\u6846\u67B6\u4E5F\u53EF\u80FD\u2014\u2014\u4F8B\u5982\uFF0CSwing \u56FE\u5F62\u7528\u6237\u754C\u9762\uFF08GUI\uFF09\u5E93\uFF0C\u6216\u8005\u50CF <strong>Timer</strong> \u7C7B\uFF08\u8BA1\u65F6\u5668\uFF09\u90A3\u6837\u7B80\u5355\u7684\u4E1C\u897F\u3002</li><li>\u6700\u7CDF\u7CD5\u7684\u662F\uFF1A\u5F53\u4F60\u521B\u5EFA\u7EC4\u4EF6\u65F6\uFF0C\u5FC5\u987B\u5047\u8BBE\u8FD9\u4E9B\u7EC4\u4EF6\u53EF\u80FD\u4F1A\u5728\u591A\u7EBF\u7A0B\u73AF\u5883\u4E2D\u91CD\u7528\u3002\u5373\u4F7F\u4F60\u7684\u89E3\u51B3\u65B9\u6848\u662F\u653E\u5F03\u5E76\u58F0\u660E\u4F60\u7684\u7EC4\u4EF6\u662F\u201C\u975E\u7EBF\u7A0B\u5B89\u5168\u7684\u201D\uFF0C\u4F60\u4ECD\u7136\u5FC5\u987B\u5145\u5206\u4E86\u89E3\u8FD9\u6837\u4E00\u4E2A\u8BED\u53E5\u7684\u91CD\u8981\u6027\u53CA\u5176\u542B\u4E49\u3002</li></ul><p>\u4EBA\u4EEC\u6709\u65F6\u4F1A\u8BA4\u4E3A\u5E76\u53D1\u5BF9\u4E8E\u4ECB\u7ECD\u8BED\u8A00\u7684\u4E66\u6765\u8BF4\u592A\u9AD8\u7EA7\u4E86\uFF0C\u56E0\u6B64\u4E0D\u9002\u5408\u653E\u5728\u5176\u4E2D\u3002\u4ED6\u4EEC\u8BA4\u4E3A\u5E76\u53D1\u662F\u4E00\u4E2A\u72EC\u7ACB\u7684\u4E3B\u9898\uFF0C\u5E76\u4E14\u5BF9\u4E8E\u5C11\u6570\u51FA\u73B0\u5728\u65E5\u5E38\u7684\u7A0B\u5E8F\u8BBE\u8BA1\u4E2D\u7684\u60C5\u51B5\uFF08\u4F8B\u5982\u56FE\u5F62\u7528\u6237\u754C\u9762\uFF09\uFF0C\u53EF\u4EE5\u7528\u7279\u6B8A\u7684\u60EF\u7528\u6CD5\u6765\u5904\u7406\u3002\u5982\u679C\u4F60\u53EF\u4EE5\u56DE\u907F\uFF0C\u4E3A\u4EC0\u4E48\u8FD8\u8981\u4ECB\u7ECD\u8FD9\u4E48\u590D\u6742\u7684\u4E3B\u9898\u5462\uFF1F</p><p>\u5509\uFF0C\u5982\u679C\u662F\u8FD9\u6837\u5C31\u597D\u4E86\u3002\u9057\u61BE\u7684\u662F\uFF0C\u5BF9\u4E8E\u7EBF\u7A0B\u4F55\u65F6\u51FA\u73B0\u5728 Java \u7A0B\u5E8F\u4E2D\uFF0C\u8FD9\u4E0D\u662F\u4F60\u80FD\u51B3\u5B9A\u7684\u3002\u4EC5\u4EC5\u662F\u4F60\u81EA\u5DF1\u6CA1\u6709\u542F\u52A8\u7EBF\u7A0B\uFF0C\u5E76\u4E0D\u4EE3\u8868\u4F60\u5C31\u53EF\u4EE5\u56DE\u907F\u7F16\u5199\u4F7F\u7528\u7EBF\u7A0B\u7684\u4EE3\u7801\u3002\u4F8B\u5982\uFF0CWeb \u7CFB\u7EDF\u662F\u6700\u5E38\u89C1\u7684 Java \u5E94\u7528\u4E4B\u4E00\uFF0C\u672C\u8D28\u4E0A\u662F\u591A\u7EBF\u7A0B\u7684 Web \u670D\u52A1\u5668\uFF0C\u901A\u5E38\u5305\u542B\u591A\u4E2A\u5904\u7406\u5668\uFF0C\u800C\u5E76\u884C\u662F\u5229\u7528\u8FD9\u4E9B\u5904\u7406\u5668\u7684\u7406\u60F3\u65B9\u5F0F\u3002\u5C3D\u7BA1\u8FD9\u6837\u7684\u7CFB\u7EDF\u770B\u8D77\u6765\u5F88\u7B80\u5355\uFF0C\u4F46\u4F60\u5FC5\u987B\u7406\u89E3\u5E76\u53D1\u624D\u80FD\u6B63\u786E\u5730\u7F16\u5199\u5B83\u3002</p><p>Java \u662F\u4E00\u79CD\u591A\u7EBF\u7A0B\u8BED\u8A00\uFF0C\u4E0D\u7BA1\u4F60\u6709\u6CA1\u6709\u610F\u8BC6\u5230\u5E76\u53D1\u95EE\u9898\uFF0C\u5B83\u5C31\u5728\u90A3\u91CC\u3002\u56E0\u6B64\uFF0C\u6709\u5F88\u591A\u4F7F\u7528\u5E76\u53D1\u7684 Java \u7A0B\u5E8F\uFF0C\u8981\u4E48\u53EA\u662F\u5076\u7136\u8FD0\u884C\uFF0C\u8981\u4E48\u5927\u90E8\u5206\u65F6\u95F4\u90FD\u5728\u8FD0\u884C\uFF0C\u5E76\u4E14\u4F1A\u56E0\u4E3A\u672A\u88AB\u53D1\u73B0\u7684\u5E76\u53D1\u7F3A\u9677\u800C\u65F6\u4E0D\u65F6\u5730\u795E\u79D8\u5D29\u6E83\u3002\u6709\u65F6\u8FD9\u79CD\u5D29\u6E83\u662F\u76F8\u5BF9\u6E29\u548C\u7684\uFF0C\u4F46\u6709\u65F6\u5B83\u610F\u5473\u7740\u4E22\u5931\u6709\u4EF7\u503C\u7684\u6570\u636E\uFF0C\u5982\u679C\u4F60\u6CA1\u6709\u610F\u8BC6\u5230\u5E76\u53D1\u95EE\u9898\uFF0C\u4F60\u6700\u7EC8\u53EF\u80FD\u4F1A\u628A\u95EE\u9898\u5F52\u548E\u4E8E\u5176\u4ED6\u5730\u65B9\u800C\u4E0D\u662F\u4F60\u7684\u4EE3\u7801\u4E2D\u3002\u5982\u679C\u5C06\u7A0B\u5E8F\u79FB\u52A8\u5230\u591A\u5904\u7406\u5668\u7CFB\u7EDF\u4E2D\uFF0C\u8FD9\u4E9B\u7C7B\u578B\u7684\u95EE\u9898\u8FD8\u4F1A\u88AB\u66B4\u9732\u6216\u653E\u5927\u3002\u57FA\u672C\u4E0A\uFF0C\u4E86\u89E3\u5E76\u53D1\u53EF\u4EE5\u4F7F\u4F60\u610F\u8BC6\u5230\u660E\u663E\u6B63\u786E\u7684\u7A0B\u5E8F\u4E5F\u53EF\u80FD\u4F1A\u8868\u73B0\u51FA\u9519\u8BEF\u7684\u884C\u4E3A\u3002</p><h2 id="\u6B8B\u9177\u7684\u771F\u76F8" tabindex="-1"><a class="header-anchor" href="#\u6B8B\u9177\u7684\u771F\u76F8" aria-hidden="true">#</a> \u6B8B\u9177\u7684\u771F\u76F8</h2><p>\u5F53\u4EBA\u7C7B\u5F00\u59CB\u70F9\u996A\u4ED6\u4EEC\u7684\u98DF\u7269\u65F6\uFF0C\u4ED6\u4EEC\u5927\u5927\u51CF\u5C11\u4E86\u4ED6\u4EEC\u7684\u8EAB\u4F53\u5206\u89E3\u548C\u6D88\u5316\u98DF\u7269\u6240\u9700\u7684\u80FD\u91CF\u3002\u70F9\u996A\u521B\u9020\u4E86\u4E00\u4E2A\u201C\u5916\u5316\u7684\u80C3\u201D\uFF0C\u4ECE\u800C\u91CA\u653E\u51FA\u80FD\u91CF\u53BB\u53D1\u5C55\u5176\u4ED6\u7684\u80FD\u529B\u3002\u706B\u7684\u4F7F\u7528\u4FC3\u6210\u4E86\u6587\u660E\u3002</p><p>\u6211\u4EEC\u73B0\u5728\u901A\u8FC7\u8BA1\u7B97\u673A\u548C\u7F51\u7EDC\u6280\u672F\u521B\u9020\u4E86\u4E00\u4E2A\u201C\u5916\u5316\u5927\u8111\u201D\uFF0C\u5F00\u59CB\u4E86\u7B2C\u4E8C\u6B21\u57FA\u672C\u8F6C\u53D8\u3002\u867D\u7136\u6211\u4EEC\u53EA\u662F\u89E6\u53CA\u8868\u9762\uFF0C\u4F46\u5DF2\u7ECF\u5F15\u53D1\u4E86\u5176\u4ED6\u8F6C\u53D8\uFF0C\u4F8B\u5982\u8BBE\u8BA1\u751F\u7269\u673A\u5236\u7684\u80FD\u529B\uFF0C\u5E76\u4E14\u5DF2\u7ECF\u770B\u5230\u6587\u5316\u6F14\u53D8\u7684\u663E\u8457\u52A0\u901F\uFF08\u8FC7\u53BB\uFF0C\u4EBA\u4EEC\u901A\u8FC7\u65C5\u6E38\u8FDB\u884C\u6587\u5316\u4EA4\u6D41\uFF0C\u4F46\u73B0\u5728\u4ED6\u4EEC\u5F00\u59CB\u5728\u4E92\u8054\u7F51\u4E0A\u505A\u8FD9\u4EF6\u4E8B\uFF09\u3002\u8FD9\u4E9B\u8F6C\u53D8\u7684\u5F71\u54CD\u548C\u597D\u5904\u5DF2\u7ECF\u8D85\u51FA\u4E86\u79D1\u5E7B\u4F5C\u5BB6\u9884\u6D4B\u5B83\u4EEC\u7684\u80FD\u529B\uFF08\u4ED6\u4EEC\u5728\u9884\u6D4B\u6587\u5316\u548C\u4E2A\u4EBA\u53D8\u5316\uFF0C\u751A\u81F3\u6280\u672F\u8F6C\u53D8\u7684\u6B21\u8981\u5F71\u54CD\u65B9\u9762\u90FD\u7279\u522B\u56F0\u96BE\uFF09\u3002</p><p>\u6709\u4E86\u8FD9\u79CD\u6839\u672C\u6027\u7684\u4EBA\u7C7B\u53D8\u5316\uFF0C\u770B\u5230\u8BB8\u591A\u7834\u574F\u548C\u5931\u8D25\u7684\u5B9E\u9A8C\u5E76\u4E0D\u4EE4\u4EBA\u60CA\u8BB6\u3002\u5B9E\u9645\u4E0A\uFF0C\u8FDB\u5316\u4F9D\u8D56\u4E8E\u65E0\u6570\u7684\u5B9E\u9A8C\uFF0C\u5176\u4E2D\u5927\u591A\u6570\u90FD\u5931\u8D25\u4E86\u3002\u8FD9\u4E9B\u5B9E\u9A8C\u662F\u5411\u524D\u53D1\u5C55\u7684\u5FC5\u8981\u6761\u4EF6\u3002</p><p>Java \u662F\u5728\u5145\u6EE1\u81EA\u4FE1\uFF0C\u70ED\u60C5\u548C\u777F\u667A\u7684\u6C1B\u56F4\u4E2D\u521B\u5EFA\u7684\u3002\u5728\u53D1\u660E\u4E00\u79CD\u7F16\u7A0B\u8BED\u8A00\u65F6\uFF0C\u5F88\u5BB9\u6613\u611F\u89C9\u8BED\u8A00\u7684\u521D\u59CB\u53EF\u5851\u6027\u4F1A\u6301\u7EED\u5B58\u5728\u4E00\u6837\uFF0C\u4F60\u53EF\u4EE5\u628A\u67D0\u4E9B\u4E1C\u897F\u62FF\u51FA\u6765\uFF0C\u5982\u679C\u4E0D\u80FD\u89E3\u51B3\u95EE\u9898\uFF0C\u90A3\u4E48\u5C31\u4FEE\u590D\u5B83\u3002\u7F16\u7A0B\u8BED\u8A00\u4EE5\u8FD9\u79CD\u65B9\u5F0F\u662F\u72EC\u4E00\u65E0\u4E8C\u7684 - \u5B83\u4EEC\u7ECF\u5386\u4E86\u7C7B\u4F3C\u6C34\u7684\u6539\u53D8\uFF1A\u6C14\u6001\uFF0C\u6DB2\u6001\u548C\u6700\u7EC8\u7684\u56FA\u6001\u3002\u5728\u6C14\u6001\u9636\u6BB5\uFF0C\u7075\u6D3B\u6027\u4F3C\u4E4E\u662F\u65E0\u9650\u7684\uFF0C\u5E76\u4E14\u5F88\u5BB9\u6613\u8BA4\u4E3A\u5B83\u603B\u662F\u90A3\u6837\u3002\u4E00\u65E6\u4EBA\u4EEC\u5F00\u59CB\u4F7F\u7528\u4F60\u7684\u8BED\u8A00\uFF0C\u53D8\u5316\u5C31\u4F1A\u53D8\u5F97\u66F4\u52A0\u4E25\u91CD\uFF0C\u73AF\u5883\u53D8\u5F97\u66F4\u52A0\u7C98\u7A20\u3002\u8BED\u8A00\u8BBE\u8BA1\u7684\u8FC7\u7A0B\u672C\u8EAB\u5C31\u662F\u4E00\u95E8\u827A\u672F\u3002</p><p>\u7D27\u8FEB\u611F\u6765\u81EA\u4E92\u8054\u7F51\u7684\u6700\u521D\u5174\u8D77\u3002\u5B83\u4F3C\u4E4E\u662F\u4E00\u573A\u6BD4\u8D5B\uFF0C\u7B2C\u4E00\u4E2A\u901A\u8FC7\u8D77\u8DD1\u7EBF\u7684\u4EBA\u5C06\u201C\u83B7\u80DC\u201D\uFF08\u4E8B\u5B9E\u4E0A\uFF0CJava\uFF0CJavaScript \u548C PHP \u7B49\u8BED\u8A00\u7684\u6D41\u884C\u7A0B\u5EA6\u53EF\u4EE5\u8BC1\u660E\u8FD9\u4E00\u70B9\uFF09\u3002\u5509\uFF0C\u901A\u8FC7\u5306\u5FD9\u8BBE\u8BA1\u8BED\u8A00\u800C\u4EA7\u751F\u7684\u8BA4\u77E5\u8D1F\u8377\u548C\u6280\u672F\u503A\u52A1\u6700\u7EC8\u4F1A\u8D76\u4E0A\u6211\u4EEC\u3002</p><p><a href="https://en.wikipedia.org/wiki/Turing_completeness" target="_blank" rel="noopener noreferrer">Turing completeness</a> \u662F\u4E0D\u8DB3\u591F\u7684;\u8BED\u8A00\u9700\u8981\u66F4\u591A\u7684\u4E1C\u897F\uFF1A\u5B83\u4EEC\u5FC5\u987B\u80FD\u591F\u521B\u9020\u6027\u5730\u8868\u8FBE\uFF0C\u800C\u4E0D\u662F\u7528\u4E0D\u5FC5\u8981\u7684\u4E1C\u897F\u6765\u8861\u91CF\u6211\u4EEC\u3002\u89E3\u653E\u6211\u4EEC\u7684\u5FC3\u7406\u80FD\u529B\u53EA\u662F\u4E3A\u4E86\u626D\u8F6C\u5E76\u518D\u6B21\u9677\u5165\u56F0\u5883\uFF0C\u8FD9\u662F\u6BEB\u65E0\u610F\u4E49\u7684\u3002\u6211\u627F\u8BA4\uFF0C\u5C3D\u7BA1\u5B58\u5728\u8FD9\u4E9B\u95EE\u9898\uFF0C\u6211\u4EEC\u5DF2\u7ECF\u5B8C\u6210\u4E86\u4EE4\u4EBA\u60CA\u5947\u7684\u4E8B\u60C5\uFF0C\u4F46\u6211\u4E5F\u77E5\u9053\u5982\u679C\u6CA1\u6709\u8FD9\u4E9B\u95EE\u9898\u6211\u4EEC\u80FD\u505A\u5F97\u66F4\u591A\u3002</p><p>\u70ED\u60C5\u4F7F\u539F\u59CB Java \u8BBE\u8BA1\u5E08\u52A0\u5165\u4E86\u4E00\u4E9B\u4F3C\u4E4E\u6709\u5FC5\u8981\u7684\u7279\u6027\u3002\u4FE1\u5FC3\uFF08\u4EE5\u53CA\u6C14\u6001\u7684\u521D\u59CB\u8BED\u8A00\uFF09\u8BA9\u4ED6\u4EEC\u8BA4\u4E3A\u4EFB\u4F55\u95EE\u9898\u968F\u540E\u90FD\u53EF\u4EE5\u89E3\u51B3\u3002\u5728\u65F6\u95F4\u8F74\u7684\u67D0\u4E2A\u5730\u65B9\uFF0C\u6709\u4EBA\u8BA4\u4E3A\u4EFB\u4F55\u52A0\u5165 Java \u7684\u4E1C\u897F\u662F\u56FA\u5B9A\u7684\u548C\u6C38\u4E45\u6027\u7684 -\u4ED6\u4EEC\u975E\u5E38\u6709\u4FE1\u5FC3\uFF0C\u5E76\u76F8\u4FE1\u7B2C\u4E00\u4E2A\u51B3\u5B9A\u6C38\u8FDC\u662F\u6B63\u786E\u7684\uFF0C\u56E0\u6B64\u6211\u4EEC\u770B\u5230 Java \u7684\u4F53\u7CFB\u4E2D\u5145\u65A5\u7740\u7CDF\u7CD5\u7684\u51B3\u7B56\u3002\u5176\u4E2D\u4E00\u4E9B\u51B3\u5B9A\u6700\u7EC8\u6CA1\u6709\u4EC0\u4E48\u540E\u679C;\u4F8B\u5982\uFF0C\u4F60\u53EF\u4EE5\u544A\u8BC9\u4EBA\u4EEC\u4E0D\u8981\u4F7F\u7528 Vector\uFF0C\u4F46\u53EA\u80FD\u5728\u8BED\u8A00\u4E2D\u7EE7\u7EED\u4FDD\u7559\u5B83\u4EE5\u4FBF\u5BF9\u4E4B\u524D\u7248\u672C\u7684\u652F\u6301\u3002</p><p>\u7EBF\u7A0B\u5305\u542B\u5728 Java 1.0 \u4E2D\u3002\u5F53\u7136\uFF0C\u5BF9 java \u6765\u8BF4\u652F\u6301\u5E76\u53D1\u662F\u4E00\u4E2A\u5F88\u57FA\u672C\u7684\u8BBE\u8BA1\u51B3\u5B9A\uFF0C\u8BE5\u7279\u6027\u5F71\u54CD\u4E86\u8FD9\u4E2A\u8BED\u8A00\u7684\u5404\u4E2A\u89D2\u843D\uFF0C\u6211\u4EEC\u5F88\u96BE\u60F3\u8C61\u4EE5\u540E\u5728\u4EE5\u540E\u7684\u7248\u672C\u6DFB\u52A0\u5B83\u3002\u516C\u5E73\u5730\u8BF4\uFF0C\u5F53\u65F6\u5E76\u4E0D\u6E05\u695A\u57FA\u672C\u7684\u5E76\u53D1\u6027\u662F\u591A\u5C11\u3002\u50CF C \u8FD9\u6837\u7684\u5176\u4ED6\u8BED\u8A00\u80FD\u591F\u5C06\u7EBF\u7A0B\u89C6\u4E3A\u4E00\u4E2A\u9644\u52A0\u529F\u80FD\uFF0C\u56E0\u6B64 Java \u8BBE\u8BA1\u5E08\u4E5F\u7EB7\u7EB7\u6548\u4EFF\uFF0C\u5305\u62EC\u4E00\u4E2A Thread \u7C7B\u548C\u5FC5\u8981\u7684 JVM \u652F\u6301\uFF08\u8FD9\u6BD4\u4F60\u60F3\u8C61\u7684\u8981\u590D\u6742\u5F97\u591A\uFF09\u3002</p><p>C \u8BED\u8A00\u662F\u9762\u5411\u8FC7\u7A0B\u8BED\u8A00\uFF0C\u8FD9\u9650\u5236\u4E86\u5B83\u7684\u91CE\u5FC3\u3002\u8FD9\u4E9B\u9650\u5236\u4F7F\u9644\u52A0\u7EBF\u7A0B\u5E93\u5408\u7406\u3002\u5F53\u91C7\u7528\u539F\u59CB\u6A21\u578B\u5E76\u5C06\u5176\u7C98\u8D34\u5230\u590D\u6742\u8BED\u8A00\u4E2D\u65F6\uFF0CJava \u7684\u5927\u89C4\u6A21\u6269\u5C55\u8FC5\u901F\u66B4\u9732\u4E86\u57FA\u672C\u95EE\u9898\u3002\u5728 Thread \u7C7B\u4E2D\u7684\u8BB8\u591A\u65B9\u6CD5\u7684\u5F03\u7528\u4EE5\u53CA\u540E\u7EED\u7684\u9AD8\u7EA7\u5E93\u6D6A\u6F6E\u4E2D\uFF0C\u8FD9\u79CD\u60C5\u51B5\u53D8\u5F97\u660E\u663E\uFF0C\u8FD9\u4E9B\u5E93\u8BD5\u56FE\u63D0\u4F9B\u66F4\u597D\u7684\u5E76\u53D1\u62BD\u8C61\u3002</p><p>\u4E0D\u5E78\u7684\u662F\uFF0C\u4E3A\u4E86\u5728\u66F4\u9AD8\u7EA7\u522B\u7684\u8BED\u8A00\u4E2D\u83B7\u5F97\u5E76\u53D1\u6027\uFF0C\u6240\u6709\u8BED\u8A00\u529F\u80FD\u90FD\u4F1A\u53D7\u5230\u5F71\u54CD\uFF0C\u5305\u62EC\u6700\u57FA\u672C\u7684\u529F\u80FD\uFF0C\u4F8B\u5982\u6807\u8BC6\u7B26\u4EE3\u8868\u53EF\u53D8\u503C\u3002\u5728\u7B80\u5316\u5E76\u53D1\u7F16\u7A0B\u4E2D\uFF0C\u6240\u6709\u51FD\u6570\u548C\u65B9\u6CD5\u4E2D\u4E3A\u4E86\u4FDD\u6301\u4E8B\u7269\u4E0D\u53D8\u548C\u9632\u6B62\u526F\u4F5C\u7528\u90FD\u8981\u505A\u51FA\u5DE8\u5927\u7684\u6539\u53D8\uFF08\u8FD9\u4E9B\u662F\u7EAF\u51FD\u6570\u5F0F\u7F16\u7A0B\u8BED\u8A00\u7684\u57FA\u7840\uFF09\uFF0C\u4F46\u5F53\u65F6\u5BF9\u4E8E\u4E3B\u6D41\u8BED\u8A00\u7684\u521B\u5EFA\u8005\u6765\u8BF4\u4F3C\u4E4E\u662F\u5947\u602A\u7684\u60F3\u6CD5\u3002\u6700\u521D\u7684 Java \u8BBE\u8BA1\u5E08\u8981\u4E48\u6CA1\u6709\u610F\u8BC6\u5230\u8FD9\u4E9B\u9009\u62E9\uFF0C\u8981\u4E48\u8BA4\u4E3A\u5B83\u4EEC\u592A\u4E0D\u540C\u4E86\uFF0C\u5E76\u4E14\u4F1A\u529D\u9000\u8BB8\u591A\u6F5C\u5728\u7684\u8BED\u8A00\u4F7F\u7528\u8005\u3002\u6211\u4EEC\u53EF\u4EE5\u6177\u6168\u5730\u8BF4\uFF0C\u8BED\u8A00\u8BBE\u8BA1\u793E\u533A\u5F53\u65F6\u6839\u672C\u6CA1\u6709\u8DB3\u591F\u7684\u7ECF\u9A8C\u6765\u7406\u89E3\u8C03\u6574\u5728\u7EBF\u7A0B\u5E93\u4E2D\u7684\u5F71\u54CD\u3002</p><p>Java \u5B9E\u9A8C\u544A\u8BC9\u6211\u4EEC\uFF0C\u7ED3\u679C\u662F\u6084\u7136\u707E\u96BE\u6027\u7684\u3002\u7A0B\u5E8F\u5458\u5F88\u5BB9\u6613\u9677\u5165\u8BA4\u4E3A Java \u7EBF\u7A0B\u5E76\u4E0D\u90A3\u4E48\u56F0\u96BE\u7684\u9677\u9631\u3002\u8868\u9762\u4E0A\u770B\u8D77\u6765\u6B63\u5E38\u5DE5\u4F5C\u7684\u7A0B\u5E8F\u5B9E\u9645\u4E0A\u5145\u6EE1\u4E86\u5FAE\u5999\u7684\u5E76\u53D1 bug\u3002</p><p>\u4E3A\u4E86\u83B7\u5F97\u6B63\u786E\u7684\u5E76\u53D1\u6027\uFF0C\u8BED\u8A00\u529F\u80FD\u5FC5\u987B\u4ECE\u5934\u5F00\u59CB\u8BBE\u8BA1\u5E76\u8003\u8651\u5E76\u53D1\u6027\u3002\u6728\u5DF2\u6210\u821F\uFF1BJava \u5C06\u4E0D\u518D\u662F\u4E3A\u5E76\u53D1\u800C\u8BBE\u8BA1\u7684\u8BED\u8A00\uFF0C\u800C\u53EA\u662F\u4E00\u79CD\u5141\u8BB8\u5E76\u53D1\u7684\u8BED\u8A00\u3002</p><p>\u5C3D\u7BA1\u6709\u8FD9\u4E9B\u57FA\u672C\u7684\u4E0D\u53EF\u4FEE\u590D\u7684\u7F3A\u9677\uFF0C\u4F46\u4EE4\u4EBA\u5370\u8C61\u6DF1\u523B\u7684\u662F\u5B83\u5DF2\u7ECF\u8D70\u4E86\u8FD9\u4E48\u8FDC\u3002Java \u7684\u540E\u7EED\u7248\u672C\u6DFB\u52A0\u4E86\u5E93\uFF0C\u4EE5\u4FBF\u5728\u4F7F\u7528\u5E76\u53D1\u65F6\u63D0\u5347\u62BD\u8C61\u7EA7\u522B\u3002\u4E8B\u5B9E\u4E0A\uFF0C\u6211\u6839\u672C\u4E0D\u4F1A\u60F3\u5230\u6709\u53EF\u80FD\u5728 Java 8 \u4E2D\u8FDB\u884C\u6539\u8FDB\uFF1A\u5E76\u884C\u6D41\u548C <strong>CompletableFutures</strong> - \u8FD9\u662F\u60CA\u4EBA\u7684\u53F2\u8BD7\u822C\u7684\u53D8\u5316\uFF0C\u6211\u4F1A\u60CA\u5947\u5730\u91CD\u590D\u7684\u67E5\u770B\u5B83[^3]\u3002</p><p>\u8FD9\u4E9B\u6539\u8FDB\u975E\u5E38\u6709\u7528\uFF0C\u6211\u4EEC\u5C06\u5728\u672C\u7AE0\u91CD\u70B9\u4ECB\u7ECD\u5E76\u884C\u6D41\u548C <strong>CompletableFutures</strong> \u3002\u867D\u7136\u5B83\u4EEC\u53EF\u4EE5\u5927\u5927\u7B80\u5316\u4F60\u5BF9\u5E76\u53D1\u548C\u540E\u7EED\u4EE3\u7801\u7684\u601D\u8003\u65B9\u5F0F\uFF0C\u4F46\u57FA\u672C\u95EE\u9898\u4ECD\u7136\u5B58\u5728\uFF1A\u7531\u4E8E Java \u7684\u539F\u59CB\u8BBE\u8BA1\uFF0C\u4EE3\u7801\u7684\u6240\u6709\u90E8\u5206\u4ECD\u7136\u5F88\u8106\u5F31\uFF0C\u4F60\u4ECD\u7136\u5FC5\u987B\u7406\u89E3\u8FD9\u4E9B\u590D\u6742\u548C\u5FAE\u5999\u7684\u95EE\u9898\u3002Java \u4E2D\u7684\u7EBF\u7A0B\u7EDD\u4E0D\u662F\u7B80\u5355\u6216\u5B89\u5168\u7684;\u90A3\u79CD\u7ECF\u5386\u5FC5\u987B\u964D\u7EA7\u4E3A\u53E6\u4E00\u79CD\u66F4\u65B0\u7684\u8BED\u8A00\u3002</p><h2 id="\u672C\u7AE0\u5176\u4F59\u90E8\u5206" tabindex="-1"><a class="header-anchor" href="#\u672C\u7AE0\u5176\u4F59\u90E8\u5206" aria-hidden="true">#</a> \u672C\u7AE0\u5176\u4F59\u90E8\u5206</h2>',110),r=n("\u8FD9\u662F\u6211\u4EEC\u5C06\u5728\u672C\u7AE0\u7684\u5176\u4F59\u90E8\u5206\u4ECB\u7ECD\u7684\u5185\u5BB9\u3002\u8BF7\u8BB0\u4F4F\uFF0C\u672C\u7AE0\u7684\u91CD\u70B9\u662F\u4F7F\u7528\u6700\u65B0\u7684\u9AD8\u7EA7 Java \u5E76\u53D1\u7ED3\u6784\u3002\u76F8\u6BD4\u4E8E\u65E7\u7684\u66FF\u4EE3\u54C1\uFF0C\u4F7F\u7528\u8FD9\u4E9B\u4F1A\u4F7F\u4F60\u7684\u751F\u6D3B\u66F4\u52A0\u8F7B\u677E\u3002\u4F46\u662F\uFF0C\u4F60\u4ECD\u4F1A\u5728\u9057\u7559\u4EE3\u7801\u4E2D\u9047\u5230\u4E00\u4E9B\u4F4E\u7EA7\u5DE5\u5177\u3002\u6709\u65F6\uFF0C\u4F60\u53EF\u80FD\u4F1A\u88AB\u8FEB\u81EA\u5DF1\u4F7F\u7528\u5176\u4E2D\u7684\u4E00\u4E9B\u3002\u9644\u5F55\uFF1A"),d=n("\u5E76\u53D1\u5E95\u5C42\u539F\u7406 "),v=n(" \u5305\u542B\u4E00\u4E9B\u66F4\u539F\u59CB\u7684 Java \u5E76\u53D1\u5143\u7D20\u7684\u4ECB\u7ECD\u3002"),m=e(`<ul><li>Parallel Streams\uFF08\u5E76\u884C\u6D41\uFF09 \u5230\u76EE\u524D\u4E3A\u6B62\uFF0C\u6211\u5DF2\u7ECF\u5F3A\u8C03\u4E86 Java 8 Streams \u63D0\u4F9B\u7684\u6539\u8FDB\u8BED\u6CD5\u3002\u73B0\u5728\u8BE5\u8BED\u6CD5\uFF08\u4F5C\u4E3A\u4E00\u4E2A\u7C89\u4E1D\uFF0C\u6211\u5E0C\u671B\uFF09\u4F1A\u4F7F\u4F60\u611F\u5230\u8212\u9002\uFF0C\u4F60\u53EF\u4EE5\u83B7\u5F97\u989D\u5916\u7684\u597D\u5904\uFF1A\u4F60\u53EF\u4EE5\u901A\u8FC7\u7B80\u5355\u5730\u5C06 parallel() \u6DFB\u52A0\u5230\u8868\u8FBE\u5F0F\u6765\u5E76\u884C\u5316\u6D41\u3002\u8FD9\u662F\u4E00\u79CD\u7B80\u5355\uFF0C\u5F3A\u5927\uFF0C\u5766\u7387\u5730\u8BF4\u662F\u5229\u7528\u591A\u5904\u7406\u5668\u7684\u60CA\u4EBA\u65B9\u5F0F</li></ul><p>\u6DFB\u52A0 parallel() \u6765\u63D0\u9AD8\u901F\u5EA6\u4F3C\u4E4E\u662F\u5FAE\u4E0D\u8DB3\u9053\u7684\uFF0C\u4F46\u662F\uFF0C\u5509\uFF0C\u5B83\u5C31\u50CF\u4F60\u521A\u521A\u5728<a href="#The-Brutal-Truth">\u6B8B\u9177\u7684\u771F\u76F8 </a> \u4E2D\u5B66\u5230\u7684\u90A3\u6837\u7B80\u5355\u3002\u6211\u5C06\u6F14\u793A\u5E76\u89E3\u91CA\u4E00\u4E9B\u76F2\u76EE\u6DFB\u52A0 parallel() \u5230 Stream \u8868\u8FBE\u5F0F\u7684\u7F3A\u9677\u3002</p><ul><li>\u521B\u5EFA\u548C\u8FD0\u884C\u4EFB\u52A1 \u4EFB\u52A1\u662F\u4E00\u6BB5\u53EF\u4EE5\u72EC\u7ACB\u8FD0\u884C\u7684\u4EE3\u7801\u3002\u4E3A\u4E86\u89E3\u91CA\u521B\u5EFA\u548C\u8FD0\u884C\u4EFB\u52A1\u7684\u4E00\u4E9B\u57FA\u7840\u77E5\u8BC6\uFF0C\u672C\u8282\u4ECB\u7ECD\u4E86\u4E00\u79CD\u6BD4\u5E76\u884C\u6D41\u6216 CompletableFutures \u66F4\u7B80\u5355\u7684\u673A\u5236\uFF1AExecutor\u3002\u6267\u884C\u8005\u7BA1\u7406\u4E00\u4E9B\u4F4E\u7EA7 Thread \u5BF9\u8C61\uFF08Java \u4E2D\u6700\u539F\u59CB\u7684\u5E76\u53D1\u5F62\u5F0F\uFF09\u3002\u4F60\u521B\u5EFA\u4E00\u4E2A\u4EFB\u52A1\uFF0C\u7136\u540E\u5C06\u5176\u4EA4\u7ED9 Executor \u53BB\u8FD0\u884C\u3002</li></ul><p>\u6709\u591A\u79CD\u7C7B\u578B\u7684 Executor \u7528\u4E8E\u4E0D\u540C\u7684\u76EE\u7684\u3002\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u5C06\u5C55\u793A\u89C4\u8303\u5F62\u5F0F\uFF0C\u4EE3\u8868\u521B\u5EFA\u548C\u8FD0\u884C\u4EFB\u52A1\u7684\u6700\u7B80\u5355\u548C\u6700\u4F73\u65B9\u6CD5\u3002</p><ul><li>\u7EC8\u6B62\u957F\u65F6\u95F4\u8FD0\u884C\u7684\u4EFB\u52A1 \u4EFB\u52A1\u72EC\u7ACB\u8FD0\u884C\uFF0C\u56E0\u6B64\u9700\u8981\u4E00\u79CD\u673A\u5236\u6765\u5173\u95ED\u5B83\u4EEC\u3002\u5178\u578B\u7684\u65B9\u6CD5\u4F7F\u7528\u4E86\u4E00\u4E2A\u6807\u5FD7\uFF0C\u8FD9\u5F15\u5165\u4E86\u5171\u4EAB\u5185\u5B58\u7684\u95EE\u9898\uFF0C\u6211\u4EEC\u5C06\u4F7F\u7528 Java \u7684\u201CAtomic\u201D\u5E93\u6765\u56DE\u907F\u5B83\u3002</li><li>Completable Futures \u5F53\u4F60\u5C06\u8863\u670D\u5E26\u5230\u5E72\u6D17\u5E97\u65F6\uFF0C\u4ED6\u4EEC\u4F1A\u7ED9\u4F60\u4E00\u5F20\u6536\u636E\u3002\u4F60\u7EE7\u7EED\u5B8C\u6210\u5176\u4ED6\u4EFB\u52A1\uFF0C\u5F53\u4F60\u7684\u8863\u670D\u6D17\u5E72\u51C0\u65F6\u4F60\u53EF\u4EE5\u628A\u5B83\u53D6\u8D70\u3002\u6536\u636E\u662F\u4F60\u4E0E\u5E72\u6D17\u5E97\u5728\u540E\u53F0\u6267\u884C\u7684\u4EFB\u52A1\u7684\u8FDE\u63A5\u3002\u8FD9\u662F Java 5 \u4E2D\u5F15\u5165\u7684 Future \u7684\u65B9\u6CD5\u3002</li></ul><p>Future \u6BD4\u4EE5\u524D\u7684\u65B9\u6CD5\u66F4\u65B9\u4FBF\uFF0C\u4F46\u4F60\u4ECD\u7136\u5FC5\u987B\u51FA\u73B0\u5E76\u7528\u6536\u636E\u53D6\u51FA\u5E72\u6D17\uFF0C\u5982\u679C\u4EFB\u52A1\u6CA1\u6709\u5B8C\u6210\u4F60\u8FD8\u9700\u8981\u7B49\u5F85\u3002\u5BF9\u4E8E\u4E00\u7CFB\u5217\u64CD\u4F5C\uFF0CFutures \u5E76\u6CA1\u6709\u771F\u6B63\u5E2E\u52A9\u90A3\u4E48\u591A\u3002</p><p>Java 8 CompletableFuture \u662F\u4E00\u4E2A\u66F4\u597D\u7684\u89E3\u51B3\u65B9\u6848\uFF1A\u5B83\u5141\u8BB8\u4F60\u5C06\u64CD\u4F5C\u94FE\u63A5\u5728\u4E00\u8D77\uFF0C\u56E0\u6B64\u4F60\u4E0D\u5FC5\u5C06\u4EE3\u7801\u5199\u5165\u63A5\u53E3\u6392\u5E8F\u64CD\u4F5C\u3002\u6709\u4E86 CompletableFuture \u5B8C\u7F8E\u7684\u7ED3\u5408\uFF0C\u5C31\u53EF\u4EE5\u66F4\u5BB9\u6613\u5730\u505A\u51FA\u201C\u91C7\u8D2D\u539F\u6599\uFF0C\u7EC4\u5408\u6210\u5206\uFF0C\u70F9\u996A\u98DF\u7269\uFF0C\u63D0\u4F9B\u98DF\u7269\uFF0C\u6536\u62FE\u9910\u5177\uFF0C\u50A8\u5B58\u9910\u5177\u201D\u7B49\u4E00\u7CFB\u5217\u94FE\u5F0F\u64CD\u4F5C\u3002</p><ul><li>\u6B7B\u9501 \u67D0\u4E9B\u4EFB\u52A1\u5FC5\u987B\u53BB<strong>\u7B49\u5F85 - \u963B\u585E</strong>\u6765\u83B7\u5F97\u5176\u4ED6\u4EFB\u52A1\u7684\u7ED3\u679C\u3002\u88AB\u963B\u6B62\u7684\u4EFB\u52A1\u6709\u53EF\u80FD\u7B49\u5F85\u53E6\u4E00\u4E2A\u88AB\u963B\u6B62\u7684\u4EFB\u52A1\uFF0C\u53E6\u4E00\u4E2A\u88AB\u963B\u6B62\u7684\u4EFB\u52A1\u4E5F\u5728\u7B49\u5F85\u5176\u4ED6\u4EFB\u52A1\uFF0C\u7B49\u7B49\u3002\u5982\u679C\u88AB\u963B\u6B62\u7684\u4EFB\u52A1\u94FE\u5FAA\u73AF\u5230\u7B2C\u4E00\u4E2A\uFF0C\u6CA1\u6709\u4EBA\u53EF\u4EE5\u53D6\u5F97\u4EFB\u4F55\u8FDB\u5C55\uFF0C\u4F60\u5C31\u4F1A\u9677\u5165\u6B7B\u9501\u3002</li></ul><p>\u5982\u679C\u5728\u8FD0\u884C\u7A0B\u5E8F\u65F6\u6CA1\u6709\u7ACB\u5373\u51FA\u73B0\u6B7B\u9501\uFF0C\u5219\u4F1A\u51FA\u73B0\u6700\u5927\u7684\u95EE\u9898\u3002\u4F60\u7684\u7CFB\u7EDF\u53EF\u80FD\u5BB9\u6613\u51FA\u73B0\u6B7B\u9501\uFF0C\u5E76\u4E14\u53EA\u4F1A\u5728\u67D0\u4E9B\u6761\u4EF6\u4E0B\u6B7B\u9501\u3002\u7A0B\u5E8F\u53EF\u80FD\u5728\u67D0\u4E2A\u5E73\u53F0\u4E0A\uFF08\u4F8B\u5982\u5728\u4F60\u7684\u5F00\u53D1\u673A\u5668\uFF09\u8FD0\u884C\u6B63\u5E38\uFF0C\u4F46\u662F\u5F53\u4F60\u5C06\u5176\u90E8\u7F72\u5230\u4E0D\u540C\u7684\u786C\u4EF6\u65F6\u4F1A\u5F00\u59CB\u6B7B\u9501\u3002</p><p>\u6B7B\u9501\u901A\u5E38\u6E90\u4E8E\u7EC6\u5FAE\u7684\u7F16\u7A0B\u9519\u8BEF;\u4E00\u7CFB\u5217\u65E0\u8F9C\u7684\u51B3\u5B9A\uFF0C\u6700\u7EC8\u610F\u5916\u5730\u521B\u5EFA\u4E86\u4E00\u4E2A\u4F9D\u8D56\u5FAA\u73AF\u3002\u672C\u8282\u5305\u542B\u4E00\u4E2A\u7ECF\u5178\u793A\u4F8B\uFF0C\u6F14\u793A\u4E86\u6B7B\u9501\u7684\u7279\u6027\u3002</p><ul><li>\u52AA\u529B\uFF0C\u590D\u6742\uFF0C\u6210\u672C</li></ul><p>\u6211\u4EEC\u5C06\u901A\u8FC7\u6A21\u62DF\u521B\u5EFA\u62AB\u8428\u7684\u8FC7\u7A0B\u5B8C\u6210\u672C\u7AE0\uFF0C\u9996\u5148\u4F7F\u7528\u5E76\u884C\u6D41\u5B9E\u73B0\u5B83\uFF0C\u7136\u540E\u662F CompletableFutures\u3002\u8FD9\u4E0D\u4EC5\u4EC5\u662F\u4E24\u79CD\u65B9\u6CD5\u7684\u6BD4\u8F83\uFF0C\u66F4\u91CD\u8981\u7684\u662F\u63A2\u7D22\u4F60\u5E94\u8BE5\u6295\u5165\u591A\u5C11\u5DE5\u4F5C\u6765\u4F7F\u4F60\u7684\u7A0B\u5E8F\u53D8\u5F97\u66F4\u5FEB\u3002</p><h2 id="\u5E76\u884C\u6D41" tabindex="-1"><a class="header-anchor" href="#\u5E76\u884C\u6D41" aria-hidden="true">#</a> \u5E76\u884C\u6D41</h2><p>Java 8 \u6D41\u7684\u4E00\u4E2A\u663E\u8457\u4F18\u70B9\u662F\uFF0C\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u5B83\u4EEC\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u5E76\u884C\u5316\u3002\u8FD9\u6765\u81EA\u5E93\u7684\u4ED4\u7EC6\u8BBE\u8BA1\uFF0C\u7279\u522B\u662F\u6D41\u4F7F\u7528\u5185\u90E8\u8FED\u4EE3\u7684\u65B9\u5F0F - \u4E5F\u5C31\u662F\u8BF4\uFF0C\u5B83\u4EEC\u63A7\u5236\u7740\u81EA\u5DF1\u7684\u8FED\u4EE3\u5668\u3002\u7279\u522B\u662F\uFF0C\u4ED6\u4EEC\u4F7F\u7528\u4E00\u79CD\u7279\u6B8A\u7684\u8FED\u4EE3\u5668\uFF0C\u79F0\u4E3A Spliterator\uFF0C\u5B83\u88AB\u9650\u5236\u4E3A\u6613\u4E8E\u81EA\u52A8\u5206\u5272\u3002\u6211\u4EEC\u53EA\u9700\u8981\u5FF5 <code>.parallel()</code> \u5C31\u4F1A\u4EA7\u751F\u9B54\u6CD5\u822C\u7684\u7ED3\u679C\uFF0C\u6D41\u4E2D\u7684\u6240\u6709\u5185\u5BB9\u90FD\u4F5C\u4E3A\u4E00\u7EC4\u5E76\u884C\u4EFB\u52A1\u8FD0\u884C\u3002\u5982\u679C\u4F60\u7684\u4EE3\u7801\u662F\u4F7F\u7528 Streams \u7F16\u5199\u7684\uFF0C\u90A3\u4E48\u5E76\u884C\u5316\u4EE5\u63D0\u9AD8\u901F\u5EA6\u4F3C\u4E4E\u662F\u4E00\u79CD\u7410\u4E8B</p><p>\u4F8B\u5982\uFF0C\u8003\u8651\u6765\u81EA Streams \u7684 Prime.java\u3002\u67E5\u627E\u8D28\u6570\u53EF\u80FD\u662F\u4E00\u4E2A\u8017\u65F6\u7684\u8FC7\u7A0B\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u8BE5\u7A0B\u5E8F\u7684\u8BA1\u65F6\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/ParallelPrime.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">LongStream</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParallelPrime</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> COUNT <span class="token operator">=</span> <span class="token number">100_000</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isPrime</span><span class="token punctuation">(</span><span class="token keyword">long</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noneMatch</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> n <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> primes <span class="token operator">=</span>
            <span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// [1]</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ParallelPrime</span><span class="token operator">::</span><span class="token function">isPrime</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>COUNT<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">toString</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;primes.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> primes<span class="token punctuation">,</span> <span class="token class-name">StandardOpenOption</span><span class="token punctuation">.</span>CREATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    Output:
    1224
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,18),b=n("\u8BF7\u6CE8\u610F\uFF0C\u8FD9\u4E0D\u662F\u5FAE\u57FA\u51C6\u6D4B\u8BD5\uFF0C\u56E0\u4E3A\u6211\u4EEC\u8BA1\u65F6\u6574\u4E2A\u7A0B\u5E8F\u3002\u6211\u4EEC\u5C06\u6570\u636E\u4FDD\u5B58\u5728\u78C1\u76D8\u4E0A\u4EE5\u9632\u6B62\u7F16\u8BD1\u5668\u8FC7\u6FC0\u7684\u4F18\u5316;\u5982\u679C\u6211\u4EEC\u6CA1\u6709\u5BF9\u7ED3\u679C\u505A\u4EFB\u4F55\u4E8B\u60C5\uFF0C\u90A3\u4E48\u4E00\u4E2A\u9AD8\u7EA7\u7684\u7F16\u8BD1\u5668\u53EF\u80FD\u4F1A\u89C2\u5BDF\u5230\u7A0B\u5E8F\u6CA1\u6709\u610F\u4E49\u5E76\u4E14\u7EC8\u6B62\u4E86\u8BA1\u7B97\uFF08\u8FD9\u4E0D\u592A\u53EF\u80FD\uFF0C\u4F46\u5E76\u975E\u4E0D\u53EF\u80FD\uFF09\u3002\u8BF7\u6CE8\u610F\u4F7F\u7528 nio2 \u5E93\u7F16\u5199\u6587\u4EF6\u7684\u7B80\u5355\u6027\uFF08\u5728"),g=n("\u6587\u4EF6 "),w=n(" \u4E00\u7AE0\u4E2D\u6709\u63CF\u8FF0\uFF09\u3002"),y=e(`<p>\u5F53\u6211\u6CE8\u91CA\u6389[1] parallel() \u884C\u65F6\uFF0C\u6211\u7684\u7ED3\u679C\u7528\u65F6\u5927\u7EA6\u662F parallel() \u7684\u4E09\u500D\u3002</p><p>\u5E76\u884C\u6D41\u4F3C\u4E4E\u662F\u4E00\u4E2A\u751C\u871C\u7684\u4EA4\u6613\u3002\u4F60\u6240\u9700\u8981\u505A\u7684\u5C31\u662F\u5C06\u7F16\u7A0B\u95EE\u9898\u8F6C\u6362\u4E3A\u6D41\uFF0C\u7136\u540E\u63D2\u5165 parallel() \u4EE5\u52A0\u5FEB\u901F\u5EA6\u3002\u5B9E\u9645\u4E0A\uFF0C\u6709\u65F6\u5019\u8FD9\u5F88\u5BB9\u6613\u3002\u4F46\u9057\u61BE\u7684\u662F\uFF0C\u6709\u8BB8\u591A\u9677\u9631\u3002</p><ul><li>parallel() \u4E0D\u662F\u7075\u4E39\u5999\u836F</li></ul><p>\u4F5C\u4E3A\u5BF9\u6D41\u548C\u5E76\u884C\u6D41\u7684\u4E0D\u786E\u5B9A\u6027\u7684\u63A2\u7D22\uFF0C\u8BA9\u6211\u4EEC\u770B\u4E00\u4E2A\u770B\u4F3C\u7B80\u5355\u7684\u95EE\u9898\uFF1A\u5BF9\u589E\u957F\u7684\u6570\u5B57\u5E8F\u5217\u8FDB\u884C\u6C42\u548C\u3002\u4E8B\u5B9E\u8BC1\u660E\u6709\u5927\u91CF\u7684\u65B9\u5F0F\u53BB\u5B9E\u73B0\u5B83\uFF0C\u5E76\u4E14\u6211\u5C06\u5192\u9669\u7528\u8BA1\u65F6\u5668\u5C06\u5B83\u4EEC\u8FDB\u884C\u6BD4\u8F83 - \u6211\u4F1A\u5C3D\u91CF\u5C0F\u5FC3\uFF0C\u4F46\u6211\u627F\u8BA4\u6211\u53EF\u80FD\u4F1A\u5728\u8BA1\u65F6\u4EE3\u7801\u6267\u884C\u65F6\u9047\u5230\u8BB8\u591A\u57FA\u672C\u9677\u9631\u4E4B\u4E00\u3002\u7ED3\u679C\u53EF\u80FD\u6709\u4E00\u4E9B\u7F3A\u9677\uFF08\u4F8B\u5982 JVM \u6CA1\u6709\u201C\u70ED\u8EAB\u201D\uFF09\uFF0C\u4F46\u6211\u8BA4\u4E3A\u5B83\u4ECD\u7136\u63D0\u4F9B\u4E86\u4E00\u4E9B\u6709\u7528\u7684\u6307\u793A\u3002</p><p>\u6211\u5C06\u4ECE\u4E00\u4E2A\u8BA1\u65F6\u65B9\u6CD5 <strong>timeTest()</strong> \u5F00\u59CB\uFF0C\u5B83\u91C7\u7528 <strong>LongSupplier</strong> \uFF0C\u6D4B\u91CF <strong>getAsLong()</strong> \u8C03\u7528\u7684\u957F\u5EA6\uFF0C\u5C06\u7ED3\u679C\u4E0E <strong>checkValue</strong> \u8FDB\u884C\u6BD4\u8F83\u5E76\u663E\u793A\u7ED3\u679C\u3002</p><p>\u8BF7\u6CE8\u610F\uFF0C\u4E00\u5207\u90FD\u5FC5\u987B\u4E25\u683C\u4F7F\u7528 <strong>long</strong> \uFF1B\u6211\u82B1\u4E86\u4E00\u4E9B\u65F6\u95F4\u53D1\u73B0\u9690\u853D\u7684\u6EA2\u51FA\uFF0C\u7136\u540E\u624D\u610F\u8BC6\u5230\u5728\u91CD\u8981\u7684\u5730\u65B9\u9519\u8FC7\u4E86 <strong>long</strong> \u3002</p><p>\u6240\u6709\u5173\u4E8E\u65F6\u95F4\u548C\u5185\u5B58\u7684\u6570\u5B57\u548C\u8BA8\u8BBA\u90FD\u662F\u6307\u201C\u6211\u7684\u673A\u5668\u201D\u3002\u4F60\u7684\u7ECF\u5386\u53EF\u80FD\u4F1A\u6709\u6240\u4E0D\u540C\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Summing.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Summing</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token keyword">long</span> checkValue<span class="token punctuation">,</span>    <span class="token class-name">LongSupplier</span> operation<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>id <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> result <span class="token operator">=</span> operation<span class="token punctuation">.</span><span class="token function">getAsLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> checkValue<span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;result: %d%ncheckValue: %d%n&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">,</span> checkValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SZ <span class="token operator">=</span> <span class="token number">100_000_000</span><span class="token punctuation">;</span>
    <span class="token comment">// This even works:</span>
    <span class="token comment">// public static final int SZ = 1_000_000_000;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> CHECK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>SZ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>SZ <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// Gauss&#39;s formula</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>CHECK<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Sum Stream&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">LongStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SZ<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Sum Stream Parallel&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">LongStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SZ<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Sum Iterated&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">LongStream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>SZ<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Slower &amp; runs out of memory above 1_000_000:</span>
        <span class="token comment">// timeTest(&quot;Sum Iterated Parallel&quot;, CHECK, () -&gt;</span>
        <span class="token comment">//   LongStream.iterate(0, i -&gt; i + 1)</span>
        <span class="token comment">//     .parallel()</span>
        <span class="token comment">//     .limit(SZ+1).sum());</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>5000000050000000
Sum Stream: 167ms
Sum Stream Parallel: 46ms
Sum Iterated: 284ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>CHECK</strong> \u503C\u662F\u4F7F\u7528 Carl Friedrich Gauss\uFF08\u9AD8\u65AF\uFF09\u5728 1700 \u5E74\u4EE3\u540E\u671F\u8FD8\u5728\u4E0A\u5C0F\u5B66\u7684\u65F6\u5019\u521B\u5EFA\u7684\u516C\u5F0F\u8BA1\u7B97\u51FA\u6765\u7684.</p><p><strong>main()</strong> \u7684\u7B2C\u4E00\u4E2A\u7248\u672C\u4F7F\u7528\u76F4\u63A5\u751F\u6210 <strong>Stream</strong> \u5E76\u8C03\u7528 <strong>sum()</strong> \u7684\u65B9\u6CD5\u3002\u6211\u4EEC\u770B\u5230\u6D41\u7684\u597D\u5904\u5728\u4E8E\u5373\u4F7F SZ \u4E3A\u5341\u4EBF\uFF081_000_000_000\uFF09\u7A0B\u5E8F\u4E5F\u53EF\u4EE5\u5F88\u597D\u5730\u5904\u7406\u800C\u6CA1\u6709\u6EA2\u51FA\uFF08\u4E3A\u4E86\u8BA9\u7A0B\u5E8F\u8FD0\u884C\u5F97\u5FEB\u4E00\u70B9\uFF0C\u6211\u4F7F\u7528\u4E86\u8F83\u5C0F\u7684\u6570\u5B57\uFF09\u3002\u4F7F\u7528 <strong>parallel()</strong> \u7684\u57FA\u672C\u8303\u56F4\u64CD\u4F5C\u660E\u663E\u66F4\u5FEB\u3002</p><p>\u5982\u679C\u4F7F\u7528 <strong>iterate()</strong> \u6765\u751F\u6210\u5E8F\u5217\uFF0C\u5219\u51CF\u901F\u662F\u76F8\u5F53\u660E\u663E\u7684\uFF0C\u53EF\u80FD\u662F\u56E0\u4E3A\u6BCF\u6B21\u751F\u6210\u6570\u5B57\u65F6\u90FD\u5FC5\u987B\u8C03\u7528 lambda\u3002\u4F46\u662F\u5982\u679C\u6211\u4EEC\u5C1D\u8BD5\u5E76\u884C\u5316\uFF0C\u5F53 <strong>SZ</strong> \u8D85\u8FC7\u4E00\u767E\u4E07\u65F6\uFF0C\u7ED3\u679C\u4E0D\u4EC5\u6BD4\u975E\u5E76\u884C\u7248\u672C\u82B1\u8D39\u7684\u65F6\u95F4\u66F4\u957F\uFF0C\u800C\u4E14\u4E5F\u4F1A\u8017\u5C3D\u5185\u5B58\uFF08\u5728\u67D0\u4E9B\u673A\u5668\u4E0A\uFF09\u3002\u5F53\u7136\uFF0C\u5F53\u4F60\u53EF\u4EE5\u4F7F\u7528 <strong>range()</strong> \u65F6\uFF0C\u4F60\u4E0D\u4F1A\u4F7F\u7528 <strong>iterate()</strong> \uFF0C\u4F46\u5982\u679C\u4F60\u751F\u6210\u7684\u4E1C\u897F\u4E0D\u662F\u7B80\u5355\u7684\u5E8F\u5217\uFF0C\u4F60\u5FC5\u987B\u4F7F\u7528 <strong>iterate()</strong> \u3002\u5E94\u7528 <strong>parallel()</strong> \u662F\u4E00\u4E2A\u5408\u7406\u7684\u5C1D\u8BD5\uFF0C\u4F46\u4F1A\u4EA7\u751F\u4EE4\u4EBA\u60CA\u8BB6\u7684\u7ED3\u679C\u3002\u6211\u4EEC\u5C06\u5728\u540E\u9762\u7684\u90E8\u5206\u4E2D\u63A2\u8BA8\u5185\u5B58\u9650\u5236\u7684\u539F\u56E0\uFF0C\u4F46\u6211\u4EEC\u53EF\u4EE5\u5BF9\u6D41\u5E76\u884C\u7B97\u6CD5\u8FDB\u884C\u521D\u6B65\u89C2\u5BDF\uFF1A</p><ul><li>\u6D41\u5E76\u884C\u6027\u5C06\u8F93\u5165\u6570\u636E\u5206\u6210\u591A\u4E2A\u90E8\u5206\uFF0C\u56E0\u6B64\u7B97\u6CD5\u53EF\u4EE5\u5E94\u7528\u4E8E\u90A3\u4E9B\u5355\u72EC\u7684\u90E8\u5206\u3002</li><li>\u6570\u7EC4\u5206\u5272\u6210\u672C\u4F4E\uFF0C\u5206\u5272\u5747\u5300\u4E14\u5BF9\u5206\u5272\u7684\u5927\u5C0F\u6709\u7740\u5B8C\u7F8E\u7684\u638C\u63A7\u3002</li><li>\u94FE\u8868\u6CA1\u6709\u8FD9\u4E9B\u5C5E\u6027;\u201C\u62C6\u5206\u201D\u4E00\u4E2A\u94FE\u8868\u4EC5\u4EC5\u610F\u5473\u7740\u628A\u5B83\u5206\u6210\u201C\u7B2C\u4E00\u5143\u7D20\u201D\u548C\u201C\u5176\u4F59\u5143\u7D20\u201D\uFF0C\u8FD9\u76F8\u5BF9\u65E0\u7528\u3002</li><li>\u65E0\u72B6\u6001\u751F\u6210\u5668\u7684\u884C\u4E3A\u7C7B\u4F3C\u4E8E\u6570\u7EC4;\u4E0A\u9762\u4F7F\u7528\u7684 <strong>range()</strong> \u5C31\u662F\u65E0\u72B6\u6001\u7684\u3002</li><li>\u8FED\u4EE3\u751F\u6210\u5668\u7684\u884C\u4E3A\u7C7B\u4F3C\u4E8E\u94FE\u8868; <strong>iterate()</strong> \u662F\u4E00\u4E2A\u8FED\u4EE3\u751F\u6210\u5668\u3002</li></ul><p>\u73B0\u5728\u8BA9\u6211\u4EEC\u5C1D\u8BD5\u901A\u8FC7\u5728\u6570\u7EC4\u4E2D\u586B\u5145\u503C\u5E76\u5BF9\u6570\u7EC4\u6C42\u548C\u6765\u89E3\u51B3\u95EE\u9898\u3002\u56E0\u4E3A\u6570\u7EC4\u53EA\u5206\u914D\u4E86\u4E00\u6B21\uFF0C\u6240\u4EE5\u6211\u4EEC\u4E0D\u592A\u53EF\u80FD\u9047\u5230\u5783\u573E\u6536\u96C6\u65F6\u5E8F\u95EE\u9898\u3002</p><p>\u9996\u5148\u6211\u4EEC\u5C06\u5C1D\u8BD5\u4E00\u4E2A\u5145\u6EE1\u539F\u59CB <strong>long</strong> \u7684\u6570\u7EC4\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Summing2.java</span>
<span class="token comment">// {ExcludeFromTravisCI}import java.util.*;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Summing2</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">basicSum</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ia<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> ia<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            sum <span class="token operator">+=</span> ia<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Approximate largest value of SZ before</span>
    <span class="token comment">// running out of memory on mymachine:</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SZ <span class="token operator">=</span> <span class="token number">20_000_000</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> CHECK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>SZ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>SZ <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>CHECK<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> la <span class="token operator">=</span> newlong<span class="token punctuation">[</span>SZ<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">parallelSetAll</span><span class="token punctuation">(</span>la<span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Summing</span><span class="token punctuation">.</span><span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Array Stream Sum&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>la<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Summing</span><span class="token punctuation">.</span><span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Parallel&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>la<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Summing</span><span class="token punctuation">.</span><span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Basic Sum&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token function">basicSum</span><span class="token punctuation">(</span>la<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Destructive summation:</span>
        <span class="token class-name">Summing</span><span class="token punctuation">.</span><span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;parallelPrefix&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">parallelPrefix</span><span class="token punctuation">(</span>la<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> la<span class="token punctuation">[</span>la<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>200000010000000
Array Stream
Sum: 104ms
Parallel: 81ms
Basic Sum: 106ms
parallelPrefix: 265ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7B2C\u4E00\u4E2A\u9650\u5236\u662F\u5185\u5B58\u5927\u5C0F\uFF1B\u56E0\u4E3A\u6570\u7EC4\u662F\u9884\u5148\u5206\u914D\u7684\uFF0C\u6240\u4EE5\u6211\u4EEC\u4E0D\u80FD\u521B\u5EFA\u51E0\u4E4E\u4E0E\u4EE5\u524D\u7248\u672C\u4E00\u6837\u5927\u7684\u4EFB\u4F55\u4E1C\u897F\u3002\u5E76\u884C\u5316\u53EF\u4EE5\u52A0\u5FEB\u901F\u5EA6\uFF0C\u751A\u81F3\u6BD4\u4F7F\u7528 <strong>basicSum()</strong> \u5FAA\u73AF\u66F4\u5FEB\u3002\u6709\u8DA3\u7684\u662F\uFF0C <strong>Arrays.parallelPrefix()</strong> \u4F3C\u4E4E\u5B9E\u9645\u4E0A\u51CF\u6162\u4E86\u901F\u5EA6\u3002\u4F46\u662F\uFF0C\u8FD9\u4E9B\u6280\u672F\u4E2D\u7684\u4EFB\u4F55\u4E00\u79CD\u5728\u5176\u4ED6\u6761\u4EF6\u4E0B\u90FD\u53EF\u80FD\u66F4\u6709\u7528 - \u8FD9\u5C31\u662F\u4E3A\u4EC0\u4E48\u4F60\u4E0D\u80FD\u505A\u51FA\u4EFB\u4F55\u786E\u5B9A\u6027\u7684\u58F0\u660E\uFF0C\u9664\u4E86\u201C\u4F60\u5FC5\u987B\u5C1D\u8BD5\u4E00\u4E0B\u201D\u3002</p><p>\u6700\u540E\uFF0C\u8003\u8651\u4F7F\u7528\u5305\u88C5\u7C7B <strong>Long</strong> \u7684\u6548\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Summing3.java</span>
<span class="token comment">// {ExcludeFromTravisCI}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Summing3</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">basicSum</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ia<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> ia<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            sum <span class="token operator">+=</span> ia<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Approximate largest value of SZ before</span>
    <span class="token comment">// running out of memory on my machine:</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SZ <span class="token operator">=</span> <span class="token number">10_000_000</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> CHECK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>SZ <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>SZ <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>CHECK<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aL <span class="token operator">=</span> newLong<span class="token punctuation">[</span>SZ<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">parallelSetAll</span><span class="token punctuation">(</span>aL<span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Summing</span><span class="token punctuation">.</span><span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Long Array Stream Reduce&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>aL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Summing</span><span class="token punctuation">.</span><span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Long Basic Sum&quot;</span><span class="token punctuation">,</span> CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token function">basicSum</span><span class="token punctuation">(</span>aL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Destructive summation:</span>
        <span class="token class-name">Summing</span><span class="token punctuation">.</span><span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Long parallelPrefix&quot;</span><span class="token punctuation">,</span>CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">parallelPrefix</span><span class="token punctuation">(</span>aL<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> aL<span class="token punctuation">[</span>aL<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>50000005000000
Long Array
Stream Reduce: 1038ms
Long Basic
Sum: 21ms
Long parallelPrefix: 3616ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u73B0\u5728\u53EF\u7528\u7684\u5185\u5B58\u91CF\u5927\u7EA6\u51CF\u534A\uFF0C\u5E76\u4E14\u6240\u6709\u60C5\u51B5\u4E0B\u6240\u9700\u7684\u65F6\u95F4\u90FD\u4F1A\u5F88\u957F\uFF0C\u9664\u4E86 <strong>basicSum()</strong> \uFF0C\u5B83\u53EA\u662F\u5FAA\u73AF\u904D\u5386\u6570\u7EC4\u3002\u4EE4\u4EBA\u60CA\u8BB6\u7684\u662F\uFF0C <strong>Arrays.parallelPrefix()</strong> \u6BD4\u4EFB\u4F55\u5176\u4ED6\u65B9\u6CD5\u90FD\u8981\u82B1\u8D39\u66F4\u957F\u7684\u65F6\u95F4\u3002</p><p>\u6211\u5C06 <strong>parallel()</strong> \u7248\u672C\u5206\u5F00\u4E86\uFF0C\u56E0\u4E3A\u5728\u4E0A\u9762\u7684\u7A0B\u5E8F\u4E2D\u8FD0\u884C\u5B83\u5BFC\u81F4\u4E86\u4E00\u4E2A\u5197\u957F\u7684\u5783\u573E\u6536\u96C6\uFF0C\u626D\u66F2\u4E86\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Summing4.java</span>
<span class="token comment">// {ExcludeFromTravisCI}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Summing4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Summing3</span><span class="token punctuation">.</span>CHECK<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aL <span class="token operator">=</span> newLong<span class="token punctuation">[</span><span class="token class-name">Summing3</span><span class="token punctuation">.</span>SZ<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">parallelSetAll</span><span class="token punctuation">(</span>aL<span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Summing</span><span class="token punctuation">.</span><span class="token function">timeTest</span><span class="token punctuation">(</span><span class="token string">&quot;Long Parallel&quot;</span><span class="token punctuation">,</span>
        <span class="token class-name">Summing3</span><span class="token punctuation">.</span>CHECK<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>aL<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>50000005000000
Long Parallel: 1014ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B83\u6BD4\u975E parallel() \u7248\u672C\u7565\u5FEB\uFF0C\u4F46\u5E76\u4E0D\u663E\u7740\u3002</p><p>\u5BFC\u81F4\u65F6\u95F4\u589E\u52A0\u7684\u4E00\u4E2A\u91CD\u8981\u539F\u56E0\u662F\u5904\u7406\u5668\u5185\u5B58\u7F13\u5B58\u3002\u4F7F\u7528 <strong>Summing2.java</strong> \u4E2D\u7684\u539F\u59CB <strong>long</strong> \uFF0C\u6570\u7EC4 <strong>la</strong> \u662F\u8FDE\u7EED\u7684\u5185\u5B58\u3002\u5904\u7406\u5668\u53EF\u4EE5\u66F4\u5BB9\u6613\u5730\u9884\u6D4B\u8BE5\u9635\u5217\u7684\u4F7F\u7528\uFF0C\u5E76\u4F7F\u7F13\u5B58\u5145\u6EE1\u4E0B\u4E00\u4E2A\u9700\u8981\u7684\u9635\u5217\u5143\u7D20\u3002\u8BBF\u95EE\u7F13\u5B58\u6BD4\u8BBF\u95EE\u4E3B\u5185\u5B58\u5FEB\u5F97\u591A\u3002\u4F3C\u4E4E <strong>Long parallelPrefix</strong> \u8BA1\u7B97\u53D7\u5230\u5F71\u54CD\uFF0C\u56E0\u4E3A\u5B83\u4E3A\u6BCF\u4E2A\u8BA1\u7B97\u8BFB\u53D6\u4E24\u4E2A\u6570\u7EC4\u5143\u7D20\uFF0C\u5E76\u5C06\u7ED3\u679C\u5199\u56DE\u5230\u6570\u7EC4\u4E2D\uFF0C\u5E76\u4E14\u6BCF\u4E2A\u90FD\u4E3A <strong>Long</strong> \u751F\u6210\u4E00\u4E2A\u8D85\u51FA\u7F13\u5B58\u7684\u5F15\u7528\u3002</p><p>\u4F7F\u7528 <strong>Summing3.java</strong> \u548C <strong>Summing4.java</strong> \uFF0C<strong>aL</strong> \u662F\u4E00\u4E2A <strong>Long</strong> \u6570\u7EC4\uFF0C\u5B83\u4E0D\u662F\u4E00\u4E2A\u8FDE\u7EED\u7684\u6570\u636E\u6570\u7EC4\uFF0C\u800C\u662F\u4E00\u4E2A\u8FDE\u7EED\u7684 <strong>Long</strong> \u5BF9\u8C61\u5F15\u7528\u6570\u7EC4\u3002\u5C3D\u7BA1\u8BE5\u6570\u7EC4\u53EF\u80FD\u4F1A\u5728\u7F13\u5B58\u4E2D\u51FA\u73B0\uFF0C\u4F46\u6307\u5411\u7684\u5BF9\u8C61\u51E0\u4E4E\u603B\u662F\u4E0D\u5728\u7F13\u5B58\u4E2D\u3002</p><p>\u8FD9\u4E9B\u793A\u4F8B\u4F7F\u7528\u4E0D\u540C\u7684 SZ \u503C\u6765\u663E\u793A\u5185\u5B58\u9650\u5236\u3002</p><p>\u4E3A\u4E86\u8FDB\u884C\u65F6\u95F4\u6BD4\u8F83\uFF0C\u4EE5\u4E0B\u662F SZ \u8BBE\u7F6E\u4E3A\u6700\u5C0F\u503C 1000 \u4E07\u7684\u7ED3\u679C\uFF1A</p><p><strong>Sum Stream: 69msSum Stream Parallel: 18msSum Iterated: 277ms Array Stream Sum: 57ms Parallel: 14ms Basic Sum: 16ms parallelPrefix: 28ms Long Array Stream Reduce: 1046ms Long Basic Sum: 21ms Long parallelPrefix: 3287ms Long Parallel: 1008ms</strong></p><p>\u867D\u7136 Java 8 \u7684\u5404\u79CD\u5185\u7F6E\u201C\u5E76\u884C\u201D\u5DE5\u5177\u975E\u5E38\u68D2\uFF0C\u4F46\u6211\u8BA4\u4E3A\u5B83\u4EEC\u88AB\u89C6\u4E3A\u795E\u5947\u7684\u7075\u4E39\u5999\u836F\uFF1A\u201C\u53EA\u9700\u6DFB\u52A0 parallel() \u5E76\u4E14\u5B83\u4F1A\u66F4\u5FEB\uFF01\u201D \u6211\u5E0C\u671B\u6211\u5DF2\u7ECF\u5F00\u59CB\u8868\u660E\u60C5\u51B5\u5E76\u975E\u6240\u6709\u90FD\u662F\u5982\u6B64\uFF0C\u5E76\u4E14\u76F2\u76EE\u5730\u5E94\u7528\u5185\u7F6E\u7684\u201C\u5E76\u884C\u201D\u64CD\u4F5C\u6709\u65F6\u751A\u81F3\u4F1A\u4F7F\u8FD0\u884C\u901F\u5EA6\u660E\u663E\u53D8\u6162\u3002</p><ul><li>parallel()/limit() \u4EA4\u70B9</li></ul><p>\u4F7F\u7528 <strong>parallel()</strong> \u65F6\u4F1A\u6709\u66F4\u590D\u6742\u7684\u95EE\u9898\u3002\u4ECE\u5176\u4ED6\u8BED\u8A00\u4E2D\u5438\u53D6\u7684\u6D41\u673A\u5236\u88AB\u8BBE\u8BA1\u4E3A\u5927\u7EA6\u662F\u4E00\u4E2A\u65E0\u9650\u7684\u6D41\u6A21\u578B\u3002\u5982\u679C\u4F60\u62E5\u6709\u6709\u9650\u6570\u91CF\u7684\u5143\u7D20\uFF0C\u5219\u53EF\u4EE5\u4F7F\u7528\u96C6\u5408\u4EE5\u53CA\u4E3A\u6709\u9650\u5927\u5C0F\u7684\u96C6\u5408\u8BBE\u8BA1\u7684\u5173\u8054\u7B97\u6CD5\u3002\u5982\u679C\u4F60\u4F7F\u7528\u65E0\u9650\u6D41\uFF0C\u5219\u4F7F\u7528\u9488\u5BF9\u6D41\u4F18\u5316\u7684\u7B97\u6CD5\u3002</p><p>Java 8 \u5C06\u4E24\u8005\u5408\u5E76\u8D77\u6765\u3002\u4F8B\u5982\uFF0C<strong>Collections</strong> \u6CA1\u6709\u5185\u7F6E\u7684 <strong>map()</strong> \u64CD\u4F5C\u3002\u5728 <strong>Collection</strong> \u548C <strong>Map</strong> \u4E2D\u552F\u4E00\u7C7B\u4F3C\u6D41\u7684\u6279\u5904\u7406\u64CD\u4F5C\u662F <strong>forEach()</strong> \u3002\u5982\u679C\u8981\u6267\u884C <strong>map()</strong> \u548C <strong>reduce()</strong> \u7B49\u64CD\u4F5C\uFF0C\u5FC5\u987B\u9996\u5148\u5C06 <strong>Collection</strong> \u8F6C\u6362\u4E3A\u5B58\u5728\u8FD9\u4E9B\u64CD\u4F5C\u7684 <strong>Stream</strong> :</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CollectionIntoStream.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CollectionIntoStream</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> strings <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Rand<span class="token punctuation">.</span>String</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    strings<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Convert to a Stream for many more options:</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>btpen
pccux
szgvg
meinn
eeloz
tdvew
cippc
ygpoa
lkljl
bynxt
:PENCUXGVGINNLOZVEWPPCPOALJLNXT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Collection</strong> \u786E\u5B9E\u6709\u4E00\u4E9B\u6279\u5904\u7406\u64CD\u4F5C\uFF0C\u5982 <strong>removeAll()</strong> \uFF0C<strong>removeIf()</strong> \u548C <strong>retainAll()</strong> \uFF0C\u4F46\u8FD9\u4E9B\u90FD\u662F\u7834\u574F\u6027\u7684\u64CD\u4F5C\u3002<strong>ConcurrentHashMap</strong> \u5BF9 <strong>forEach</strong> \u548C <strong>reduce</strong> \u64CD\u4F5C\u6709\u7279\u522B\u5E7F\u6CDB\u7684\u652F\u6301\u3002</p><p>\u5728\u8BB8\u591A\u60C5\u51B5\u4E0B\uFF0C\u53EA\u5728\u96C6\u5408\u4E0A\u8C03\u7528 <strong>stream()</strong> \u6216\u8005 <strong>parallelStream()</strong> \u6CA1\u6709\u95EE\u9898\u3002\u4F46\u662F\uFF0C\u6709\u65F6\u5C06 <strong>Stream</strong> \u4E0E <strong>Collection</strong> \u6DF7\u5408\u4F1A\u4EA7\u751F\u610F\u60F3\u4E0D\u5230\u7684\u7ED3\u679C\u3002\u8FD9\u662F\u4E00\u4E2A\u6709\u8DA3\u7684\u96BE\u9898\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/ParallelStreamPuzzle.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParallelStreamPuzzle</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IntGenerator</span>
    <span class="token keyword">implements</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> current<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> x <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IntGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// [1]</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* Output:
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C[1] \u6CE8\u91CA\u8FD0\u884C\u5B83\uFF0C\u5B83\u4F1A\u4EA7\u751F\u9884\u671F\u7684\uFF1A <strong>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</strong> \u6BCF\u6B21\u3002\u4F46\u662F\u5305\u542B\u4E86 parallel()\uFF0C\u5B83\u770B\u8D77\u6765\u50CF\u4E00\u4E2A\u968F\u673A\u6570\u751F\u6210\u5668\uFF0C\u5E26\u6709\u8F93\u51FA\uFF08\u4ECE\u4E00\u6B21\u8FD0\u884C\u5230\u4E0B\u4E00\u6B21\u8FD0\u884C\u4E0D\u540C\uFF09\uFF0C\u5982\uFF1A <strong>[0, 3, 6, 8, 11, 14, 17, 20, 23, 26]</strong> \u8FD9\u6837\u4E00\u4E2A\u7B80\u5355\u7684\u7A0B\u5E8F\u600E\u4E48\u4F1A\u5982\u6B64\u7CDF\u7CD5\u5462\uFF1F\u8BA9\u6211\u4EEC\u8003\u8651\u4E00\u4E0B\u6211\u4EEC\u5728\u8FD9\u91CC\u8981\u5B9E\u73B0\u7684\u76EE\u6807\uFF1A\u201C\u5E76\u884C\u751F\u6210\u3002\u201D\u90A3\u610F\u5473\u7740\u4EC0\u4E48\uFF1F\u4E00\u5806\u7EBF\u7A0B\u90FD\u5728\u4ECE\u4E00\u4E2A\u751F\u6210\u5668\u53D6\u503C\uFF0C\u7136\u540E\u4EE5\u67D0\u79CD\u65B9\u5F0F\u9009\u62E9\u6709\u9650\u7684\u7ED3\u679C\u96C6\uFF1F\u4EE3\u7801\u770B\u8D77\u6765\u5F88\u7B80\u5355\uFF0C\u4F46\u5B83\u53D8\u6210\u4E86\u4E00\u4E2A\u7279\u522B\u68D8\u624B\u7684\u95EE\u9898\u3002</p><p>\u4E3A\u4E86\u770B\u5230\u5B83\uFF0C\u6211\u4EEC\u5C06\u6DFB\u52A0\u4E00\u4E9B\u4EEA\u5668\u3002\u7531\u4E8E\u6211\u4EEC\u6B63\u5728\u5904\u7406\u7EBF\u7A0B\uFF0C\u56E0\u6B64\u6211\u4EEC\u5FC5\u987B\u5C06\u4EFB\u4F55\u8DDF\u8E2A\u4FE1\u606F\u6355\u83B7\u5230\u5E76\u53D1\u6570\u636E\u7ED3\u6784\u4E2D\u3002\u5728\u8FD9\u91CC\u6211\u4F7F\u7528 <strong>ConcurrentLinkedDeque</strong> \uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/ParallelStreamPuzzle2.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParallelStreamPuzzle2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> TRACE <span class="token operator">=</span>
    <span class="token keyword">new</span> <span class="token class-name">ConcurrentLinkedDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span>
    <span class="token class-name">IntGenerator</span> <span class="token keyword">implements</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> current <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            TRACE<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> current<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> x <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token function">newIntGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;PSP2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TRACE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>current \u662F\u4F7F\u7528\u7EBF\u7A0B\u5B89\u5168\u7684 <strong>AtomicInteger</strong> \u7C7B\u5B9A\u4E49\u7684\uFF0C\u53EF\u4EE5\u9632\u6B62\u7ADE\u4E89\u6761\u4EF6\uFF1B<strong>parallel()</strong> \u5141\u8BB8\u591A\u4E2A\u7EBF\u7A0B\u8C03\u7528 <strong>get()</strong> \u3002</p><p>\u5728\u67E5\u770B <strong>PSP2.txt</strong> .<strong>IntGenerator.get()</strong> \u88AB\u8C03\u7528 1024 \u6B21\u65F6\uFF0C\u4F60\u53EF\u80FD\u4F1A\u611F\u5230\u60CA\u8BB6\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>0: main
1: ForkJoinPool.commonPool-worker-1
2: ForkJoinPool.commonPool-worker-2
3: ForkJoinPool.commonPool-worker-2
4: ForkJoinPool.commonPool-worker-1
5: ForkJoinPool.commonPool-worker-1
6: ForkJoinPool.commonPool-worker-1
7: ForkJoinPool.commonPool-worker-1
8: ForkJoinPool.commonPool-worker-4
9: ForkJoinPool.commonPool-worker-4
10: ForkJoinPool.commonPool-worker-4
11: main
12: main
13: main
14: main
15: main...10
17: ForkJoinPool.commonPool-worker-110
18: ForkJoinPool.commonPool-worker-610
19: ForkJoinPool.commonPool-worker-610
20: ForkJoinPool.commonPool-worker-110
21: ForkJoinPool.commonPool-worker-110
22: ForkJoinPool.commonPool-worker-110
23: ForkJoinPool.commonPool-worker-1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E2A\u5757\u5927\u5C0F\u4F3C\u4E4E\u662F\u5185\u90E8\u5B9E\u73B0\u7684\u4E00\u90E8\u5206\uFF08\u5C1D\u8BD5\u4F7F\u7528<code>limit()</code> \u7684\u4E0D\u540C\u53C2\u6570\u6765\u67E5\u770B\u4E0D\u540C\u7684\u5757\u5927\u5C0F\uFF09\u3002\u5C06<code>parallel()</code>\u4E0E<code>limit()</code>\u7ED3\u5408\u4F7F\u7528\u53EF\u4EE5\u9884\u53D6\u4E00\u4E32\u503C\uFF0C\u4F5C\u4E3A\u6D41\u8F93\u51FA\u3002</p><p>\u8BD5\u7740\u60F3\u8C61\u4E00\u4E0B\u8FD9\u91CC\u53D1\u751F\u4E86\u4EC0\u4E48\uFF1A\u4E00\u4E2A\u6D41\u62BD\u8C61\u51FA\u65E0\u9650\u5E8F\u5217\uFF0C\u6309\u9700\u751F\u6210\u3002\u5F53\u4F60\u8981\u6C42\u5B83\u5E76\u884C\u4EA7\u751F\u6D41\u65F6\uFF0C\u4F60\u8981\u6C42\u6240\u6709\u8FD9\u4E9B\u7EBF\u7A0B\u5C3D\u53EF\u80FD\u5730\u8C03\u7528<code>get()</code>\u3002\u6DFB\u52A0<code>limit()</code>\uFF0C\u4F60\u8BF4\u201C\u53EA\u9700\u8981\u8FD9\u4E9B\u3002\u201D\u57FA\u672C\u4E0A\uFF0C\u5F53\u4F60\u4E3A\u4E86\u968F\u673A\u8F93\u51FA\u800C\u9009\u62E9\u5C06<code>parallel()</code>\u4E0E<code>limit()</code>\u7ED3\u5408\u4F7F\u7528\u65F6\uFF0C\u8FD9\u79CD\u65B9\u6CD5\u53EF\u80FD\u5BF9\u4F60\u6B63\u5728\u89E3\u51B3\u7684\u95EE\u9898\u6709\u6548\u3002\u4F46\u662F\u5F53\u4F60\u8FD9\u6837\u505A\u65F6\uFF0C\u4F60\u5FC5\u987B\u660E\u767D\u3002\u8FD9\u662F\u4E00\u4E2A\u4EC5\u9650\u4E13\u5BB6\u7684\u529F\u80FD\uFF0C\u800C\u4E0D\u662F\u8981\u4E89\u8FA9\u8BF4\u201CJava \u5F04\u9519\u4E86\u201D\u3002</p><p>\u4EC0\u4E48\u662F\u66F4\u5408\u7406\u7684\u65B9\u6CD5\u6765\u89E3\u51B3\u95EE\u9898\uFF1F\u597D\u5427\uFF0C\u5982\u679C\u4F60\u60F3\u751F\u6210\u4E00\u4E2A int \u6D41\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528 IntStream.range()\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/ParallelStreamPuzzle3.java</span>
<span class="token comment">// {VisuallyInspectOutput}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParallelStreamPuzzle3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> x <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>8: main
6: ForkJoinPool.commonPool-worker-5
3: ForkJoinPool.commonPool-worker-7
5: ForkJoinPool.commonPool-worker-5
1: ForkJoinPool.commonPool-worker-3
2: ForkJoinPool.commonPool-worker-6
4: ForkJoinPool.commonPool-worker-1
0: ForkJoinPool.commonPool-worker-4
7: ForkJoinPool.commonPool-worker-1
9: ForkJoinPool.commonPool-worker-2
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3A\u4E86\u8868\u660E <strong>parallel()</strong> \u786E\u5B9E\u6709\u6548\uFF0C\u6211\u6DFB\u52A0\u4E86\u4E00\u4E2A\u5BF9 <strong>peek()</strong> \u7684\u8C03\u7528\uFF0C\u8FD9\u662F\u4E00\u4E2A\u4E3B\u8981\u7528\u4E8E\u8C03\u8BD5\u7684\u6D41\u51FD\u6570\uFF1A\u5B83\u4ECE\u6D41\u4E2D\u63D0\u53D6\u4E00\u4E2A\u503C\u5E76\u6267\u884C\u67D0\u4E9B\u64CD\u4F5C\u4F46\u4E0D\u5F71\u54CD\u4ECE\u6D41\u5411\u4E0B\u4F20\u9012\u7684\u5143\u7D20\u3002\u6CE8\u610F\u8FD9\u4F1A\u5E72\u6270\u7EBF\u7A0B\u884C\u4E3A\uFF0C\u4F46\u6211\u53EA\u662F\u5C1D\u8BD5\u5728\u8FD9\u91CC\u505A\u4E00\u4E9B\u4E8B\u60C5\uFF0C\u800C\u4E0D\u662F\u5B9E\u9645\u8C03\u8BD5\u4EFB\u4F55\u4E1C\u897F\u3002</p><p>\u4F60\u8FD8\u53EF\u4EE5\u770B\u5230 <strong>boxed()</strong> \u7684\u6DFB\u52A0\uFF0C\u5B83\u63A5\u53D7 <strong>int</strong> \u6D41\u5E76\u5C06\u5176\u8F6C\u6362\u4E3A <strong>Integer</strong> \u6D41\u3002</p><p>\u73B0\u5728\u6211\u4EEC\u5F97\u5230\u591A\u4E2A\u7EBF\u7A0B\u4EA7\u751F\u4E0D\u540C\u7684\u503C\uFF0C\u4F46\u5B83\u53EA\u4EA7\u751F 10 \u4E2A\u8BF7\u6C42\u7684\u503C\uFF0C\u800C\u4E0D\u662F 1024 \u4E2A\u4EA7\u751F 10 \u4E2A\u503C\u3002</p><p>\u5B83\u66F4\u5FEB\u5417\uFF1F\u4E00\u4E2A\u66F4\u597D\u7684\u95EE\u9898\u662F\uFF1A\u4EC0\u4E48\u65F6\u5019\u5F00\u59CB\u6709\u610F\u4E49\uFF1F\u5F53\u7136\u4E0D\u662F\u8FD9\u4E48\u5C0F\u7684\u4E00\u5957\uFF1B\u4E0A\u4E0B\u6587\u5207\u6362\u7684\u4EE3\u4EF7\u8FDC\u8FDC\u8D85\u8FC7\u5E76\u884C\u6027\u7684\u4EFB\u4F55\u52A0\u901F\u3002\u5F88\u96BE\u60F3\u8C61\u4EC0\u4E48\u65F6\u5019\u7528\u5E76\u884C\u751F\u6210\u4E00\u4E2A\u7B80\u5355\u7684\u6570\u5B57\u5E8F\u5217\u4F1A\u6709\u610F\u4E49\u3002\u5982\u679C\u4F60\u8981\u751F\u6210\u7684\u4E1C\u897F\u9700\u8981\u5F88\u9AD8\u7684\u6210\u672C\uFF0C\u5B83\u53EF\u80FD\u6709\u610F\u4E49 - \u4F46\u8FD9\u90FD\u662F\u731C\u6D4B\u3002\u53EA\u6709\u901A\u8FC7\u6D4B\u8BD5\u6211\u4EEC\u624D\u80FD\u77E5\u9053\u7528\u5E76\u884C\u662F\u5426\u6709\u6548\u3002\u8BB0\u4F4F\u8FD9\u53E5\u683C\u8A00\uFF1A\u201C\u9996\u5148\u4F7F\u5B83\u5DE5\u4F5C\uFF0C\u7136\u540E\u4F7F\u5B83\u66F4\u5FEB\u5730\u5DE5\u4F5C - \u53EA\u6709\u5F53\u4F60\u5FC5\u987B\u8FD9\u6837\u505A\u65F6\u3002\u201D\u5C06 <strong>parallel()</strong> \u548C <strong>limit()</strong> \u7ED3\u5408\u4F7F\u7528\u4EC5\u4F9B\u4E13\u5BB6\u64CD\u4F5C\uFF08\u628A\u8BDD\u8BF4\u5728\u524D\u9762\uFF0C\u6211\u4E0D\u8BA4\u4E3A\u81EA\u5DF1\u662F\u8FD9\u91CC\u7684\u4E13\u5BB6\uFF09\u3002</p><ul><li>\u5E76\u884C\u6D41\u53EA\u770B\u8D77\u6765\u5F88\u5BB9\u6613</li></ul><p>\u5B9E\u9645\u4E0A\uFF0C\u5728\u8BB8\u591A\u60C5\u51B5\u4E0B\uFF0C\u5E76\u884C\u6D41\u786E\u5B9E\u53EF\u4EE5\u6BEB\u4E0D\u8D39\u529B\u5730\u66F4\u5FEB\u5730\u4EA7\u751F\u7ED3\u679C\u3002\u4F46\u6B63\u5982\u4F60\u6240\u89C1\uFF0C\u4EC5\u4EC5\u5C06 <strong>parallel()</strong> \u52A0\u5230\u4F60\u7684 Stream \u64CD\u4F5C\u4E0A\u5E76\u4E0D\u4E00\u5B9A\u662F\u5B89\u5168\u7684\u4E8B\u60C5\u3002\u5728\u4F7F\u7528 <strong>parallel()</strong> \u4E4B\u524D\uFF0C\u4F60\u5FC5\u987B\u4E86\u89E3\u5E76\u884C\u6027\u5982\u4F55\u5E2E\u52A9\u6216\u635F\u5BB3\u4F60\u7684\u64CD\u4F5C\u3002\u4E00\u4E2A\u57FA\u672C\u8BA4\u77E5\u9519\u8BEF\u5C31\u662F\u8BA4\u4E3A\u4F7F\u7528\u5E76\u884C\u6027\u603B\u662F\u4E00\u4E2A\u597D\u4E3B\u610F\u3002\u4E8B\u5B9E\u4E0A\u5E76\u4E0D\u662F\u3002Stream \u610F\u5473\u7740\u4F60\u4E0D\u9700\u8981\u91CD\u5199\u6240\u6709\u4EE3\u7801\u4FBF\u53EF\u4EE5\u5E76\u884C\u8FD0\u884C\u5B83\u3002\u4F46\u662F\u6D41\u7684\u51FA\u73B0\u5E76\u4E0D\u610F\u5473\u7740\u4F60\u53EF\u4EE5\u4E0D\u7528\u7406\u89E3\u5E76\u884C\u7684\u539F\u7406\u4EE5\u53CA\u4E0D\u7528\u8003\u8651\u5E76\u884C\u662F\u5426\u771F\u7684\u6709\u52A9\u4E8E\u5B9E\u73B0\u4F60\u7684\u76EE\u6807\u3002</p><h2 id="\u521B\u5EFA\u548C\u8FD0\u884C\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u548C\u8FD0\u884C\u4EFB\u52A1" aria-hidden="true">#</a> \u521B\u5EFA\u548C\u8FD0\u884C\u4EFB\u52A1</h2><p>\u5982\u679C\u65E0\u6CD5\u901A\u8FC7\u5E76\u884C\u6D41\u5B9E\u73B0\u5E76\u53D1\uFF0C\u5219\u5FC5\u987B\u521B\u5EFA\u5E76\u8FD0\u884C\u81EA\u5DF1\u7684\u4EFB\u52A1\u3002\u7A0D\u540E\u4F60\u5C06\u770B\u5230\u8FD0\u884C\u4EFB\u52A1\u7684\u7406\u60F3 Java 8 \u65B9\u6CD5\u662F CompletableFuture\uFF0C\u4F46\u6211\u4EEC\u5C06\u4F7F\u7528\u66F4\u57FA\u672C\u7684\u5DE5\u5177\u4ECB\u7ECD\u6982\u5FF5\u3002</p>`,67),f=n("Java \u5E76\u53D1\u7684\u5386\u53F2\u59CB\u4E8E\u975E\u5E38\u539F\u59CB\u548C\u6709\u95EE\u9898\u7684\u673A\u5236\uFF0C\u5E76\u4E14\u5145\u6EE1\u4E86\u5404\u79CD\u5C1D\u8BD5\u7684\u6539\u8FDB\u3002\u8FD9\u4E9B\u4E3B\u8981\u5F52\u5165\u9644\u5F55\uFF1A"),h=n("\u4F4E\u7EA7\u5E76\u53D1 (Appendix: Low-Level Concurrency)"),x=n("\u3002\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u5C06\u5C55\u793A\u4E00\u4E2A\u89C4\u8303\u5F62\u5F0F\uFF0C\u8868\u793A\u521B\u5EFA\u548C\u8FD0\u884C\u4EFB\u52A1\u7684\u6700\u7B80\u5355\uFF0C\u6700\u597D\u7684\u65B9\u6CD5\u3002\u4E0E\u5E76\u53D1\u4E2D\u7684\u6240\u6709\u5185\u5BB9\u4E00\u6837\uFF0C\u5B58\u5728\u5404\u79CD\u53D8\u4F53\uFF0C\u4F46\u8FD9\u4E9B\u53D8\u4F53\u8981\u4E48\u964D\u7EA7\u5230\u8BE5\u9644\u5F55\uFF0C\u8981\u4E48\u8D85\u51FA\u672C\u4E66\u7684\u8303\u56F4\u3002"),S=e(`<ul><li>Tasks and Executors</li></ul><p>\u5728 Java \u7684\u65E9\u671F\u7248\u672C\u4E2D\uFF0C\u4F60\u901A\u8FC7\u76F4\u63A5\u521B\u5EFA\u81EA\u5DF1\u7684 Thread \u5BF9\u8C61\u6765\u4F7F\u7528\u7EBF\u7A0B\uFF0C\u751A\u81F3\u5C06\u5B83\u4EEC\u5B50\u7C7B\u5316\u4EE5\u521B\u5EFA\u4F60\u81EA\u5DF1\u7684\u7279\u5B9A\u201C\u4EFB\u52A1\u7EBF\u7A0B\u201D\u5BF9\u8C61\u3002\u4F60\u624B\u52A8\u8C03\u7528\u4E86\u6784\u9020\u51FD\u6570\u5E76\u81EA\u5DF1\u542F\u52A8\u4E86\u7EBF\u7A0B\u3002</p><p>\u521B\u5EFA\u6240\u6709\u8FD9\u4E9B\u7EBF\u7A0B\u7684\u5F00\u9500\u53D8\u5F97\u975E\u5E38\u91CD\u8981\uFF0C\u73B0\u5728\u4E0D\u9F13\u52B1\u91C7\u7528\u624B\u52A8\u64CD\u4F5C\u65B9\u6CD5\u3002\u5728 Java 5 \u4E2D\uFF0C\u6DFB\u52A0\u4E86\u7C7B\u6765\u4E3A\u4F60\u5904\u7406\u7EBF\u7A0B\u6C60\u3002\u4F60\u53EF\u4EE5\u5C06\u4EFB\u52A1\u521B\u5EFA\u4E3A\u5355\u72EC\u7684\u7C7B\u578B\uFF0C\u7136\u540E\u5C06\u5176\u4EA4\u7ED9 ExecutorService \u4EE5\u8FD0\u884C\u8BE5\u4EFB\u52A1\uFF0C\u800C\u4E0D\u662F\u4E3A\u6BCF\u79CD\u4E0D\u540C\u7C7B\u578B\u7684\u4EFB\u52A1\u521B\u5EFA\u65B0\u7684 Thread \u5B50\u7C7B\u578B\u3002ExecutorService \u4E3A\u4F60\u7BA1\u7406\u7EBF\u7A0B\uFF0C\u5E76\u4E14\u5728\u8FD0\u884C\u4EFB\u52A1\u540E\u91CD\u65B0\u5FAA\u73AF\u7EBF\u7A0B\u800C\u4E0D\u662F\u4E22\u5F03\u7EBF\u7A0B\u3002</p><p>\u9996\u5148\uFF0C\u6211\u4EEC\u5C06\u521B\u5EFA\u4E00\u4E2A\u51E0\u4E4E\u4E0D\u6267\u884C\u4EFB\u52A1\u7684\u4EFB\u52A1\u3002\u5B83\u201Csleep\u201D\uFF08\u6682\u505C\u6267\u884C\uFF09100 \u6BEB\u79D2\uFF0C\u663E\u793A\u5176\u6807\u8BC6\u7B26\u548C\u6B63\u5728\u6267\u884C\u4EFB\u52A1\u7684\u7EBF\u7A0B\u7684\u540D\u79F0\uFF0C\u7136\u540E\u5B8C\u6210\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/NapTask.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NapTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">NapTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Seconds</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token operator">+</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token string">&quot;NapTask[&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u53EA\u662F\u4E00\u4E2A <strong>Runnable</strong> \uFF1A\u4E00\u4E2A\u5305\u542B <strong>run()</strong> \u65B9\u6CD5\u7684\u7C7B\u3002\u5B83\u6CA1\u6709\u5305\u542B\u5B9E\u9645\u8FD0\u884C\u4EFB\u52A1\u7684\u673A\u5236\u3002\u6211\u4EEC\u4F7F\u7528 <strong>Nap</strong> \u7C7B\u4E2D\u7684\u201Csleep\u201D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// onjava/Nap.java</span>
<span class="token keyword">package</span> <span class="token namespace">onjava</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Nap</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token keyword">double</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Seconds</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token keyword">double</span> t<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3A\u4E86\u6D88\u9664\u5F02\u5E38\u5904\u7406\u7684\u89C6\u89C9\u5E72\u6270\uFF0C\u8FD9\u88AB\u5B9A\u4E49\u4E3A\u5B9E\u7528\u7A0B\u5E8F\u3002\u7B2C\u4E8C\u4E2A\u6784\u9020\u51FD\u6570\u5728\u8D85\u65F6\u65F6\u663E\u793A\u4E00\u6761\u6D88\u606F</p><p>\u5BF9 <strong>TimeUnit.MILLISECONDS.sleep()</strong> \u7684\u8C03\u7528\u83B7\u53D6\u201C\u5F53\u524D\u7EBF\u7A0B\u201D\u5E76\u5728\u53C2\u6570\u4E2D\u5C06\u5176\u7F6E\u4E8E\u4F11\u7720\u72B6\u6001\uFF0C\u8FD9\u610F\u5473\u7740\u8BE5\u7EBF\u7A0B\u88AB\u6302\u8D77\u3002\u8FD9\u5E76\u4E0D\u610F\u5473\u7740\u5E95\u5C42\u5904\u7406\u5668\u505C\u6B62\u3002\u64CD\u4F5C\u7CFB\u7EDF\u5C06\u5176\u5207\u6362\u5230\u5176\u4ED6\u4EFB\u52A1\uFF0C\u4F8B\u5982\u5728\u4F60\u7684\u8BA1\u7B97\u673A\u4E0A\u8FD0\u884C\u53E6\u4E00\u4E2A\u7A97\u53E3\u3002OS \u4EFB\u52A1\u7BA1\u7406\u5668\u5B9A\u671F\u68C0\u67E5 <strong>sleep()</strong> \u662F\u5426\u8D85\u65F6\u3002\u5F53\u5B83\u6267\u884C\u65F6\uFF0C\u7EBF\u7A0B\u88AB\u201C\u5524\u9192\u201D\u5E76\u7ED9\u4E88\u66F4\u591A\u5904\u7406\u65F6\u95F4\u3002</p><p>\u4F60\u53EF\u4EE5\u770B\u5230 <strong>sleep()</strong> \u629B\u51FA\u4E00\u4E2A\u53D7\u68C0\u7684 <strong>InterruptedException</strong> ;\u8FD9\u662F\u539F\u59CB Java \u8BBE\u8BA1\u4E2D\u7684\u4E00\u4E2A\u5DE5\u4EF6\uFF0C\u5B83\u901A\u8FC7\u7A81\u7136\u65AD\u5F00\u5B83\u4EEC\u6765\u7EC8\u6B62\u4EFB\u52A1\u3002\u56E0\u4E3A\u5B83\u5F80\u5F80\u4F1A\u4EA7\u751F\u4E0D\u7A33\u5B9A\u7684\u72B6\u6001\uFF0C\u6240\u4EE5\u540E\u6765\u4E0D\u9F13\u52B1\u7EC8\u6B62\u3002\u4F46\u662F\uFF0C\u6211\u4EEC\u5FC5\u987B\u5728\u9700\u8981\u6216\u4ECD\u7136\u53D1\u751F\u7EC8\u6B62\u7684\u60C5\u51B5\u4E0B\u6355\u83B7\u5F02\u5E38\u3002</p><p>\u8981\u6267\u884C\u4EFB\u52A1\uFF0C\u6211\u4EEC\u5C06\u4ECE\u6700\u7B80\u5355\u7684\u65B9\u6CD5--SingleThreadExecutor \u5F00\u59CB:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//concurrent/SingleThreadExecutor.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingleThreadExecutor</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> exec <span class="token operator">=</span>
            <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">NapTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>exec<span class="token operator">::</span><span class="token function">execute</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;All tasks submitted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>exec<span class="token punctuation">.</span><span class="token function">isTerminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>
            <span class="token string">&quot; awaiting termination&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>All tasks submitted
main awaiting termination
main awaiting termination
NapTask[0] pool-1-thread-1
main awaiting termination
NapTask[1] pool-1-thread-1
main awaiting termination
NapTask[2] pool-1-thread-1
main awaiting termination
NapTask[3] pool-1-thread-1
main awaiting termination
NapTask[4] pool-1-thread-1
main awaiting termination
NapTask[5] pool-1-thread-1
main awaiting termination
NapTask[6] pool-1-thread-1
main awaiting termination
NapTask[7] pool-1-thread-1
main awaiting termination
NapTask[8] pool-1-thread-1
main awaiting termination
NapTask[9] pool-1-thread-1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9996\u5148\u8BF7\u6CE8\u610F\uFF0C\u6CA1\u6709 <strong>SingleThreadExecutor</strong> \u7C7B\u3002<strong>newSingleThreadExecutor()</strong> \u662F <strong>Executors</strong> \u4E2D\u7684\u4E00\u4E2A\u5DE5\u5382\u65B9\u6CD5\uFF0C\u5B83\u521B\u5EFA\u7279\u5B9A\u7C7B\u578B\u7684 <strong>ExecutorService</strong> [^4]</p><p>\u6211\u521B\u5EFA\u4E86\u5341\u4E2A NapTasks \u5E76\u5C06\u5B83\u4EEC\u63D0\u4EA4\u7ED9 ExecutorService\uFF0C\u8FD9\u610F\u5473\u7740\u5B83\u4EEC\u5F00\u59CB\u81EA\u5DF1\u8FD0\u884C\u3002\u7136\u800C\uFF0C\u5728\u6B64\u671F\u95F4\uFF0Cmain() \u7EE7\u7EED\u505A\u4E8B\u3002\u5F53\u6211\u8FD0\u884C callexec.shutdown() \u65F6\uFF0C\u5B83\u544A\u8BC9 ExecutorService \u5B8C\u6210\u5DF2\u7ECF\u63D0\u4EA4\u7684\u4EFB\u52A1\uFF0C\u4F46\u4E0D\u63A5\u53D7\u4EFB\u4F55\u65B0\u4EFB\u52A1\u3002\u6B64\u65F6\uFF0C\u8FD9\u4E9B\u4EFB\u52A1\u4ECD\u7136\u5728\u8FD0\u884C\uFF0C\u56E0\u6B64\u6211\u4EEC\u5FC5\u987B\u7B49\u5230\u5B83\u4EEC\u5728\u9000\u51FA main() \u4E4B\u524D\u5B8C\u6210\u3002\u8FD9\u662F\u901A\u8FC7\u68C0\u67E5 exec.isTerminated() \u6765\u5B9E\u73B0\u7684\uFF0C\u8FD9\u5728\u6240\u6709\u4EFB\u52A1\u5B8C\u6210\u540E\u53D8\u4E3A true\u3002</p><p>\u8BF7\u6CE8\u610F\uFF0Cmain() \u4E2D\u7EBF\u7A0B\u7684\u540D\u79F0\u662F main\uFF0C\u5E76\u4E14\u53EA\u6709\u4E00\u4E2A\u5176\u4ED6\u7EBF\u7A0B pool-1-thread-1\u3002\u6B64\u5916\uFF0C\u4EA4\u9519\u8F93\u51FA\u663E\u793A\u4E24\u4E2A\u7EBF\u7A0B\u786E\u5B9E\u540C\u65F6\u8FD0\u884C\u3002</p><p>\u5982\u679C\u4F60\u53EA\u662F\u8C03\u7528 exec.shutdown()\uFF0C\u7A0B\u5E8F\u5C06\u5B8C\u6210\u6240\u6709\u4EFB\u52A1\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u4E0D\u9700\u8981 <strong>while(!exec.isTerminated())</strong> \u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/SingleThreadExecutor2.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingleThreadExecutor2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> exec
        <span class="token operator">=</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">NapTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>exec<span class="token operator">::</span><span class="token function">execute</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>NapTask[0] pool-1-thread-1
NapTask[1] pool-1-thread-1
NapTask[2] pool-1-thread-1
NapTask[3] pool-1-thread-1
NapTask[4] pool-1-thread-1
NapTask[5] pool-1-thread-1
NapTask[6] pool-1-thread-1
NapTask[7] pool-1-thread-1
NapTask[8] pool-1-thread-1
NapTask[9] pool-1-thread-1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u65E6\u4F60\u8C03\u7528\u4E86 exec.shutdown()\uFF0C\u5C1D\u8BD5\u63D0\u4EA4\u65B0\u4EFB\u52A1\u5C06\u629B\u51FA RejectedExecutionException\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/MoreTasksAfterShutdown.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MoreTasksAfterShutdown</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> exec
        <span class="token operator">=</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token function">newNapTask</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            exec<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token function">newNapTask</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">RejectedExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>java.util.concurrent.RejectedExecutionException: TaskNapTask[99] rejected from java.util.concurrent.ThreadPoolExecutor@4e25154f[Shutting down, pool size = 1,active threads = 1, queued tasks = 0, completed tasks =0]NapTask[1] pool-1-thread-1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>exec.shutdown()</strong> \u7684\u66FF\u4EE3\u65B9\u6CD5\u662F <strong>exec.shutdownNow()</strong> \uFF0C\u5B83\u9664\u4E86\u4E0D\u63A5\u53D7\u65B0\u4EFB\u52A1\u5916\uFF0C\u8FD8\u4F1A\u5C1D\u8BD5\u901A\u8FC7\u4E2D\u65AD\u4EFB\u52A1\u6765\u505C\u6B62\u4EFB\u4F55\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684\u4EFB\u52A1\u3002\u540C\u6837\uFF0C\u4E2D\u65AD\u662F\u9519\u8BEF\u7684\uFF0C\u5BB9\u6613\u51FA\u9519\u5E76\u4E14\u4E0D\u9F13\u52B1\u3002</p><ul><li>\u4F7F\u7528\u66F4\u591A\u7EBF\u7A0B</li></ul><p>\u4F7F\u7528\u7EBF\u7A0B\u7684\u91CD\u70B9\u662F\uFF08\u51E0\u4E4E\u603B\u662F\uFF09\u66F4\u5FEB\u5730\u5B8C\u6210\u4EFB\u52A1\uFF0C\u90A3\u4E48\u6211\u4EEC\u4E3A\u4EC0\u4E48\u8981\u9650\u5236\u81EA\u5DF1\u4F7F\u7528 SingleThreadExecutor \u5462\uFF1F\u67E5\u770B\u6267\u884C <strong>Executors</strong> \u7684 Javadoc\uFF0C\u4F60\u5C06\u770B\u5230\u66F4\u591A\u9009\u9879\u3002\u4F8B\u5982 CachedThreadPool\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CachedThreadPool.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachedThreadPool</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> exec
        <span class="token operator">=</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">NapTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>exec<span class="token operator">::</span><span class="token function">execute</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>NapTask[7] pool-1-thread-8
NapTask[4] pool-1-thread-5
NapTask[1] pool-1-thread-2
NapTask[3] pool-1-thread-4
NapTask[0] pool-1-thread-1
NapTask[8] pool-1-thread-9
NapTask[2] pool-1-thread-3
NapTask[9] pool-1-thread-10
NapTask[6] pool-1-thread-7
NapTask[5] pool-1-thread-6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u4F60\u8FD0\u884C\u8FD9\u4E2A\u7A0B\u5E8F\u65F6\uFF0C\u4F60\u4F1A\u53D1\u73B0\u5B83\u5B8C\u6210\u5F97\u66F4\u5FEB\u3002\u8FD9\u662F\u6709\u9053\u7406\u7684\uFF0C\u6BCF\u4E2A\u4EFB\u52A1\u90FD\u6709\u81EA\u5DF1\u7684\u7EBF\u7A0B\uFF0C\u6240\u4EE5\u5B83\u4EEC\u90FD\u5E76\u884C\u8FD0\u884C\uFF0C\u800C\u4E0D\u662F\u4F7F\u7528\u76F8\u540C\u7684\u7EBF\u7A0B\u6765\u987A\u5E8F\u8FD0\u884C\u6BCF\u4E2A\u4EFB\u52A1\u3002\u8FD9\u4F3C\u4E4E\u6CA1\u6BDB\u75C5\uFF0C\u5F88\u96BE\u7406\u89E3\u4E3A\u4EC0\u4E48\u6709\u4EBA\u4F1A\u4F7F\u7528 SingleThreadExecutor\u3002</p><p>\u8981\u7406\u89E3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6211\u4EEC\u9700\u8981\u4E00\u4E2A\u66F4\u590D\u6742\u7684\u4EFB\u52A1\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/InterferingTask.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterferingTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">InterferingTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        val<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token operator">+</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6BCF\u4E2A\u4EFB\u52A1\u589E\u52A0 val \u4E00\u767E\u6B21\u3002\u8FD9\u4F3C\u4E4E\u5F88\u7B80\u5355\u3002\u8BA9\u6211\u4EEC\u7528 CachedThreadPool \u5C1D\u8BD5\u4E00\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CachedThreadPool2.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachedThreadPool2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ExecutorService</span> exec
    <span class="token operator">=</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">InterferingTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>exec<span class="token operator">::</span><span class="token function">execute</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>0 pool-1-thread-1 200
1 pool-1-thread-2 200
4 pool-1-thread-5 300
5 pool-1-thread-6 400
8 pool-1-thread-9 500
9 pool-1-thread-10 600
2 pool-1-thread-3 700
7 pool-1-thread-8 800
3 pool-1-thread-4 900
6 pool-1-thread-7 1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u4E0D\u662F\u6211\u4EEC\u6240\u671F\u671B\u7684\uFF0C\u5E76\u4E14\u4ECE\u4E00\u6B21\u8FD0\u884C\u5230\u4E0B\u4E00\u6B21\u8FD0\u884C\u4F1A\u6709\u6240\u4E0D\u540C\u3002\u95EE\u9898\u662F\u6240\u6709\u7684\u4EFB\u52A1\u90FD\u8BD5\u56FE\u5199\u5165 val \u7684\u5355\u4E2A\u5B9E\u4F8B\uFF0C\u5E76\u4E14\u4ED6\u4EEC\u6B63\u5728\u8E29\u7740\u5F7C\u6B64\u7684\u811A\u8DBE\u3002\u6211\u4EEC\u79F0\u8FD9\u6837\u7684\u7C7B\u662F\u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684\u3002\u8BA9\u6211\u4EEC\u770B\u770B SingleThreadExecutor \u4F1A\u53D1\u751F\u4EC0\u4E48\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/SingleThreadExecutor3.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingleThreadExecutor3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> exec
        <span class="token operator">=</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">InterferingTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>exec<span class="token operator">::</span><span class="token function">execute</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>0 pool-1-thread-1 100
1 pool-1-thread-1 200
2 pool-1-thread-1 300
3 pool-1-thread-1 400
4 pool-1-thread-1 500
5 pool-1-thread-1 600
6 pool-1-thread-1 700
7 pool-1-thread-1 800
8 pool-1-thread-1 900
9 pool-1-thread-1 1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u73B0\u5728\u6211\u4EEC\u6BCF\u6B21\u90FD\u5F97\u5230\u4E00\u81F4\u7684\u7ED3\u679C\uFF0C\u5C3D\u7BA1 <strong>InterferingTask</strong> \u7F3A\u4E4F\u7EBF\u7A0B\u5B89\u5168\u6027\u3002\u8FD9\u662F SingleThreadExecutor \u7684\u4E3B\u8981\u597D\u5904 - \u56E0\u4E3A\u5B83\u4E00\u6B21\u8FD0\u884C\u4E00\u4E2A\u4EFB\u52A1\uFF0C\u8FD9\u4E9B\u4EFB\u52A1\u4E0D\u4F1A\u76F8\u4E92\u5E72\u6270\uFF0C\u56E0\u6B64\u5F3A\u52A0\u4E86\u7EBF\u7A0B\u5B89\u5168\u6027\u3002\u8FD9\u79CD\u73B0\u8C61\u79F0\u4E3A\u7EBF\u7A0B\u5C01\u95ED\uFF0C\u56E0\u4E3A\u5728\u5355\u7EBF\u7A0B\u4E0A\u8FD0\u884C\u4EFB\u52A1\u9650\u5236\u4E86\u5B83\u4EEC\u7684\u5F71\u54CD\u3002\u7EBF\u7A0B\u5C01\u95ED\u9650\u5236\u4E86\u52A0\u901F\uFF0C\u4F46\u53EF\u4EE5\u8282\u7701\u5F88\u591A\u56F0\u96BE\u7684\u8C03\u8BD5\u548C\u91CD\u5199\u3002</p><ul><li>\u4EA7\u751F\u7ED3\u679C</li></ul><p>\u56E0\u4E3A <strong>InterferingTask</strong> \u662F\u4E00\u4E2A <strong>Runnable</strong> \uFF0C\u5B83\u6CA1\u6709\u8FD4\u56DE\u503C\uFF0C\u56E0\u6B64\u53EA\u80FD\u4F7F\u7528\u526F\u4F5C\u7528\u4EA7\u751F\u7ED3\u679C - \u64CD\u7EB5\u7F13\u51B2\u503C\u800C\u4E0D\u662F\u8FD4\u56DE\u7ED3\u679C\u3002\u526F\u4F5C\u7528\u662F\u5E76\u53D1\u7F16\u7A0B\u4E2D\u7684\u4E3B\u8981\u95EE\u9898\u4E4B\u4E00\uFF0C\u56E0\u4E3A\u6211\u4EEC\u770B\u5230\u4E86 <strong>CachedThreadPool2.java</strong> \u3002<strong>InterferingTask</strong> \u4E2D\u7684 <strong>val</strong> \u88AB\u79F0\u4E3A\u53EF\u53D8\u5171\u4EAB\u72B6\u6001\uFF0C\u8FD9\u5C31\u662F\u95EE\u9898\u6240\u5728\uFF1A\u591A\u4E2A\u4EFB\u52A1\u540C\u65F6\u4FEE\u6539\u540C\u4E00\u4E2A\u53D8\u91CF\u4F1A\u4EA7\u751F\u7ADE\u4E89\u3002\u7ED3\u679C\u53D6\u51B3\u4E8E\u9996\u5148\u5728\u7EC8\u70B9\u7EBF\u4E0A\u6267\u884C\u54EA\u4E2A\u4EFB\u52A1\uFF0C\u5E76\u4FEE\u6539\u53D8\u91CF\uFF08\u4EE5\u53CA\u5176\u4ED6\u53EF\u80FD\u6027\u7684\u5404\u79CD\u53D8\u5316\uFF09\u3002</p><p>\u907F\u514D\u7ADE\u4E89\u6761\u4EF6\u7684\u6700\u597D\u65B9\u6CD5\u662F\u907F\u514D\u53EF\u53D8\u7684\u5171\u4EAB\u72B6\u6001\u3002\u6211\u4EEC\u53EF\u4EE5\u79F0\u4E4B\u4E3A\u81EA\u79C1\u7684\u5B69\u5B50\u539F\u5219\uFF1A\u4EC0\u4E48\u90FD\u4E0D\u5206\u4EAB\u3002</p><p>\u4F7F\u7528 <strong>InterferingTask</strong> \uFF0C\u6700\u597D\u5220\u9664\u526F\u4F5C\u7528\u5E76\u8FD4\u56DE\u4EFB\u52A1\u7ED3\u679C\u3002\u4E3A\u6B64\uFF0C\u6211\u4EEC\u521B\u5EFA <strong>Callable</strong> \u800C\u4E0D\u662F <strong>Runnable</strong> \uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CountingTask.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountingTask</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">CountingTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span> val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        val<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>call() \u5B8C\u5168\u72EC\u7ACB\u4E8E\u6240\u6709\u5176\u4ED6 CountingTasks \u751F\u6210\u5176\u7ED3\u679C</strong>\uFF0C\u8FD9\u610F\u5473\u7740\u6CA1\u6709\u53EF\u53D8\u7684\u5171\u4EAB\u72B6\u6001</p><p><strong>ExecutorService</strong> \u5141\u8BB8\u4F60\u4F7F\u7528 <strong>invokeAll()</strong> \u542F\u52A8\u96C6\u5408\u4E2D\u7684\u6BCF\u4E2A Callable\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CachedThreadPool3.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachedThreadPool3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">extractResult</span><span class="token punctuation">(</span><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ExecutorService</span> exec <span class="token operator">=</span>
    <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CountingTask</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">CountingTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> futures <span class="token operator">=</span>
            exec<span class="token punctuation">.</span><span class="token function">invokeAll</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> sum <span class="token operator">=</span> futures<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">CachedThreadPool3</span><span class="token operator">::</span><span class="token function">extractResult</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sum = &quot;</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1 pool-1-thread-2 100
0 pool-1-thread-1 100
4 pool-1-thread-5 100
5 pool-1-thread-6 100
8 pool-1-thread-9 100
9 pool-1-thread-10 100
2 pool-1-thread-3 100
3 pool-1-thread-4 100
6 pool-1-thread-7 100
7 pool-1-thread-8 100
sum = 1000

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EA\u6709\u5728\u6240\u6709\u4EFB\u52A1\u5B8C\u6210\u540E\uFF0C<strong>invokeAll()</strong> \u624D\u4F1A\u8FD4\u56DE\u4E00\u4E2A <strong>Future</strong> \u5217\u8868\uFF0C\u6BCF\u4E2A\u4EFB\u52A1\u4E00\u4E2A <strong>Future</strong> \u3002<strong>Future</strong> \u662F Java 5 \u4E2D\u5F15\u5165\u7684\u673A\u5236\uFF0C\u5141\u8BB8\u4F60\u63D0\u4EA4\u4EFB\u52A1\u800C\u65E0\u9700\u7B49\u5F85\u5B83\u5B8C\u6210\u3002\u5728\u8FD9\u91CC\uFF0C\u6211\u4EEC\u4F7F\u7528 <strong>ExecutorService.submit()</strong> :</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Futures.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Futures</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ExecutorService</span> exec
        <span class="token operator">=</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span>
        exec<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token function">newCountingTask</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1]</span>
    exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>99 pool-1-thread-1 100
100
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>[1] \u5F53\u4F60\u7684\u4EFB\u52A1\u5728\u5C1A\u672A\u5B8C\u6210\u7684 <strong>Future</strong> \u4E0A\u8C03\u7528 <strong>get()</strong> \u65F6\uFF0C\u8C03\u7528\u4F1A\u963B\u585E\uFF08\u7B49\u5F85\uFF09\u76F4\u5230\u7ED3\u679C\u53EF\u7528\u3002</li></ul><p>\u4F46\u8FD9\u610F\u5473\u7740\uFF0C\u5728 <strong>CachedThreadPool3.java</strong> \u4E2D\uFF0C<strong>Future</strong> \u4F3C\u4E4E\u662F\u591A\u4F59\u7684\uFF0C\u56E0\u4E3A <strong>invokeAll()</strong> \u751A\u81F3\u5728\u6240\u6709\u4EFB\u52A1\u5B8C\u6210\u4E4B\u524D\u90FD\u4E0D\u4F1A\u8FD4\u56DE\u3002\u4F46\u662F\uFF0C\u8FD9\u91CC\u7684 Future \u5E76\u4E0D\u7528\u4E8E\u5EF6\u8FDF\u7ED3\u679C\uFF0C\u800C\u662F\u7528\u4E8E\u6355\u83B7\u4EFB\u4F55\u53EF\u80FD\u53D1\u751F\u7684\u5F02\u5E38\u3002</p><p>\u8FD8\u8981\u6CE8\u610F\u5728 <strong>CachedThreadPool3.java.get()</strong> \u4E2D\u629B\u51FA\u5F02\u5E38\uFF0C\u56E0\u6B64 <strong>extractResult()</strong> \u5728 Stream \u4E2D\u6267\u884C\u6B64\u63D0\u53D6\u3002</p><p>\u56E0\u4E3A\u5F53\u4F60\u8C03\u7528 <strong>get()</strong> \u65F6\uFF0C<strong>Future</strong> \u4F1A\u963B\u585E\uFF0C\u6240\u4EE5\u5B83\u53EA\u80FD\u89E3\u51B3\u7B49\u5F85\u4EFB\u52A1\u5B8C\u6210\u624D\u66B4\u9732\u95EE\u9898\u3002\u6700\u7EC8\uFF0C<strong>Futures</strong> \u88AB\u8BA4\u4E3A\u662F\u4E00\u79CD\u65E0\u6548\u7684\u89E3\u51B3\u65B9\u6848\uFF0C\u73B0\u5728\u4E0D\u9F13\u52B1\uFF0C\u6211\u4EEC\u63A8\u8350 Java 8 \u7684 <strong>CompletableFuture</strong> \uFF0C\u8FD9\u5C06\u5728\u672C\u7AE0\u540E\u9762\u63A2\u8BA8\u3002\u5F53\u7136\uFF0C\u4F60\u4ECD\u4F1A\u5728\u9057\u7559\u5E93\u4E2D\u9047\u5230 Futures\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u5E76\u884C Stream \u4EE5\u66F4\u7B80\u5355\uFF0C\u66F4\u4F18\u96C5\u7684\u65B9\u5F0F\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CountingStream.java</span>
<span class="token comment">// {VisuallyInspectOutput}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountingStream</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
            <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">CountingTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>ct <span class="token operator">-&gt;</span> ct<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1 ForkJoinPool.commonPool-worker-3 100
8 ForkJoinPool.commonPool-worker-2 100
0 ForkJoinPool.commonPool-worker-6 100
2 ForkJoinPool.commonPool-worker-1 100
4 ForkJoinPool.commonPool-worker-5 100
9 ForkJoinPool.commonPool-worker-7 100
6 main 100
7 ForkJoinPool.commonPool-worker-4 100
5 ForkJoinPool.commonPool-worker-2 100
3 ForkJoinPool.commonPool-worker-3 100
1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E0D\u4EC5\u66F4\u5BB9\u6613\u7406\u89E3\uFF0C\u800C\u4E14\u6211\u4EEC\u9700\u8981\u505A\u7684\u5C31\u662F\u5C06 <code>parallel()</code> \u63D2\u5165\u5230\u5176\u4ED6\u987A\u5E8F\u64CD\u4F5C\u4E2D\uFF0C\u7136\u540E\u4E00\u5207\u90FD\u5728\u540C\u65F6\u8FD0\u884C\u3002</p><ul><li>Lambda \u548C\u65B9\u6CD5\u5F15\u7528\u4F5C\u4E3A\u4EFB\u52A1</li></ul><p>\u5728 <strong>java8</strong> \u6709\u4E86 <strong>lambdas</strong> \u548C\u65B9\u6CD5\u5F15\u7528\uFF0C\u4F60\u4E0D\u9700\u8981\u53D7\u9650\u4E8E\u53EA\u80FD\u4F7F\u7528 <strong>Runnable</strong> \u548C <strong>Callable</strong> \u3002\u56E0\u4E3A java8 \u7684 <strong>lambdas</strong> \u548C\u65B9\u6CD5\u5F15\u7528\u53EF\u4EE5\u901A\u8FC7\u5339\u914D\u65B9\u6CD5\u7B7E\u540D\u6765\u4F7F\u7528\uFF08\u5373\uFF0C\u5B83\u652F\u6301\u7ED3\u6784\u4E00\u81F4\u6027\uFF09\uFF0C\u6240\u4EE5\u6211\u4EEC\u53EF\u4EE5\u5C06\u975E <strong>Runnable</strong> \u6216 <strong>Callable</strong> \u7684\u53C2\u6570\u4F20\u9012\u7ED9 <code>ExecutorService</code> :</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/LambdasAndMethodReferences.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">NotRunnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;NotRunnable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">NotCallable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;NotCallable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LambdasAndMethodReferences</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ExecutorService</span> exec <span class="token operator">=</span>
        <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exec<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Lambda1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exec<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NotRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">go</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exec<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Lambda2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exec<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NotCallable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exec<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Lambda1
NotCallable
NotRunnable
Lambda2

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\uFF0C\u524D\u4E24\u4E2A <strong>submit()</strong> \u8C03\u7528\u53EF\u4EE5\u6539\u4E3A\u8C03\u7528 <strong>execute()</strong> \u3002\u6240\u6709 <strong>submit()</strong> \u8C03\u7528\u90FD\u8FD4\u56DE <strong>Futures</strong> \uFF0C\u4F60\u53EF\u4EE5\u5728\u540E\u4E24\u6B21\u8C03\u7528\u7684\u60C5\u51B5\u4E0B\u63D0\u53D6\u7ED3\u679C\u3002</p><h2 id="\u7EC8\u6B62\u8017\u65F6\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#\u7EC8\u6B62\u8017\u65F6\u4EFB\u52A1" aria-hidden="true">#</a> \u7EC8\u6B62\u8017\u65F6\u4EFB\u52A1</h2><p>\u5E76\u53D1\u7A0B\u5E8F\u901A\u5E38\u4F7F\u7528\u957F\u65F6\u95F4\u8FD0\u884C\u7684\u4EFB\u52A1\u3002\u53EF\u8C03\u7528\u4EFB\u52A1\u5728\u5B8C\u6210\u65F6\u8FD4\u56DE\u503C;\u867D\u7136\u8FD9\u7ED9\u5B83\u4E00\u4E2A\u6709\u9650\u7684\u5BFF\u547D\uFF0C\u4F46\u4ECD\u7136\u53EF\u80FD\u5F88\u957F\u3002\u53EF\u8FD0\u884C\u7684\u4EFB\u52A1\u6709\u65F6\u88AB\u8BBE\u7F6E\u4E3A\u6C38\u8FDC\u8FD0\u884C\u7684\u540E\u53F0\u8FDB\u7A0B\u3002\u4F60\u7ECF\u5E38\u9700\u8981\u4E00\u79CD\u65B9\u6CD5\u5728\u6B63\u5E38\u5B8C\u6210\u4E4B\u524D\u505C\u6B62 <strong>Runnable</strong> \u548C <strong>Callable</strong> \u4EFB\u52A1\uFF0C\u4F8B\u5982\u5F53\u4F60\u5173\u95ED\u7A0B\u5E8F\u65F6\u3002</p><p>\u6700\u521D\u7684 Java \u8BBE\u8BA1\u63D0\u4F9B\u4E86\u4E2D\u65AD\u8FD0\u884C\u4EFB\u52A1\u7684\u673A\u5236\uFF08\u4E3A\u4E86\u5411\u540E\u517C\u5BB9\uFF0C\u4ECD\u7136\u5B58\u5728\uFF09;\u4E2D\u65AD\u673A\u5236\u5305\u62EC\u963B\u585E\u95EE\u9898\u3002\u4E2D\u65AD\u4EFB\u52A1\u65E2\u4E71\u53C8\u590D\u6742\uFF0C\u56E0\u4E3A\u4F60\u5FC5\u987B\u4E86\u89E3\u53EF\u80FD\u53D1\u751F\u4E2D\u65AD\u7684\u6240\u6709\u53EF\u80FD\u72B6\u6001\uFF0C\u4EE5\u53CA\u53EF\u80FD\u5BFC\u81F4\u7684\u6570\u636E\u4E22\u5931\u3002\u4F7F\u7528\u4E2D\u65AD\u88AB\u89C6\u4E3A\u53CD\u5BF9\u6A21\u5F0F\uFF0C\u4F46\u6211\u4EEC\u4ECD\u7136\u88AB\u8FEB\u63A5\u53D7\u3002</p><p>InterruptedException\uFF0C\u56E0\u4E3A\u8BBE\u8BA1\u7684\u5411\u540E\u517C\u5BB9\u6027\u6B8B\u7559\u3002</p><p>\u4EFB\u52A1\u7EC8\u6B62\u7684\u6700\u4F73\u65B9\u6CD5\u662F\u8BBE\u7F6E\u4EFB\u52A1\u5468\u671F\u6027\u68C0\u67E5\u7684\u6807\u5FD7\u3002\u7136\u540E\u4EFB\u52A1\u53EF\u4EE5\u901A\u8FC7\u81EA\u5DF1\u7684 shutdown \u8FDB\u7A0B\u5E76\u6B63\u5E38\u7EC8\u6B62\u3002\u4E0D\u662F\u5728\u4EFB\u52A1\u4E2D\u968F\u673A\u5173\u95ED\u7EBF\u7A0B\uFF0C\u800C\u662F\u8981\u6C42\u4EFB\u52A1\u5728\u5230\u8FBE\u4E86\u4E00\u4E2A\u8F83\u597D\u65F6\u81EA\u884C\u7EC8\u6B62\u3002\u8FD9\u603B\u662F\u4EA7\u751F\u6BD4\u4E2D\u65AD\u66F4\u597D\u7684\u7ED3\u679C\uFF0C\u4EE5\u53CA\u66F4\u5BB9\u6613\u7406\u89E3\u7684\u66F4\u5408\u7406\u7684\u4EE3\u7801\u3002</p><p>\u4EE5\u8FD9\u79CD\u65B9\u5F0F\u7EC8\u6B62\u4EFB\u52A1\u542C\u8D77\u6765\u5F88\u7B80\u5355\uFF1A\u8BBE\u7F6E\u4EFB\u52A1\u53EF\u4EE5\u770B\u5230\u7684 <strong>boolean</strong> flag\u3002\u7F16\u5199\u4EFB\u52A1\uFF0C\u4EE5\u4FBF\u5B9A\u671F\u68C0\u67E5\u6807\u5FD7\u5E76\u6267\u884C\u6B63\u5E38\u7EC8\u6B62\u3002\u8FD9\u5B9E\u9645\u4E0A\u5C31\u662F\u4F60\u6240\u505A\u7684\uFF0C\u4F46\u662F\u6709\u4E00\u4E2A\u590D\u6742\u7684\u95EE\u9898\uFF1A\u6211\u4EEC\u7684\u65E7\u514B\u661F\uFF0C\u5171\u540C\u7684\u53EF\u53D8\u72B6\u6001\u3002\u5982\u679C\u8BE5\u6807\u5FD7\u53EF\u4EE5\u88AB\u53E6\u4E00\u4E2A\u4EFB\u52A1\u64CD\u7EB5\uFF0C\u5219\u5B58\u5728\u78B0\u649E\u53EF\u80FD\u6027\u3002</p>`,78),C=n("\u5728\u7814\u7A76 Java \u6587\u732E\u65F6\uFF0C\u4F60\u4F1A\u53D1\u73B0\u5F88\u591A\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u7684\u65B9\u6CD5\uFF0C\u7ECF\u5E38\u4F7F\u7528 "),j=s("strong",null,"volatile",-1),E=n(" \u5173\u952E\u5B57\u3002\u6211\u4EEC\u5C06\u4F7F\u7528\u66F4\u7B80\u5355\u7684\u6280\u672F\u5E76\u907F\u514D\u6240\u6709\u6613\u53D8\u7684\u53C2\u6570\uFF0C\u8FD9\u4E9B\u90FD\u5728"),P=n("\u9644\u5F55\uFF1A\u4F4E\u7EA7\u5E76\u53D1 "),z=n(" \u4E2D\u6709\u6240\u6D89\u53CA\u3002"),A=e(`<p>Java 5 \u5F15\u5165\u4E86 <strong>Atomic</strong> \u7C7B\uFF0C\u5B83\u63D0\u4F9B\u4E86\u4E00\u7EC4\u53EF\u4EE5\u4F7F\u7528\u7684\u7C7B\u578B\uFF0C\u800C\u4E0D\u5FC5\u62C5\u5FC3\u5E76\u53D1\u95EE\u9898\u3002\u6211\u4EEC\u5C06\u6DFB\u52A0 <strong>AtomicBoolean</strong> \u6807\u5FD7\uFF0C\u544A\u8BC9\u4EFB\u52A1\u6E05\u7406\u81EA\u5DF1\u5E76\u9000\u51FA\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/QuittableTask.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicBoolean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuittableTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">QuittableTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicBoolean</span> running <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">AtomicBoolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        running<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>running<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">// [1]</span>
            <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>id <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [2]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u867D\u7136\u591A\u4E2A\u4EFB\u52A1\u53EF\u4EE5\u5728\u540C\u4E00\u4E2A\u5B9E\u4F8B\u4E0A\u6210\u529F\u8C03\u7528 <strong>quit()</strong> \uFF0C\u4F46\u662F <strong>AtomicBoolean</strong> \u53EF\u4EE5\u9632\u6B62\u591A\u4E2A\u4EFB\u52A1\u540C\u65F6\u5B9E\u9645\u4FEE\u6539 <strong>running</strong> \uFF0C\u4ECE\u800C\u4F7F <strong>quit()</strong> \u65B9\u6CD5\u6210\u4E3A\u7EBF\u7A0B\u5B89\u5168\u7684\u3002</p><ul><li>[1]:\u53EA\u8981\u8FD0\u884C\u6807\u5FD7\u4E3A true\uFF0C\u6B64\u4EFB\u52A1\u7684 run() \u65B9\u6CD5\u5C06\u7EE7\u7EED\u3002</li><li></li></ul><p>\u9700\u8981 <strong>running AtomicBoolean</strong> \u8BC1\u660E\u7F16\u5199 Java program \u5E76\u53D1\u65F6\u6700\u57FA\u672C\u7684\u56F0\u96BE\u4E4B\u4E00\u662F\uFF0C\u5982\u679C <strong>running</strong> \u662F\u4E00\u4E2A\u666E\u901A\u7684\u5E03\u5C14\u503C\uFF0C\u4F60\u53EF\u80FD\u65E0\u6CD5\u5728\u6267\u884C\u7A0B\u5E8F\u4E2D\u770B\u5230\u95EE\u9898\u3002\u5B9E\u9645\u4E0A\uFF0C\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u4F60\u53EF\u80FD\u6C38\u8FDC\u4E0D\u4F1A\u6709\u4EFB\u4F55\u95EE\u9898 - \u4F46\u662F\u4EE3\u7801\u4ECD\u7136\u662F\u4E0D\u5B89\u5168\u7684\u3002\u7F16\u5199\u8868\u660E\u8BE5\u95EE\u9898\u7684\u6D4B\u8BD5\u53EF\u80FD\u5F88\u56F0\u96BE\u6216\u4E0D\u53EF\u80FD\u3002\u56E0\u6B64\uFF0C\u4F60\u6CA1\u6709\u4EFB\u4F55\u53CD\u9988\u6765\u544A\u8BC9\u4F60\u5DF2\u7ECF\u505A\u9519\u4E86\u3002\u901A\u5E38\uFF0C\u4F60\u7F16\u5199\u7EBF\u7A0B\u5B89\u5168\u4EE3\u7801\u7684\u552F\u4E00\u65B9\u6CD5\u5C31\u662F\u901A\u8FC7\u4E86\u89E3\u4E8B\u60C5\u53EF\u80FD\u51FA\u9519\u7684\u6240\u6709\u7EC6\u5FAE\u4E4B\u5904\u3002</p><p>\u4F5C\u4E3A\u6D4B\u8BD5\uFF0C\u6211\u4EEC\u5C06\u542F\u52A8\u5F88\u591A QuittableTasks \u7136\u540E\u5173\u95ED\u5B83\u4EEC\u3002\u5C1D\u8BD5\u4F7F\u7528\u8F83\u5927\u7684 COUNT \u503C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/QuittingTasks.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuittingTasks</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> COUNT <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span>
    <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">QuittableTask</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span>
    <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> COUNT<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">QuittableTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>qt <span class="token operator">-&gt;</span> es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>qt<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">QuittableTask</span><span class="token operator">::</span><span class="token function">quit</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    es<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>24 27 31 8 11 7 19 12 16 4 23 3 28 32 15 20 63 60 68 6764 39 47 52 51 55 40 43 48 59 44 56 36 35 71 72 83 10396 92 88 99 100 87 91 79 75 84 76 115 108 112 104 107111 95 80 147 120 127 119 123 144 143 116 132 124 128
136 131 135 139 148 140 2 126 6 5 1 18 129 17 14 13 2122 9 10 30 33 58 37 125 26 34 133 145 78 137 141 138 6274 142 86 65 73 146 70 42 149 121 110 134 105 82 117106 113 122 45 114 118 38 50 29 90 101 89 57 53 94 4161 66 130 69 77 81 85 93 25 102 54 109 98 49 46 97
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4F7F\u7528 <strong>peek()</strong> \u5C06 <strong>QuittableTasks</strong> \u4F20\u9012\u7ED9 <strong>ExecutorService</strong> \uFF0C\u7136\u540E\u5C06\u8FD9\u4E9B\u4EFB\u52A1\u6536\u96C6\u5230 <strong>List.main()</strong> \u4E2D\uFF0C\u53EA\u8981\u4EFB\u4F55\u4EFB\u52A1\u4ECD\u5728\u8FD0\u884C\uFF0C\u5C31\u4F1A\u963B\u6B62\u7A0B\u5E8F\u9000\u51FA\u3002\u5373\u4F7F\u4E3A\u6BCF\u4E2A\u4EFB\u52A1\u6309\u987A\u5E8F\u8C03\u7528 quit() \u65B9\u6CD5\uFF0C\u4EFB\u52A1\u4E5F\u4E0D\u4F1A\u6309\u7167\u5B83\u4EEC\u521B\u5EFA\u7684\u987A\u5E8F\u5173\u95ED\u3002\u72EC\u7ACB\u8FD0\u884C\u7684\u4EFB\u52A1\u4E0D\u4F1A\u786E\u5B9A\u6027\u5730\u54CD\u5E94\u4FE1\u53F7\u3002</p><h2 id="completablefuture-\u7C7B" tabindex="-1"><a class="header-anchor" href="#completablefuture-\u7C7B" aria-hidden="true">#</a> CompletableFuture \u7C7B</h2><p>\u4F5C\u4E3A\u4ECB\u7ECD\uFF0C\u8FD9\u91CC\u662F\u4F7F\u7528 CompletableFutures \u5728 QuittingTasks.java \u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/QuittingCompletable.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuittingCompletable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">QuittableTask</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">QuittingTasks</span><span class="token punctuation">.</span>COUNT<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">QuittableTask</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> cfutures <span class="token operator">=</span>
        tasks<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token operator">::</span><span class="token function">runAsync</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">QuittableTask</span><span class="token operator">::</span><span class="token function">quit</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cfutures<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token operator">::</span><span class="token function">join</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 2526 27 28 29 30 31 32 33 34 6 35 4 38 39 40 41 42 43 4445 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 6263 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 8081 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 9899 100 101 102 103 104 105 106 107 108 109 110 111 1121 113 114 116 117 118 119 120 121 122 123 124 125 126127 128 129 130 131 132 133 134 135 136 137 138 139 140141 142 143 144 145 146 147 148 149 5 115 37 36 2 3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4EFB\u52A1\u662F\u4E00\u4E2A <code>List&lt;QuittableTask&gt;</code>\uFF0C\u5C31\u50CF\u5728 <code>QuittingTasks.java</code> \u4E2D\u4E00\u6837\uFF0C\u4F46\u662F\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u6CA1\u6709 <code>peek()</code> \u5C06\u6BCF\u4E2A <code>QuittableTask</code> \u63D0\u4EA4\u7ED9 <code>ExecutorService</code>\u3002\u76F8\u53CD\uFF0C\u5728\u521B\u5EFA <code>cfutures</code> \u671F\u95F4\uFF0C\u6BCF\u4E2A\u4EFB\u52A1\u90FD\u4EA4\u7ED9 <code>CompletableFuture::runAsync</code>\u3002\u8FD9\u6267\u884C <code>VerifyTask.run()</code> \u5E76\u8FD4\u56DE <code>CompletableFuture&lt;Void&gt;</code> \u3002\u56E0\u4E3A <code>run()</code> \u4E0D\u8FD4\u56DE\u4EFB\u4F55\u5185\u5BB9\uFF0C\u6240\u4EE5\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\u6211\u53EA\u4F7F\u7528 <code>CompletableFuture</code> \u8C03\u7528 <code>join()</code> \u6765\u7B49\u5F85\u5B83\u5B8C\u6210\u3002</p><p>\u5728\u672C\u4F8B\u4E2D\u9700\u8981\u6CE8\u610F\u7684\u91CD\u8981\u4E00\u70B9\u662F\uFF0C\u8FD0\u884C\u4EFB\u52A1\u4E0D\u9700\u8981\u4F7F\u7528 <code>ExecutorService</code>\u3002\u800C\u662F\u76F4\u63A5\u4EA4\u7ED9 <code>CompletableFuture</code> \u7BA1\u7406 (\u4E0D\u8FC7\u4F60\u53EF\u4EE5\u5411\u5B83\u63D0\u4F9B\u81EA\u5DF1\u5B9A\u4E49\u7684 <code>ExectorService</code>)\u3002\u60A8\u4E5F\u4E0D\u9700\u8981\u8C03\u7528 <code>shutdown()</code>;\u4E8B\u5B9E\u4E0A\uFF0C\u9664\u975E\u4F60\u50CF\u6211\u5728\u8FD9\u91CC\u6240\u505A\u7684\u90A3\u6837\u663E\u5F0F\u5730\u8C03\u7528 <code>join()</code>\uFF0C\u5426\u5219\u7A0B\u5E8F\u5C06\u5C3D\u5FEB\u9000\u51FA\uFF0C\u800C\u4E0D\u5FC5\u7B49\u5F85\u4EFB\u52A1\u5B8C\u6210\u3002</p><p>\u8FD9\u4E2A\u4F8B\u5B50\u53EA\u662F\u4E00\u4E2A\u8D77\u70B9\u3002\u4F60\u5F88\u5FEB\u5C31\u4F1A\u770B\u5230 <code>ComplempleFuture</code> \u80FD\u591F\u505A\u5F97\u66F4\u591A\u3002</p><h3 id="\u57FA\u672C\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u7528\u6CD5" aria-hidden="true">#</a> \u57FA\u672C\u7528\u6CD5</h3><p>\u8FD9\u662F\u4E00\u4E2A\u5E26\u6709\u9759\u6001\u65B9\u6CD5 <strong>work()</strong> \u7684\u7C7B\uFF0C\u5B83\u5BF9\u8BE5\u7C7B\u7684\u5BF9\u8C61\u6267\u884C\u67D0\u4E9B\u5DE5\u4F5C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Machina.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Machina</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
        START<span class="token punctuation">,</span> ONE<span class="token punctuation">,</span> TWO<span class="token punctuation">,</span> THREE<span class="token punctuation">,</span> END<span class="token punctuation">;</span>
        <span class="token class-name">State</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">equals</span><span class="token punctuation">(</span>END<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> END<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">State</span> state <span class="token operator">=</span> <span class="token class-name">State</span><span class="token punctuation">.</span>START<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Machina</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Machina</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token class-name">Machina</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">State</span><span class="token punctuation">.</span>END<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m<span class="token punctuation">.</span>state <span class="token operator">=</span> m<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> m<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token string">&quot;Machina&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">State</span><span class="token punctuation">.</span>END<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token string">&quot;complete&quot;</span> <span class="token operator">:</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u662F\u4E00\u4E2A\u6709\u9650\u72B6\u6001\u673A\uFF0C\u4E00\u4E2A\u5FAE\u4E0D\u8DB3\u9053\u7684\u673A\u5668\uFF0C\u56E0\u4E3A\u5B83\u6CA1\u6709\u5206\u652F......\u5B83\u53EA\u662F\u4ECE\u5934\u5230\u5C3E\u904D\u5386\u4E00\u6761\u8DEF\u5F84\u3002<strong>work()</strong> \u65B9\u6CD5\u5C06\u673A\u5668\u4ECE\u4E00\u4E2A\u72B6\u6001\u79FB\u52A8\u5230\u4E0B\u4E00\u4E2A\u72B6\u6001\uFF0C\u5E76\u4E14\u9700\u8981 100 \u6BEB\u79D2\u624D\u80FD\u5B8C\u6210\u201C\u5DE5\u4F5C\u201D\u3002</p><p><strong>CompletableFuture</strong> \u53EF\u4EE5\u88AB\u7528\u6765\u505A\u7684\u4E00\u4EF6\u4E8B\u662F, \u4F7F\u7528 <strong>completedFuture()</strong> \u5C06\u5B83\u611F\u5174\u8DA3\u7684\u5BF9\u8C61\u8FDB\u884C\u5305\u88C5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CompletedMachina.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletedMachina</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Machina</span><span class="token punctuation">&gt;</span></span> cf <span class="token operator">=</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Machina</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Machina</span> m <span class="token operator">=</span> cf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Doesn&#39;t block</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span>
            <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>completedFuture()</strong> \u521B\u5EFA\u4E00\u4E2A\u201C\u5DF2\u7ECF\u5B8C\u6210\u201D\u7684 <strong>CompletableFuture</strong> \u3002\u5BF9\u8FD9\u6837\u4E00\u4E2A\u672A\u6765\u505A\u7684\u552F\u4E00\u6709\u7528\u7684\u4E8B\u60C5\u662F <strong>get()</strong> \u91CC\u9762\u7684\u5BF9\u8C61\uFF0C\u6240\u4EE5\u8FD9\u770B\u8D77\u6765\u4F3C\u4E4E\u6CA1\u6709\u7528\u3002\u6CE8\u610F <strong>CompletableFuture</strong> \u88AB\u8F93\u5165\u5230\u5B83\u5305\u542B\u7684\u5BF9\u8C61\u3002\u8FD9\u4E2A\u5F88\u91CD\u8981\u3002</p><p>\u901A\u5E38\uFF0C<strong>get()</strong> \u5728\u7B49\u5F85\u7ED3\u679C\u65F6\u963B\u585E\u8C03\u7528\u7EBF\u7A0B\u3002\u6B64\u5757\u53EF\u4EE5\u901A\u8FC7 <strong>InterruptedException</strong> \u6216 <strong>ExecutionException</strong> \u4E2D\u65AD\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u963B\u6B62\u6C38\u8FDC\u4E0D\u4F1A\u53D1\u751F\uFF0C\u56E0\u4E3A <strong>CompletableFuture</strong> \u5DF2\u7ECF\u5B8C\u6210\uFF0C\u6240\u4EE5\u7ED3\u679C\u7ACB\u5373\u53EF\u7528\u3002</p><p>\u5F53\u6211\u4EEC\u5C06 <strong>handle()</strong> \u5305\u88C5\u5728 <strong>CompletableFuture</strong> \u4E2D\u65F6\uFF0C\u53D1\u73B0\u6211\u4EEC\u53EF\u4EE5\u5728 <strong>CompletableFuture</strong> \u4E0A\u6DFB\u52A0\u64CD\u4F5C\u6765\u5904\u7406\u6240\u5305\u542B\u7684\u5BF9\u8C61\uFF0C\u4F7F\u5F97\u4E8B\u60C5\u53D8\u5F97\u66F4\u52A0\u6709\u8DA3\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CompletableApply.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableApply</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Machina</span><span class="token punctuation">&gt;</span></span> cf <span class="token operator">=</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Machina</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Machina</span><span class="token punctuation">&gt;</span></span> cf2 <span class="token operator">=</span>
            cf<span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Machina</span><span class="token punctuation">&gt;</span></span> cf3 <span class="token operator">=</span>
            cf2<span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Machina</span><span class="token punctuation">&gt;</span></span> cf4 <span class="token operator">=</span>
            cf3<span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Machina</span><span class="token punctuation">&gt;</span></span> cf5 <span class="token operator">=</span>
            cf4<span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u8F93\u51FA\u7ED3\u679C</strong>\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Machina0: ONE
Machina0: TWO
Machina0: THREE
Machina0: complete
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>thenApply()</code> \u5E94\u7528\u4E00\u4E2A\u63A5\u6536\u8F93\u5165\u5E76\u4EA7\u751F\u8F93\u51FA\u7684\u51FD\u6570\u3002\u5728\u672C\u4F8B\u4E2D\uFF0C<code>work()</code> \u51FD\u6570\u4EA7\u751F\u7684\u7C7B\u578B\u4E0E\u5B83\u6240\u63A5\u6536\u7684\u7C7B\u578B\u76F8\u540C \uFF08<code>Machina</code>\uFF09\uFF0C\u56E0\u6B64\u6BCF\u4E2A <code>CompletableFuture</code>\u6DFB\u52A0\u7684\u64CD\u4F5C\u7684\u8FD4\u56DE\u7C7B\u578B\u90FD\u4E3A <code>Machina</code>\uFF0C\u4F46\u662F (\u7C7B\u4F3C\u4E8E\u6D41\u4E2D\u7684 <code>map()</code> ) \u51FD\u6570\u4E5F\u53EF\u4EE5\u8FD4\u56DE\u4E0D\u540C\u7684\u7C7B\u578B\uFF0C\u8FD9\u5C06\u4F53\u73B0\u5728\u8FD4\u56DE\u7C7B\u578B\u4E0A\u3002</p><p>\u4F60\u53EF\u4EE5\u5728\u6B64\u5904\u770B\u5230\u6709\u5173 <strong>CompletableFutures</strong> \u7684\u91CD\u8981\u4FE1\u606F\uFF1A\u5B83\u4EEC\u4F1A\u5728\u4F60\u6267\u884C\u64CD\u4F5C\u65F6\u81EA\u52A8\u89E3\u5305\u5E76\u91CD\u65B0\u5305\u88C5\u5B83\u4EEC\u6240\u643A\u5E26\u7684\u5BF9\u8C61\u3002\u8FD9\u4F7F\u5F97\u7F16\u5199\u548C\u7406\u89E3\u4EE3\u7801\u53D8\u5F97\u66F4\u52A0\u7B80\u5355\uFF0C \u800C\u4E0D\u4F1A\u5728\u9677\u5165\u5728\u9EBB\u70E6\u7684\u7EC6\u8282\u4E2D\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u6D88\u9664\u4E2D\u95F4\u53D8\u91CF\u5E76\u5C06\u64CD\u4F5C\u94FE\u63A5\u5728\u4E00\u8D77\uFF0C\u5C31\u50CF\u6211\u4EEC\u4F7F\u7528 Streams \u4E00\u6837\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CompletableApplyChained.javaimport java.util.concurrent.*;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableApplyChained</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Machina</span><span class="token punctuation">&gt;</span></span> cf <span class="token operator">=</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Machina</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Machina0: ONE
Machina0: TWO
Machina0: THREE
Machina0: complete
514
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6211\u4EEC\u8FD8\u6DFB\u52A0\u4E86\u4E00\u4E2A <code>Timer</code>\uFF0C\u5B83\u7684\u529F\u80FD\u5728\u6BCF\u4E00\u6B65\u90FD\u663E\u6027\u5730\u589E\u52A0 100ms \u7B49\u5F85\u65F6\u95F4\u4E4B\u5916\uFF0C\u8FD8\u5C06 <code>CompletableFuture</code> \u5185\u90E8 <code>thenApply</code> \u5E26\u6765\u7684\u989D\u5916\u5F00\u9500\u7ED9\u4F53\u73B0\u51FA\u6765\u4E86\u3002 <strong>CompletableFutures</strong> \u7684\u4E00\u4E2A\u91CD\u8981\u597D\u5904\u662F\u5B83\u4EEC\u9F13\u52B1\u4F7F\u7528\u79C1\u6709\u5B50\u7C7B\u539F\u5219\uFF08\u4E0D\u5171\u4EAB\u4EFB\u4F55\u4E1C\u897F\uFF09\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u4F7F\u7528 <strong>thenApply()</strong> \u6765\u5E94\u7528\u4E00\u4E2A\u4E0D\u5BF9\u5916\u901A\u4FE1\u7684\u51FD\u6570 - \u5B83\u53EA\u9700\u8981\u4E00\u4E2A\u53C2\u6570\u5E76\u8FD4\u56DE\u4E00\u4E2A\u7ED3\u679C\u3002\u8FD9\u662F\u51FD\u6570\u5F0F\u7F16\u7A0B\u7684\u57FA\u7840\uFF0C\u5E76\u4E14\u5B83\u5728\u5E76\u53D1\u7279\u6027\u65B9\u9762\u975E\u5E38\u6709\u6548[^5]\u3002\u5E76\u884C\u6D41\u548C <code>ComplempleFutures</code> \u65E8\u5728\u652F\u6301\u8FD9\u4E9B\u539F\u5219\u3002\u53EA\u8981\u4F60\u4E0D\u51B3\u5B9A\u5171\u4EAB\u6570\u636E\uFF08\u5171\u4EAB\u975E\u5E38\u5BB9\u6613\u5BFC\u81F4\u610F\u5916\u53D1\u751F\uFF09\u4F60\u5C31\u53EF\u4EE5\u7F16\u5199\u51FA\u76F8\u5BF9\u5B89\u5168\u7684\u5E76\u53D1\u7A0B\u5E8F\u3002</p><p>\u56DE\u8C03 <code>thenApply()</code> \u4E00\u65E6\u5F00\u59CB\u4E00\u4E2A\u64CD\u4F5C\uFF0C\u5728\u5B8C\u6210\u6240\u6709\u4EFB\u52A1\u4E4B\u524D\uFF0C\u4E0D\u4F1A\u5B8C\u6210 <strong>CompletableFuture</strong> \u7684\u6784\u5EFA\u3002\u867D\u7136\u8FD9\u6709\u65F6\u5F88\u6709\u7528\uFF0C\u4F46\u662F\u5F00\u59CB\u6240\u6709\u4EFB\u52A1\u901A\u5E38\u66F4\u6709\u4EF7\u503C\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u8FD0\u884C\u7EE7\u7EED\u524D\u8FDB\u5E76\u6267\u884C\u5176\u4ED6\u64CD\u4F5C\u3002\u6211\u4EEC\u53EF\u901A\u8FC7<code>thenApplyAsync()</code> \u6765\u5B9E\u73B0\u6B64\u76EE\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CompletableApplyAsync.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableApplyAsync</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Machina</span><span class="token punctuation">&gt;</span></span> cf <span class="token operator">=</span>
            <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Machina</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Machina</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cf<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>116
Machina0: ONE
Machina0: TWO
Machina0:THREE
Machina0: complete
Machina0: complete
552
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540C\u6B65\u8C03\u7528 (\u6211\u4EEC\u901A\u5E38\u4F7F\u7528\u7684\u90A3\u79CD) \u610F\u5473\u7740\uFF1A\u201C\u5F53\u4F60\u5B8C\u6210\u5DE5\u4F5C\u65F6\uFF0C\u624D\u8FD4\u56DE\u201D\uFF0C\u800C\u5F02\u6B65\u8C03\u7528\u4EE5\u610F\u5473\u7740\uFF1A \u201C\u7ACB\u523B\u8FD4\u56DE\u5E76\u7EE7\u7EED\u540E\u7EED\u5DE5\u4F5C\u201D\u3002 \u6B63\u5982\u4F60\u6240\u770B\u5230\u7684\uFF0C<code>cf</code> \u7684\u521B\u5EFA\u73B0\u5728\u53D1\u751F\u7684\u66F4\u5FEB\u3002\u6BCF\u6B21\u8C03\u7528 <code>thenApplyAsync()</code> \u90FD\u4F1A\u7ACB\u523B\u8FD4\u56DE\uFF0C\u56E0\u6B64\u53EF\u4EE5\u8FDB\u884C\u4E0B\u4E00\u6B21\u8C03\u7528\uFF0C\u6574\u4E2A\u8C03\u7528\u94FE\u8DEF\u5B8C\u6210\u901F\u5EA6\u6BD4\u4EE5\u524D\u5FEB\u5F97\u591A\u3002</p><p>\u4E8B\u5B9E\u4E0A\uFF0C\u5982\u679C\u6CA1\u6709\u56DE\u8C03 <code>cf.join()</code> \u65B9\u6CD5\uFF0C\u7A0B\u5E8F\u4F1A\u5728\u5B8C\u6210\u5176\u5DE5\u4F5C\u4E4B\u524D\u9000\u51FA\u3002\u800C <code>cf.join()</code> \u76F4\u5230 cf \u64CD\u4F5C\u5B8C\u6210\u4E4B\u524D\uFF0C\u963B\u6B62 <code>main()</code> \u8FDB\u7A0B\u7ED3\u675F\u3002\u6211\u4EEC\u8FD8\u53EF\u4EE5\u770B\u51FA\u672C\u793A\u4F8B\u5927\u90E8\u5206\u65F6\u95F4\u6D88\u8017\u5728 <code>cf.join()</code> \u8FD9\u3002</p><p>\u8FD9\u79CD\u201C\u7ACB\u5373\u8FD4\u56DE\u201D\u7684\u5F02\u6B65\u80FD\u529B\u9700\u8981 <code>CompletableFuture</code> \u5E93\u8FDB\u884C\u4E00\u4E9B\u79D8\u5BC6\uFF08<code>client</code> \u65E0\u611F\uFF09\u5DE5\u4F5C\u3002\u7279\u522B\u662F\uFF0C\u5B83\u5C06\u4F60\u9700\u8981\u7684\u64CD\u4F5C\u94FE\u5B58\u50A8\u4E3A\u4E00\u7EC4\u56DE\u8C03\u3002\u5F53\u64CD\u4F5C\u7684\u7B2C\u4E00\u4E2A\u94FE\u8DEF\uFF08\u540E\u53F0\u64CD\u4F5C\uFF09\u5B8C\u6210\u5E76\u8FD4\u56DE\u65F6\uFF0C\u7B2C\u4E8C\u4E2A\u94FE\u8DEF\uFF08\u540E\u53F0\u64CD\u4F5C\uFF09\u5FC5\u987B\u83B7\u53D6\u751F\u6210\u7684 <code>Machina</code> \u5E76\u5F00\u59CB\u5DE5\u4F5C\uFF0C\u4EE5\u6B64\u7C7B\u63A8\uFF01 \u4F46\u8FD9\u79CD\u5F02\u6B65\u673A\u5236\u6CA1\u6709\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u7A0B\u5E8F\u8C03\u7528\u6808\u63A7\u5236\u7684\u666E\u901A\u51FD\u6570\u8C03\u7528\u5E8F\u5217\uFF0C\u5B83\u7684\u8C03\u7528\u94FE\u8DEF\u987A\u5E8F\u4F1A\u4E22\u5931\uFF0C\u56E0\u6B64\u5B83\u4F7F\u7528\u4E00\u4E2A\u51FD\u6570\u5730\u5740\u6765\u5B58\u50A8\u7684\u56DE\u8C03\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002</p><p>\u5E78\u8FD0\u7684\u662F\uFF0C\u8FD9\u5C31\u662F\u4F60\u9700\u8981\u4E86\u89E3\u7684\u6709\u5173\u56DE\u8C03\u7684\u5168\u90E8\u4FE1\u606F\u3002\u7A0B\u5E8F\u5458\u5C06\u8FD9\u79CD\u4EBA\u4E3A\u5236\u9020\u7684\u6DF7\u4E71\u79F0\u4E3A callback hell\uFF08\u56DE\u8C03\u5730\u72F1\uFF09\u3002\u901A\u8FC7\u5F02\u6B65\u8C03\u7528\uFF0C<code>CompletableFuture</code> \u5E2E\u4F60\u7BA1\u7406\u6240\u6709\u56DE\u8C03\u3002 \u9664\u975E\u4F60\u77E5\u9053\u4F60\u7CFB\u7EDF\u4E2D\u7684\u4E00\u4E9B\u7279\u5B9A\u903B\u8F91\u4F1A\u5BFC\u81F4\u67D0\u4E9B\u6539\u53D8\uFF0C\u6216\u8BB8\u4F60\u66F4\u60F3\u4F7F\u7528\u5F02\u6B65\u8C03\u7528\u6765\u5B9E\u73B0\u7A0B\u5E8F\u3002</p><ul><li>\u5176\u4ED6\u64CD\u4F5C</li></ul><p>\u5F53\u4F60\u67E5\u770B<code>CompletableFuture</code>\u7684 <code>Javadoc</code> \u65F6\uFF0C\u4F60\u4F1A\u770B\u5230\u5B83\u6709\u5F88\u591A\u65B9\u6CD5\uFF0C\u4F46\u8FD9\u4E2A\u65B9\u6CD5\u7684\u5927\u90E8\u5206\u6765\u81EA\u4E0D\u540C\u64CD\u4F5C\u7684\u53D8\u4F53\u3002\u4F8B\u5982\uFF0C\u6709 <code>thenApply()</code>\uFF0C<code>thenApplyAsync()</code> \u548C\u7B2C\u4E8C\u79CD\u5F62\u5F0F\u7684 <code>thenApplyAsync()</code>\uFF0C\u5B83\u4EEC\u4F7F\u7528 <code>Executor</code> \u6765\u8FD0\u884C\u4EFB\u52A1 (\u5728\u672C\u4E66\u4E2D\uFF0C\u6211\u4EEC\u5FFD\u7565\u4E86 <code>Executor</code> \u9009\u9879)\u3002</p><p>\u4E0B\u9762\u7684\u793A\u4F8B\u5C55\u793A\u4E86\u6240\u6709&quot;\u57FA\u672C&quot;\u64CD\u4F5C\uFF0C\u8FD9\u4E9B\u64CD\u4F5C\u65E2\u4E0D\u6D89\u53CA\u7EC4\u5408\u4E24\u4E2A <code>CompletableFuture</code>\uFF0C\u4E5F\u4E0D\u6D89\u53CA\u5F02\u5E38 (\u6211\u4EEC\u5C06\u5728\u540E\u9762\u4ECB\u7ECD)\u3002\u9996\u5148\uFF0C\u4E3A\u4E86\u63D0\u4F9B\u7B80\u6D01\u6027\u548C\u65B9\u4FBF\u6027\uFF0C\u6211\u4EEC\u5E94\u8BE5\u91CD\u7528\u4EE5\u4E0B\u4E24\u4E2A\u5B9E\u7528\u7A0B\u5E8F:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">onjava</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableUtilities</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get and show value stored in a CF:</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">showr</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span>
            <span class="token operator">|</span> <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// For CF operations that have no value:</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">voidr</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      c<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns void</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span>
            <span class="token operator">|</span> <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>showr()</code> \u5728 <code>CompletableFuture&lt;Integer&gt;</code> \u4E0A\u8C03\u7528 <code>get()</code>\uFF0C\u5E76\u663E\u793A\u7ED3\u679C\uFF0C<code>try/catch</code> \u4E24\u4E2A\u53EF\u80FD\u4F1A\u51FA\u73B0\u7684\u5F02\u5E38\u3002</p><p><code>voidr()</code> \u662F <code>CompletableFuture&lt;Void&gt;</code> \u7684 <code>showr()</code> \u7248\u672C\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C<code>CompletableFutures</code> \u53EA\u4E3A\u4EFB\u52A1\u5B8C\u6210\u6216\u5931\u8D25\u65F6\u663E\u793A\u4FE1\u606F\u3002</p><p>\u4E3A\u7B80\u5355\u8D77\u89C1\uFF0C\u4E0B\u9762\u7684 <code>CompletableFutures</code> \u53EA\u5305\u88C5\u6574\u6570\u3002<code>cfi()</code> \u662F\u4E00\u4E2A\u4FBF\u5229\u7684\u65B9\u6CD5\uFF0C\u5B83\u628A\u4E00\u4E2A\u6574\u6570\u5305\u88C5\u5728\u4E00\u4E2A\u5B8C\u6574\u7684 <code>CompletableFuture&lt;Integer&gt;</code> :</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CompletableOperations.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">CompletableUtilities</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableOperations</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">cfi</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
                <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>
                        <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showr</span><span class="token punctuation">(</span><span class="token function">cfi</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Basic test</span>
        <span class="token function">voidr</span><span class="token punctuation">(</span><span class="token function">cfi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;runAsync&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">voidr</span><span class="token punctuation">(</span><span class="token function">cfi</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thenRunAsync&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">voidr</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;runAsync is static&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showr</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">voidr</span><span class="token punctuation">(</span><span class="token function">cfi</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thenAcceptAsync: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showr</span><span class="token punctuation">(</span><span class="token function">cfi</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i <span class="token operator">+</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showr</span><span class="token punctuation">(</span><span class="token function">cfi</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenComposeAsync</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token function">cfi</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token function">cfi</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">obtrudeValue</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showr</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showr</span><span class="token punctuation">(</span><span class="token function">cfi</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toCompletableFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showr</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;cancelled: &quot;</span> <span class="token operator">+</span>
                c<span class="token punctuation">.</span><span class="token function">isCancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;completed exceptionally: &quot;</span> <span class="token operator">+</span>
                c<span class="token punctuation">.</span><span class="token function">isCompletedExceptionally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;done: &quot;</span> <span class="token operator">+</span> c<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">777</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i <span class="token operator">+</span> <span class="token number">42</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i <span class="token operator">*</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;dependents: &quot;</span> <span class="token operator">+</span>
                c<span class="token punctuation">.</span><span class="token function">getNumberOfDependents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;dependents: &quot;</span> <span class="token operator">+</span>
                c<span class="token punctuation">.</span><span class="token function">getNumberOfDependents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u8F93\u51FA\u7ED3\u679C</strong> \uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1
runAsync
thenRunAsync
runAsync is static
99
thenAcceptAsync: 4
47
105
111
8
9
cancelled: true
completed exceptionally: true
done: true
java.util.concurrent.CompletableFuture@6d311334[Complet ed exceptionally]
777
dependents: 1
dependents: 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>main()</code> \u5305\u542B\u4E00\u7CFB\u5217\u53EF\u7531\u5176 <code>int</code> \u503C\u5F15\u7528\u7684\u6D4B\u8BD5\u3002 <ul><li><code>cfi(1)</code> \u6F14\u793A\u4E86 <code>showr()</code> \u6B63\u5E38\u5DE5\u4F5C\u3002</li><li><code>cfi(2)</code> \u662F\u8C03\u7528 <code>runAsync()</code> \u7684\u793A\u4F8B\u3002\u7531\u4E8E <code>Runnable</code> \u4E0D\u4EA7\u751F\u8FD4\u56DE\u503C\uFF0C\u56E0\u6B64\u4F7F\u7528\u4E86\u8FD4\u56DE <code>CompletableFuture &lt;Void&gt;</code> \u7684<code>voidr()</code> \u65B9\u6CD5\u3002</li><li>\u6CE8\u610F\u4F7F\u7528 <code>cfi(3)</code>,<code>thenRunAsync()</code> \u6548\u679C\u4F3C\u4E4E\u4E0E \u4E0A\u4F8B <code>cfi(2)</code> \u4F7F\u7528\u7684 <code>runAsync()</code>\u76F8\u540C\uFF0C\u5DEE\u5F02\u5728\u540E\u7EED\u7684\u6D4B\u8BD5\u4E2D\u4F53\u73B0\uFF1A <ul><li><code>runAsync()</code> \u662F\u4E00\u4E2A <code>static</code> \u65B9\u6CD5\uFF0C\u6240\u4EE5\u4F60\u901A\u5E38\u4E0D\u4F1A\u50CF<code>cfi(2)</code>\u4E00\u6837\u8C03\u7528\u5B83\u3002\u76F8\u53CD\u4F60\u53EF\u4EE5\u5728 <code>QuittingCompletable.java</code> \u4E2D\u4F7F\u7528\u5B83\u3002</li><li>\u540E\u7EED\u6D4B\u8BD5\u4E2D\u8868\u660E <code>supplyAsync()</code> \u4E5F\u662F\u9759\u6001\u65B9\u6CD5\uFF0C\u533A\u522B\u5728\u4E8E\u5B83\u9700\u8981\u4E00\u4E2A <code>Supplier</code> \u800C\u4E0D\u662F<code>Runnable</code>, \u5E76\u4EA7\u751F\u4E00\u4E2A<code>CompletableFuture&lt;Integer&gt;</code> \u800C\u4E0D\u662F <code>CompletableFuture&lt;Void&gt;</code>\u3002</li></ul></li><li><code>then</code> \u7CFB\u5217\u65B9\u6CD5\u5C06\u5BF9\u73B0\u6709\u7684 <code>CompletableFuture&lt;Integer&gt;</code> \u8FDB\u4E00\u6B65\u64CD\u4F5C\u3002 <ul><li>\u4E0E <code>thenRunAsync()</code> \u4E0D\u540C\uFF0C<code>cfi(4)</code>\uFF0C<code>cfi(5)</code> \u548C<code>cfi(6)</code> &quot;then&quot; \u65B9\u6CD5\u7684\u53C2\u6570\u662F\u672A\u5305\u88C5\u7684 <code>Integer</code>\u3002</li><li>\u901A\u8FC7\u4F7F\u7528 <code>voidr()</code>\u65B9\u6CD5\u53EF\u4EE5\u770B\u5230: <ul><li><code>AcceptAsync()</code>\u63A5\u6536\u4E86\u4E00\u4E2A <code>Consumer</code>\uFF0C\u56E0\u6B64\u4E0D\u4F1A\u4EA7\u751F\u7ED3\u679C\u3002</li><li><code>thenApplyAsync()</code> \u63A5\u6536\u4E00\u4E2A<code>Function</code>, \u5E76\u751F\u6210\u4E00\u4E2A\u7ED3\u679C\uFF08\u8BE5\u7ED3\u679C\u7684\u7C7B\u578B\u53EF\u4EE5\u4E0D\u540C\u4E8E\u5176\u8F93\u5165\u7C7B\u578B\uFF09\u3002</li><li><code>thenComposeAsync()</code> \u4E0E <code>thenApplyAsync()</code>\u975E\u5E38\u76F8\u4F3C\uFF0C\u552F\u4E00\u533A\u522B\u5728\u4E8E\u5176 <code>Function</code> \u5FC5\u987B\u4EA7\u751F\u5DF2\u7ECF\u5305\u88C5\u5728<code>CompletableFuture</code>\u4E2D\u7684\u7ED3\u679C\u3002</li></ul></li></ul></li><li><code>cfi(7)</code> \u793A\u4F8B\u6F14\u793A\u4E86 <code>obtrudeValue()</code>\uFF0C\u5B83\u5F3A\u5236\u5C06\u503C\u4F5C\u4E3A\u7ED3\u679C\u3002</li><li><code>cfi(8)</code> \u4F7F\u7528 <code>toCompletableFuture()</code> \u4ECE <code>CompletionStage</code> \u751F\u6210\u4E00\u4E2A<code>CompletableFuture</code>\u3002</li><li><code>c.complete(9)</code> \u663E\u793A\u4E86\u5982\u4F55\u901A\u8FC7\u7ED9\u5B83\u4E00\u4E2A\u7ED3\u679C\u6765\u5B8C\u6210\u4E00\u4E2A<code>task</code>\uFF08<code>future</code>\uFF09\uFF08\u4E0E <code>obtrudeValue()</code> \u76F8\u5BF9\uFF0C\u540E\u8005\u53EF\u80FD\u4F1A\u8FEB\u4F7F\u5176\u7ED3\u679C\u66FF\u6362\u8BE5\u7ED3\u679C\uFF09\u3002</li><li>\u5982\u679C\u4F60\u8C03\u7528 <code>CompletableFuture</code>\u4E2D\u7684 <code>cancel()</code>\u65B9\u6CD5\uFF0C\u5982\u679C\u5DF2\u7ECF\u5B8C\u6210\u6B64\u4EFB\u52A1\uFF0C\u5219\u6B63\u5E38\u7ED3\u675F\u3002 \u5982\u679C\u5C1A\u672A\u5B8C\u6210\uFF0C\u5219\u4F7F\u7528 <code>CancellationException</code> \u5B8C\u6210\u6B64 <code>CompletableFuture</code>\u3002</li><li>\u5982\u679C\u4EFB\u52A1\uFF08<code>future</code>\uFF09\u5B8C\u6210\uFF0C\u5219 <strong>getNow()</strong> \u65B9\u6CD5\u8FD4\u56DE<code>CompletableFuture</code>\u7684\u5B8C\u6210\u503C\uFF0C\u5426\u5219\u8FD4\u56DE<code>getNow()</code>\u7684\u66FF\u6362\u53C2\u6570\u3002</li><li>\u6700\u540E\uFF0C\u6211\u4EEC\u770B\u4E00\u4E0B\u4F9D\u8D56 (<code>dependents</code>) \u7684\u6982\u5FF5\u3002\u5982\u679C\u6211\u4EEC\u5C06\u4E24\u4E2A<code>thenApplyAsync()</code>\u8C03\u7528\u94FE\u8DEF\u5230<code>CompletableFuture</code>\u4E0A\uFF0C\u5219\u4F9D\u8D56\u9879\u7684\u6570\u91CF\u4E0D\u4F1A\u589E\u52A0\uFF0C\u4FDD\u6301\u4E3A 1\u3002\u4F46\u662F\uFF0C\u5982\u679C\u6211\u4EEC\u53E6\u5916\u5C06\u53E6\u4E00\u4E2A<code>thenApplyAsync()</code>\u76F4\u63A5\u9644\u52A0\u5230<code>c</code>\uFF0C\u5219\u73B0\u5728\u6709\u4E24\u4E2A\u4F9D\u8D56\u9879\uFF1A\u4E24\u4E2A\u4E00\u8D77\u7684\u94FE\u8DEF\u548C\u53E6\u4E00\u4E2A\u5355\u72EC\u9644\u52A0\u7684\u94FE\u8DEF\u3002 <ul><li>\u8FD9\u8868\u660E\u4F60\u53EF\u4EE5\u4F7F\u7528\u4E00\u4E2A<code>CompletionStage</code>\uFF0C\u5F53\u5B83\u5B8C\u6210\u65F6\uFF0C\u53EF\u4EE5\u6839\u636E\u5176\u7ED3\u679C\u6D3E\u751F\u591A\u4E2A\u65B0\u4EFB\u52A1\u3002</li></ul></li></ul></li></ul><h3 id="\u7ED3\u5408-completablefuture" tabindex="-1"><a class="header-anchor" href="#\u7ED3\u5408-completablefuture" aria-hidden="true">#</a> \u7ED3\u5408 CompletableFuture</h3><p>\u7B2C\u4E8C\u79CD\u7C7B\u578B\u7684 <code>CompletableFuture</code> \u65B9\u6CD5\u91C7\u7528\u4E24\u79CD <code>CompletableFuture</code> \u5E76\u4EE5\u5404\u5F02\u65B9\u5F0F\u5C06\u5B83\u4EEC\u7EC4\u5408\u5728\u4E00\u8D77\u3002\u5C31\u50CF\u4E24\u4E2A\u4EBA\u5728\u6BD4\u8D5B\u4E00\u6837, \u4E00\u4E2A<code>CompletableFuture</code>\u901A\u5E38\u6BD4\u53E6\u4E00\u4E2A\u66F4\u65E9\u5730\u5230\u8FBE\u7EC8\u70B9\u3002\u8FD9\u4E9B\u65B9\u6CD5\u5141\u8BB8\u4F60\u4EE5\u4E0D\u540C\u7684\u65B9\u5F0F\u5904\u7406\u7ED3\u679C\u3002 \u4E3A\u4E86\u6D4B\u8BD5\u8FD9\u4E00\u70B9\uFF0C\u6211\u4EEC\u5C06\u521B\u5EFA\u4E00\u4E2A\u4EFB\u52A1\uFF0C\u5B83\u6709\u4E00\u4E2A\u6211\u4EEC\u53EF\u4EE5\u63A7\u5236\u7684\u5B9A\u4E49\u4E86\u5B8C\u6210\u4EFB\u52A1\u6240\u9700\u8981\u7684\u65F6\u95F4\u91CF\u7684\u53C2\u6570\u3002 CompletableFuture \u5148\u5B8C\u6210:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Workable.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Workable</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">double</span> duration<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Workable</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token keyword">double</span> duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> duration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Workable[&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Workable</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token class-name">Workable</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Seconds</span>
        tt<span class="token punctuation">.</span>id <span class="token operator">=</span> tt<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot;W&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Workable</span><span class="token punctuation">&gt;</span></span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token keyword">double</span> duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span>
                <span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">Workable</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> duration<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Workable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 <code>make()</code>\u4E2D\uFF0C<code>work()</code>\u65B9\u6CD5\u5E94\u7528\u4E8E<code>CompletableFuture</code>\u3002<code>work()</code>\u9700\u8981\u4E00\u5B9A\u7684\u65F6\u95F4\u624D\u80FD\u5B8C\u6210\uFF0C\u7136\u540E\u5B83\u5C06\u5B57\u6BCD W \u9644\u52A0\u5230 id \u4E0A\uFF0C\u8868\u793A\u5DE5\u4F5C\u5DF2\u7ECF\u5B8C\u6210\u3002</p><p>\u73B0\u5728\u6211\u4EEC\u53EF\u4EE5\u521B\u5EFA\u591A\u4E2A\u7ADE\u4E89\u7684 <code>CompletableFuture</code>\uFF0C\u5E76\u4F7F\u7528 <code>CompletableFuture</code> \u5E93\u4E2D\u7684\u5404\u79CD\u65B9\u6CD5\u6765\u8FDB\u884C\u64CD\u4F5C:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/DualCompletableOperations.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">CompletableUtilities</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DualCompletableOperations</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Workable</span><span class="token punctuation">&gt;</span></span> cfA<span class="token punctuation">,</span> cfB<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cfA <span class="token operator">=</span> <span class="token class-name">Workable</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cfB <span class="token operator">=</span> <span class="token class-name">Workable</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token number">0.10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Always wins</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cfA<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cfB<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;*****************&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">voidr</span><span class="token punctuation">(</span>cfA<span class="token punctuation">.</span><span class="token function">runAfterEitherAsync</span><span class="token punctuation">(</span>cfB<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;runAfterEither&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">voidr</span><span class="token punctuation">(</span>cfA<span class="token punctuation">.</span><span class="token function">runAfterBothAsync</span><span class="token punctuation">(</span>cfB<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;runAfterBoth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showr</span><span class="token punctuation">(</span>cfA<span class="token punctuation">.</span><span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span>cfB<span class="token punctuation">,</span> w <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;applyToEither: &quot;</span> <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> w<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">voidr</span><span class="token punctuation">(</span>cfA<span class="token punctuation">.</span><span class="token function">acceptEitherAsync</span><span class="token punctuation">(</span>cfB<span class="token punctuation">,</span> w <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;acceptEither: &quot;</span> <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">voidr</span><span class="token punctuation">(</span>cfA<span class="token punctuation">.</span><span class="token function">thenAcceptBothAsync</span><span class="token punctuation">(</span>cfB<span class="token punctuation">,</span> <span class="token punctuation">(</span>w1<span class="token punctuation">,</span> w2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thenAcceptBoth: &quot;</span>
                    <span class="token operator">+</span> w1 <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> w2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">showr</span><span class="token punctuation">(</span>cfA<span class="token punctuation">.</span><span class="token function">thenCombineAsync</span><span class="token punctuation">(</span>cfB<span class="token punctuation">,</span> <span class="token punctuation">(</span>w1<span class="token punctuation">,</span> w2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thenCombine: &quot;</span>
                    <span class="token operator">+</span> w1 <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> w2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> w1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Workable</span><span class="token punctuation">&gt;</span></span>
                cfC <span class="token operator">=</span> <span class="token class-name">Workable</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                cfD <span class="token operator">=</span> <span class="token class-name">Workable</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span> <span class="token number">0.09</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">anyOf</span><span class="token punctuation">(</span>cfA<span class="token punctuation">,</span> cfB<span class="token punctuation">,</span> cfC<span class="token punctuation">,</span> cfD<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;anyOf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cfC <span class="token operator">=</span> <span class="token class-name">Workable</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cfD <span class="token operator">=</span> <span class="token class-name">Workable</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span> <span class="token number">0.09</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>cfA<span class="token punctuation">,</span> cfB<span class="token punctuation">,</span> cfC<span class="token punctuation">,</span> cfD<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;allOf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u8F93\u51FA\u7ED3\u679C</strong>\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Workable[BW]
runAfterEither
Workable[AW]
*****************
Workable[BW]
Workable[AW]
runAfterBoth
*****************
Workable[BW]
applyToEither: Workable[BW]
Workable[BW]
Workable[AW]
*****************
Workable[BW]
acceptEither: Workable[BW]
Workable[AW]
*****************
Workable[BW]
Workable[AW]
thenAcceptBoth: Workable[AW], Workable[BW]
****************
 Workable[BW]
 Workable[AW]
 thenCombine: Workable[AW], Workable[BW]
 Workable[AW]
 *****************
 Workable[CW]
 anyOf
 Workable[DW]
 Workable[BW]
 Workable[AW]
 *****************
 Workable[CW]
 Workable[DW]
 Workable[BW]
 Workable[AW]
 *****************
 allOf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u4E3A\u4E86\u65B9\u4FBF\u8BBF\u95EE\uFF0C \u5C06 <code>cfA</code> \u548C <code>cfB</code> \u5B9A\u4E49\u4E3A <code>static</code>\u7684\u3002 <ul><li><code>init()</code>\u65B9\u6CD5\u7528\u4E8E <code>A</code>, <code>B</code> \u521D\u59CB\u5316\u8FD9\u4E24\u4E2A\u53D8\u91CF\uFF0C\u56E0\u4E3A <code>B</code> \u603B\u662F\u7ED9\u51FA\u6BD4<code>A</code>\u8F83\u77ED\u7684\u5EF6\u8FDF\uFF0C\u6240\u4EE5\u603B\u662F <code>win</code> \u7684\u4E00\u65B9\u3002</li><li><code>join()</code> \u662F\u5728\u4E24\u4E2A\u65B9\u6CD5\u4E0A\u8C03\u7528 <code>join()</code> \u5E76\u663E\u793A\u8FB9\u6846\u7684\u53E6\u4E00\u4E2A\u4FBF\u5229\u65B9\u6CD5\u3002</li></ul></li><li>\u6240\u6709\u8FD9\u4E9B \u201C<code>dual</code>\u201D \u65B9\u6CD5\u90FD\u4EE5\u4E00\u4E2A <code>CompletableFuture</code> \u4F5C\u4E3A\u8C03\u7528\u8BE5\u65B9\u6CD5\u7684\u5BF9\u8C61\uFF0C\u7B2C\u4E8C\u4E2A <code>CompletableFuture</code> \u4F5C\u4E3A\u7B2C\u4E00\u4E2A\u53C2\u6570\uFF0C\u7136\u540E\u662F\u8981\u6267\u884C\u7684\u64CD\u4F5C\u3002</li><li>\u901A\u8FC7\u4F7F\u7528 <code>showr()</code> \u548C <code>voidr()</code> \u53EF\u4EE5\u770B\u5230\uFF0C\u201C<code>run</code>\u201D\u548C\u201C<code>accept</code>\u201D\u662F\u7EC8\u7AEF\u64CD\u4F5C\uFF0C\u800C\u201C<code>apply</code>\u201D\u548C\u201C<code>combine</code>\u201D\u5219\u751F\u6210\u65B0\u7684 <code>payload-bearing</code> (\u627F\u8F7D\u8D1F\u8F7D) \u7684 <code>CompletableFuture</code>\u3002</li><li>\u65B9\u6CD5\u7684\u540D\u79F0\u4E0D\u8A00\u81EA\u660E\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7\u67E5\u770B\u8F93\u51FA\u6765\u9A8C\u8BC1\u8FD9\u4E00\u70B9\u3002\u4E00\u4E2A\u7279\u522B\u6709\u8DA3\u7684\u65B9\u6CD5\u662F <code>combineAsync()</code>\uFF0C\u5B83\u7B49\u5F85\u4E24\u4E2A <code>CompletableFuture</code> \u5B8C\u6210\uFF0C\u7136\u540E\u5C06\u5B83\u4EEC\u90FD\u4EA4\u7ED9\u4E00\u4E2A <code>BiFunction</code>\uFF0C\u8FD9\u4E2A <code>BiFunction</code> \u53EF\u4EE5\u5C06\u7ED3\u679C\u52A0\u5165\u5230\u6700\u7EC8\u7684 <code>CompletableFuture</code> \u7684\u6709\u6548\u8D1F\u8F7D\u4E2D\u3002</li></ul><h3 id="\u6A21\u62DF" tabindex="-1"><a class="header-anchor" href="#\u6A21\u62DF" aria-hidden="true">#</a> \u6A21\u62DF</h3><p>\u4F5C\u4E3A\u4F7F\u7528 <code>CompletableFuture</code> \u5C06\u4E00\u7CFB\u5217\u64CD\u4F5C\u7EC4\u5408\u7684\u793A\u4F8B\uFF0C\u8BA9\u6211\u4EEC\u6A21\u62DF\u4E00\u4E0B\u5236\u4F5C\u86CB\u7CD5\u7684\u8FC7\u7A0B\u3002\u5728\u7B2C\u4E00\u9636\u6BB5\uFF0C\u6211\u4EEC\u51C6\u5907\u5E76\u5C06\u539F\u6599\u6DF7\u5408\u6210\u9762\u7CCA:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Batter.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Batter</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Eggs</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Milk</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Sugar</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Flour</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token class-name">T</span> ingredient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ingredient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">prep</span><span class="token punctuation">(</span><span class="token class-name">T</span> ingredient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span>
                <span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>ingredient<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Batter</span><span class="token operator">::</span><span class="token function">prepare</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Batter</span><span class="token punctuation">&gt;</span></span> <span class="token function">mix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Eggs</span><span class="token punctuation">&gt;</span></span> eggs <span class="token operator">=</span> <span class="token function">prep</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Eggs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Milk</span><span class="token punctuation">&gt;</span></span> milk <span class="token operator">=</span> <span class="token function">prep</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Milk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Sugar</span><span class="token punctuation">&gt;</span></span> sugar <span class="token operator">=</span> <span class="token function">prep</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Sugar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Flour</span><span class="token punctuation">&gt;</span></span> flour <span class="token operator">=</span> <span class="token function">prep</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Flour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span>
                <span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>eggs<span class="token punctuation">,</span> milk<span class="token punctuation">,</span> sugar<span class="token punctuation">,</span> flour<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mixing time</span>
        <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Batter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6BCF\u79CD\u539F\u6599\u90FD\u9700\u8981\u4E00\u4E9B\u65F6\u95F4\u6765\u51C6\u5907\u3002<code>allOf()</code> \u7B49\u5F85\u6240\u6709\u7684\u914D\u6599\u90FD\u51C6\u5907\u597D\uFF0C\u7136\u540E\u4F7F\u7528\u66F4\u591A\u4E9B\u7684\u65F6\u95F4\u5C06\u5176\u6DF7\u5408\u6210\u9762\u7CCA\u3002\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u628A\u5355\u6279\u9762\u7CCA\u653E\u5165\u56DB\u4E2A\u5E73\u5E95\u9505\u4E2D\u70D8\u70E4\u3002\u4EA7\u54C1\u4F5C\u4E3A <code>CompletableFutures</code> \u6D41\u8FD4\u56DE\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Baked.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Baked</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Pan</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">Pan</span> <span class="token function">pan</span><span class="token punctuation">(</span><span class="token class-name">Batter</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Pan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">Baked</span> <span class="token function">heat</span><span class="token punctuation">(</span><span class="token class-name">Pan</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Baked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Baked</span><span class="token punctuation">&gt;</span></span> <span class="token function">bake</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Batter</span><span class="token punctuation">&gt;</span></span> cfb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> cfb
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Baked</span><span class="token operator">::</span><span class="token function">pan</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Baked</span><span class="token operator">::</span><span class="token function">heat</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">&lt;</span><span class="token class-name">Baked</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Batter</span><span class="token punctuation">&gt;</span></span> batter <span class="token operator">=</span> <span class="token class-name">Batter</span><span class="token punctuation">.</span><span class="token function">mix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
                <span class="token function">bake</span><span class="token punctuation">(</span>batter<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">bake</span><span class="token punctuation">(</span>batter<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">bake</span><span class="token punctuation">(</span>batter<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">bake</span><span class="token punctuation">(</span>batter<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6700\u540E\uFF0C\u6211\u4EEC\u5236\u4F5C\u4E86\u4E00\u6279\u7CD6\uFF0C\u5E76\u7528\u5B83\u5BF9\u86CB\u7CD5\u8FDB\u884C\u7CD6\u5316\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/FrostedCake.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Frosting</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Frosting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Frosting</span><span class="token punctuation">&gt;</span></span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span>
                <span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Frosting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FrostedCake</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">FrostedCake</span><span class="token punctuation">(</span><span class="token class-name">Baked</span> baked<span class="token punctuation">,</span> <span class="token class-name">Frosting</span> frosting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;FrostedCake&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Baked</span><span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
                baked <span class="token operator">-&gt;</span> baked
                        <span class="token punctuation">.</span><span class="token function">thenCombineAsync</span><span class="token punctuation">(</span><span class="token class-name">Frosting</span><span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token punctuation">(</span>cake<span class="token punctuation">,</span> frosting<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                                        <span class="token keyword">new</span> <span class="token class-name">FrostedCake</span><span class="token punctuation">(</span>cake<span class="token punctuation">,</span> frosting<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u65E6\u4F60\u4E60\u60EF\u4E86\u8FD9\u79CD\u80CC\u540E\u7684\u60F3\u6CD5, <code>CompletableFuture</code> \u5B83\u4EEC\u76F8\u5BF9\u6613\u4E8E\u4F7F\u7528\u3002</p><h3 id="\u5F02\u5E38" tabindex="-1"><a class="header-anchor" href="#\u5F02\u5E38" aria-hidden="true">#</a> \u5F02\u5E38</h3><p>\u4E0E <code>CompletableFuture</code> \u5728\u5904\u7406\u94FE\u4E2D\u5305\u88C5\u5BF9\u8C61\u7684\u65B9\u5F0F\u76F8\u540C\uFF0C\u5B83\u4E5F\u4F1A\u7F13\u51B2\u5F02\u5E38\u3002\u8FD9\u4E9B\u5728\u5904\u7406\u65F6\u8C03\u7528\u8005\u662F\u65E0\u611F\u7684\uFF0C\u4F46\u4EC5\u5F53\u4F60\u5C1D\u8BD5\u63D0\u53D6\u7ED3\u679C\u65F6\u624D\u4F1A\u88AB\u544A\u77E5\u3002\u4E3A\u4E86\u8BF4\u660E\u5B83\u4EEC\u662F\u5982\u4F55\u5DE5\u4F5C\u7684\uFF0C\u6211\u4EEC\u9996\u5148\u521B\u5EFA\u4E00\u4E2A\u7C7B\uFF0C\u5B83\u5728\u7279\u5B9A\u7684\u6761\u4EF6\u4E0B\u629B\u51FA\u4E00\u4E2A\u5F02\u5E38:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Breakable.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Breakable</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> failcount<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Breakable</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token keyword">int</span> failcount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>failcount <span class="token operator">=</span> failcount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Breakable_&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot; [&quot;</span> <span class="token operator">+</span> failcount <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Breakable</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>b<span class="token punctuation">.</span>failcount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;Throwing Exception for &quot;</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;Breakable_&quot;</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot; failed&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53<code>failcount</code> &gt; 0\uFF0C\u4E14\u6BCF\u6B21\u5C06\u5BF9\u8C61\u4F20\u9012\u7ED9 <code>work()</code> \u65B9\u6CD5\u65F6\uFF0C <code>failcount - 1</code> \u3002\u5F53<code>failcount - 1 = 0</code> \u65F6\uFF0C<code>work()</code> \u5C06\u629B\u51FA\u4E00\u4E2A\u5F02\u5E38\u3002\u5982\u679C\u4F20\u7ED9 <code>work()</code> \u7684 <code>failcount = 0</code> \uFF0C<code>work()</code> \u6C38\u8FDC\u4E0D\u4F1A\u629B\u51FA\u5F02\u5E38\u3002</p><p>\u6CE8\u610F\uFF0C\u5F02\u5E38\u4FE1\u606F\u6B64\u793A\u4F8B\u4E2D\u88AB\u629B\u51FA\uFF08 <code>RuntimeException</code> )</p><p>\u5728\u4E0B\u9762\u793A\u4F8B <code>test()</code> \u65B9\u6CD5\u4E2D\uFF0C<code>work()</code> \u591A\u6B21\u5E94\u7528\u4E8E <code>Breakable</code>\uFF0C\u56E0\u6B64\u5982\u679C <code>failcount</code> \u5728\u8303\u56F4\u5185\uFF0C\u5C31\u4F1A\u629B\u51FA\u5F02\u5E38\u3002\u7136\u800C\uFF0C\u5728\u6D4B\u8BD5<code>A</code>\u5230<code>E</code>\u4E2D\uFF0C\u4F60\u53EF\u4EE5\u4ECE\u8F93\u51FA\u4E2D\u770B\u5230\u629B\u51FA\u4E86\u5F02\u5E38\uFF0C\u4F46\u5B83\u4EEC\u4ECE\u672A\u51FA\u73B0:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CompletableExceptions.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableExceptions</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Breakable</span><span class="token punctuation">&gt;</span></span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token keyword">int</span> failcount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Breakable</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> failcount<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Exceptions don&#39;t appear ...</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;E&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ... until you try to fetch the value:</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;F&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or join()</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Test for exceptions:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;G&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isCompletedExceptionally</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Counts as &quot;done&quot;:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;H&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Force an exception:</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> cfi <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;done? &quot;</span> <span class="token operator">+</span> cfi<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cfi<span class="token punctuation">.</span><span class="token function">completeExceptionally</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;forced&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            cfi<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Throwing Exception for A
Breakable_B [1]
Throwing Exception for B
Breakable_C [2]
Breakable_C [1]
Throwing Exception for C
Breakable_D [3]
Breakable_D [2]
Breakable_D [1]
Throwing Exception for D
Breakable_E [4]
Breakable_E [3]
Breakable_E [2]
Breakable_E [1]
Breakable_F [1]
Throwing Exception for F
java.lang.RuntimeException: Breakable_F failed
Breakable_G [1]
Throwing Exception for G
true
Breakable_H [1]
Throwing Exception for H
true
done? false
java.lang.RuntimeException: forced
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5 <code>A</code> \u5230 <code>E</code> \u8FD0\u884C\u5230\u629B\u51FA\u5F02\u5E38\uFF0C\u7136\u540E\u2026\u5E76\u6CA1\u6709\u5C06\u629B\u51FA\u7684\u5F02\u5E38\u66B4\u9732\u7ED9\u8C03\u7528\u65B9\u3002\u53EA\u6709\u5728\u6D4B\u8BD5 F \u4E2D\u8C03\u7528 <code>get()</code> \u65F6\uFF0C\u6211\u4EEC\u624D\u4F1A\u770B\u5230\u629B\u51FA\u7684\u5F02\u5E38\u3002 \u6D4B\u8BD5 <code>G</code> \u8868\u660E\uFF0C\u4F60\u53EF\u4EE5\u9996\u5148\u68C0\u67E5\u5728\u5904\u7406\u671F\u95F4\u662F\u5426\u629B\u51FA\u5F02\u5E38\uFF0C\u800C\u4E0D\u629B\u51FA\u8BE5\u5F02\u5E38\u3002\u7136\u800C\uFF0Ctest <code>H</code> \u544A\u8BC9\u6211\u4EEC\uFF0C\u4E0D\u7BA1\u5F02\u5E38\u662F\u5426\u6210\u529F\uFF0C\u5B83\u4ECD\u7136\u88AB\u89C6\u4E3A\u5DF2\u201C\u5B8C\u6210\u201D\u3002 \u4EE3\u7801\u7684\u6700\u540E\u4E00\u90E8\u5206\u5C55\u793A\u4E86\u5982\u4F55\u5C06\u5F02\u5E38\u63D2\u5165\u5230 <code>CompletableFuture</code> \u4E2D\uFF0C\u800C\u4E0D\u7BA1\u662F\u5426\u5B58\u5728\u4EFB\u4F55\u5931\u8D25\u3002 \u5728\u8FDE\u63A5\u6216\u83B7\u53D6\u7ED3\u679C\u65F6\uFF0C\u6211\u4EEC\u4F7F\u7528 <code>CompletableFuture</code> \u63D0\u4F9B\u7684\u66F4\u590D\u6742\u7684\u673A\u5236\u6765\u81EA\u52A8\u54CD\u5E94\u5F02\u5E38\uFF0C\u800C\u4E0D\u662F\u4F7F\u7528\u7C97\u7CD9\u7684 <code>try-catch</code>\u3002 \u4F60\u53EF\u4EE5\u4F7F\u7528\u4E0E\u6211\u4EEC\u770B\u5230\u7684\u6240\u6709 <code>CompletableFuture</code> \u76F8\u540C\u7684\u8868\u5355\u6765\u5B8C\u6210\u6B64\u64CD\u4F5C:\u5728\u94FE\u4E2D\u63D2\u5165\u4E00\u4E2A <code>CompletableFuture</code> \u8C03\u7528\u3002\u6709\u4E09\u4E2A\u9009\u9879 <code>exceptionally()</code>\uFF0C<code>handle()</code>\uFF0C <code>whenComplete()</code>:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CatchCompletableExceptions.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatchCompletableExceptions</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token keyword">int</span> failcount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Call the Function only if there&#39;s an</span>
        <span class="token comment">// exception, must produce same type as came in:</span>
        <span class="token class-name">CompletableExceptions</span>
                <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;exceptionally&quot;</span><span class="token punctuation">,</span> failcount<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// Function</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>ex <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;I don&#39;t get it yet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Breakable</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result: &quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Create a new result (recover):</span>
        <span class="token class-name">CompletableExceptions</span>
                <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;handle&quot;</span><span class="token punctuation">,</span> failcount<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> fail<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// BiFunction</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token string">&quot;Failure recovery object&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">else</span>
                        <span class="token keyword">return</span> result <span class="token operator">+</span> <span class="token string">&quot; is good&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result: &quot;</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Do something but pass the same result through:</span>
        <span class="token class-name">CompletableExceptions</span>
                <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;whenComplete&quot;</span><span class="token punctuation">,</span> failcount<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> fail<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// BiConsumer</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;It failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">else</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result <span class="token operator">+</span> <span class="token string">&quot; OK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result: &quot;</span> <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;**** Failure Mode ****&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;**** Success Mode ****&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>**** Failure Mode ****
Breakable_exceptionally [1]
Throwing Exception for exceptionally
result: Breakable_java.lang.RuntimeException:
Breakable_exceptionally failed [0]
Breakable_handle [1]
Throwing Exception for handle
result: Failure recovery object
Breakable_whenComplete [1]
Throwing Exception for whenComplete
It failed
**** Success Mode ****
Breakable_exceptionally [-1]
Breakable_exceptionally [-2]
Breakable_exceptionally [-3]
Breakable_exceptionally [-4]
result: Breakable_exceptionally [-4]
Breakable_handle [-1]
Breakable_handle [-2]
Breakable_handle [-3]
Breakable_handle [-4]
result: Breakable_handle [-4] is good
Breakable_whenComplete [-1]
Breakable_whenComplete [-2]
Breakable_whenComplete [-3]
Breakable_whenComplete [-4]
Breakable_whenComplete [-4] OK
result: Breakable_whenComplete [-4]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>exceptionally()</code> \u53C2\u6570\u4EC5\u5728\u51FA\u73B0\u5F02\u5E38\u65F6\u624D\u8FD0\u884C\u3002<code>exceptionally()</code> \u5C40\u9650\u6027\u5728\u4E8E\uFF0C\u8BE5\u51FD\u6570\u53EA\u80FD\u8FD4\u56DE\u8F93\u5165\u7C7B\u578B\u76F8\u540C\u7684\u503C\u3002</p></li><li><p><code>exceptionally()</code> \u901A\u8FC7\u5C06\u4E00\u4E2A\u597D\u7684\u5BF9\u8C61\u63D2\u5165\u5230\u6D41\u4E2D\u6765\u6062\u590D\u5230\u4E00\u4E2A\u53EF\u884C\u7684\u72B6\u6001\u3002</p></li><li><p><code>handle()</code> \u4E00\u81F4\u88AB\u8C03\u7528\u6765\u67E5\u770B\u662F\u5426\u53D1\u751F\u5F02\u5E38\uFF08\u5FC5\u987B\u68C0\u67E5 fail \u662F\u5426\u4E3A true\uFF09\u3002</p><ul><li><p>\u4F46\u662F <code>handle()</code> \u53EF\u4EE5\u751F\u6210\u4EFB\u4F55\u65B0\u7C7B\u578B\uFF0C\u6240\u4EE5\u5B83\u5141\u8BB8\u6267\u884C\u5904\u7406\uFF0C\u800C\u4E0D\u662F\u50CF\u4F7F\u7528 <code>exceptionally()</code>\u90A3\u6837\u7B80\u5355\u5730\u6062\u590D\u3002</p></li><li><p><code>whenComplete()</code> \u7C7B\u4F3C\u4E8E handle()\uFF0C\u540C\u6837\u5FC5\u987B\u6D4B\u8BD5\u5B83\u662F\u5426\u5931\u8D25\uFF0C\u4F46\u662F\u53C2\u6570\u662F\u4E00\u4E2A\u6D88\u8D39\u8005\uFF0C\u5E76\u4E14\u4E0D\u4FEE\u6539\u4F20\u9012\u7ED9\u5B83\u7684\u7ED3\u679C\u5BF9\u8C61\u3002</p></li></ul></li></ul><h3 id="\u6D41\u5F02\u5E38-stream-exception" tabindex="-1"><a class="header-anchor" href="#\u6D41\u5F02\u5E38-stream-exception" aria-hidden="true">#</a> \u6D41\u5F02\u5E38\uFF08Stream Exception\uFF09</h3><p>\u901A\u8FC7\u4FEE\u6539 <strong>CompletableExceptions.java</strong> \uFF0C\u770B\u770B <strong>CompletableFuture</strong> \u5F02\u5E38\u4E0E\u6D41\u5F02\u5E38\u6709\u4F55\u4E0D\u540C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/StreamExceptions.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamExceptions</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">static</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Breakable</span><span class="token punctuation">&gt;</span></span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token keyword">int</span> failcount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Breakable</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> failcount<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Breakable</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// No operations are even applied ...</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Breakable</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;E&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ... until there&#39;s a terminal operation:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Entering try&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            c<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// [1]</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Entering try
Breakable_C [2]
Breakable_C [1]
Throwing Exception for C
Breakable_C failed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 <code>CompletableFuture</code>\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u6D4B\u8BD5 A \u5230 E \u7684\u8FDB\u5C55\uFF0C\u4F46\u662F\u4F7F\u7528\u6D41\uFF0C\u5728\u4F60\u5E94\u7528\u4E00\u4E2A\u7EC8\u7AEF\u64CD\u4F5C\u4E4B\u524D\uFF08e.g. <code>forEach()</code>\uFF09\uFF0C\u4EC0\u4E48\u90FD\u4E0D\u4F1A\u66B4\u9732\u7ED9 Client</p><p><code>CompletableFuture</code> \u6267\u884C\u5DE5\u4F5C\u5E76\u6355\u83B7\u4EFB\u4F55\u5F02\u5E38\u4F9B\u4EE5\u540E\u68C0\u7D22\u3002\u6BD4\u8F83\u8FD9\u4E24\u8005\u5E76\u4E0D\u5BB9\u6613\uFF0C\u56E0\u4E3A <code>Stream</code> \u5728\u6CA1\u6709\u7EC8\u7AEF\u64CD\u4F5C\u7684\u60C5\u51B5\u4E0B\u6839\u672C\u4E0D\u505A\u4EFB\u4F55\u4E8B\u60C5\u2014\u2014\u4F46\u662F\u6D41\u7EDD\u5BF9\u4E0D\u4F1A\u5B58\u50A8\u5B83\u7684\u5F02\u5E38\u3002</p><h3 id="\u68C0\u67E5\u6027\u5F02\u5E38" tabindex="-1"><a class="header-anchor" href="#\u68C0\u67E5\u6027\u5F02\u5E38" aria-hidden="true">#</a> \u68C0\u67E5\u6027\u5F02\u5E38</h3><p><code>CompletableFuture</code> \u548C <code>parallel Stream</code> \u90FD\u4E0D\u652F\u6301\u5305\u542B\u68C0\u67E5\u6027\u5F02\u5E38\u7684\u64CD\u4F5C\u3002\u76F8\u53CD\uFF0C\u4F60\u5FC5\u987B\u5728\u8C03\u7528\u64CD\u4F5C\u65F6\u5904\u7406\u68C0\u67E5\u5230\u7684\u5F02\u5E38\uFF0C\u8FD9\u4F1A\u4EA7\u751F\u4E0D\u592A\u4F18\u96C5\u7684\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/ThrowsChecked.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThrowsChecked</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Checked</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">ThrowsChecked</span> <span class="token function">nochecked</span><span class="token punctuation">(</span><span class="token class-name">ThrowsChecked</span> tc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> tc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">ThrowsChecked</span> <span class="token function">withchecked</span><span class="token punctuation">(</span><span class="token class-name">ThrowsChecked</span> tc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Checked</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> tc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThrowsChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">ThrowsChecked</span><span class="token operator">::</span><span class="token function">nochecked</span><span class="token punctuation">)</span>
                <span class="token comment">// .map(ThrowsChecked::withchecked); // [1]</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
                        tc <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> <span class="token function">withchecked</span><span class="token punctuation">(</span>tc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Checked</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testCompletableFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span>
                <span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThrowsChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">ThrowsChecked</span><span class="token operator">::</span><span class="token function">nochecked</span><span class="token punctuation">)</span>
                <span class="token comment">// .thenApply(ThrowsChecked::withchecked); // [2]</span>
                <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>
                        tc <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> <span class="token function">withchecked</span><span class="token punctuation">(</span>tc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Checked</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C\u4F60\u8BD5\u56FE\u50CF\u4F7F\u7528 <code>nochecked()</code> \u90A3\u6837\u4F7F\u7528<code> withchecked()</code> \u7684\u65B9\u6CD5\u5F15\u7528\uFF0C\u7F16\u8BD1\u5668\u4F1A\u5728 <code>[1]</code> \u548C <code>[2]</code> \u4E2D\u62A5\u9519\u3002\u76F8\u53CD\uFF0C\u4F60\u5FC5\u987B\u5199\u51FA lambda \u8868\u8FBE\u5F0F (\u6216\u8005\u7F16\u5199\u4E00\u4E2A\u4E0D\u4F1A\u629B\u51FA\u5F02\u5E38\u7684\u5305\u88C5\u5668\u65B9\u6CD5)\u3002</p><h2 id="\u6B7B\u9501" tabindex="-1"><a class="header-anchor" href="#\u6B7B\u9501" aria-hidden="true">#</a> \u6B7B\u9501</h2><p>\u7531\u4E8E\u4EFB\u52A1\u53EF\u4EE5\u88AB\u963B\u585E\uFF0C\u56E0\u6B64\u4E00\u4E2A\u4EFB\u52A1\u6709\u53EF\u80FD\u5361\u5728\u7B49\u5F85\u53E6\u4E00\u4E2A\u4EFB\u52A1\u4E0A\uFF0C\u800C\u540E\u8005\u53C8\u5728\u7B49\u5F85\u522B\u7684\u4EFB\u52A1\uFF0C\u8FD9\u6837\u4E00\u76F4\u4E0B\u53BB\uFF0C\u77E5\u9053\u8FD9\u4E2A\u94FE\u6761\u4E0A\u7684\u4EFB\u52A1\u53C8\u5728\u7B49\u5F85\u7B2C\u4E00\u4E2A\u4EFB\u52A1\u91CA\u653E\u9501\u3002\u8FD9\u5F97\u5230\u4E86\u4E00\u4E2A\u4EFB\u52A1\u4E4B\u95F4\u76F8\u4E92\u7B49\u5F85\u7684\u8FDE\u7EED\u5FAA\u73AF\uFF0C \u6CA1\u6709\u54EA\u4E2A\u7EBF\u7A0B\u80FD\u7EE7\u7EED\uFF0C \u8FD9\u79F0\u4E4B\u4E3A\u6B7B\u9501[^6] \u5982\u679C\u4F60\u8FD0\u884C\u4E00\u4E2A\u7A0B\u5E8F\uFF0C\u800C\u5B83\u9A6C\u4E0A\u5C31\u6B7B\u9501\u4E86\uFF0C \u4F60\u53EF\u4EE5\u7ACB\u5373\u8DDF\u8E2A\u4E0B\u53BB\u3002\u771F\u6B63\u7684\u95EE\u9898\u5728\u4E8E\uFF0C\u7A0B\u5E8F\u770B\u8D77\u6765\u5DE5\u4F5C\u826F\u597D\uFF0C \u4F46\u662F\u5177\u6709\u6F5C\u5728\u7684\u6B7B\u9501\u5371\u9669\u3002\u8FD9\u65F6\uFF0C \u6B7B\u9501\u53EF\u80FD\u53D1\u751F\uFF0C\u800C\u4E8B\u5148\u5374\u6CA1\u6709\u4EFB\u4F55\u5F81\u5146\uFF0C \u6240\u4EE5 <code>bug</code> \u4F1A\u6F5C\u4F0F\u5728\u4F60\u7684\u7A0B\u5E8F\u4F8B\uFF0C\u76F4\u5230\u5BA2\u6237\u53D1\u73B0\u5B83\u51FA\u4E4E\u610F\u6599\u7684\u53D1\u751F\uFF08\u4EE5\u4E00\u79CD\u51E0\u4E4E\u80AF\u5B9A\u662F\u5F88\u96BE\u91CD\u73B0\u7684\u65B9\u5F0F\u53D1\u751F\uFF09\u3002\u56E0\u6B64\u5728\u7F16\u5199\u5E76\u53D1\u7A0B\u5E8F\u7684\u65F6\u5019\uFF0C\u8FDB\u884C\u4ED4\u7EC6\u7684\u7A0B\u5E8F\u8BBE\u8BA1\u4EE5\u9632\u6B62\u6B7B\u9501\u662F\u5173\u952E\u90E8\u5206\u3002 \u57C3\u5FB7\u65AF\xB7\u8FEA\u514B\u65AF\u7279\u62C9\uFF08<code>Essger Dijkstra</code>\uFF09\u53D1\u660E\u7684\u201C\u54F2\u5B66\u5BB6\u8FDB\u9910&quot;\u95EE\u9898\u662F\u7ECF\u5178\u7684\u6B7B\u9501\u4F8B\u8BC1\u3002\u57FA\u672C\u63CF\u8FF0\u6307\u5B9A\u4E86\u4E94\u4F4D\u54F2\u5B66\u5BB6\uFF08\u6B64\u5904\u663E\u793A\u7684\u793A\u4F8B\u5141\u8BB8\u4EFB\u4F55\u6570\u76EE\uFF09\u3002\u8FD9\u4E9B\u54F2\u5B66\u5BB6\u5C06\u82B1\u90E8\u5206\u65F6\u95F4\u601D\u8003\uFF0C\u82B1\u90E8\u5206\u65F6\u95F4\u5C31\u9910\u3002\u4ED6\u4EEC\u5728\u601D\u8003\u7684\u65F6\u5019\u5E76\u4E0D\u9700\u8981\u4EFB\u4F55\u5171\u4EAB\u8D44\u6E90\uFF1B\u4F46\u662F\u4ED6\u4EEC\u4F7F\u7528\u7684\u9910\u5177\u6570\u91CF\u6709\u9650\u3002\u5728\u6700\u521D\u7684\u95EE\u9898\u63CF\u8FF0\u4E2D\uFF0C\u9910\u5177\u662F\u53C9\u5B50\uFF0C\u9700\u8981\u4E24\u4E2A\u53C9\u5B50\u624D\u80FD\u4ECE\u684C\u5B50\u4E2D\u95F4\u7684\u7897\u91CC\u53D6\u51FA\u610F\u5927\u5229\u9762\u3002\u5E38\u89C1\u7684\u7248\u672C\u662F\u4F7F\u7528\u7B77\u5B50\uFF0C \u663E\u7136\uFF0C\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u90FD\u9700\u8981\u4E24\u6839\u7B77\u5B50\u624D\u80FD\u5403\u996D\u3002 \u5F15\u5165\u4E86\u4E00\u4E2A\u56F0\u96BE\uFF1A\u4F5C\u4E3A\u54F2\u5B66\u5BB6\uFF0C\u4ED6\u4EEC\u7684\u94B1\u5F88\u5C11\uFF0C\u6240\u4EE5\u4ED6\u4EEC\u53EA\u80FD\u4E70\u4E94\u6839\u7B77\u5B50\uFF08\u66F4\u4E00\u822C\u5730\u8BB2\uFF0C\u7B77\u5B50\u7684\u6570\u91CF\u4E0E\u54F2\u5B66\u5BB6\u76F8\u540C\uFF09\u3002\u4ED6\u4EEC\u56F4\u5728\u684C\u5B50\u5468\u56F4\uFF0C\u6BCF\u4EBA\u4E4B\u95F4\u653E\u4E00\u6839\u7B77\u5B50\u3002 \u5F53\u4E00\u4E2A\u54F2\u5B66\u5BB6\u8981\u5C31\u9910\u65F6\uFF0C\u8BE5\u54F2\u5B66\u5BB6\u5FC5\u987B\u540C\u65F6\u6301\u6709\u5DE6\u8FB9\u548C\u53F3\u8FB9\u7684\u7B77\u5B50\u3002\u5982\u679C\u4EFB\u4E00\u4FA7\u7684\u54F2\u5B66\u5BB6\u90FD\u5728\u4F7F\u7528\u6240\u9700\u7684\u7B77\u5B50\uFF0C\u5219\u6211\u4EEC\u7684\u54F2\u5B66\u5BB6\u5FC5\u987B\u7B49\u5F85\uFF0C\u76F4\u5230\u53EF\u5F97\u5230\u5FC5\u987B\u7684\u7B77\u5B50\u3002</p><p><strong>StickHolder</strong> \u7C7B\u901A\u8FC7\u5C06\u5355\u6839\u7B77\u5B50\u4FDD\u6301\u5728\u5927\u5C0F\u4E3A 1 \u7684 <strong>BlockingQueue</strong> \u4E2D\u6765\u7BA1\u7406\u5B83\u3002<strong>BlockingQueue</strong> \u662F\u4E00\u4E2A\u8BBE\u8BA1\u7528\u4E8E\u5728\u5E76\u53D1\u7A0B\u5E8F\u4E2D\u5B89\u5168\u4F7F\u7528\u7684\u96C6\u5408\uFF0C\u5982\u679C\u4F60\u8C03\u7528 take() \u5E76\u4E14\u961F\u5217\u4E3A\u7A7A\uFF0C\u5219\u5B83\u5C06\u963B\u585E\uFF08\u7B49\u5F85\uFF09\u3002\u5C06\u65B0\u5143\u7D20\u653E\u5165\u961F\u5217\u540E\uFF0C\u5C06\u91CA\u653E\u8BE5\u5757\u5E76\u8FD4\u56DE\u8BE5\u503C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/StickHolder.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StickHolder</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Chopstick</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Chopstick</span> stick <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Chopstick</span><span class="token punctuation">&gt;</span></span> holder <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">StickHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            holder<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Blocks if unavailable</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            holder<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>stick<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3A\u7B80\u5355\u8D77\u89C1\uFF0C<code>Chopstick</code>(<code>static</code>) \u5B9E\u9645\u4E0A\u4E0D\u662F\u7531 <code>StickHolder</code> \u751F\u4EA7\u7684\uFF0C\u800C\u662F\u5728\u5176\u7C7B\u4E2D\u4FDD\u6301\u79C1\u6709\u7684\u3002</p><p>\u5982\u679C\u60A8\u8C03\u7528\u4E86<code>pickUp()</code>\uFF0C\u800C <code>stick</code> \u4E0D\u53EF\u7528\uFF0C\u90A3\u4E48<code>pickUp()</code>\u5C06\u963B\u585E\u8BE5 <code>stick</code>\uFF0C\u76F4\u5230\u53E6\u4E00\u4E2A\u54F2\u5B66\u5BB6\u8C03\u7528<code>putDown()</code> \u5C06 <code>stick</code> \u8FD4\u56DE\u3002</p><p>\u6CE8\u610F\uFF0C\u8BE5\u7C7B\u4E2D\u7684\u6240\u6709\u7EBF\u7A0B\u5B89\u5168\u90FD\u662F\u901A\u8FC7 <code>BlockingQueue</code> \u5B9E\u73B0\u7684\u3002</p><p>\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u90FD\u662F\u4E00\u9879\u4EFB\u52A1\uFF0C\u4ED6\u4EEC\u8BD5\u56FE\u628A\u7B77\u5B50\u5206\u522B <code>pickUp()</code> \u5728\u5DE6\u624B\u548C\u53F3\u624B\u4E0A\uFF0C\u8FD9\u6837\u7B77\u5B50\u624D\u80FD\u5403\u4E1C\u897F\uFF0C\u7136\u540E\u901A\u8FC7 <code>putDown()</code> \u653E\u4E0B <code>stick</code>\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Philosopher.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Philosopher</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> seat<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StickHolder</span> left<span class="token punctuation">,</span> right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span><span class="token keyword">int</span> seat<span class="token punctuation">,</span> <span class="token class-name">StickHolder</span> left<span class="token punctuation">,</span> <span class="token class-name">StickHolder</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>seat <span class="token operator">=</span> seat<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;P&quot;</span> <span class="token operator">+</span> seat<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// System.out.println(&quot;Thinking&quot;);   // [1]</span>
            right<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            left<span class="token punctuation">.</span><span class="token function">pickUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">+</span> <span class="token string">&quot; eating&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            right<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            left<span class="token punctuation">.</span><span class="token function">putDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CA1\u6709\u4E24\u4E2A\u54F2\u5B66\u5BB6\u53EF\u4EE5\u540C\u65F6\u6210\u529F\u8C03\u7528 take() \u540C\u4E00\u53EA\u7B77\u5B50\u3002\u53E6\u5916\uFF0C\u5982\u679C\u4E00\u4E2A\u54F2\u5B66\u5BB6\u5DF2\u7ECF\u62FF\u8FC7\u7B77\u5B50\uFF0C\u90A3\u4E48\u4E0B\u4E00\u4E2A\u8BD5\u56FE\u62FF\u8D77\u540C\u4E00\u6839\u7B77\u5B50\u7684\u54F2\u5B66\u5BB6\u5C06\u963B\u585E\uFF0C\u7B49\u5F85\u5176\u88AB\u91CA\u653E\u3002</p><p>\u7ED3\u679C\u662F\u4E00\u4E2A\u770B\u4F3C\u65E0\u8F9C\u7684\u7A0B\u5E8F\u9677\u5165\u4E86\u6B7B\u9501\u3002\u6211\u5728\u8FD9\u91CC\u4F7F\u7528\u6570\u7EC4\u800C\u4E0D\u662F\u96C6\u5408\uFF0C\u53EA\u662F\u56E0\u4E3A\u8FD9\u79CD\u8BED\u6CD5\u66F4\u7B80\u6D01\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/DiningPhilosophers.java</span>
<span class="token comment">// Hidden deadlock</span>
<span class="token comment">// {ExcludeFromGradle} Gradle has trouble</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DiningPhilosophers</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">StickHolder</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sticks<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Philosopher</span><span class="token punctuation">[</span><span class="token punctuation">]</span> philosophers<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DiningPhilosophers</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sticks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StickHolder</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>sticks<span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">StickHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        philosophers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>philosophers<span class="token punctuation">,</span> i <span class="token operator">-&gt;</span>
                <span class="token keyword">new</span> <span class="token class-name">Philosopher</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>
                        sticks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> sticks<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// [1]</span>
        <span class="token comment">// Fix by reversing stick order for this one:</span>
        <span class="token comment">// philosophers[1] =                     // [2]</span>
        <span class="token comment">//   new Philosopher(0, sticks[0], sticks[1]);</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>philosophers<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token operator">::</span><span class="token function">runAsync</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [3]</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Returns right away:</span>
        <span class="token keyword">new</span> <span class="token class-name">DiningPhilosophers</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// [4]</span>
        <span class="token comment">// Keeps main() from exiting:</span>
        <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;Shutdown&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5F53\u4F60\u505C\u6B62\u67E5\u770B\u8F93\u51FA\u65F6\uFF0C\u8BE5\u7A0B\u5E8F\u5C06\u6B7B\u9501\u3002\u4F46\u662F\uFF0C\u6839\u636E\u4F60\u7684\u8BA1\u7B97\u673A\u914D\u7F6E\uFF0C\u4F60\u53EF\u80FD\u4E0D\u4F1A\u770B\u5230\u6B7B\u9501\u3002\u770B\u6765\u8FD9\u53D6\u51B3\u4E8E\u8BA1\u7B97\u673A\u4E0A\u7684\u5185\u6838\u6570[^7]\u3002\u4E24\u4E2A\u6838\u5FC3\u4E0D\u4F1A\u4EA7\u751F\u6B7B\u9501\uFF0C\u4F46\u4E24\u6838\u4EE5\u4E0A\u5374\u5F88\u5BB9\u6613\u4EA7\u751F\u6B7B\u9501\u3002</li><li>\u6B64\u884C\u4E3A\u4F7F\u8BE5\u793A\u4F8B\u66F4\u597D\u5730\u8BF4\u660E\u4E86\u6B7B\u9501\uFF0C\u56E0\u4E3A\u4F60\u53EF\u80FD\u6B63\u5728\u5177\u6709 2 \u6838\u7684\u8BA1\u7B97\u673A\u4E0A\u7F16\u5199\u7A0B\u5E8F\uFF08\u5982\u679C\u786E\u5B9E\u662F\u5BFC\u81F4\u95EE\u9898\u7684\u539F\u56E0\uFF09\uFF0C\u5E76\u4E14\u786E\u4FE1\u8BE5\u7A0B\u5E8F\u53EF\u4EE5\u6B63\u5E38\u5DE5\u4F5C\uFF0C\u53EA\u80FD\u542F\u52A8\u5B83\u5C06\u5176\u5B89\u88C5\u5728\u53E6\u4E00\u53F0\u8BA1\u7B97\u673A\u4E0A\u65F6\u51FA\u73B0\u6B7B\u9501\u3002\u8BF7\u6CE8\u610F\uFF0C\u4E0D\u80FD\u56E0\u4E3A\u4F60\u6CA1\u6216\u4E0D\u5BB9\u6613\u770B\u5230\u6B7B\u9501\uFF0C\u8FD9\u5E76\u4E0D\u610F\u5473\u7740\u6B64\u7A0B\u5E8F\u4E0D\u4F1A\u5728 2 \u6838\u673A\u5668\u4E0A\u53D1\u751F\u6B7B\u9501\u3002 \u8BE5\u7A0B\u5E8F\u4ECD\u7136\u6709\u6B7B\u9501\u503E\u5411\uFF0C\u53EA\u662F\u5F88\u5C11\u53D1\u751F\u2014\u2014\u53EF\u4EE5\u8BF4\u662F\u6700\u7CDF\u7CD5\u7684\u60C5\u51B5\uFF0C\u56E0\u4E3A\u95EE\u9898\u4E0D\u5BB9\u6613\u51FA\u73B0\u3002</li><li>\u5728 <code>DiningPhilosophers</code> \u7684\u6784\u9020\u65B9\u6CD5\u4E2D\uFF0C\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u90FD\u83B7\u5F97\u4E00\u4E2A\u5DE6\u53F3\u7B77\u5B50\u7684\u5F15\u7528\u3002\u9664\u6700\u540E\u4E00\u4E2A\u54F2\u5B66\u5BB6\u5916\uFF0C\u90FD\u662F\u901A\u8FC7\u628A\u54F2\u5B66\u5BB6\u653E\u5728\u4E0B\u4E00\u53CC\u7A7A\u95F2\u7B77\u5B50\u4E4B\u95F4\u6765\u521D\u59CB\u5316\uFF1A <ul><li>\u6700\u540E\u4E00\u4F4D\u54F2\u5B66\u5BB6\u5F97\u5230\u4E86\u7B2C 0 \u6839\u7B77\u5B50\u4F5C\u4E3A\u4ED6\u7684\u53F3\u7B77\u5B50\uFF0C\u6240\u4EE5\u5706\u684C\u5C31\u5B8C\u6210\u3002</li><li>\u90A3\u662F\u56E0\u4E3A\u6700\u540E\u4E00\u4F4D\u54F2\u5B66\u5BB6\u6B63\u5750\u5728\u7B2C\u4E00\u4E2A\u54F2\u5B66\u5BB6\u7684\u65C1\u8FB9\uFF0C\u800C\u4E14\u4ED6\u4EEC\u4FE9\u90FD\u5171\u7528\u96F6\u7B77\u5B50\u3002[1] \u663E\u793A\u4E86\u4EE5 n \u4E3A\u6A21\u6570\u9009\u62E9\u7684\u53F3\u7B77\u5B50\uFF0C\u5C06\u6700\u540E\u4E00\u4E2A\u54F2\u5B66\u5BB6\u7ED5\u5230\u7B2C\u4E00\u4E2A\u54F2\u5B66\u5BB6\u7684\u65C1\u8FB9\u3002</li></ul></li><li>\u73B0\u5728\uFF0C\u6240\u6709\u54F2\u5B66\u5BB6\u90FD\u53EF\u4EE5\u5C1D\u8BD5\u5403\u996D\uFF0C\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u90FD\u5728\u65C1\u8FB9\u7B49\u5F85\u54F2\u5B66\u5BB6\u653E\u4E0B\u7B77\u5B50\u3002 <ul><li>\u4E3A\u4E86\u8BA9\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u5728[3] \u4E0A\u8FD0\u884C\uFF0C\u8C03\u7528 <code>runAsync()</code>\uFF0C\u8FD9\u610F\u5473\u7740 DiningPhilosophers \u7684\u6784\u9020\u51FD\u6570\u7ACB\u5373\u8FD4\u56DE\u5230[4]\u3002</li><li>\u5982\u679C\u6CA1\u6709\u4EFB\u4F55\u4E1C\u897F\u963B\u6B62 <code>main()</code> \u5B8C\u6210\uFF0C\u7A0B\u5E8F\u5C31\u4F1A\u9000\u51FA\uFF0C\u4E0D\u4F1A\u505A\u592A\u591A\u4E8B\u60C5\u3002</li><li><code>Nap</code> \u5BF9\u8C61\u963B\u6B62 <code>main()</code> \u9000\u51FA\uFF0C\u7136\u540E\u5728\u4E09\u79D2\u540E\u5F3A\u5236\u9000\u51FA (\u5047\u8BBE/\u53EF\u80FD\u662F) \u6B7B\u9501\u7A0B\u5E8F\u3002</li><li>\u5728\u7ED9\u5B9A\u7684\u914D\u7F6E\u4E2D\uFF0C\u54F2\u5B66\u5BB6\u51E0\u4E4E\u4E0D\u82B1\u65F6\u95F4\u601D\u8003\u3002\u56E0\u6B64\uFF0C\u4ED6\u4EEC\u5728\u5403\u4E1C\u897F\u7684\u65F6\u5019\u90FD\u4E89\u7740\u7528\u7B77\u5B50\uFF0C\u800C\u4E14\u5F80\u5F80\u5F88\u5FEB\u5C31\u4F1A\u9677\u5165\u50F5\u5C40\u3002\u4F60\u53EF\u4EE5\u6539\u53D8\u8FD9\u4E2A:</li></ul></li></ul><ol><li><p>\u901A\u8FC7\u589E\u52A0[4] \u7684\u503C\u6765\u6DFB\u52A0\u66F4\u591A\u54F2\u5B66\u5BB6\u3002</p></li><li><p>\u5728 Philosopher.java \u4E2D\u53D6\u6D88\u6CE8\u91CA\u884C[1]\u3002</p></li></ol><p>\u4EFB\u4E00\u79CD\u65B9\u6CD5\u90FD\u4F1A\u51CF\u5C11\u6B7B\u9501\u7684\u53EF\u80FD\u6027\uFF0C\u8FD9\u8868\u660E\u7F16\u5199\u5E76\u53D1\u7A0B\u5E8F\u5E76\u8BA4\u4E3A\u5B83\u662F\u5B89\u5168\u7684\u5371\u9669\uFF0C\u56E0\u4E3A\u5B83\u4F3C\u4E4E\u201C\u5728\u6211\u7684\u673A\u5668\u4E0A\u8FD0\u884C\u6B63\u5E38\u201D\u3002\u4F60\u53EF\u4EE5\u8F7B\u677E\u5730\u8BF4\u670D\u81EA\u5DF1\u8BE5\u7A0B\u5E8F\u6CA1\u6709\u6B7B\u9501\uFF0C\u5373\u4F7F\u5B83\u4E0D\u662F\u3002\u8FD9\u4E2A\u793A\u4F8B\u76F8\u5F53\u6709\u8DA3\uFF0C\u56E0\u4E3A\u5B83\u6F14\u793A\u4E86\u770B\u8D77\u6765\u53EF\u4EE5\u6B63\u786E\u8FD0\u884C\uFF0C\u4F46\u5B9E\u9645\u4E0A\u4F1A\u53EF\u80FD\u53D1\u751F\u6B7B\u9501\u7684\u7A0B\u5E8F\u3002</p><p>\u8981\u4FEE\u6B63\u6B7B\u9501\u95EE\u9898\uFF0C\u4F60\u5FC5\u987B\u660E\u767D\uFF0C\u5F53\u4EE5\u4E0B\u56DB\u4E2A\u6761\u4EF6\u540C\u65F6\u6EE1\u8DB3\u65F6\uFF0C\u5C31\u4F1A\u53D1\u751F\u6B7B\u9501\uFF1A</p><ol><li>\u4E92\u65A5\u6761\u4EF6\u3002\u4EFB\u52A1\u4F7F\u7528\u7684\u8D44\u6E90\u4E2D\u81F3\u5C11\u6709\u4E00\u4E2A\u4E0D\u80FD\u5171\u4EAB\u7684\u3002 \u8FD9\u91CC\uFF0C\u4E00\u6839\u7B77\u5B50\u4E00\u6B21\u5C31\u53EA\u80FD\u88AB\u4E00\u4E2A\u54F2\u5B66\u5BB6\u4F7F\u7528\u3002</li><li>\u81F3\u5C11\u6709\u4E00\u4E2A\u4EFB\u52A1\u5B83\u5FC5\u987B\u6301\u6709\u4E00\u4E2A\u8D44\u6E90\u4E14\u6B63\u5728\u7B49\u5F85\u83B7\u53D6\u4E00\u4E2A\u88AB\u5F53\u524D\u522B\u7684\u4EFB\u52A1\u6301\u6709\u7684\u8D44\u6E90\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u8981\u53D1\u751F\u6B7B\u9501\uFF0C\u54F2\u5B66\u5BB6\u5FC5\u987B\u62FF\u7740\u4E00\u6839\u7B77\u5B50\u5E76\u4E14\u7B49\u5F85\u53E6\u4E00\u6839\u3002</li><li>\u8D44\u6E90\u4E0D\u80FD\u88AB\u4EFB\u52A1\u62A2\u5360\uFF0C \u4EFB\u52A1\u5FC5\u987B\u628A\u8D44\u6E90\u91CA\u653E\u5F53\u4F5C\u666E\u901A\u4E8B\u4EF6\u3002\u54F2\u5B66\u5BB6\u5F88\u6709\u793C\u8C8C\uFF0C\u4ED6\u4EEC\u4E0D\u4F1A\u4ECE\u5176\u5B83\u54F2\u5B66\u5BB6\u90A3\u91CC\u62A2\u7B77\u5B50\u3002</li><li>\u5FC5\u987B\u6709\u5FAA\u73AF\u7B49\u5F85\uFF0C \u8FD9\u65F6\uFF0C\u4E00\u4E2A\u4EFB\u52A1\u7B49\u5F85\u5176\u5B83\u4EFB\u52A1\u6240\u6301\u6709\u7684\u8D44\u6E90\uFF0C \u540E\u8005\u53C8\u5728\u7B49\u5F85\u53E6\u4E00\u4E2A\u4EFB\u52A1\u6240\u6301\u6709\u7684\u8D44\u6E90\uFF0C \u8FD9\u6837\u4E00\u76F4\u4E0B\u53BB\uFF0C\u77E5\u9053\u6709\u4E00\u4E2A\u4EFB\u52A1\u5728\u7B49\u5F85\u7B2C\u4E00\u4E2A\u4EFB\u52A1\u6240\u6301\u6709\u7684\u8D44\u6E90\uFF0C \u4F7F\u5F97\u5927\u5BB6\u90FD\u88AB\u9501\u4F4F\u3002 \u5728 <code>DiningPhilosophers.java</code> \u4E2D\uFF0C \u56E0\u4E3A\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u90FD\u8BD5\u56FE\u5148\u5F97\u5230\u53F3\u8FB9\u7684 \u7B77\u5B50, \u7136\u540E\u5F97\u5230\u5DE6\u8FB9\u7684 \u7B77\u5B50, \u6240\u4EE5\u53D1\u751F\u4E86\u5FAA\u73AF\u7B49\u5F85\u3002</li></ol><p>\u56E0\u4E3A\u5FC5\u987B\u6EE1\u8DB3\u6240\u6709\u6761\u4EF6\u624D\u80FD\u5BFC\u81F4\u6B7B\u9501\uFF0C\u6240\u4EE5\u8981\u963B\u6B62\u6B7B\u9501\u7684\u8BDD\uFF0C\u53EA\u9700\u8981\u7834\u574F\u5176\u4E2D\u4E00\u4E2A\u5373\u53EF\u3002\u5728\u6B64\u7A0B\u5E8F\u4E2D\uFF0C\u9632\u6B62\u6B7B\u9501\u7684\u4E00\u79CD\u7B80\u5355\u65B9\u6CD5\u662F\u6253\u7834\u7B2C\u56DB\u4E2A\u6761\u4EF6\u3002\u4E4B\u6240\u4EE5\u4F1A\u53D1\u751F\u8FD9\u79CD\u60C5\u51B5\uFF0C\u662F\u56E0\u4E3A\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u90FD\u5C1D\u8BD5\u6309\u7167\u7279\u5B9A\u7684\u987A\u5E8F\u62FE\u8D77\u81EA\u5DF1\u7684\u7B77\u5B50\uFF1A\u5148\u53F3\u540E\u5DE6\u3002\u56E0\u6B64\uFF0C\u6BCF\u4E2A\u54F2\u5B66\u5BB6\u90FD\u6709\u53EF\u80FD\u5728\u7B49\u5F85\u5DE6\u624B\u7684\u540C\u65F6\u63E1\u4F4F\u53F3\u624B\u7684\u7B77\u5B50\uFF0C\u4ECE\u800C\u5BFC\u81F4\u5FAA\u73AF\u7B49\u5F85\u72B6\u6001\u3002\u4F46\u662F\uFF0C\u5982\u679C\u5176\u4E2D\u4E00\u4F4D\u54F2\u5B66\u5BB6\u5C1D\u8BD5\u9996\u5148\u62FF\u8D77\u5DE6\u7B77\u5B50\uFF0C\u5219\u8BE5\u54F2\u5B66\u5BB6\u51B3\u4E0D\u4F1A\u963B\u6B62\u7D27\u90BB\u53F3\u65B9\u7684\u54F2\u5B66\u5BB6\u62FF\u8D77\u7B77\u5B50\uFF0C\u4ECE\u800C\u6392\u9664\u4E86\u5FAA\u73AF\u7B49\u5F85\u3002</p><p>\u5728 <strong>DiningPhilosophers.java</strong> \u4E2D\uFF0C\u53D6\u6D88\u6CE8\u91CA[1] \u548C\u5176\u540E\u7684\u4E00\u884C\u3002\u8FD9\u5C06\u539F\u6765\u7684\u54F2\u5B66\u5BB6[1] \u66FF\u6362\u4E3A\u7B77\u5B50\u98A0\u5012\u7684\u54F2\u5B66\u5BB6\u3002\u901A\u8FC7\u786E\u4FDD\u7B2C\u4E8C\u4F4D\u54F2\u5B66\u5BB6\u62FE\u8D77\u5E76\u5728\u53F3\u624B\u4E4B\u524D\u653E\u4E0B\u5DE6\u7B77\u5B50\uFF0C\u6211\u4EEC\u6D88\u9664\u4E86\u6B7B\u9501\u7684\u53EF\u80FD\u6027\u3002 \u8FD9\u53EA\u662F\u89E3\u51B3\u95EE\u9898\u7684\u4E00\u79CD\u65B9\u6CD5\u3002\u4F60\u4E5F\u53EF\u4EE5\u901A\u8FC7\u9632\u6B62\u5176\u4ED6\u60C5\u51B5\u4E4B\u4E00\u6765\u89E3\u51B3\u5B83\u3002 \u6CA1\u6709\u8BED\u8A00\u652F\u6301\u53EF\u4EE5\u5E2E\u52A9\u9632\u6B62\u6B7B\u9501\uFF1B\u4F60\u6709\u8D23\u4EFB\u901A\u8FC7\u7CBE\u5FC3\u8BBE\u8BA1\u6765\u907F\u514D\u8FD9\u79CD\u60C5\u51B5\u3002\u5BF9\u4E8E\u8BD5\u56FE\u8C03\u8BD5\u6B7B\u9501\u7A0B\u5E8F\u7684\u4EBA\u6765\u8BF4\uFF0C\u8FD9\u4E9B\u90FD\u4E0D\u662F\u5B89\u6170\u3002\u5F53\u7136\uFF0C\u907F\u514D\u5E76\u53D1\u95EE\u9898\u7684\u6700\u7B80\u5355\uFF0C\u6700\u597D\u7684\u65B9\u6CD5\u662F\u6C38\u8FDC\u4E0D\u8981\u5171\u4EAB\u8D44\u6E90-\u4E0D\u5E78\u7684\u662F\uFF0C\u8FD9\u5E76\u4E0D\u603B\u662F\u53EF\u80FD\u7684\u3002</p><h2 id="\u6784\u9020\u65B9\u6CD5\u975E\u7EBF\u7A0B\u5B89\u5168" tabindex="-1"><a class="header-anchor" href="#\u6784\u9020\u65B9\u6CD5\u975E\u7EBF\u7A0B\u5B89\u5168" aria-hidden="true">#</a> \u6784\u9020\u65B9\u6CD5\u975E\u7EBF\u7A0B\u5B89\u5168</h2><p>\u5F53\u4F60\u5728\u8111\u5B50\u91CC\u60F3\u8C61\u4E00\u4E2A\u5BF9\u8C61\u6784\u9020\u7684\u8FC7\u7A0B\uFF0C\u4F60\u4F1A\u5F88\u5BB9\u6613\u8BA4\u4E3A\u8FD9\u4E2A\u8FC7\u7A0B\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\u3002\u6BD5\u7ADF\uFF0C\u5728\u5BF9\u8C61\u521D\u59CB\u5316\u5B8C\u6210\u524D\u5BF9\u5916\u4E0D\u53EF\u89C1\uFF0C\u6240\u4EE5\u53C8\u600E\u4F1A\u5BF9\u6B64\u4EA7\u751F\u4E89\u8BAE\u5462\uFF1F\u786E\u5B9E\uFF0C<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-8.html#jls-8.8.3" target="_blank" rel="noopener noreferrer">Java \u8BED\u8A00\u89C4\u8303 </a> (JLS) \u81EA\u4FE1\u6EE1\u6EE1\u5730\u9648\u8FF0\u9053\uFF1A\u201C<em>\u6CA1\u5FC5\u8981\u4F7F\u6784\u9020\u5668\u7684\u7EBF\u7A0B\u540C\u6B65\uFF0C\u56E0\u4E3A\u5B83\u4F1A\u9501\u5B9A\u6B63\u5728\u6784\u9020\u7684\u5BF9\u8C61\uFF0C\u76F4\u5230\u6784\u9020\u5668\u5B8C\u6210\u521D\u59CB\u5316\u540E\u624D\u5BF9\u5176\u4ED6\u7EBF\u7A0B\u53EF\u89C1\u3002</em>\u201D</p><p>\u4E0D\u5E78\u7684\u662F\uFF0C\u5BF9\u8C61\u7684\u6784\u9020\u8FC7\u7A0B\u5982\u5176\u4ED6\u64CD\u4F5C\u4E00\u6837\uFF0C\u4E5F\u4F1A\u53D7\u5230\u5171\u4EAB\u5185\u5B58\u5E76\u53D1\u95EE\u9898\u7684\u5F71\u54CD\uFF0C\u53EA\u662F\u4F5C\u7528\u673A\u5236\u53EF\u80FD\u66F4\u5FAE\u5999\u7F62\u4E86\u3002</p><p>\u8BBE\u60F3\u4E0B\u4F7F\u7528\u4E00\u4E2A <strong>static</strong> \u5B57\u6BB5\u4E3A\u6BCF\u4E2A\u5BF9\u8C61\u81EA\u52A8\u521B\u5EFA\u552F\u4E00\u6807\u8BC6\u7B26\u7684\u8FC7\u7A0B\u3002\u4E3A\u4E86\u6D4B\u8BD5\u5176\u4E0D\u540C\u7684\u5B9E\u73B0\u8FC7\u7A0B\uFF0C\u6211\u4EEC\u4ECE\u4E00\u4E2A\u63A5\u53E3\u5F00\u59CB\u3002\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//concurrent/HasID.java</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HasID</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E <strong>StaticIDField</strong> \u7C7B\u663E\u5F0F\u5730\u5B9E\u73B0\u8BE5\u63A5\u53E3\u3002\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/StaticIDField.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticIDField</span> <span class="token keyword">implements</span> <span class="token class-name">HasID</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id <span class="token operator">=</span> counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> id<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u4F60\u6240\u60F3\uFF0C\u8BE5\u7C7B\u662F\u4E2A\u7B80\u5355\u65E0\u5BB3\u7684\u7C7B\uFF0C\u5B83\u751A\u81F3\u90FD\u6CA1\u4E00\u4E2A\u663E\u5F0F\u7684\u6784\u9020\u5668\u6765\u5F15\u53D1\u95EE\u9898\u3002\u5F53\u6211\u4EEC\u8FD0\u884C\u591A\u4E2A\u7528\u4E8E\u521B\u5EFA\u6B64\u7C7B\u5BF9\u8C61\u7684\u7EBF\u7A0B\u65F6\uFF0C\u7A76\u7ADF\u4F1A\u53D1\u751F\u4EC0\u4E48\uFF1F\u4E3A\u4E86\u641E\u6E05\u695A\u8FD9\u70B9\uFF0C\u6211\u4EEC\u505A\u4E86\u4EE5\u4E0B\u6D4B\u8BD5\u3002\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/IDChecker.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">Sets</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IDChecker</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SIZE <span class="token operator">=</span> <span class="token number">100_000</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MakeObjects</span> <span class="token keyword">implements</span>
        <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HasID</span><span class="token punctuation">&gt;</span></span> gen<span class="token punctuation">;</span>

        <span class="token class-name">MakeObjects</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HasID</span><span class="token punctuation">&gt;</span></span> gen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>gen <span class="token operator">=</span> gen<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>SIZE<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">HasID</span><span class="token operator">::</span><span class="token function">getID</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HasID</span><span class="token punctuation">&gt;</span></span> gen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span>
        groupA <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span>
            <span class="token class-name">MakeObjects</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        groupB <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span>
            <span class="token class-name">MakeObjects</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        groupA<span class="token punctuation">.</span><span class="token function">thenAcceptBoth</span><span class="token punctuation">(</span>groupB<span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
                <span class="token class-name">Sets</span><span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>
                <span class="token class-name">Sets</span><span class="token punctuation">.</span><span class="token function">newHashSet</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Sets</span><span class="token punctuation">.</span><span class="token function">newHashSet</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>MakeObjects</strong> \u7C7B\u662F\u4E00\u4E2A\u751F\u4EA7\u8005\u7C7B\uFF0C\u5305\u542B\u4E00\u4E2A\u80FD\u591F\u4EA7\u751F List&lt;Integer&gt; \u7C7B\u578B\u7684\u5217\u8868\u5BF9\u8C61\u7684 <code>get()</code> \u65B9\u6CD5\u3002\u901A\u8FC7\u4ECE\u6BCF\u4E2A <code>HasID</code> \u5BF9\u8C61\u63D0\u53D6 <code>ID</code> \u5E76\u653E\u5165\u5217\u8868\u4E2D\u6765\u751F\u6210\u8FD9\u4E2A\u5217\u8868\u5BF9\u8C61\uFF0C\u800C <code>test()</code> \u65B9\u6CD5\u5219\u521B\u5EFA\u4E86\u4E24\u4E2A\u5E76\u884C\u7684 <strong>CompletableFuture</strong> \u5BF9\u8C61\uFF0C\u7528\u4E8E\u8FD0\u884C <strong>MakeObjects</strong> \u751F\u4EA7\u8005\u7C7B\uFF0C\u7136\u540E\u83B7\u53D6\u8FD0\u884C\u7ED3\u679C\u3002</p><p>\u4F7F\u7528 Guava \u5E93\u4E2D\u7684 **Sets.<code>intersection()</code> \u65B9\u6CD5\uFF0C\u8BA1\u7B97\u51FA\u8FD9\u4E24\u4E2A\u8FD4\u56DE\u7684 List&lt;Integer&gt; \u5BF9\u8C61\u4E2D\u6709\u591A\u5C11\u76F8\u540C\u7684 <code>ID</code>\uFF08\u4F7F\u7528\u8C37\u6B4C Guava \u5E93\u91CC\u7684\u65B9\u6CD5\u6BD4\u4F7F\u7528\u5B98\u65B9\u7684 <code>retainAll()</code> \u65B9\u6CD5\u901F\u5EA6\u5FEB\u5F97\u591A\uFF09\u3002</p><p>\u73B0\u5728\u6211\u4EEC\u53EF\u4EE5\u6D4B\u8BD5\u4E0A\u9762\u7684 <strong>StaticIDField</strong> \u7C7B\u4E86\u3002\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/TestStaticIDField.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestStaticIDField</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IDChecker</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">StaticIDField</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    13287
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7ED3\u679C\u4E2D\u51FA\u73B0\u4E86\u5F88\u591A\u91CD\u590D\u9879\u3002\u5F88\u663E\u7136\uFF0C\u7EAF\u9759\u6001 <code>int</code> \u7528\u4E8E\u6784\u9020\u8FC7\u7A0B\u5E76\u4E0D\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\u3002\u8BA9\u6211\u4EEC\u4F7F\u7528 <strong>AtomicInteger</strong> \u6765\u4F7F\u5176\u53D8\u4E3A\u7EBF\u7A0B\u5B89\u5168\u7684\u3002\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/GuardedIDField.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GuardedIDField</span> <span class="token keyword">implements</span> <span class="token class-name">HasID</span> <span class="token punctuation">{</span>  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> counter <span class="token operator">=</span> <span class="token keyword">new</span>
        <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> id <span class="token operator">=</span> counter<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> id<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">IDChecker</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">GuardedIDField</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6784\u9020\u5668\u6709\u4E00\u79CD\u66F4\u5FAE\u5999\u7684\u72B6\u6001\u5171\u4EAB\u65B9\u5F0F\uFF1A\u901A\u8FC7\u6784\u9020\u5668\u53C2\u6570\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/SharedConstructorArgument.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">SharedArg</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Unsafe</span> <span class="token keyword">implements</span> <span class="token class-name">SharedArg</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Safe</span> <span class="token keyword">implements</span> <span class="token class-name">SharedArg</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> counter<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SharedUser</span> <span class="token keyword">implements</span> <span class="token class-name">HasID</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token class-name">SharedUser</span><span class="token punctuation">(</span><span class="token class-name">SharedArg</span> sa<span class="token punctuation">)</span><span class="token punctuation">{</span>
        id <span class="token operator">=</span> sa<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SharedConstructorArgument</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IDChecker</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SharedUser</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Safe</span> safe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Safe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IDChecker</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SharedUser</span><span class="token punctuation">(</span>safe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    24838
    0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u8FD9\u91CC\uFF0C<strong>SharedUser</strong> \u6784\u9020\u5668\u5B9E\u9645\u4E0A\u5171\u4EAB\u4E86\u76F8\u540C\u7684\u53C2\u6570\u3002\u5373\u4F7F <strong>SharedUser</strong> \u4EE5\u5B8C\u5168\u65E0\u5BB3\u4E14\u5408\u7406\u7684\u65B9\u5F0F\u4F7F\u7528\u5176\u81EA\u5DF1\u7684\u53C2\u6570\uFF0C\u5176\u6784\u9020\u5668\u7684\u8C03\u7528\u65B9\u5F0F\u4E5F\u4F1A\u5F15\u8D77\u51B2\u7A81\u3002<strong>SharedUser</strong> \u751A\u81F3\u4E0D\u77E5\u9053\u5B83\u662F\u4EE5\u8FD9\u79CD\u65B9\u5F0F\u8C03\u7528\u7684\uFF0C\u66F4\u4E0D\u5FC5\u8BF4\u63A7\u5236\u5B83\u4E86\u3002</p>`,141),T=n("\u540C\u6B65\u6784\u9020\u5668\u5E76\u4E0D\u88AB java \u8BED\u8A00\u6240\u652F\u6301\uFF0C\u4F46\u662F\u901A\u8FC7\u4F7F\u7528\u540C\u6B65\u8BED\u5757\u6765\u521B\u5EFA\u4F60\u81EA\u5DF1\u7684\u540C\u6B65\u6784\u9020\u5668\u662F\u53EF\u80FD\u7684\uFF08\u8BF7\u53C2\u9605\u9644\u5F55\uFF1A"),F=n("\u5E76\u53D1\u5E95\u5C42\u539F\u7406 "),q=n("\uFF0C\u6765\u8FDB\u4E00\u6B65\u4E86\u89E3\u540C\u6B65\u5173\u952E\u5B57\u2014\u2014 "),D=s("code",null,"synchronized",-1),_=n("\uFF09\u3002\u5C3D\u7BA1 JLS\uFF08java \u8BED\u8A00\u89C4\u8303\uFF09\u8FD9\u6837\u9648\u8FF0\u9053\uFF1A\u201C\u2026\u2026\u5B83\u4F1A\u9501\u5B9A\u6B63\u5728\u6784\u9020\u7684\u5BF9\u8C61\u201D\uFF0C\u4F46\u8FD9\u5E76\u4E0D\u662F\u771F\u7684\u2014\u2014\u6784\u9020\u5668\u5B9E\u9645\u4E0A\u53EA\u662F\u4E00\u4E2A\u9759\u6001\u65B9\u6CD5\uFF0C\u56E0\u6B64\u540C\u6B65\u6784\u9020\u5668\u5B9E\u9645\u4E0A\u4F1A\u9501\u5B9A\u8BE5\u7C7B\u7684 Class \u5BF9\u8C61\u3002\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u521B\u5EFA\u81EA\u5DF1\u7684\u9759\u6001\u5BF9\u8C61\u5E76\u9501\u5B9A\u5B83\uFF0C\u6765\u8FBE\u5230\u4E0E\u540C\u6B65\u6784\u9020\u5668\u76F8\u540C\u7684\u6548\u679C\uFF1A"),B=e(`<div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/SynchronizedConstructor.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SyncConstructor</span> <span class="token keyword">implements</span> <span class="token class-name">HasID</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> constructorLock <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SyncConstructor</span><span class="token punctuation">(</span><span class="token class-name">SharedArg</span> sa<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>constructorLock<span class="token punctuation">)</span><span class="token punctuation">{</span>
            id <span class="token operator">=</span> sa<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedConstructor</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IDChecker</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SyncConstructor</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Unsafe</strong> \u7C7B\u7684\u5171\u4EAB\u4F7F\u7528\u73B0\u5728\u5C31\u53D8\u5F97\u5B89\u5168\u4E86\u3002\u53E6\u4E00\u79CD\u65B9\u6CD5\u662F\u5C06\u6784\u9020\u5668\u8BBE\u4E3A\u79C1\u6709\uFF08\u56E0\u6B64\u53EF\u4EE5\u9632\u6B62\u7EE7\u627F\uFF09\uFF0C\u5E76\u63D0\u4F9B\u4E00\u4E2A\u9759\u6001 Factory \u65B9\u6CD5\u6765\u751F\u6210\u65B0\u5BF9\u8C61\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/SynchronizedFactory.java</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SyncFactory</span> <span class="token keyword">implements</span> <span class="token class-name">HasID</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">SyncFactory</span><span class="token punctuation">(</span><span class="token class-name">SharedArg</span> sa<span class="token punctuation">)</span><span class="token punctuation">{</span>
        id <span class="token operator">=</span> sa<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">SyncFactory</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name">SharedArg</span> sa<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SyncFactory</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedFactory</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IDChecker</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">SyncFactory</span><span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u901A\u8FC7\u540C\u6B65\u9759\u6001\u5DE5\u5382\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u5728\u6784\u9020\u8FC7\u7A0B\u4E2D\u9501\u5B9A <strong>Class</strong> \u5BF9\u8C61\u3002</p><p>\u8FD9\u4E9B\u793A\u4F8B\u5145\u5206\u8868\u660E\u4E86\u5728\u5E76\u53D1 Java \u7A0B\u5E8F\u4E2D\u68C0\u6D4B\u548C\u7BA1\u7406\u5171\u4EAB\u72B6\u6001\u6709\u591A\u56F0\u96BE\u3002\u5373\u4F7F\u4F60\u91C7\u53D6\u201C\u4E0D\u5171\u4EAB\u4EFB\u4F55\u5185\u5BB9\u201D\u7684\u7B56\u7565\uFF0C\u4E5F\u5F88\u5BB9\u6613\u4EA7\u751F\u610F\u5916\u7684\u5171\u4EAB\u4E8B\u4EF6\u3002</p><h2 id="\u590D\u6742\u6027\u548C\u4EE3\u4EF7" tabindex="-1"><a class="header-anchor" href="#\u590D\u6742\u6027\u548C\u4EE3\u4EF7" aria-hidden="true">#</a> \u590D\u6742\u6027\u548C\u4EE3\u4EF7</h2><p>\u5047\u8BBE\u4F60\u6B63\u5728\u505A\u62AB\u8428\uFF0C\u6211\u4EEC\u628A\u4ECE\u6574\u4E2A\u6D41\u7A0B\u7684\u5F53\u524D\u6B65\u9AA4\u5230\u4E0B\u4E00\u4E2A\u6B65\u9AA4\u6240\u9700\u7684\u5DE5\u4F5C\u91CF\uFF0C\u5728\u8FD9\u91CC\u4E00\u4E00\u8868\u793A\u4E3A\u679A\u4E3E\u53D8\u91CF\u7684\u4E00\u90E8\u5206\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/Pizza.java import java.util.function.*;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Nap</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Pizza</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Step</span><span class="token punctuation">{</span>
        <span class="token function">DOUGH</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ROLLED</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">SAUCED</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">CHEESED</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">TOPPED</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">BAKED</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">SLICED</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">BOXED</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> effort<span class="token punctuation">;</span><span class="token comment">// Needed to get to the next step </span>

        <span class="token class-name">Step</span><span class="token punctuation">(</span><span class="token keyword">int</span> effort<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>effort <span class="token operator">=</span> effort<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Step</span> <span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">equals</span><span class="token punctuation">(</span>BOXED<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> BOXED<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Nap</span><span class="token punctuation">(</span>effort <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Step</span> step <span class="token operator">=</span> <span class="token class-name">Step</span><span class="token punctuation">.</span>DOUGH<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        step <span class="token operator">=</span> step<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Pizza &quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">Step</span> previousStep<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>step<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>previousStep<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Expected &quot;</span> <span class="token operator">+</span>
                      previousStep <span class="token operator">+</span> <span class="token string">&quot; but found &quot;</span> <span class="token operator">+</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">roll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>DOUGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">sauce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>ROLLED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">cheese</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>SAUCED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">toppings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>CHEESED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">bake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>TOPPED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>BAKED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">box</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>SLICED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> step<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>BOXED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Pizza&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>step<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Step</span><span class="token punctuation">.</span>BOXED<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;complete&quot;</span> <span class="token operator">:</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u53EA\u7B97\u5F97\u4E0A\u662F\u4E00\u4E2A\u5E73\u51E1\u7684\u72B6\u6001\u673A\uFF0C\u5C31\u50CF <strong>Machina</strong> \u7C7B\u4E00\u6837\u3002</p><p>\u5236\u4F5C\u4E00\u4E2A\u62AB\u8428\uFF0C\u5F53\u62AB\u8428\u997C\u6700\u7EC8\u88AB\u653E\u5728\u76D2\u5B50\u4E2D\u65F6\uFF0C\u5C31\u7B97\u5B8C\u6210\u6700\u7EC8\u4EFB\u52A1\u4E86\u3002 \u5982\u679C\u4E00\u4E2A\u4EBA\u5728\u505A\u4E00\u4E2A\u62AB\u8428\u997C\uFF0C\u90A3\u4E48\u6240\u6709\u6B65\u9AA4\u90FD\u662F\u7EBF\u6027\u8FDB\u884C\u7684\uFF0C\u5373\u4E00\u4E2A\u63A5\u4E00\u4E2A\u5730\u8FDB\u884C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/OnePizza.java </span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnePizza</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Pizza</span> za <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pizza</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>za<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> za<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Pizza 0: ROLLED 
Pizza 0: SAUCED 
Pizza 0: CHEESED 
Pizza 0: TOPPED 
Pizza 0: BAKED 
Pizza 0: SLICED 
Pizza 0: BOXED 
	1622 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u65F6\u95F4\u4EE5\u6BEB\u79D2\u4E3A\u5355\u4F4D\uFF0C\u52A0\u603B\u6240\u6709\u6B65\u9AA4\u7684\u5DE5\u4F5C\u91CF\uFF0C\u4F1A\u5F97\u51FA\u4E0E\u6211\u4EEC\u7684\u671F\u671B\u503C\u76F8\u7B26\u7684\u6570\u5B57\u3002 \u5982\u679C\u4F60\u4EE5\u8FD9\u79CD\u65B9\u5F0F\u5236\u4F5C\u4E86\u4E94\u4E2A\u62AB\u8428\uFF0C\u90A3\u4E48\u4F60\u4F1A\u8BA4\u4E3A\u5B83\u82B1\u8D39\u7684\u65F6\u95F4\u662F\u539F\u6765\u7684\u4E94\u500D\u3002 \u4F46\u662F\uFF0C\u5982\u679C\u8FD9\u8FD8\u4E0D\u591F\u5FEB\u600E\u4E48\u529E\uFF1F \u6211\u4EEC\u53EF\u4EE5\u4ECE\u5C1D\u8BD5\u5E76\u884C\u6D41\u65B9\u6CD5\u5F00\u59CB\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/PizzaStreams.java</span>
<span class="token comment">// import java.util.*; import java.util.stream.*;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PizzaStreams</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> QUANTITY <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> QUANTITY<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//[1]</span>
        	<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>za <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>za<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> za<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Pizza 2: ROLLED
Pizza 0: ROLLED
Pizza 1: ROLLED
Pizza 4: ROLLED
Pizza 3:ROLLED
Pizza 2:SAUCED
Pizza 1:SAUCED
Pizza 0:SAUCED
Pizza 4:SAUCED
Pizza 3:SAUCED
Pizza 2:CHEESED
Pizza 1:CHEESED
Pizza 0:CHEESED
Pizza 4:CHEESED
Pizza 3:CHEESED
Pizza 2:TOPPED
Pizza 1:TOPPED
Pizza 0:TOPPED
Pizza 4:TOPPED
Pizza 3:TOPPED
Pizza 2:BAKED
Pizza 1:BAKED
Pizza 0:BAKED
Pizza 4:BAKED
Pizza 3:BAKED
Pizza 2:SLICED
Pizza 1:SLICED
Pizza 0:SLICED
Pizza 4:SLICED
Pizza 3:SLICED
Pizza 2:BOXED
Pizza 1:BOXED
Pizza 0:BOXED
Pizza 4:BOXED
Pizza 3:BOXED
1739
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u73B0\u5728\uFF0C\u6211\u4EEC\u5236\u4F5C\u4E94\u4E2A\u62AB\u8428\u7684\u65F6\u95F4\u4E0E\u5236\u4F5C\u5355\u4E2A\u62AB\u8428\u7684\u65F6\u95F4\u5C31\u5DEE\u4E0D\u591A\u4E86\u3002 \u5C1D\u8BD5\u5220\u9664\u6807\u8BB0\u4E3A[1] \u7684\u884C\u540E\uFF0C\u4F60\u4F1A\u53D1\u73B0\u5B83\u82B1\u8D39\u7684\u65F6\u95F4\u662F\u539F\u6765\u7684\u4E94\u500D\u3002 \u4F60\u8FD8\u53EF\u4EE5\u5C1D\u8BD5\u5C06 <strong>QUANTITY</strong> \u66F4\u6539\u4E3A 4\u30018\u300110\u300116 \u548C 17\uFF0C\u770B\u770B\u4F1A\u6709\u4EC0\u4E48\u4E0D\u540C\uFF0C\u5E76\u731C\u731C\u770B\u4E3A\u4EC0\u4E48\u4F1A\u8FD9\u6837\u3002</p><p><strong>PizzaStreams</strong> \u7C7B\u4EA7\u751F\u7684\u6BCF\u4E2A\u5E76\u884C\u6D41\u5728\u5B83\u7684<code>forEach()</code>\u5185\u5B8C\u6210\u6240\u6709\u5DE5\u4F5C\uFF0C\u5982\u679C\u6211\u4EEC\u5C06\u5176\u5404\u4E2A\u6B65\u9AA4\u7528\u6620\u5C04\u7684\u65B9\u5F0F\u4E00\u6B65\u4E00\u6B65\u5904\u7406\uFF0C\u60C5\u51B5\u4F1A\u6709\u6240\u4E0D\u540C\u5417\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/PizzaParallelSteps.java </span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PizzaParallelSteps</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> QUANTITY <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> QUANTITY<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">roll</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">sauce</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">cheese</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">toppings</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">bake</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">slice</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">box</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>za <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>za<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Pizza 2: ROLLED 
Pizza 0: ROLLED 
Pizza 1: ROLLED 
Pizza 4: ROLLED 
Pizza 3: ROLLED 
Pizza 1: SAUCED 
Pizza 0: SAUCED 
Pizza 2: SAUCED 
Pizza 3: SAUCED 
Pizza 4: SAUCED 
Pizza 1: CHEESED 
Pizza 0: CHEESED 
Pizza 2: CHEESED 
Pizza 3: CHEESED 
Pizza 4: CHEESED 
Pizza 0: TOPPED 
Pizza 2: TOPPED
Pizza 1: TOPPED 
Pizza 3: TOPPED 
Pizza 4: TOPPED 
Pizza 1: BAKED 
Pizza 2: BAKED 
Pizza 0: BAKED 
Pizza 4: BAKED 
Pizza 3: BAKED 
Pizza 0: SLICED 
Pizza 2: SLICED 
Pizza 1: SLICED 
Pizza 3: SLICED 
Pizza 4: SLICED 
Pizza 1: BOXED 
Pizza1: complete 
Pizza 2: BOXED 
Pizza 0: BOXED 
Pizza2: complete 
Pizza0: complete 
Pizza 3: BOXED
Pizza 4: BOXED 
Pizza4: complete 
Pizza3: complete 
1738 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7B54\u6848\u662F\u201C\u5426\u201D\uFF0C\u4E8B\u540E\u770B\u6765\u8FD9\u5E76\u4E0D\u5947\u602A\uFF0C\u56E0\u4E3A\u6BCF\u4E2A\u62AB\u8428\u90FD\u9700\u8981\u6309\u987A\u5E8F\u6267\u884C\u6B65\u9AA4\u3002\u56E0\u6B64\uFF0C\u6CA1\u6CD5\u901A\u8FC7\u5206\u6B65\u6267\u884C\u64CD\u4F5C\u6765\u8FDB\u4E00\u6B65\u63D0\u9AD8\u901F\u5EA6\uFF0C\u5C31\u50CF\u4E0A\u6587\u7684 <code>PizzaParallelSteps.java</code> \u91CC\u9762\u5C55\u793A\u7684\u4E00\u6837\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 <strong>CompletableFutures</strong> \u91CD\u5199\u8FD9\u4E2A\u4F8B\u5B50\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// concurrent/CompletablePizza.java </span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">onjava<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletablePizza</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> QUANTITY <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pizza</span><span class="token punctuation">&gt;</span></span> <span class="token function">makeCF</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span> za<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span>
                <span class="token punctuation">.</span><span class="token function">completedFuture</span><span class="token punctuation">(</span>za<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">roll</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">sauce</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">cheese</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">toppings</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">bake</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">slice</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token function">box</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pizza</span><span class="token punctuation">&gt;</span></span> cf<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Timer</span> timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">&lt;</span><span class="token class-name">Pizza</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> pizzas <span class="token operator">=</span>
                <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> QUANTITY<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">Pizza</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">CompletablePizza</span><span class="token operator">::</span><span class="token function">makeCF</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pizzas<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">CompletablePizza</span><span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>timer<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>169 
Pizza 0: ROLLED 
Pizza 1: ROLLED 
Pizza 2: ROLLED 
Pizza 4: ROLLED 
Pizza 3: ROLLED 
Pizza 1: SAUCED 
Pizza 0: SAUCED 
Pizza 2: SAUCED 
Pizza 4: SAUCED
Pizza 3: SAUCED 
Pizza 0: CHEESED 
Pizza 4: CHEESED 
Pizza 1: CHEESED 
Pizza 2: CHEESED 
Pizza 3: CHEESED 
Pizza 0: TOPPED 
Pizza 4: TOPPED 
Pizza 1: TOPPED 
Pizza 2: TOPPED 
Pizza 3: TOPPED 
Pizza 0: BAKED 
Pizza 4: BAKED 
Pizza 1: BAKED 
Pizza 3: BAKED 
Pizza 2: BAKED 
Pizza 0: SLICED 
Pizza 4: SLICED 
Pizza 1: SLICED 
Pizza 3: SLICED
Pizza 2: SLICED 
Pizza 4: BOXED 
Pizza 0: BOXED 
Pizza0: complete 
Pizza 1: BOXED 
Pizza1: complete 
Pizza 3: BOXED 
Pizza 2: BOXED 
Pizza2: complete 
Pizza3: complete 
Pizza4: complete 
1797 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5E76\u884C\u6D41\u548C <strong>CompletableFutures</strong> \u662F Java \u5E76\u53D1\u5DE5\u5177\u7BB1\u4E2D\u6700\u5148\u8FDB\u53D1\u8FBE\u7684\u6280\u672F\u3002 \u4F60\u5E94\u8BE5\u59CB\u7EC8\u9996\u5148\u9009\u62E9\u5176\u4E2D\u4E4B\u4E00\u3002 \u5F53\u4E00\u4E2A\u95EE\u9898\u5F88\u5BB9\u6613\u5E76\u884C\u5904\u7406\u65F6\uFF0C\u6216\u8005\u8BF4\uFF0C\u5F88\u5BB9\u6613\u628A\u6570\u636E\u5206\u89E3\u6210\u76F8\u540C\u7684\u3001\u6613\u4E8E\u5904\u7406\u7684\u5404\u4E2A\u90E8\u5206\u65F6\uFF0C\u4F7F\u7528\u5E76\u884C\u6D41\u65B9\u6CD5\u5904\u7406\u6700\u4E3A\u5408\u9002\uFF08\u800C\u5982\u679C\u4F60\u51B3\u5B9A\u4E0D\u501F\u52A9\u5B83\u800C\u7531\u81EA\u5DF1\u5B8C\u6210\uFF0C\u4F60\u5C31\u5FC5\u987B\u64B8\u8D77\u8896\u5B50\uFF0C\u6DF1\u5165\u7814\u7A76 <strong>Spliterator</strong> \u7684\u6587\u6863\uFF09\u3002</p><p>\u800C\u5F53\u5DE5\u4F5C\u7684\u5404\u4E2A\u90E8\u5206\u5185\u5BB9\u5404\u4E0D\u76F8\u540C\u65F6\uFF0C\u4F7F\u7528 <strong>CompletableFutures</strong> \u662F\u6700\u597D\u7684\u9009\u62E9\u3002\u6BD4\u8D77\u9762\u5411\u6570\u636E\uFF0C<strong>CompletableFutures</strong> \u66F4\u50CF\u662F\u9762\u5411\u4EFB\u52A1\u7684\u3002</p><p>\u5BF9\u4E8E\u62AB\u8428\u95EE\u9898\uFF0C\u7ED3\u679C\u4F3C\u4E4E\u4E5F\u6CA1\u6709\u4EC0\u4E48\u4E0D\u540C\u3002\u5B9E\u9645\u4E0A\uFF0C\u5E76\u884C\u6D41\u65B9\u6CD5\u770B\u8D77\u6765\u66F4\u7B80\u6D01\uFF0C\u4EC5\u51FA\u4E8E\u8FD9\u4E2A\u539F\u56E0\uFF0C\u6211\u8BA4\u4E3A\u5E76\u884C\u6D41\u4F5C\u4E3A\u89E3\u51B3\u95EE\u9898\u7684\u9996\u6B21\u5C1D\u8BD5\u65B9\u6CD5\u66F4\u5177\u5438\u5F15\u529B\u3002</p><p>\u7531\u4E8E\u5236\u4F5C\u62AB\u8428\u603B\u9700\u8981\u4E00\u5B9A\u7684\u65F6\u95F4\uFF0C\u65E0\u8BBA\u4F60\u4F7F\u7528\u54EA\u79CD\u5E76\u53D1\u65B9\u6CD5\uFF0C\u4F60\u80FD\u505A\u5230\u7684\u6700\u597D\u60C5\u51B5\uFF0C\u662F\u5728\u5236\u4F5C\u4E00\u4E2A\u62AB\u8428\u7684\u76F8\u540C\u65F6\u95F4\u5185\u5236\u4F5C n \u4E2A\u62AB\u8428\u3002 \u5728\u8FD9\u91CC\u5F53\u7136\u5F88\u5BB9\u6613\u770B\u51FA\u6765\uFF0C\u4F46\u662F\u5F53\u4F60\u5904\u7406\u66F4\u590D\u6742\u7684\u95EE\u9898\u65F6\uFF0C\u4F60\u5C31\u53EF\u80FD\u5FD8\u8BB0\u8FD9\u4E00\u70B9\u3002 \u901A\u5E38\uFF0C\u5728\u9879\u76EE\u5F00\u59CB\u65F6\u8FDB\u884C\u7C97\u7565\u7684\u8BA1\u7B97\uFF0C\u5C31\u80FD\u5F88\u5FEB\u5F04\u6E05\u695A\u6700\u5927\u53EF\u80FD\u7684\u5E76\u884C\u541E\u5410\u91CF\uFF0C\u8FD9\u53EF\u4EE5\u9632\u6B62\u4F60\u56E0\u4E3A\u91C7\u53D6\u65E0\u7528\u7684\u52A0\u5FEB\u8FD0\u884C\u901F\u5EA6\u7684\u4E3E\u63AA\u800C\u5FD9\u5F97\u56E2\u56E2\u8F6C\u3002</p><p>\u4F7F\u7528 <strong>CompletableFutures</strong> \u6216\u8BB8\u53EF\u4EE5\u8F7B\u6613\u5730\u5E26\u6765\u91CD\u5927\u6536\u76CA\uFF0C\u4F46\u662F\u5728\u5C1D\u8BD5\u66F4\u8FDB\u4E00\u6B65\u65F6\u9700\u8981\u500D\u52A0\u5C0F\u5FC3\uFF0C\u56E0\u4E3A\u989D\u5916\u589E\u52A0\u7684\u6210\u672C\u548C\u5DE5\u4F5C\u91CF\u4F1A\u975E\u5E38\u5BB9\u6613\u8FDC\u8FDC\u8D85\u51FA\u4F60\u4E4B\u524D\u62FC\u547D\u6324\u51FA\u7684\u90A3\u4E00\u70B9\u70B9\u6536\u76CA\u3002</p><h2 id="\u672C\u7AE0\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u672C\u7AE0\u5C0F\u7ED3" aria-hidden="true">#</a> \u672C\u7AE0\u5C0F\u7ED3</h2><p>\u9700\u8981\u5E76\u53D1\u7684\u552F\u4E00\u7406\u7531\u662F\u201C\u7B49\u5F85\u592A\u591A\u201D\u3002\u8FD9\u4E5F\u53EF\u4EE5\u5305\u62EC\u7528\u6237\u754C\u9762\u7684\u54CD\u5E94\u901F\u5EA6\uFF0C\u4F46\u662F\u7531\u4E8E Java \u7528\u4E8E\u6784\u5EFA\u7528\u6237\u754C\u9762\u65F6\u5E76\u4E0D\u9AD8\u6548\uFF0C\u56E0\u6B64[^8] \u8FD9\u4EC5\u4EC5\u610F\u5473\u7740\u201C\u4F60\u7684\u7A0B\u5E8F\u8FD0\u884C\u901F\u5EA6\u8FD8\u4E0D\u591F\u5FEB\u201D\u3002</p><p>\u5982\u679C\u5E76\u53D1\u5F88\u5BB9\u6613\uFF0C\u5219\u6CA1\u6709\u7406\u7531\u62D2\u7EDD\u5E76\u53D1\u3002 \u6B63\u56E0\u4E3A\u5E76\u53D1\u5B9E\u9645\u4E0A\u5F88\u96BE\uFF0C\u6240\u4EE5\u4F60\u5E94\u8BE5\u4ED4\u7EC6\u8003\u8651\u662F\u5426\u503C\u5F97\u4E3A\u6B64\u4ED8\u51FA\u52AA\u529B\uFF0C\u5E76\u8003\u8651\u4F60\u80FD\u5426\u4EE5\u5176\u4ED6\u65B9\u5F0F\u63D0\u5347\u901F\u5EA6\u3002</p><p>\u4F8B\u5982\uFF0C\u8FC1\u79FB\u5230\u66F4\u5FEB\u7684\u786C\u4EF6\uFF08\u8FD9\u53EF\u80FD\u6BD4\u6D88\u8017\u7A0B\u5E8F\u5458\u7684\u65F6\u95F4\u8981\u4FBF\u5B9C\u5F97\u591A\uFF09\u6216\u8005\u5C06\u7A0B\u5E8F\u5206\u89E3\u6210\u591A\u4E2A\u90E8\u5206\uFF0C\u7136\u540E\u5728\u4E0D\u540C\u7684\u673A\u5668\u4E0A\u8FD0\u884C\u8FD9\u4E9B\u90E8\u5206\u3002</p><p>\u5965\u5361\u59C6\u5243\u5200\u662F\u4E00\u4E2A\u7ECF\u5E38\u88AB\u8BEF\u89E3\u7684\u539F\u5219\u3002 \u6211\u770B\u8FC7\u81F3\u5C11\u4E00\u90E8\u7535\u5F71\uFF0C\u4ED6\u4EEC\u5C06\u5176\u5B9A\u4E49\u4E3A\u201D\u6700\u7B80\u5355\u7684\u89E3\u51B3\u65B9\u6848\u662F\u6B63\u786E\u7684\u89E3\u51B3\u65B9\u6848\u201C\uFF0C\u5C31\u597D\u50CF\u8FD9\u662F\u67D0\u79CD\u6BCB\u5EB8\u7F6E\u7591\u7684\u6CD5\u5F8B\u3002\u5B9E\u9645\u4E0A\uFF0C\u8FD9\u662F\u4E00\u4E2A\u51C6\u5219\uFF1A\u9762\u5BF9\u591A\u79CD\u65B9\u6CD5\u65F6\uFF0C\u8BF7\u5148\u5C1D\u8BD5\u9700\u8981\u6700\u5C11\u5047\u8BBE\u7684\u65B9\u6CD5\u3002 \u5728\u7F16\u7A0B\u4E16\u754C\u4E2D\uFF0C\u8FD9\u5DF2\u6F14\u53D8\u4E3A\u201C\u5C1D\u8BD5\u53EF\u80FD\u53EF\u884C\u7684\u6700\u7B80\u5355\u7684\u65B9\u6CD5\u201D\u3002\u5F53\u4F60\u4E86\u89E3\u4E86\u7279\u5B9A\u5DE5\u5177\u7684\u77E5\u8BC6\u65F6\u2014\u2014\u5C31\u50CF\u4F60\u73B0\u5728\u4E86\u89E3\u4E86\u6709\u5173\u5E76\u53D1\u6027\u7684\u77E5\u8BC6\u4E00\u6837\uFF0C\u4F60\u53EF\u80FD\u4F1A\u5F88\u60F3\u4F7F\u7528\u5B83\uFF0C\u6216\u8005\u63D0\u524D\u89C4\u5B9A\u4F60\u7684\u89E3\u51B3\u65B9\u6848\u5FC5\u987B\u80FD\u591F\u201C\u901F\u5EA6\u98DE\u5FEB\u201D\uFF0C\u4ECE\u800C\u6765\u8BC1\u660E\u4ECE\u4E00\u5F00\u59CB\u5C31\u8FDB\u884C\u5E76\u53D1\u8BBE\u8BA1\u662F\u5408\u7406\u7684\u3002\u4F46\u662F\uFF0C\u6211\u4EEC\u7684\u5965\u5361\u59C6\u5243\u5200\u7F16\u7A0B\u7248\u672C\u8868\u793A\u4F60\u5E94\u8BE5\u9996\u5148\u5C1D\u8BD5\u6700\u7B80\u5355\u7684\u65B9\u6CD5\uFF08\u8FD9\u79CD\u65B9\u6CD5\u5F00\u53D1\u8D77\u6765\u4E5F\u66F4\u4FBF\u5B9C\uFF09\uFF0C\u7136\u540E\u770B\u770B\u5B83\u662F\u5426\u8DB3\u591F\u597D\u3002</p><p>\u7531\u4E8E\u6211\u51FA\u8EAB\u4E8E\u5E95\u5C42\u5B66\u672F\u80CC\u666F\uFF08\u7269\u7406\u5B66\u548C\u8BA1\u7B97\u673A\u5DE5\u7A0B\uFF09\uFF0C\u6240\u4EE5\u6211\u5F88\u5BB9\u6613\u60F3\u5230\u6240\u6709\u5C0F\u8F6E\u5B50\u8F6C\u52A8\u7684\u6210\u672C\u3002\u6211\u786E\u5B9A\u4F7F\u7528\u6700\u7B80\u5355\u7684\u65B9\u6CD5\u4E0D\u591F\u5FEB\u7684\u573A\u666F\u51FA\u73B0\u7684\u6B21\u6570\u5DF2\u7ECF\u6570\u4E0D\u8FC7\u6765\u4E86\uFF0C\u4F46\u662F\u5C1D\u8BD5\u540E\u5374\u53D1\u73B0\u5B83\u5B9E\u9645\u4E0A\u7EF0\u7EF0\u6709\u4F59\u3002</p><h3 id="\u7F3A\u70B9" tabindex="-1"><a class="header-anchor" href="#\u7F3A\u70B9" aria-hidden="true">#</a> \u7F3A\u70B9</h3><p>\u5E76\u53D1\u7F16\u7A0B\u7684\u4E3B\u8981\u7F3A\u70B9\u662F\uFF1A</p><ol><li><p>\u5728\u7EBF\u7A0B\u7B49\u5F85\u5171\u4EAB\u8D44\u6E90\u65F6\u4F1A\u964D\u4F4E\u901F\u5EA6\u3002</p></li><li><p>\u7EBF\u7A0B\u7BA1\u7406\u4EA7\u751F\u989D\u5916 CPU \u5F00\u9500\u3002</p></li><li><p>\u7CDF\u7CD5\u7684\u8BBE\u8BA1\u51B3\u7B56\u5E26\u6765\u65E0\u6CD5\u5F25\u8865\u7684\u590D\u6742\u6027\u3002</p></li><li><p>\u8BF8\u5982\u9965\u997F\uFF0C\u7ADE\u901F\uFF0C\u6B7B\u9501\u548C\u6D3B\u9501\uFF08\u591A\u7EBF\u7A0B\u5404\u81EA\u5904\u7406\u5355\u4E2A\u4EFB\u52A1\u800C\u6574\u4F53\u5374\u65E0\u6CD5\u5B8C\u6210\uFF09\u4E4B\u7C7B\u7684\u95EE\u9898\u3002</p></li><li><p>\u8DE8\u5E73\u53F0\u7684\u4E0D\u4E00\u81F4\u3002 \u901A\u8FC7\u4E00\u4E9B\u793A\u4F8B\uFF0C\u6211\u53D1\u73B0\u4E86\u67D0\u4E9B\u8BA1\u7B97\u673A\u4E0A\u5F88\u5FEB\u51FA\u73B0\u7684\u7ADE\u4E89\u72B6\u51B5\uFF0C\u800C\u5728\u5176\u4ED6\u8BA1\u7B97\u673A\u4E0A\u5374\u6CA1\u6709\u3002 \u5982\u679C\u4F60\u5728\u540E\u8005\u4E0A\u5F00\u53D1\u7A0B\u5E8F\uFF0C\u5219\u5728\u5206\u53D1\u7A0B\u5E8F\u65F6\u53EF\u80FD\u4F1A\u611F\u5230\u975E\u5E38\u60CA\u8BB6\u3002</p></li></ol><p>\u53E6\u5916\uFF0C\u5E76\u53D1\u7684\u5E94\u7528\u662F\u4E00\u95E8\u827A\u672F\u3002 Java \u65E8\u5728\u5141\u8BB8\u4F60\u521B\u5EFA\u5C3D\u53EF\u80FD\u591A\u7684\u6240\u9700\u8981\u7684\u5BF9\u8C61\u6765\u89E3\u51B3\u95EE\u9898\u2014\u2014\u81F3\u5C11\u5728\u7406\u8BBA\u4E0A\u662F\u8FD9\u6837\u3002[^9] \u4F46\u662F\uFF0C\u7EBF\u7A0B\u4E0D\u662F\u5178\u578B\u7684\u5BF9\u8C61\uFF1A\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u5176\u81EA\u5DF1\u7684\u6267\u884C\u73AF\u5883\uFF0C\u5305\u62EC\u5806\u6808\u548C\u5176\u4ED6\u5FC5\u8981\u7684\u5143\u7D20\uFF0C\u4F7F\u5176\u6BD4\u666E\u901A\u5BF9\u8C61\u5927\u5F97\u591A\u3002 \u5728\u5927\u591A\u6570\u73AF\u5883\u4E2D\uFF0C\u53EA\u80FD\u5728\u5185\u5B58\u7528\u5149\u4E4B\u524D\u521B\u5EFA\u6570\u5343\u4E2A <strong>Thread</strong> \u5BF9\u8C61\u3002\u901A\u5E38\uFF0C\u4F60\u53EA\u9700\u8981\u51E0\u4E2A\u7EBF\u7A0B\u5373\u53EF\u89E3\u51B3\u95EE\u9898\uFF0C\u56E0\u6B64\u4E00\u822C\u6765\u8BF4\u521B\u5EFA\u7EBF\u7A0B\u6CA1\u6709\u4EC0\u4E48\u9650\u5236\uFF0C\u4F46\u662F\u5BF9\u4E8E\u67D0\u4E9B\u8BBE\u8BA1\u800C\u8A00\uFF0C\u5B83\u4F1A\u6210\u4E3A\u4E00\u79CD\u7EA6\u675F\uFF0C\u53EF\u80FD\u8FEB\u4F7F\u4F60\u4F7F\u7528\u5B8C\u5168\u4E0D\u540C\u7684\u65B9\u6848\u3002</p><h3 id="\u5171\u4EAB\u5185\u5B58\u9677\u9631" tabindex="-1"><a class="header-anchor" href="#\u5171\u4EAB\u5185\u5B58\u9677\u9631" aria-hidden="true">#</a> \u5171\u4EAB\u5185\u5B58\u9677\u9631</h3><p>\u5E76\u53D1\u6027\u7684\u4E3B\u8981\u56F0\u96BE\u4E4B\u4E00\u662F\u56E0\u4E3A\u53EF\u80FD\u6709\u591A\u4E2A\u4EFB\u52A1\u5171\u4EAB\u4E00\u4E2A\u8D44\u6E90\uFF08\u4F8B\u5982\u5BF9\u8C61\u4E2D\u7684\u5185\u5B58\uFF09\uFF0C\u5E76\u4E14\u4F60\u5FC5\u987B\u786E\u4FDD\u591A\u4E2A\u4EFB\u52A1\u4E0D\u4F1A\u540C\u65F6\u8BFB\u53D6\u548C\u66F4\u6539\u8BE5\u8D44\u6E90\u3002</p><p>\u6211\u82B1\u4E86\u591A\u5E74\u7684\u65F6\u95F4\u7814\u7A76\u5E76\u53D1\u3002 \u6211\u4E86\u89E3\u5230\u4F60\u6C38\u8FDC\u65E0\u6CD5\u76F8\u4FE1\u4F7F\u7528\u5171\u4EAB\u5185\u5B58\u5E76\u53D1\u7684\u7A0B\u5E8F\u53EF\u4EE5\u6B63\u5E38\u5DE5\u4F5C\u3002 \u4F60\u53EF\u4EE5\u8F7B\u6613\u53D1\u73B0\u5B83\u662F\u9519\u8BEF\u7684\uFF0C\u4F46\u6C38\u8FDC\u65E0\u6CD5\u8BC1\u660E\u5B83\u662F\u6B63\u786E\u7684\u3002 \u8FD9\u662F\u4F17\u6240\u5468\u77E5\u7684\u5E76\u53D1\u539F\u5219\u4E4B\u4E00\u3002[^10]</p><p>\u6211\u9047\u5230\u4E86\u8BB8\u591A\u4EBA\uFF0C\u4ED6\u4EEC\u5BF9\u7F16\u5199\u6B63\u786E\u7684\u7EBF\u7A0B\u7A0B\u5E8F\u7684\u80FD\u529B\u5145\u6EE1\u4FE1\u5FC3\u3002 \u6211\u5076\u5C14\u5F00\u59CB\u8BA4\u4E3A\u6211\u4E5F\u53EF\u4EE5\u505A\u597D\u3002 \u5BF9\u4E8E\u4E00\u4E2A\u7279\u5B9A\u7684\u7A0B\u5E8F\uFF0C\u6211\u6700\u521D\u662F\u5728\u53EA\u6709\u5355\u4E2A CPU \u7684\u673A\u5668\u4E0A\u7F16\u5199\u7684\u3002 \u90A3\u65F6\u6211\u80FD\u591F\u8BF4\u670D\u81EA\u5DF1\u8BE5\u7A0B\u5E8F\u662F\u6B63\u786E\u7684\uFF0C\u56E0\u4E3A\u6211\u4EE5\u4E3A\u6211\u5BF9 Java \u5DE5\u5177\u5F88\u4E86\u89E3\u3002 \u800C\u4E14\u5728\u6211\u7684\u5355 CPU \u8BA1\u7B97\u673A\u4E0A\u4E5F\u6CA1\u6709\u5931\u8D25\u3002\u800C\u5230\u4E86\u5177\u6709\u591A\u4E2A CPU \u7684\u8BA1\u7B97\u673A\uFF0C\u7A0B\u5E8F\u51FA\u73B0\u95EE\u9898\u4E0D\u80FD\u8FD0\u884C\u540E\uFF0C\u6211\u611F\u5230\u5F88\u60CA\u8BB6\uFF0C\u4F46\u8FD9\u8FD8\u53EA\u662F\u4F17\u591A\u95EE\u9898\u4E2D\u7684\u4E00\u4E2A\u800C\u5DF2\u3002 \u8FD9\u4E0D\u662F Java \u7684\u9519\uFF1B \u201C\u5199\u4E00\u6B21\uFF0C\u5230\u5904\u8FD0\u884C\u201D\uFF0C\u5728\u5355\u6838\u4E0E\u591A\u6838\u8BA1\u7B97\u673A\u95F4\u65E0\u6CD5\u6269\u5C55\u5230\u5E76\u53D1\u7F16\u7A0B\u9886\u57DF\u3002\u8FD9\u662F\u5E76\u53D1\u7F16\u7A0B\u7684\u57FA\u672C\u95EE\u9898\u3002 \u5B9E\u9645\u4E0A\u4F60\u53EF\u4EE5\u5728\u5355 CPU \u673A\u5668\u4E0A\u53D1\u73B0\u4E00\u4E9B\u5E76\u53D1\u95EE\u9898\uFF0C\u4F46\u662F\u5728\u591A\u7EBF\u7A0B\u5B9E\u9645\u4E0A\u771F\u7684\u5728\u5E76\u884C\u8FD0\u884C\u7684\u591A CPU \u673A\u5668\u4E0A\uFF0C\u5C31\u4F1A\u51FA\u73B0\u4E00\u4E9B\u5176\u4ED6\u95EE\u9898\u3002</p><p>\u518D\u4E3E\u4E00\u4E2A\u4F8B\u5B50\uFF0C\u54F2\u5B66\u5BB6\u5C31\u9910\u7684\u95EE\u9898\u53EF\u4EE5\u5F88\u5BB9\u6613\u5730\u8FDB\u884C\u8C03\u6574\uFF0C\u56E0\u6B64\u51E0\u4E4E\u4E0D\u4F1A\u4EA7\u751F\u6B7B\u9501\uFF0C\u8FD9\u4F1A\u7ED9\u4F60\u4E00\u79CD\u4E00\u5207\u90FD\u68D2\u6781\u4E86\u7684\u5370\u8C61\u3002\u5F53\u6D89\u53CA\u5230\u5171\u4EAB\u5185\u5B58\u5E76\u53D1\u7F16\u7A0B\u65F6\uFF0C\u4F60\u6C38\u8FDC\u4E0D\u5E94\u8BE5\u5BF9\u81EA\u5DF1\u7684\u7F16\u7A0B\u80FD\u529B\u53D8\u5F97\u8FC7\u4E8E\u81EA\u4FE1\u3002</p><h3 id="this-albatross-is-big" tabindex="-1"><a class="header-anchor" href="#this-albatross-is-big" aria-hidden="true">#</a> This Albatross is Big</h3><p>\u5982\u679C\u4F60\u5BF9 Java \u5E76\u53D1\u611F\u5230\u4E0D\u77E5\u6240\u63AA\uFF0C\u90A3\u8BF4\u660E\u4F60\u8EAB\u5904\u5728\u4E00\u5BB6\u51FA\u8272\u7684\u516C\u53F8\u91CC\u3002\u4F60\u53EF\u4EE5\u8BBF\u95EE <strong>Thread</strong> \u7C7B\u7684<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html" target="_blank" rel="noopener noreferrer">Javadoc</a> \u9875\u9762\uFF0C \u770B\u4E00\u4E0B\u54EA\u4E9B\u65B9\u6CD5\u73B0\u5728\u662F <strong>Deprecated</strong> \uFF08\u5E9F\u5F03\u7684\uFF09\u3002\u8FD9\u4E9B\u662F Java \u8BED\u8A00\u8BBE\u8BA1\u8005\u72AF\u8FC7\u9519\u7684\u5730\u65B9\uFF0C\u56E0\u4E3A\u4ED6\u4EEC\u5728\u8BBE\u8BA1\u8BED\u8A00\u65F6\u5BF9\u5E76\u53D1\u6027\u4E86\u89E3\u4E0D\u8DB3\u3002</p><p>\u4E8B\u5B9E\u8BC1\u660E\uFF0C\u5728 Java \u7684\u540E\u7EED\u7248\u672C\u4E2D\u6DFB\u52A0\u7684\u8BB8\u591A\u5E93\u89E3\u51B3\u65B9\u6848\u90FD\u662F\u65E0\u6548\u7684\uFF0C\u751A\u81F3\u662F\u65E0\u7528\u7684\u3002 \u5E78\u8FD0\u7684\u662F\uFF0CJava 8 \u4E2D\u7684\u5E76\u884C <strong>Streams</strong> \u548C <strong>CompletableFutures</strong> \u90FD\u975E\u5E38\u6709\u4EF7\u503C\u3002\u4F46\u662F\u5F53\u4F60\u4F7F\u7528\u65E7\u4EE3\u7801\u65F6\uFF0C\u4ECD\u7136\u4F1A\u9047\u5230\u65E7\u7684\u89E3\u51B3\u65B9\u6848\u3002</p><p>\u5728\u672C\u4E66\u7684\u5176\u4ED6\u5730\u65B9\uFF0C\u6211\u8C08\u5230\u4E86 Java \u7684\u4E00\u4E2A\u57FA\u672C\u95EE\u9898\uFF1A\u6BCF\u4E2A\u5931\u8D25\u7684\u5B9E\u9A8C\u90FD\u6C38\u8FDC\u5D4C\u5165\u5728\u8BED\u8A00\u6216\u5E93\u4E2D\u3002 Java \u5E76\u53D1\u5F3A\u8C03\u4E86\u8FD9\u4E2A\u95EE\u9898\u3002\u5C3D\u7BA1\u6709\u4E0D\u5C11\u9519\u8BEF\uFF0C\u4F46\u9519\u8BEF\u5E76\u4E0D\u662F\u90A3\u4E48\u591A\uFF0C\u56E0\u4E3A\u6709\u5F88\u591A\u4E0D\u540C\u7684\u5C1D\u8BD5\u65B9\u6CD5\u6765\u89E3\u51B3\u95EE\u9898\u3002 \u597D\u7684\u65B9\u9762\u662F\uFF0C\u8FD9\u4E9B\u5C1D\u8BD5\u4EA7\u751F\u4E86\u66F4\u597D\uFF0C\u66F4\u7B80\u5355\u7684\u8BBE\u8BA1\u3002 \u4E0D\u5229\u4E4B\u5904\u5728\u4E8E\uFF0C\u5728\u627E\u5230\u597D\u7684\u65B9\u6CD5\u4E4B\u524D\uFF0C\u4F60\u5F88\u5BB9\u6613\u8FF7\u5931\u4E8E\u65E7\u7684\u8BBE\u8BA1\u4E2D\u3002</p><h3 id="\u5176\u4ED6\u7C7B\u5E93" tabindex="-1"><a class="header-anchor" href="#\u5176\u4ED6\u7C7B\u5E93" aria-hidden="true">#</a> \u5176\u4ED6\u7C7B\u5E93</h3>`,56),I=n("\u672C\u7AE0\u91CD\u70B9\u4ECB\u7ECD\u4E86\u76F8\u5BF9\u5B89\u5168\u6613\u7528\u7684\u5E76\u884C\u5DE5\u5177\u6D41\u548C "),L=s("strong",null,"CompletableFutures",-1),O=n(" \uFF0C\u5E76\u4E14\u4EC5\u6D89\u53CA Java \u6807\u51C6\u5E93\u4E2D\u4E00\u4E9B\u66F4\u7EC6\u7C92\u5EA6\u7684\u5DE5\u5177\u3002 \u4E3A\u907F\u514D\u4F60\u4E0D\u77E5\u6240\u63AA\uFF0C\u6211\u6CA1\u6709\u4ECB\u7ECD\u4F60\u53EF\u80FD\u5B9E\u9645\u5728\u5B9E\u8DF5\u4E2D\u4F7F\u7528\u7684\u67D0\u4E9B\u5E93\u3002\u6211\u4EEC\u4F7F\u7528\u4E86\u51E0\u4E2A "),J=s("strong",null,"Atomic",-1),N=n(" \uFF08\u539F\u5B50\uFF09\u7C7B\uFF0C"),M=s("strong",null,"ConcurrentLinkedDeque",-1),W=n(" \uFF0C"),R=s("strong",null,"ExecutorService",-1),H=n(" \u548C "),U=s("strong",null,"ArrayBlockingQueue",-1),K=n(" \u3002\u9644\u5F55\uFF1A"),Q=n("\u5E76\u53D1\u5E95\u5C42\u539F\u7406 "),V=n(" \u6DB5\u76D6\u4E86\u5176\u4ED6\u4E00\u4E9B\u5185\u5BB9\uFF0C\u4F46\u662F\u4F60\u8FD8\u60F3\u63A2\u7D22 "),G=s("strong",null,"java.util.concurrent",-1),Z=n(" \u7684 Javadocs\u3002 \u4F46\u662F\u8981\u5C0F\u5FC3\uFF0C\u56E0\u4E3A\u67D0\u4E9B\u5E93\u7EC4\u4EF6\u5DF2\u88AB\u65B0\u7684\u66F4\u597D\u7684\u7EC4\u4EF6\u6240\u53D6\u4EE3\u3002"),X=s("h3",{id:"\u8003\u8651\u4E3A\u5E76\u53D1\u8BBE\u8BA1\u7684\u8BED\u8A00",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u8003\u8651\u4E3A\u5E76\u53D1\u8BBE\u8BA1\u7684\u8BED\u8A00","aria-hidden":"true"},"#"),n(" \u8003\u8651\u4E3A\u5E76\u53D1\u8BBE\u8BA1\u7684\u8BED\u8A00")],-1),Y=s("p",null,[n("\u901A\u5E38\uFF0C\u8BF7\u8C28\u614E\u5730\u4F7F\u7528\u5E76\u53D1\u3002 \u5982\u679C\u9700\u8981\u4F7F\u7528\u5B83\uFF0C\u8BF7\u5C1D\u8BD5\u4F7F\u7528\u6700\u73B0\u4EE3\u7684\u65B9\u6CD5\uFF1A\u5E76\u884C\u6D41\u6216 "),s("strong",null,"CompletableFutures"),n(" \u3002 \u8FD9\u4E9B\u529F\u80FD\u65E8\u5728\uFF08\u5047\u8BBE\u4F60\u4E0D\u5C1D\u8BD5\u5171\u4EAB\u5185\u5B58\uFF09\u4F7F\u4F60\u6446\u8131\u9EBB\u70E6\uFF08\u5728 Java \u7684\u4E16\u754C\u8303\u56F4\u5185\uFF09\u3002")],-1),$=s("p",null,"\u5982\u679C\u4F60\u7684\u5E76\u53D1\u95EE\u9898\u53D8\u5F97\u6BD4\u9AD8\u7EA7 Java \u6784\u9020\u6240\u652F\u6301\u7684\u95EE\u9898\u66F4\u5927\u4E14\u66F4\u590D\u6742\uFF0C\u8BF7\u8003\u8651\u4F7F\u7528\u4E13\u4E3A\u5E76\u53D1\u8BBE\u8BA1\u7684\u8BED\u8A00\uFF0C\u4EC5\u5728\u9700\u8981\u5E76\u53D1\u7684\u7A0B\u5E8F\u90E8\u5206\u4E2D\u4F7F\u7528\u8FD9\u79CD\u8BED\u8A00\u662F\u6709\u53EF\u80FD\u7684\u3002 \u5728\u64B0\u5199\u672C\u6587\u65F6\uFF0CJVM \u4E0A\u6700\u7EAF\u7CB9\u7684\u529F\u80FD\u8BED\u8A00\u662F Clojure\uFF08Lisp \u7684\u4E00\u79CD\u7248\u672C\uFF09\u548C Frege\uFF08Haskell \u7684\u4E00\u79CD\u5B9E\u73B0\uFF09\u3002\u8FD9\u4E9B\u4F7F\u4F60\u53EF\u4EE5\u5728\u5176\u4E2D\u7F16\u5199\u5E94\u7528\u7A0B\u5E8F\u7684\u5E76\u53D1\u90E8\u5206\u8BED\u8A00\uFF0C\u5E76\u901A\u8FC7 JVM \u8F7B\u677E\u5730\u4E0E\u4F60\u7684\u4E3B\u8981 Java \u4EE3\u7801\u8FDB\u884C\u4EA4\u4E92\u3002 \u6216\u8005\uFF0C\u4F60\u53EF\u4EE5\u9009\u62E9\u66F4\u590D\u6742\u7684\u65B9\u6CD5\uFF0C\u5373\u901A\u8FC7\u5916\u90E8\u529F\u80FD\u63A5\u53E3\uFF08FFI\uFF09\u5C06 JVM \u4E4B\u5916\u7684\u8BED\u8A00\u4E0E\u53E6\u4E00\u79CD\u4E3A\u5E76\u53D1\u8BBE\u8BA1\u7684\u8BED\u8A00\u8FDB\u884C\u901A\u4FE1\u3002[^11]",-1),nn=s("p",null,[n("\u4F60\u5F88\u5BB9\u6613\u88AB\u4E00\u79CD\u8BED\u8A00\u7ED1\u5B9A\uFF0C\u8FEB\u4F7F\u81EA\u5DF1\u5C1D\u8BD5\u4F7F\u7528\u8BE5\u8BED\u8A00\u6765\u505A\u6240\u6709\u4E8B\u60C5\u3002 \u4E00\u4E2A\u5E38\u89C1\u7684\u793A\u4F8B\u662F\u6784\u5EFA HTML / JavaScript \u7528\u6237\u754C\u9762\u3002 \u8FD9\u4E9B\u5DE5\u5177\u786E\u5B9E\u5F88\u96BE\u4F7F\u7528\uFF0C\u4EE4\u4EBA\u8BA8\u538C\uFF0C\u5E76\u4E14\u6709\u8BB8\u591A\u5E93\u5141\u8BB8\u4F60\u901A\u8FC7\u4F7F\u7528\u81EA\u5DF1\u559C\u6B22\u7684\u8BED\u8A00\u7F16\u5199\u4EE3\u7801\u6765\u751F\u6210\u8FD9\u4E9B\u5DE5\u5177\uFF08\u4F8B\u5982\uFF0C"),s("strong",null,"Scala.js"),n(" \u5141\u8BB8\u4F60\u5728 Scala \u4E2D\u5B8C\u6210\u4EE3\u7801\uFF09\u3002")],-1),sn=n("\u5FC3\u7406\u4E0A\u7684\u4FBF\u5229\u662F\u4E00\u4E2A\u5408\u7406\u7684\u8003\u8651\u56E0\u7D20\u3002 \u4F46\u662F\uFF0C\u6211\u5E0C\u671B\u6211\u5728\u672C\u7AE0\uFF08\u4EE5\u53CA\u9644\u5F55\uFF1A"),an=n("\u5E76\u53D1\u5E95\u5C42\u539F\u7406 "),pn=n("\uFF09\u4E2D\u5DF2\u7ECF\u8868\u660E Java \u5E76\u53D1\u662F\u4E00\u4E2A\u4F60\u53EF\u80FD\u65E0\u6CD5\u9003\u79BB\u5F88\u6DF1\u7684\u6D1E\u3002 \u4E0E Java \u8BED\u8A00\u7684\u4EFB\u4F55\u5176\u4ED6\u90E8\u5206\u76F8\u6BD4\uFF0C\u5728\u89C6\u89C9\u4E0A\u68C0\u67E5\u4EE3\u7801\u540C\u65F6\u8BB0\u4F4F\u6240\u6709\u9677\u9631\u6240\u9700\u8981\u7684\u7684\u77E5\u8BC6\u8981\u56F0\u96BE\u5F97\u591A\u3002"),tn=s("p",null,"\u65E0\u8BBA\u4F7F\u7528\u7279\u5B9A\u7684\u8BED\u8A00\u3001\u5E93\u4F7F\u5F97\u5E76\u53D1\u770B\u8D77\u6765\u591A\u4E48\u7B80\u5355\uFF0C\u90FD\u8981\u5C06\u5176\u89C6\u4E3A\u4E00\u79CD\u5996\u672F\uFF0C\u56E0\u4E3A\u603B\u662F\u6709\u4E1C\u897F\u4F1A\u5728\u4F60\u6700\u4E0D\u671F\u671B\u51FA\u73B0\u7684\u65F6\u5019\u54AC\u4F60\u3002",-1),en=s("h3",{id:"\u62D3\u5C55\u9605\u8BFB",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u62D3\u5C55\u9605\u8BFB","aria-hidden":"true"},"#"),n(" \u62D3\u5C55\u9605\u8BFB")],-1),on=s("p",null,[n("\u300AJava Concurrency in Practice\u300B\uFF0C\u51FA\u81EA Brian Goetz\uFF0CTim Peierls\uFF0C Joshua Bloch\uFF0CJoseph Bowbeer\uFF0CDavid Holmes \u548C Doug Lea (Addison Wesley\uFF0C2006 \u5E74)\u2014\u2014\u8FD9\u4E9B\u57FA\u672C\u4E0A\u5C31\u662F Java \u5E76\u53D1\u4E16\u754C\u4E2D\u7684\u540D\u4EBA\u540D\u5355\u4E86\u300AJava Concurrency in Practice\u300B\u7B2C\u4E8C\u7248\uFF0C\u51FA\u81EA Doug Lea (Addison-Wesley\uFF0C2000 \u5E74)\u3002\u5C3D\u7BA1\u8FD9\u672C\u4E66\u51FA\u7248\u65F6\u95F4\u8FDC\u8FDC\u65E9\u4E8E Java 5 \u53D1\u5E03\uFF0C\u4F46 Doug \u7684\u5927\u90E8\u5206\u5DE5\u4F5C\u90FD\u5199\u5165\u4E86 "),s("strong",null,"java.util.concurrent"),n(" \u5E93\u3002\u56E0\u6B64\uFF0C\u8FD9\u672C\u4E66\u5BF9\u4E8E\u5168\u9762\u7406\u89E3\u5E76\u53D1\u95EE\u9898\u81F3\u5173\u91CD\u8981\u3002 \u5B83\u8D85\u8D8A\u4E86 Java\uFF0C\u8BA8\u8BBA\u4E86\u8DE8\u8BED\u8A00\u548C\u6280\u672F\u7684\u5E76\u53D1\u7F16\u7A0B\u3002 \u5C3D\u7BA1\u5B83\u5728\u67D0\u4E9B\u5730\u65B9\u53EF\u80FD\u5F88\u949D\uFF0C\u4F46\u503C\u5F97\u591A\u6B21\u91CD\u8BFB\uFF08\u6700\u597D\u662F\u5728\u4E24\u4E2A\u6708\u4E4B\u95F4\u8FDB\u884C\u6D88\u5316\uFF09\u3002 \u9053\u683C\uFF08Doug\uFF09\u662F\u4E16\u754C\u4E0A\u4E3A\u6570\u4E0D\u591A\u7684\u771F\u6B63\u4E86\u89E3\u5E76\u53D1\u7F16\u7A0B\u7684\u4EBA\u4E4B\u4E00\uFF0C\u56E0\u6B64\u8FD9\u662F\u503C\u5F97\u7684\u3002")],-1),cn=s("p",null,[n("[^1]:\u4F8B\u5982,Eric-Raymond \u5728\u201CUnix \u7F16\u7A0B\u827A\u672F\u201D\uFF08Addison-Wesley\uFF0C2004\uFF09\u4E2D\u63D0\u51FA\u4E86\u4E00\u4E2A\u5F88\u597D\u7684\u6848\u4F8B\u3002 [^2]:\u53EF\u4EE5\u8BF4\uFF0C\u8BD5\u56FE\u5C06\u5E76\u53D1\u6027\u7528\u4E8E\u540E\u7EED\u8BED\u8A00\u662F\u4E00\u79CD\u6CE8\u5B9A\u8981\u5931\u8D25\u7684\u65B9\u6CD5\uFF0C\u4F46\u4F60\u5FC5\u987B\u5F97\u51FA\u81EA\u5DF1\u7684\u7ED3\u8BBA [^3]:\u6709\u4EBA\u8C08\u8BBA\u5728 Java\u2014\u201410 \u4E2D\u56F4\u7ED5\u6CDB\u578B\u505A\u4E00\u4E9B\u7C7B\u4F3C\u7684\u57FA\u672C\u6539\u8FDB\uFF0C\u8FD9\u5C06\u662F\u975E\u5E38\u4EE4\u4EBA\u96BE\u4EE5\u7F6E\u4FE1\u7684\u3002 [^4]:\u8FD9\u662F\u4E00\u79CD\u6709\u8DA3\u7684\uFF0C\u867D\u7136\u4E0D\u4E00\u81F4\u7684\u65B9\u6CD5\u3002\u901A\u5E38\uFF0C\u6211\u4EEC\u671F\u671B\u5728\u516C\u5171\u63A5\u53E3\u4E0A\u4F7F\u7528\u663E\u5F0F\u7C7B\u8868\u793A\u4E0D\u540C\u7684\u884C\u4E3A [^5]:\u4E0D\uFF0C\u6C38\u8FDC\u4E0D\u4F1A\u6709\u7EAF\u7CB9\u7684\u529F\u80FD\u6027 Java\u3002\u6211\u4EEC\u6240\u80FD\u671F\u671B\u7684\u6700\u597D\u7684\u662F\u4E00\u79CD\u5728 JVM \u4E0A\u8FD0\u884C\u7684\u5168\u65B0\u8BED\u8A00\u3002 [^6]:\u5F53\u4E24\u4E2A\u4EFB\u52A1\u80FD\u591F\u66F4\u6539\u5176\u72B6\u6001\u4EE5\u4F7F\u5B83\u4EEC\u4E0D\u4F1A\u88AB\u963B\u6B62\u4F46\u5B83\u4EEC\u4ECE\u672A\u53D6\u5F97\u4EFB\u4F55\u6709\u7528\u7684\u8FDB\u5C55\u65F6\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u4F7F\u7528\u6D3B\u52A8\u9501\u3002 [^7]: \u800C\u4E0D\u662F\u8D85\u7EBF\u7A0B\uFF1B\u901A\u5E38\u6BCF\u4E2A\u5185\u6838\u6709\u4E24\u4E2A\u8D85\u7EBF\u7A0B\uFF0C\u5E76\u4E14\u5728\u8BE2\u95EE\u5185\u6838\u6570\u91CF\u65F6\uFF0C\u672C\u4E66\u6240\u4F7F\u7528\u7684 Java \u7248\u672C\u4F1A\u62A5\u544A\u8D85\u7EBF\u7A0B\u7684\u6570\u91CF\u3002\u8D85\u7EBF\u7A0B\u4EA7\u751F\u4E86\u66F4\u5FEB\u7684\u4E0A\u4E0B\u6587\u5207\u6362\uFF0C\u4F46\u662F\u53EA\u6709\u5B9E\u9645\u7684\u5185\u6838\u624D\u771F\u7684\u5DE5\u4F5C\uFF0C\u800C\u4E0D\u662F\u8D85\u7EBF\u7A0B\u3002 \u21A9 [^8]: \u5E93\u5C31\u5728\u90A3\u91CC\u7528\u4E8E\u8C03\u7528\uFF0C\u800C\u8BED\u8A00\u672C\u8EAB\u5C31\u88AB\u8BBE\u8BA1\u7528\u4E8E\u6B64\u76EE\u7684\uFF0C\u4F46\u5B9E\u9645\u4E0A\u5B83\u5F88\u5C11\u53D1\u751F\uFF0C\u4EE5\u81F3\u4E8E\u53EF\u4EE5\u8BF4\u201D\u6CA1\u6709\u201C\u3002\u21A9 [^9]: \u4E3E\u4F8B\u6765\u8BF4\uFF0C\u5982\u679C\u6CA1\u6709 Flyweight \u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u5728\u5DE5\u7A0B\u4E2D\u521B\u5EFA\u6570\u767E\u4E07\u4E2A\u5BF9\u8C61\u7528\u4E8E\u6709\u9650\u5143\u5206\u6790\u53EF\u80FD\u5728 Java \u4E2D\u4E0D\u53EF\u884C\u3002\u21A9 [^10]: \u5728\u79D1\u5B66\u4E2D\uFF0C\u867D\u7136\u4ECE\u6765\u6CA1\u6709\u4E00\u79CD\u7406\u8BBA\u88AB\u8BC1\u5B9E\u8FC7\uFF0C\u4F46\u662F\u4E00\u79CD\u7406\u8BBA\u5FC5\u987B\u662F\u53EF\u8BC1\u4F2A\u7684\u624D\u6709\u610F\u4E49\u3002\u800C\u5BF9\u4E8E\u5E76\u53D1\u6027\uFF0C\u6211\u4EEC\u5927\u90E8\u5206\u65F6\u95F4\u751A\u81F3\u90FD\u65E0\u6CD5\u5F97\u5230\u8FD9\u79CD\u53EF\u8BC1\u4F2A\u6027\u3002\u21A9 [^11]: \u5C3D\u7BA1 "),s("strong",null,"Go"),n(" \u8BED\u8A00\u663E\u793A\u4E86 FFI \u7684\u524D\u666F\uFF0C\u4F46\u5728\u64B0\u5199\u672C\u6587\u65F6\uFF0C\u5B83\u5E76\u672A\u63D0\u4F9B\u8DE8\u6240\u6709\u5E73\u53F0\u7684\u89E3\u51B3\u65B9\u6848\u3002")],-1),ln=s("div",{style:{"page-break-after":"always"}},null,-1);function un(kn,rn){const a=c("RouterLink");return l(),i("div",null,[k,s("p",null,[r,p(a,{to:"/docs/reprint/onjava8/book/Appendix-Low-Level-Concurrency.html"},{default:t(()=>[d]),_:1}),v]),m,s("p",null,[b,p(a,{to:"/docs/reprint/onjava8/book/17-Files.html"},{default:t(()=>[g]),_:1}),w]),y,s("p",null,[f,p(a,{to:"/docs/reprint/onjava8/book/Appendix-Low-Level-Concurrency.html"},{default:t(()=>[h]),_:1}),x]),S,s("p",null,[C,j,E,p(a,{to:"/docs/reprint/onjava8/book/Appendix-Low-Level-Concurrency.html"},{default:t(()=>[P]),_:1}),z]),A,s("p",null,[T,p(a,{to:"/docs/reprint/onjava8/book/Appendix-Low-Level-Concurrency.html"},{default:t(()=>[F]),_:1}),q,D,_]),B,s("p",null,[I,L,O,J,N,M,W,R,H,U,K,p(a,{to:"/docs/reprint/onjava8/book/Appendix-Low-Level-Concurrency.html"},{default:t(()=>[Q]),_:1}),V,G,Z]),X,Y,$,nn,s("p",null,[sn,p(a,{to:"/docs/reprint/onjava8/book/Appendix-Low-Level-Concurrency.html"},{default:t(()=>[an]),_:1}),pn]),tn,en,on,cn,ln])}var vn=o(u,[["render",un],["__file","24-Concurrent-Programming.html.vue"]]);export{vn as default};
